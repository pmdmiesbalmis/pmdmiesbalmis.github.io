<!DOCTYPE html><html><head>
      <title>PMDM 2&#xBA; DAM  Tema 7. Fragments</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
      
      
      
      
      
      
      
      
      
      <style>
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}

/* highlight */
pre[data-line] {
  position: relative;
  padding: 1em 0 1em 3em;
}
pre[data-line] .line-highlight-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  background-color: transparent;
  display: block;
  width: 100%;
}

pre[data-line] .line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: hsla(24, 20%, 50%,.08);
  background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}

pre[data-line] .line-highlight:before, 
pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-start);
  position: absolute;
  top: .4em;
  left: .6em;
  min-width: 1em;
  padding: 0 .5em;
  background-color: hsla(24, 20%, 50%,.4);
  color: hsl(24, 20%, 95%);
  font: bold 65%/1.5 sans-serif;
  text-align: center;
  vertical-align: .3em;
  border-radius: 999px;
  text-shadow: none;
  box-shadow: 0 1px white;
}

pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-end);
  top: auto;
  bottom: .4em;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
.markdown-preview.markdown-preview {
  background-color: #FFFF;
}

      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview  ">
      <style>/* 
Añade 

@import "../EstilosPersonalizadosMarkdownEnhanced.less"

justo después del front matter 
*/
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
@font-face {
  font-family: 'Catamaran';
  font-style: normal;
  font-weight: 400;
  src: url(https://fonts.gstatic.com/s/catamaran/v17/o-0bIpQoyXQa2RxT7-5B6Ryxs2E_6n1iPHjd5a7dvg.ttf) format('truetype');
}
.contenedor {
  display: flex;
  justify-content: center;
  margin: 30px auto 30px auto;
}
.fondo {
  background: url(https://programacioniesbalmis.github.io/Imagenes/BannersMoodle/banner.png);
  background-size: cover;
  width: 75%;
  height: 160px;
  border-radius: 10px;
  position: relative;
}
.cita {
  font-family: Arial;
  font-style: italic;
  font-weight: 600;
  text-align: justify;
  line-height: 1.5rem;
  opacity: 0.6;
  color: white;
  padding: 5rem;
  position: relative;
  top: 50%;
  left: 50%;
  font-size: 1.3rem;
  transform: translate(-50%, -50%);
}
.abre_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-left: 30px;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, -15%);
}
.cierra_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-right: 30px;
  right: 0%;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, 55%);
}
.autor {
  font-family: Arial;
  color: white;
  margin: 0px;
  padding-left: 30px;
  position: absolute;
  top: 83%;
  font-size: 1rem;
}
</style>
<h1 class="mume-header undefined" id="apuntes">Apuntes</h1>

<p><a href="./tema7_Fragments_val.pdf">Descarregar aquests apunts </a></p>
<h1 class="mume-header undefined" id="tema-7-fragments">Tema 7. Fragments</h1>

<h2 class="mume-header undefined" id="%C3%ADndex">&#xCD;ndex</h2>

<ol>
<li><a href="#introducci%C3%B3">Introducci&#xF3;</a></li>
<li><a href="#cicle-de-vida-dun-fragment">Cicle de vida d&apos;un Fragment</a></li>
<li><a href="#subclasses-de-fragment">Subclasses de Fragment</a></li>
<li><a href="#crear-un-fragment">Crear un Fragment</a></li>
<li><a href="#agregar-un-fragment-a-una-activity">Agregar un Fragment a una Activity</a>
<ol>
<li><a href="#agregar-fragments-est%C3%A0tics">Agregar Fragments Est&#xE0;tics</a></li>
<li><a href="#agregar-fragment-din%C3%A0mic-amb-jetpack-navigation">Agregar Fragment Din&#xE0;mic amb Jetpack Navigation</a></li>
<li><a href="#gestionar-fragments-amb-jetpack-navigation">Gestionar Fragments amb Jetpack Navigation</a></li>
<li><a href="#exemple-de-navegaci%C3%B3-entre-tres-fragments-amb-jetpack-navigation">Exemple de navegaci&#xF3; entre tres fragments amb JetPack Navigation</a></li>
</ol>
</li>
<li><a href="#comunicar-fragments-i-activitys">Comunicar Fragments i Activitys</a>
<ol>
<li><a href="#comunicaci%C3%B3-mitjan%C3%A7ant-viewmodel">Comunicaci&#xF3; mitjan&#xE7;ant ViewModel</a></li>
<li><a href="#comunicaci%C3%B3-mitjan%C3%A7ant-interf%C3%ADcies">Comunicaci&#xF3; mitjan&#xE7;ant Interf&#xED;cies</a></li>
</ol>
</li>
<li><a href="#pila-dactivitats-i-fragmentmanager-ampliaci%C3%B3">Pila d&apos;activitats i FragmentManager [Ampliaci&#xF3;]</a>
<ol>
<li><a href="#tasks-i-backstacks">Tasks i BackStacks</a></li>
<li><a href="#fragmentmanager">FragmentManager</a></li>
<li><a href="#gestionar-fragments-amb-fragmentmanager">Gestionar Fragments amb FragmentManager</a></li>
</ol>
</li>
<li><a href="#dialogfragment">DialogFragment</a></li>
<li><a href="#vistes-lliscants-vistas-deslizantes-y-tabs">Vistes Lliscants (Vistas Deslizantes) y Tabs</a>
<ol>
<li><a href="#viewpager">ViewPager</a></li>
<li><a href="#tabslayout">TabsLayout</a></li>
</ol>
</li>
</ol>
<div style="page-break-after:always;"></div>
<h3 class="mume-header" id="introducci%C3%B3">Introducci&#xF3;</h3>

<p>La necessitat d&apos;usar fragments naix amb la versi&#xF3; 3.0 (API 11) d&apos;Android, a causa de les m&#xFA;ltiples grand&#xE0;ries de pantalla que estaven apareixent en el mercat i a la capacitat d&apos;orientaci&#xF3; de la interf&#xED;cie (Landscape i Portrait). Aquestes caracter&#xED;stiques necessitaven dotar a les aplicacions Android de la capacitat per a adaptar-se i respondre a la interf&#xED;cie d&apos;usuari sense importar el dispositiu.<br>
Un <a href="https://developer.android.com/guide/components/fragments?hl=es-419">fragment</a> &#xE9;s una secci&#xF3; <em>modular</em> d&apos;interf&#xED;cie d&apos;usuari embeguda dins d&apos;una activitat amfitriona, el qual permet versatilitat i optimitzaci&#xF3; de disseny. Es tracta de miniactivitats contingudes dins d&apos;una activitat amfitriona, manejant el seu propi disseny (un recurs layout propi) i cicle de vida.</p>
<div align="center">
    <img height="200" src="./imagenes/fragments1.png">
</div>
<p>Aquestes noves entitats permeten reusar codi i estalviar temps de disseny a l&apos;hora de desenvolupar una aplicaci&#xF3;. Els fragments faciliten el desplegament de les teues aplicacions en qualsevol mena de grand&#xE0;ria de pantalla i orientaci&#xF3;.<br>
Un altre avantatge d&apos;usar-los &#xE9;s que permeten crear dissenys d&apos;interf&#xED;cies d&apos;usuari de m&#xFA;ltiples vistes. Qu&#xE8; vol dir aix&#xF2;?, que <em><strong>els fragments s&#xF3;n imprescindibles per a generar activitats amb dissenys din&#xE0;mics</strong></em>, com per exemple l&apos;&#xFA;s de pestanyes de navegaci&#xF3;, expand and collapse, stacking, etc.</p>
<div align="center">
    <img height="200" src="./imagenes/fragments2.png">
</div>
<p>Un fragment s&apos;executa en el context d&apos;una activitat, per&#xF2; t&#xE9; el seu propi cicle de vida i en general la seua pr&#xF2;pia interf&#xED;cie d&apos;usuari, rep els seus propis esdeveniments d&apos;entrada, i es poden agregar o llevar mentre que l&apos;activitat existisca.<br>
<strong>Un fragment ha d&apos;estar sempre integrat en una activity</strong>, de manera que es veur&#xE0; afectat pel propi cicle de vida de la activity. Per exemple: <em>quan una activity es det&#xE9;, ho fan tots els fragments d&apos;aquesta; quan aquesta es destrueix, ho fan tamb&#xE9; tots els seus fragments. No obstant aix&#xF2;, mentre una activity est&#xE0; en execuci&#xF3;, es pot manipular cadascun dels fragments inclosos en ella de manera independent, tant afegint-los com eliminant-los</em>.</p>
<h3 class="mume-header" id="cicle-de-vida-dun-fragment">Cicle de vida d&apos;un Fragment</h3>

<p>La imatge de l&apos;esquerra representa el cicle de vida d&apos;un fragment. I la imatge de la dreta els estats dels seus m&#xE8;todes.</p>
<div align="center">
    <img height="500" src="./imagenes/fragments3.png">
</div>
<p>Generalment els m&#xE8;todes m&#xE9;s usats a l&apos;hora d&apos;implementar un fragment s&#xF3;n els seg&#xFC;ents:</p>
<ul>
<li><strong><code>onCreate()</code></strong>. El sistema crida a aquest m&#xE8;tode a l&apos;hora de crear el fragment. Normalment en ell, iniciarem els components essencials del fragment.</li>
<li><strong><code>onCreateView()</code></strong>. El sistema crida al m&#xE8;tode quan &#xE9;s l&apos;hora de crear la interf&#xED;cie d&apos;usuari o vista, &#xE9;s a dir, associar el layout al fragment, normalment es retorna la view del fragment.</li>
<li><strong><code>onPause()</code></strong>. El sistema cridara a aquest m&#xE8;tode en el moment que l&apos;usuari abandone el fragment, per tant &#xE9;s un bon moment per a guardar informaci&#xF3;.</li>
</ul>
<p>Encara que en el cicle de vida ens trobem amb els seg&#xFC;ents m&#xE8;todes callback, relacionats amb el cicle de vida d&apos;una activitat. Esbrinem una mica sobre ells:</p>
<ul>
<li><strong><code>onAttach():</code></strong>. &#xC9;s invocat quan el fragment ha sigut associat a l&apos;activitat amfitriona.</li>
<li><strong><code>onActiviyCreated()</code></strong>. S&apos;executa quan l&apos;activitat amfitriona ja ha acabat l&apos;execuci&#xF3; del seu m&#xE8;tode <em>onCreate()</em>.</li>
<li><strong><code>onCreate()</code></strong>. Aquest m&#xE8;tode &#xE9;s anomenat quan el fragment s&apos;est&#xE0; creant. En el pots inicialitzar tots els components.</li>
<li><strong><code>onCreateView()</code></strong>. Es diu quan el fragment ser&#xE0; dibuixat per primera vegada en la interf&#xED;cie d&apos;usuari. En aquest m&#xE8;tode crearem el view que representa al fragment per a retornar-lo cap a l&apos;activitat.</li>
<li><strong><code>onStart()</code></strong>. Es diu quan el fragment aquesta visible davant l&apos;usuari. &#xD2;bviament dep&#xE9;n del m&#xE8;tode <em>onStart()</em> de l&apos;activitat.</li>
<li><strong><code>onResume()</code></strong>. &#xC9;s executat quan el fragment est&#xE0; actiu i interactuant amb l&apos;usuari. Aquesta situaci&#xF3; dep&#xE9;n del fet que l&apos;activitat amfitriona estiga primer en el seu estat Resume.</li>
<li><strong><code>onStop()</code></strong>. Es diu quan un fragment ja no &#xE9;s visible per a l&apos;usuari pel fet que l&apos;activitat amfitriona est&#xE0; detinguda o perqu&#xE8; dins de l&apos;activitat s&apos;est&#xE0; gestionant una operaci&#xF3; de fragments.</li>
<li><strong><code>onPause()</code></strong>. Igual que les activitats, onPause s&apos;executa quan es detecta que l&apos;usuari va dirigir el focus per fora del fragment.</li>
<li><strong><code>onDestroyView()</code></strong>. Aquest m&#xE8;tode &#xE9;s anomenat quan la jerarquia de views a la qual ha sigut associat el fragment ha sigut destru&#xEF;da.</li>
<li><strong><code>onDetach()</code></strong>. Es diu quan el fragment ja no est&#xE0; associat a l&apos;activitat amfitriona.</li>
</ul>
<h3 class="mume-header" id="subclasses-de-fragment">Subclasses de Fragment</h3>

<p>A part de crear un Fragment directament, Android ens ofereix la possibilitat d&apos;utilitzar les seg&#xFC;ents subclasses de Fragment, d&apos;aquestes subclasses parlarem posteriorment</p>
<ul>
<li>DialogFragment - Mostra un quadre de dialogue flotant.</li>
<li>ListFragment - Mostra una llista d&apos;elements.</li>
<li>PreferenceFragment - Mostra una llista de prefer&#xE8;ncies.</li>
</ul>
<h3 class="mume-header" id="crear-un-fragment">Crear un Fragment</h3>

<p>Per a crear un fragment primer haurem d&apos;estendre la classe <strong><code>Fragment</code></strong> i sobreescriure el m&#xE8;tode <strong><code>onCreateView()</code></strong> en el qual retornarem la vista d&apos;aquest fragment. Veurem l&apos;exemple i l&apos;expliquem a continuaci&#xF3;.</p>
<h5 class="mume-header" id="fragmentunokt">FragmentUNO.kt</h5>

<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-class">class</span> FragmentUno<span class="token operator">:</span> <span class="token function">Fragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreateView</span><span class="token punctuation">(</span>
        inflater<span class="token operator">:</span> LayoutInflater<span class="token punctuation">,</span>
        container<span class="token operator">:</span> ViewGroup<span class="token operator">?</span><span class="token punctuation">,</span>
        savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> View<span class="token operator">?</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> inflater<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>fragment_uno<span class="token punctuation">,</span>container<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><blockquote>
<p>&#x1F4CC; En sobreescriure el m&#xE8;tode <strong><code>onCreateView()</code></strong> podem observar que de s&#xE8;rie ens dona la possibilitat d&apos;utilitzar un LayoutInflater, un ViewGroup i un Bundle. El LayoutInflater normalment ho utilitzarem per a unflar el layout del nostre fragment. El ViewGroup ser&#xE0; la vista pare on s&apos;inserira el layout del nostre fragment. I finalment el Bundle podrem utilitzar-ho per a recuperar dades d&apos;una inst&#xE0;ncia anterior del nostre fragment.<br>
D&apos;aquesta manera ja tindrem creat un fragment que ens retornar&#xE0; una vista i que podrem inserir en qualsevol activity del nostre projecte.</p>
</blockquote>
<blockquote>
<p>&#x270B; Si es vol usar Binding amb Fragments, informate del seu &#xFA;s en el seg&#xFC;ent enlla&#xE7;, <a href="https://developer.android.com/topic/libraries/view-binding?hl=es-419#fragments">vincular vistes</a></p>
</blockquote>
<blockquote>
<p>&#x270B; Comentar que pr&#xE8;viament s&apos;ha creat el layout per a aquest fragment i es correspon amb <strong><code>fragment_un.xml</code></strong>.</p>
<pre data-role="codeBlock" data-info="xml" class="language-xml"><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#CC00CC00<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>
      <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Informaci&#xF3;n fragment1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">&gt;</span></span>
</pre></blockquote>
<div style="page-break-after:always;"></div>
<h3 class="mume-header" id="agregar-un-fragment-a-una-activity">Agregar un Fragment a una Activity</h3>

<p>A l&apos;hora d&apos;agregar un fragment a una activitat el podrem realitzar de dues maneres:</p>
<ol>
<li>Declarar el fragment en el layout de la activity. Aquest fragment tindr&#xE0; la qualitat de no ser eliminat o substitu&#xEF;t per res, en cas contrari tindrem errors. Se li dona el nom de <strong>fragment est&#xE0;tic o final</strong>.</li>
<li>Agregar directament el Fragment mitjan&#xE7;ant programaci&#xF3; Android. Aquest s&#xED; que es podr&#xE0; eliminar o substituir per un altre fragment o un altre contingut. <strong>Se&apos;ls dona el nom de fragment din&#xE0;mic</strong>.</li>
</ol>
<h4 class="mume-header" id="agregar-fragments-est%C3%A0tics">Agregar Fragments Est&#xE0;tics</h4>

<p>El primer que hem de fer &#xE9;s crear el layout de nostra activity especificant un element fragment.</p>
<h5 class="mume-header" id="activity_mainxml">activity_main.xml</h5>

<pre data-role="codeBlock" data-info="xml" class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>horizontal<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.fragment.app.FragmentContainerView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/fragment_uno<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.ejemplos.b3.ejemplofragmentv1.FragmentUno<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_weight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.5<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.fragment.app.FragmentContainerView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/fragment_dos<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.ejemplos.b3.ejemplofragmentv1.FragmentDos<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_weight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.5<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">&gt;</span></span>
</pre><blockquote>
<p>&#x1F4CC; Simplement creem l&apos;element <a href="https://developer.android.com/reference/androidx/fragment/app/fragmentcontainerview">FragmentContainerView</a> i especifiquem a trav&#xE9;s de l&apos;atribut <strong><code>android:name</code></strong> la ubicaci&#xF3; del nostre fragment (nom de paquet on est&#xE0; situat el fragment). FragmentContainerView &#xE9;s un contenidor personalitzat per a Fragments que est&#xE9;n de FrameLayout, per la qual cosa maneja les transaccions de manera m&#xE9;s fiable.<br>
&#xC9;s recomanable crear un identificador &#xFA;nic per a cada fragment, que ens pot servir per a restaurar fragments o fins i tot per a realitzar transaccions o eliminaci&#xF3; d&apos;aquests.<br>
Una vegada creat el layout de la activity simplement creem una activitat i li apliquem el m&#xE8;tode <strong><code>setContentView()</code></strong> indicant el id del layout que acabem de crear. El resultat pot ser el seg&#xFC;ent, tenint en compte que s&apos;ha d&apos;afegir la classe FragmentDos similar a la FragmentUno:</p>
</blockquote>
<div align="center">
    <img height="200" src="./imagenes/fragments4.png">
</div>
<p><span style="color: DarkRed; font-weight: bold;">&#x2712;&#xFE0F;Crea una App FragmentEstatico, per a provar els fragments est&#xE0;tics de l&apos;exemple anterior</span></p>
<h4 class="mume-header" id="agregar-fragment-din%C3%A0mic-amb-jetpack-navigation">Agregar Fragment Din&#xE0;mic amb Jetpack Navigation</h4>

<p>Els fragments din&#xE0;mics, &#xE9;s a dir els fragments que es poden afegir a l&apos;activitat en qualsevol moment, es poden gestionar de dos maneres:</p>
<ol>
<li>Usant <strong>JetPack Navigation</strong>, que aporta senzillesa a esta tasca.</li>
<li>Usant <strong>FragmentManager</strong> i la pila d&apos;activitats. Afegit posteriorment en el tema com a concepte d&apos;ampliaci&#xF3;.</li>
</ol>
<p>Majorit&#xE0;riament usarem Jetpack Navigation, per la qual cosa necessitarem saber com es realitzen estos passos</p>
<h5 class="mume-header" id="jetpack-navigation">Jetpack Navigation</h5>

<p>El component <a href="https://developer.android.com/guide/navigation/navigation-getting-started#add-navhost">Navigation</a> d&apos;Android Jetpack, permet implementar la navegaci&#xF3; dels elements de l&apos;aplicaci&#xF3; de forma m&#xE9;s coherent i senzilla, des de simples clics de botons fins a patrons m&#xE9;s complexos, com les barres d&apos;apps i els panells laterals de navegaci&#xF3;. &#xC9;s important seguir el sistema establit de <a href="https://developer.android.com/guide/navigation/navigation-principles">principis</a>, perqu&#xE8; l&apos;usuari puga entendre correctament el funcionament de l&apos;app. Podem trobar tres elements fonamentals:</p>
<ul>
<li><strong>Gr&#xE1;fico de navegaci&#xF3;n</strong>: &#xC9;s un recurs XML que cont&#xE9; tota la informaci&#xF3; relacionada amb la navegaci&#xF3;.</li>
<li><strong>NavHost</strong>: &#xC9;s un contenidor buit que mostra els destins del teu gr&#xE0;fic de navegaci&#xF3;. Per defecte est&#xE0; implementat el <strong><code>NavHostFragment</code></strong> per a fragments i que ser&#xE0; el que usem.</li>
<li><strong>NavController</strong>: &#xC9;s l&apos;objecte que administra la navegaci&#xF3; de l&apos;app dins d&apos;un NavHost</li>
</ul>
<blockquote>
<p>&#x270B;Ser&#xE1; important decidir com volem passar d&apos;uns fragments a altres, <strong>porque el que no s&apos;ha de fer &#xE9;s mesclar el sistema de Navigation amb el que usem amb FragmentManager</strong>.</p>
</blockquote>
<h5 class="mume-header" id="navhost">NavHost</h5>

<p>En l&apos;exemple ampliarem la versi&#xF3; anterior agregant un fragment din&#xE0;mic junt amb a l&apos;est&#xE0;tic. Ens crearem una classe per al fragment2, semblant a l&apos;anterior i un layout per a gestionar l&apos;aspecte. Despr&#xE9;s definirem en el layout un espai on poder afegir el fragment din&#xE0;mic, i que es correspondr&#xE0; amb el <strong><code>NavHost</code></strong>, per a aix&#xF2; usarem el contenidor <strong><code>FragmentContainerView</code></strong> amb id <em>fragment_container</em> i caldr&#xE0; afegir els atributs seg&#xFC;ents:&quot;</p>
<pre data-role="codeBlock" data-info="xml{highlight=[15-24,17,18,19]}" class="language-xml" data-line="15-24,17,18,19"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/tools<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>horizontal<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">tools:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>.MainActivity<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.fragment.app.FragmentContainerView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.ejemplo.b7.myapplication.FragmentUno<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/fragment_uno<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_weight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.5<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">tools:</span>layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@layout/fragment_uno<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.fragment.app.FragmentContainerView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/fragment_container<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>androidx.navigation.fragment.NavHostFragment<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>defaultNavHost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>navGraph</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@navigation/nav_graf<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_weight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.5<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#3355CC00<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>androidx.fragment.app.FragmentContainerView</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">&gt;</span></span>
<div class="line-highlight-wrapper">













<div aria-hidden="true" class="line-highlight" data-range="15-24" data-start="15" data-end="24">









</div></div><div class="line-highlight-wrapper">















<div aria-hidden="true" class="line-highlight" data-range="17" data-start="17">
</div></div><div class="line-highlight-wrapper">
















<div aria-hidden="true" class="line-highlight" data-range="18" data-start="18">
</div></div><div class="line-highlight-wrapper">

















<div aria-hidden="true" class="line-highlight" data-range="19" data-start="19">
</div></div></pre><blockquote>
<p>&#x1F4CC; el espacio para insertar los fragmentes esta definido entre las <strong>L&#xEC;neas 15 a 24</strong>, los atributos nuevos que se tienen que poner para el funcionamiento correcto son: el nombre asignado a la clase <strong>L&#xED;nea 17</strong>, se usa el <strong><code>NavHostFragment</code></strong> que ya est&#xE1; implementado; <strong>L&#xED;nea 18</strong>, el atributo <strong><code>defaultNavHost</code></strong> garantiza que tu <strong><code>NavHostFragment</code></strong> intercepte el bot&#xF3;n Atr&#xE1;s del sistema; En el <strong>navGraph</strong> se indica el nombre del gr&#xE1;fico de navegaci&#xF3;n. Elemento que vamos a explicar ahora <strong>L&#xED;nea 19</strong>.</p>
</blockquote>
<p>&#x1F4CC; l&apos;espai per a insertar els fragmentes esta definit entre les <strong>L&#xEC;neas 15 a 24</strong>, els atributs nous que s&apos;han de posar per al funcionament correcte s&#xF3;n: el nom assignat a la classe <strong>L&#xED;nea 17</strong>, s&apos;usa el <strong><code>NavHostFragment</code></strong> que ja est&#xE0; implementat; <strong>L&#xED;nea 18</strong>, l&apos;atribut <strong><code>defaultNavHost</code></strong> garantix que el teu <strong><code>NavHostFragment</code></strong> intercepte el bot&#xF3; Arrere del sistema; En el <strong>navGraph</strong> s&apos;indica el nom del gr&#xE0;fic de navegaci&#xF3;. Element que explicarem ara <strong>L&#xED;nea 19</strong>.</p>
<h5 class="mume-header" id="navgraph">NavGraph</h5>

<p>Per a crear el <strong><code>NavGraph</code></strong> hem de crear un nou recurs de tipus navigation <em><strong>res-&gt;new-&gt;android resource file</strong></em>.</p>
<div align="center">
    <img height="200" src="./imagenes/navigation1.png">
</div>
<p>Al fer a&#xE7;&#xF2; es crear&#xE0; una nova carpeta navigation amb el recurs dins d&apos;ella. L&apos;arxiu <em>.xml</em> es podr&#xE0; treballar de forma gr&#xE0;fica o per mitj&#xE0; de codi, encara que en este cas &#xE9;s m&#xE9;s senzill utilitzar la part visual. Podrem afegir els elements pels quals volem que navegue l&apos;app i crear les accions entre ells, tot &#xE9;s molt visual i senzill.</p>
<div align="center">
    <img height="150
    " src="./imagenes/navigation3.png">
</div>
<p>Podem veure que en la part del Host s&apos;ha afegit l&apos;element <strong>NavHost</strong> al crear el contenidor de fragments com hem explicat anteriorment (enlla&#xE7;ant, <em>per nombre</em>, amb el recurs en la l&#xED;nia <strong><code>app:navGraph=@navigation/navegacion_fragments</code></strong>) . Si no es crea correctament el Host no funcionaran les accions. Per a afegir <strong>elements</strong> polsarem el s&#xED;mbol de <strong><code>+</code></strong> i seleccionarem de la llista d&apos;elements navegables que tinguem en l&apos;app.</p>
<div align="center">
    <img height="200
    " src="./imagenes/navigation4.png">
</div>
<p><span style="color: DarkRed; font-weight: bold;">&#x2712;&#xFE0F;Crea una App fragmentV1, per a provar l&apos;exemple anterior, el fragment1 ser&#xE0; est&#xE0;tic mentres que el fragment2 ser&#xE0; afegit de forma din&#xE0;mica des del codi</span></p>
<h4 class="mume-header" id="gestionar-fragments-amb-jetpack-navigation">Gestionar Fragments amb Jetpack Navigation</h4>

<p>Una vegada agregats els elements, podem afegir les <strong>accions</strong> entre ells, que ens permetran gestionar la c&#xE0;rrega dels distints fragments en els contenidors. Per a aix&#xF2; crearem un altre exemple que tindr&#xE0; un contenidor per als fragments (usarem els dos fragments de l&apos;exemple anterior), i un bot&#xF3; que ens permetr&#xE0; l&apos;acci&#xF3; de canvi entre ells</p>
<pre data-role="codeBlock" data-info="xml" class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FrameLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/tools<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.fragment.app.FragmentContainerView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>androidx.navigation.fragment.NavHostFragment<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>defaultNavHost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>navGraph</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@navigation/nav_graf<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/fragment_container<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>androidx.fragment.app.FragmentContainerView</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_margin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>20dp<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/boton<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>CAMBIAR<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>center|bottom<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>FrameLayout</span><span class="token punctuation">&gt;</span></span>
</pre><p>Despr&#xE9;s de crear el xml, haurem d&apos;afegir els dos fragments al gr&#xE0;fic de navegaci&#xF3;, quedant de la manera seg&#xFC;ent:</p>
<div align="center">
    <img height="200" src="./imagenes/navigation8.png">
</div>
<p>El pas seg&#xFC;ent ser&#xE0; el d&apos;afegir l&apos;acci&#xF3;, per a afegir les accions haurem de seleccionar un element i arrossegar l&apos;acci&#xF3; al seg&#xFC;ent. Una altra manera seria indicant, d&apos;entre els elements afegits en el gr&#xE0;fic, el dest&#xED; on ens portar&#xE0; eixa acci&#xF3;, l&apos;aneu de l&apos;acci&#xF3; es crega autom&#xE0;ticament i s&apos;usar&#xE0; posteriorment en el codi.</p>
<div align="center">
    <img height="100
    " src="./imagenes/navigation5.png">
</div>
<p>Hi ha un tipus de <strong>acciones globales</strong> que permeten arribar a un dest&#xED; des de qualsevol lloc. Es mostren com una <strong><code>-&gt;</code></strong> curta enlla&#xE7;ada nom&#xE9;s pel dest&#xED;, i que es creen per mitj&#xE0; del men&#xFA; contextual del dest&#xED; seleccionat.</p>
<div align="center">
    <img height="200
    " src="./imagenes/navigation6.png">
</div>
<p>En el nostre exemple haurem de crear dos accions que ens porten d&apos;un fragment a l&apos;altre, com en la imatge seg&#xFC;ent:</p>
<div align="center">
    <img height="200
    " src="./imagenes/navigation9.png">
</div>
<p>Si polsem diverses vegades el bot&#xF3; s&apos;anir&#xE0; canviant entre fragments, el problema que ens trobarem al polsar l&apos;obci&#xF3;n <strong><code>Back</code></strong> del dispositiu &#xE9;s que deurem de passar per totes les transaccions realitzades fins a arribar al final d&apos;estes. Per a aix&#xF2; haurem de fer el seg&#xFC;ent:</p>
<blockquote>
<p>&#x270B; Quan estem creant el gr&#xE0;fic de navegaci&#xF3; podem optar per perfeccionar les accions perqu&#xE8; a l&apos;oc&#xF3;rrer estes i botar a un lloc concret, es desapilen els elements intermedis innecessaris. A&#xE7;&#xF2; evitar&#xE0; que al polsar el <strong><code>backPressed</code></strong>, es passe per cada un dels fragments apilats en les distintes accions. Per a aix&#xF2; nom&#xE9;s hem d&apos;anar a la propietat <strong>Pop Behavior</strong> de l&apos;acci&#xF3; desitjada, i indicar en <strong>popUpTo</strong> fins que element es vol desapilar, amb <strong>popUpToInclusive</strong> a true, indiquem que tamb&#xE9; es desapile eixe element.</p>
</blockquote>
<div align="center">
    <img height="80
    " src="./imagenes/navigation7.png">
</div>
<p>Encara que podem realitzar tota l&apos;operaci&#xF3; usant el dissenyador de Navigation este t&#xE9; el codi xml associat, en el cas del nostre exemple el codi associat al <strong><code>nav_graf.xml</code></strong> seria el seg&#xFC;ent:</p>
<pre data-role="codeBlock" data-info="xml" class="language-xml"><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>navigation</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/nav_graf<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">app:</span>startDestination</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@id/fragmentUno<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fragment</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/fragmentUno<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.ejemplo.b7.ejemplofragmentv2.FragmentUno<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>FragmentUno<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span>
            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/action_fragmentUno_to_fragmentDos2<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">app:</span>destination</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@id/fragmentDos<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">app:</span>popUpToInclusive</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fragment</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fragment</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/fragmentDos<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.ejemplo.b7.ejemplofragmentv2.FragmentDos<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>FragmentDos<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span>
            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/action_fragmentDos_to_fragmentUno<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">app:</span>destination</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@id/fragmentUno<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">app:</span>popUpTo</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@id/fragmentUno<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">app:</span>popUpToInclusive</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fragment</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>navigation</span><span class="token punctuation">&gt;</span></span>
</pre><h5 class="mume-header" id="navcontroller">NavController</h5>

<p>Este element ja el usarem de forma program&#xE0;tica i &#xE9;s el que ens permet executar les accions que hem creat amb el <strong><code>NavGraph</code></strong>. Cada <strong><code>NavHost</code></strong> t&#xE9; el seu propi <a href="https://developer.android.com/guide/navigation/navigation-navigate">NavController</a> corresponent. Com s&apos;explica en la documentaci&#xF3; oficial, hi ha diverses formes de fer-ho. Per exemple <strong>desde una activity</strong> i resolent el codi del nostre exemple ho podr&#xED;em fer de la manera seg&#xFC;ent:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
      <span class="token function">setContentView</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span>
      findViewById<span class="token operator">&lt;</span>Button<span class="token operator">&gt;</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>boton<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-val">val</span> navHostFragment<span class="token operator">=</span> supportFragmentManager<span class="token punctuation">.</span>
                            <span class="token function">findFragmentById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>fragment_container<span class="token punctuation">)</span> <span class="token keyword keyword-as">as</span> NavHostFragment
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>navHostFragment<span class="token punctuation">.</span>navController<span class="token punctuation">.</span>currentDestination<span class="token operator">?</span><span class="token punctuation">.</span>id <span class="token operator">==</span> R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>fragmentUno<span class="token punctuation">)</span>
                  navHostFragment<span class="token punctuation">.</span>navController<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>action_fragmentUno_to_fragmentDos2<span class="token punctuation">)</span>
              <span class="token keyword keyword-else">else</span> navHostFragment<span class="token punctuation">.</span>navController<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>action_fragmentDos_to_fragmentUno<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</pre><blockquote>
<p>&#x1F4CC; Primer usem una de les maneres existents per a referenciar al <strong><code>NavController</code></strong> per a aix&#xF2; creem un objecte <strong><code>NavHostFragment</code></strong> identificant-ho amb l&apos;id del contenidor dels fragments. Abans de navegar a una acci&#xF3;, &#xE9;s interessant comprovar si estem en el fragment que t&#xE9; creada eixa acci&#xF3;, d&apos;esta manera evitarem excepcions. Finalment, navegarem al fragment desitjat usant el <strong><code>id</code></strong> de l&apos;acci&#xF3; registrada amb anterioritat. <em>L&#xF3;gicamente, este codi ho tindrem d&apos;afegir al bot&#xF3; o un altre element que vullguem que execute la navegaci&#xF3;</em>.</p>
</blockquote>
<p>Si la navegaci&#xF3; la fem <strong>de un fragment a altre</strong>, el codi &#xE9;s molt paregut, encara que en este cas l&apos;objecte creat &#xE9;s el NavController a partir de referenciar-ho amb el NavHostFragment per defecte, que c&#xE0;rrega el fragment.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-val">val</span> navController<span class="token operator">=</span> NavHostFragment<span class="token punctuation">.</span><span class="token function">findNavController</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>navController<span class="token punctuation">.</span>currentDestination<span class="token operator">?</span><span class="token punctuation">.</span>id <span class="token operator">==</span> R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>fragment1<span class="token punctuation">)</span>
            navController<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>action_fragment1_to_fragment2<span class="token punctuation">)</span>
</pre><blockquote>
<p>&#x270B; NavController tamb&#xE9; permet <a href="https://developer.android.com/guide/navigation/navigation-pass-data#bundle">pasar dades entre fragment per mitj&#xE0; de bundle</a>, el proc&#xE9;s &#xE9;s semblant a l&apos;usat en altres explicacions.</p>
</blockquote>
<p><span style="color: DarkRed; font-weight: bold;">&#x2712;&#xFE0F;Prueba l&apos;anterior exemple FragmentV2: bot&#xF3; que et vaja carregant l&apos;un o l&apos;altre fragment i alhora que s&apos;acumulen en la pila. Provar que al polsar el bot&#xF3; de retroc&#xE9;s, es passa per cada un dels fragments que s&apos;han carregat anteriorment. I realitza el que &#xE9;s necessari perqu&#xE8; no haja de passar per tots els fragments al polsar Back</span></p>
<h4 class="mume-header" id="exemple-de-navegaci%C3%B3-entre-tres-fragments-amb-jetpack-navigation">Exemple de navegaci&#xF3; entre tres fragments amb JetPack Navigation</h4>

<blockquote>
<p>&#x1F393; Mostrarem el codi d&apos;una activitat amb tres fragments de manera que: del primer es puga navegar al segon, del segon al tercer i del tercer al primer sempre que es polse el <strong>bot&#xF3;n aceptar</strong>, mentres que si es polsa el <strong>bot&#xF3;n cancelar</strong> es navegar&#xE0; sempre al primer (la navegaci&#xF3; al primer es realitzar&#xE0; amb una acci&#xF3; global) . Per a aix&#xF2; s&apos;hauran de construir els <em>.xml</em> dels Fragments, tots seran iguals, canviant el color i el text. Codi <strong>fragment1.xml</strong> amb dos botons <em>cancelar i aceptar</em>:</p>
<pre data-role="codeBlock" data-info="xml" class="language-xml"><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/&gt;res/android<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertical<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#2196F3<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>center<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>textSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>20dp<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Fragment1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>horizontal<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.google.android.material.button.MaterialButton</span>
           <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/aceptar<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name"><span class="token namespace">android:</span>layout_weight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.5<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name"><span class="token namespace">android:</span>backgroundTint</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#2196F3<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Aceptar<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.google.android.material.button.MaterialButton</span>
           <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name"><span class="token namespace">android:</span>layout_weight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.5<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name"><span class="token namespace">android:</span>backgroundTint</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#2196F3<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Cancelar<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/cancelar<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">&gt;</span></span>
</pre></blockquote>
<blockquote>
<p>El <em>.xml</em> de l&apos;activitat principal ser&#xE0; com el que hem posat al principi de l&apos;explicaci&#xF3; de <strong><code>Navigation</code></strong>. Mentres que <strong>MainActivity.kt</strong> tendr&#xE1; el seguent c&#xF3;dig:</p>
</blockquote>
<blockquote>
<pre data-role="codeBlock" data-info="kotlin{highlight=[6,11,12]}" class="language-kotlin" data-line="6,11,12"><span class="token keyword keyword-class">class</span> MainActivity <span class="token operator">:</span> <span class="token function">AppCompatActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> navHostFragment<span class="token operator">:</span>NavHostFragment
   <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
       <span class="token function">setContentView</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span>
       navHostFragment <span class="token operator">=</span> supportFragmentManager<span class="token punctuation">.</span>
          <span class="token function">findFragmentById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>contenedor<span class="token punctuation">)</span> <span class="token keyword keyword-as">as</span> NavHostFragment
   <span class="token punctuation">}</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">cancelar</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-val">val</span> navController <span class="token operator">=</span> navHostFragment<span class="token punctuation">.</span>navController
        navController<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>action_global_fragment1<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<div class="line-highlight-wrapper">




<div aria-hidden="true" class="line-highlight" data-range="6" data-start="6">
</div></div><div class="line-highlight-wrapper">









<div aria-hidden="true" class="line-highlight" data-range="11" data-start="11">
</div></div><div class="line-highlight-wrapper">










<div aria-hidden="true" class="line-highlight" data-range="12" data-start="12">
</div></div></pre><p>&#x1F4CC; S&apos;ha creat un m&#xE8;tode <strong>cancelar</strong> que permet executar l&apos;acci&#xF3; global, s&apos;ha fet d&apos;esta manera per a no repetir codi en els fragments i de pas con&#xE9;ixer com s&apos;executa una acci&#xF3; des de la main. <strong>L&#xED;nea 6</strong>, creem la inst&#xE0;ncia del <strong><code>NavHostFragment</code></strong>. <strong>L&#xED;nea 11 i 12</strong> instanciem el <strong><code>NavController</code></strong> i executem l&apos;acci&#xF3; global de navegaci&#xF3; al Fragment1.</p>
<p>El <strong>Fragment1.kt</strong> i per tant, la resta de Fragments. Amb el bot&#xF3; <strong>aceptar</strong> que realitzar&#xE0; l&apos;acci&#xF3; de moure&apos;s al seg&#xFC;ent fragment (en Fragment3 ser&#xE0; la global de moure&apos;s al fragment1) i el bot&#xF3; <strong>cancelar</strong> que llan&#xE7;ar&#xE0; l&apos;acci&#xF3; global.</p>
<pre data-role="codeBlock" data-info="kotlin{highlight=[8,10]}" class="language-kotlin" data-line="8,10"><span class="token keyword keyword-class">class</span> Fragment1<span class="token operator">:</span> <span class="token function">Fragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreateView</span><span class="token punctuation">(</span>
       inflater<span class="token operator">:</span> LayoutInflater<span class="token punctuation">,</span>
       container<span class="token operator">:</span> ViewGroup<span class="token operator">?</span><span class="token punctuation">,</span>
       savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span>
   <span class="token punctuation">)</span><span class="token operator">:</span> View<span class="token operator">?</span> <span class="token punctuation">{</span>
       <span class="token keyword keyword-val">val</span> view<span class="token operator">=</span>inflater<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>fragment1<span class="token punctuation">,</span>container<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span>
       view<span class="token punctuation">.</span><span class="token function">findViewByIdMaterialButton</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>aceptar<span class="token punctuation">)</span><span class="token punctuation">.</span>
                setOnClickListener <span class="token punctuation">{</span> <span class="token function">aceptar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
       view<span class="token punctuation">.</span><span class="token function">findViewByIdMaterialButton</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>cancelar<span class="token punctuation">)</span><span class="token punctuation">.</span>
                setOnClickListener<span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token function">requireActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-as">as</span> MainActivity<span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">cancelar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
       <span class="token keyword keyword-return">return</span> view
<span class="token punctuation">}</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">aceptar</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> navController<span class="token operator">=</span> NavHostFragment<span class="token punctuation">.</span><span class="token function">findNavController</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>navController<span class="token punctuation">.</span>currentDestination<span class="token operator">?</span><span class="token punctuation">.</span>id <span class="token operator">==</span> R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>fragment1<span class="token punctuation">)</span>
         navController<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>action_fragment1_to_fragment2<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<div class="line-highlight-wrapper">






<div aria-hidden="true" class="line-highlight" data-range="8" data-start="8">
</div></div><div class="line-highlight-wrapper">








<div aria-hidden="true" class="line-highlight" data-range="10" data-start="10">
</div></div></pre><p>&#x1F4CC; <strong>L&#xED;nea 9</strong> acci&#xF3; del bot&#xF3; acceptar que invoca al m&#xE8;tode acceptar que executa l&apos;acci&#xF3; de navegaci&#xF3;. <strong>L&#xED;nea 10</strong> acci&#xF3; del bot&#xF3; cancel&#xB7;lar que invocar al m&#xE8;tode cancel&#xB7;lar de MainActivity, realitzant un cast del context.</p>
</blockquote>
<p><span style="color: DarkRed; font-weight: bold;">&#x2712;&#xFE0F; A partir del codi exposat en l&apos;exemple anterior, crea l&apos;exercici complet. Recorda que has de fer funcionar les accions de navegaci&#xF3; creant un recurs de tipus navigation.</span></p>
<div style="page-break-after:always;"></div>
<div style="page-break-after:always;"></div>
<h3 class="mume-header" id="comunicar-fragments-i-activitys">Comunicar Fragments i Activitys</h3>

<p>Quan parlem sobre <a href="https://developer.android.com/training/basics/fragments/communicating?hl=es">la comunicaci&#xF3; de fragments</a>, hem de tindre en compte les seg&#xFC;ents premisses:</p>
<ul>
<li>Els fragments no poden ni deuen comunicar-se directament.</li>
<li>La comunicaci&#xF3; entre fragments ha de fer-se a trav&#xE9;s dels associats activity.</li>
<li>Els fragments no necessiten con&#xE9;ixer qui &#xE9;s la seua activitat principal.</li>
</ul>
<p>A partir de l&apos;anterior, podem deduir que dos objectes Fragment mai han de comunicar-se directament. Hi ha diverses maneres de realitzar la comunicaci&#xF3; entre aquests, per&#xF2; estudiarem les dues m&#xE9;s recomanades. Aquestes dues formes s&#xF3;n: mitjan&#xE7;ant la <strong>implementaci&#xF3; d&apos;una interface</strong> o mitjan&#xE7;ant un element <strong>ViewModel</strong>.</p>
<span style="align: center; font-size: 7pt">
<table align="center">
<tbody><tr>
<td>
<div align="center">
    <img height="220" src="./imagenes/fragments5.png">
  </div>
   <div align="center"> Comunicaci&#xF3;n mediante Interface</div>
</td>
<td>
<div align="center">
    <img height="220" src="./imagenes/fragments6.png">
</div>
   <div align="center">Comunicaci&#xF3;n mediante ViewModel</div>
</td>
</tr>
</tbody></table>
</span>
<h4 class="mume-header" id="comunicaci%C3%B3-mitjan%C3%A7ant-viewmodel">Comunicaci&#xF3; mitjan&#xE7;ant ViewModel</h4>

<p><a href="https://developer.android.com/guide/fragments/communicate?hl=es-419#viewmodel">ViewModel</a>. &#xE9;s una de les noves incorporacions a la implementaci&#xF3; d&apos;Android i la que google recomana per a la comunicaci&#xF3; entre fragments.<br>
Un ViewModel sempre es crea en associaci&#xF3; amb un &#xE0;mbit (un fragment o una activitat) i es conservar&#xE0; mentre l&apos;&#xE0;mbit estiga actiu. Per exemple, si &#xE9;s una Activitat, fins que s&apos;acabe. En altres paraules, aix&#xF2; significa que un ViewModel no es destruir&#xE0; si el seu propietari es destrueix per un canvi de configuraci&#xF3; (per exemple, rotaci&#xF3;). La nova inst&#xE0;ncia del propietari es tornar&#xE0; a connectar al ViewModel existent.</p>
<p>El seg&#xFC;ent pas ser&#xE0; crear una classe que derive de ViewModel semblant a la seg&#xFC;ent, i tenint en compte que tipus de dades volem passar entre els fragments, en aquest cas un String encara que podria ser un objecte o fins i tot col&#xB7;leccions d&apos;aquests:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-class">class</span> ItemViewModel <span class="token operator">:</span> <span class="token function">ViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> liveData<span class="token operator">=</span>MutableLiveData<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
        <span class="token keyword keyword-val">val</span> getItem<span class="token operator">:</span> LiveData<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> liveData
        <span class="token keyword keyword-fun">fun</span> <span class="token function">setItem</span><span class="token punctuation">(</span>item<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           liveData<span class="token punctuation">.</span>value <span class="token operator">=</span> item
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><blockquote>
<p>&#x1F4CC;Com podem veure en el codi anterior, apareix un element nou per a exposar les dades que l&apos;hem anomenat liveData de tipus <strong><code>MutableLiveData</code></strong> que al seu torn est&#xE9;n de <strong><code>LiveData</code></strong>, aquest element &#xE9;s un titular de dades que &#xE9;s capa&#xE7; de ser observat per a enviar nom&#xE9;s actualitzacions de dades quan el seu observador est&#xE0; actiu, pot contindre qualsevol tipus de dades, i a m&#xE9;s d&apos;aix&#xF2;, &#xE9;s conscient del cicle de vida per a manar les actualitzacions de dades solament si l&apos;observador est&#xE0; actiu.<br>
Per a observar un element <a href="https://developer.android.com/topic/libraries/architecture/livedata?hl=es-419">LiveData</a>, tenim la classe <strong><code>Observer</code></strong>, que a trav&#xE9;s del seu objecte podrem saber si est&#xE0; en estat actiu (el seu cicle de vida est&#xE0; en l&apos;estat STARTED o RESUMED) o inactiu (en qualsevol altre cas). LiveData nom&#xE9;s notifica als observadors actius sobre les actualitzacions.</p>
</blockquote>
<blockquote>
<p>&#x1F393; Suposarem un exemple senzill en el qual, usant el ViewModel mostrat amb anterioritat, en una activity es carreguen dues fragments alhora i es realitza <strong>la comunicaci&#xF3; entre els dos fragments</strong>. Un tindr&#xE0; un EditText per a introduir un valor i un bot&#xF3;, en l&apos;altre es mostrar&#xE0; el contingut del EditText en pr&#xE9;mer el bot&#xF3;. Per a aix&#xF2; haurem de crear dues classe Fragments, una que ser&#xE0; el detall <strong>FragmentSecundario</strong> i que nom&#xE9;s tindr&#xE0; un text i una classe <strong>FragmentPrimario</strong> que tindr&#xE0; els elements necessaris. El resultat ser&#xE0; semblant al seg&#xFC;ent:</p>
<div align="center">
   <img height="200" src="./imagenes/fragments7.png">
</div>
</blockquote>
<div style="page-break-after:always;"></div>
<blockquote>
<p>El layout del fragment primari podria ser, <strong>fragment_primario.xml</strong>:</p>
<pre data-role="codeBlock" data-info="xml" class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertical<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>center<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EditText</span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>hint</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Introduce Texto a pasar<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/texto<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Mandar<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/boton<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">&gt;</span></span>
</pre><p>El layout del fragment detalle podria ser, <strong>fragment_secundario.xml</strong>:</p>
<pre data-role="codeBlock" data-info="xml" class="language-xml"><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#247f9e<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>
       <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>TEXTO<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/texto<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">&gt;</span></span>

</pre></blockquote>
<div style="page-break-after:always;"></div>
<blockquote>
<p>El layout de l&apos;activitat principal, <strong>activity_main.xml:</strong></p>
<pre data-role="codeBlock" data-info="xml" class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/tools<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>horizontal<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.fragment.app.FragmentContainerView</span>
       <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.ejemplo.b7.ejemplofragmentv3viewmodelfacil.FragmentPrimario<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/fragment_uno<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>200dp<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.fragment.app.FragmentContainerView</span>
       <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.ejemplo.b7.ejemplofragmentv3viewmodelfacil.FragmentSecundario<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/fragment_dos<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>200dp<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>androidx.fragment.app.FragmentContainerView</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">&gt;</span></span>
</pre><p>L&apos;activitat principal amb la c&#xE0;rrega dels dos fragments podria quedar aix&#xED;, <strong>MainActivity.kt</strong>:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-class">class</span> MainActivity <span class="token operator">:</span> <span class="token function">AppCompatActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
       <span class="token function">setContentView</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span>
       <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre></blockquote>
<div style="page-break-after:always;"></div>
<blockquote>
<p>El Fragment primari podria ser com el que segueix, <strong>FragmentPrimario.kt</strong>:</p>
<pre data-role="codeBlock" data-info="kotlin{highlight=[2,8,12]}" class="language-kotlin" data-line="2,8,12"><span class="token keyword keyword-class">class</span> FragmentPrimario <span class="token operator">:</span> <span class="token function">Fragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> model<span class="token operator">:</span>ItemViewModel <span class="token keyword keyword-by">by</span> <span class="token function">activityViewModels</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreateView</span><span class="token punctuation">(</span>
       inflater<span class="token operator">:</span> LayoutInflater<span class="token punctuation">,</span>
       container<span class="token operator">:</span> ViewGroup<span class="token operator">?</span><span class="token punctuation">,</span>
       saveInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span>
   <span class="token punctuation">)</span><span class="token operator">:</span> View<span class="token operator">?</span> 
<span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> view<span class="token operator">:</span> View <span class="token operator">=</span> inflater<span class="token punctuation">.</span><span class="token function">inflate</span>
             <span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>fragment_primario<span class="token punctuation">,</span> container<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
             view<span class="token punctuation">.</span>findViewById<span class="token operator">&lt;</span>Button<span class="token operator">&gt;</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>boton<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">{</span>
             model<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token function">requireActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                   findViewById<span class="token operator">&lt;</span>EditText<span class="token operator">&gt;</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>texto<span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
             <span class="token punctuation">}</span>
     <span class="token keyword keyword-return">return</span> view
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<div class="line-highlight-wrapper">
<div aria-hidden="true" class="line-highlight" data-range="2" data-start="2">
</div></div><div class="line-highlight-wrapper">






<div aria-hidden="true" class="line-highlight" data-range="8" data-start="8">
</div></div><div class="line-highlight-wrapper">










<div aria-hidden="true" class="line-highlight" data-range="12" data-start="12">
</div></div></pre><p>&#x1F4CC; <strong>L&#xED;nia 2</strong> es crea una propietat del <strong><code>ViewModel</code></strong> creat amb anterioritat, utilitzant el delegat <strong><code>activityViewModels</code></strong> per a obtindre una refer&#xE8;ncia al ViewModel en l&apos;&#xE0;mbit de la seua activitat i que es puga compartir entre les diferents vistes o fragments, mentre el cicle de vida ho permeta. Per a poder incloure aquest delegat, s&apos;ha d&apos;afegir la seg&#xFC;ent depend&#xE8;ncia (hui dia):</p>
<pre data-role="codeBlock" data-info="groovy" class="language-groovy">implementation <span class="token string">&quot;androidx.activity:activity-ktx:1.4.0&quot;</span>
implementation <span class="token string">&quot;androidx.fragment:fragment-ktx:1.4.1&quot;</span>
</pre><p><strong>L&#xED;nia 12</strong>, quan es prema el bot&#xF3; es modificar&#xE0; el valor del LiveData amb la informaci&#xF3; del editext</p>
<div style="page-break-after:always;"></div>
<p>El Fragment amb el detall, <strong>FragmentSecundario.kt</strong>:</p>
<pre data-role="codeBlock" data-info="kotlin{highlight=[2,9,11]}" class="language-kotlin" data-line="2,9,11"><span class="token keyword keyword-class">class</span> FragmentSecundario<span class="token operator">:</span><span class="token function">Fragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> model<span class="token operator">:</span>ItemViewModel <span class="token keyword keyword-by">by</span> <span class="token function">activityViewModels</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreateView</span><span class="token punctuation">(</span>
       inflater<span class="token operator">:</span> LayoutInflater<span class="token punctuation">,</span>
       container<span class="token operator">:</span> ViewGroup<span class="token operator">?</span><span class="token punctuation">,</span>
       saveInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> View<span class="token operator">?</span> <span class="token punctuation">{</span>
       <span class="token keyword keyword-val">val</span> view<span class="token operator">:</span> View <span class="token operator">=</span> inflater<span class="token punctuation">.</span><span class="token function">inflate</span>
                <span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>fragment_secundario<span class="token punctuation">,</span> container<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
       <span class="token keyword keyword-val">val</span> nameObserver <span class="token operator">=</span> Observer<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">{</span>cadena <span class="token operator">-&gt;</span>
               view<span class="token punctuation">.</span>findViewById<span class="token operator">&lt;</span>TextView<span class="token operator">&gt;</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>texto<span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token operator">=</span>cadena<span class="token punctuation">}</span>
       model<span class="token punctuation">.</span>getItem<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token function">requireActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nameObserver<span class="token punctuation">)</span>
       <span class="token keyword keyword-return">return</span> view
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<div class="line-highlight-wrapper">
<div aria-hidden="true" class="line-highlight" data-range="2" data-start="2">
</div></div><div class="line-highlight-wrapper">







<div aria-hidden="true" class="line-highlight" data-range="9" data-start="9">
</div></div><div class="line-highlight-wrapper">









<div aria-hidden="true" class="line-highlight" data-range="11" data-start="11">
</div></div></pre><p>&#x1F4CC; Instanciem el ViewModel <strong>L&#xED;nia 2</strong>, Creem el manejador amb la funcionalitat d&apos;assignar al TextView el text que est&#xE0; sent observat <strong>L&#xED;nia 9</strong>. <strong>L&#xED;nia 11</strong> s&apos;assigna al delegat observe el manejador creat amb anterioritat.</p>
</blockquote>
<blockquote>
<p>&#x1F393;Codificarem una altra vegada aquest cas, per&#xF2; amb un xicotet canvi que ens valdr&#xE0; per a presentar un element nou <a href="https://developer.android.com/reference/kotlin/androidx/fragment/app/listfragment">ListFragment</a>, per a aix&#xF2; el <strong>FragmentPrimario</strong> passarem a cridar-ho <strong>MyListFragment</strong> que heretar&#xE0; <strong><code>ListFragment</code></strong> i que a causa d&apos;aix&#xF2; no necessita tindre associat un xml. El resultat ser&#xE0; semblant al seg&#xFC;ent:</p>
<div align="center">
   <img height="200" src="./imagenes/fragments7v2.png">
</div>
<div style="page-break-after:always;"></div>
<p>En l&apos;&#xFA;nica classe que haurem de fer canvis &#xE9;s en la nova classe que ara es veur&#xE0; aix&#xED; <strong>MyListFragment.kt</strong>:</p>
<pre data-role="codeBlock" data-info="kotlin{highlight=[1,2,8,[11-15],14]}" class="language-kotlin" data-line="1,2,8,11-15,14"><span class="token keyword keyword-class">class</span> MyListFragment<span class="token operator">:</span> <span class="token function">ListFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> model<span class="token operator">:</span>ItemViewModel <span class="token keyword keyword-by">by</span> <span class="token function">activityViewModels</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> valores <span class="token operator">=</span>
             arrayOf<span class="token operator">&lt;</span>String<span class="token operator">?</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">&quot;item1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;item2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;item3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;item4&quot;</span><span class="token punctuation">,</span>
                               <span class="token string">&quot;item5&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;item6&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;item7&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;item8&quot;</span><span class="token punctuation">)</span>
   <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
       listAdapter <span class="token operator">=</span> ArrayAdapter<span class="token operator">&lt;</span>Any<span class="token operator">?</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token function">requireActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
                     android<span class="token punctuation">.</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>simple_list_item_1<span class="token punctuation">,</span> valores<span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
   <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onListItemClick</span><span class="token punctuation">(</span>l<span class="token operator">:</span> ListView<span class="token punctuation">,</span> v<span class="token operator">:</span> View<span class="token punctuation">,</span>
                                   position<span class="token operator">:</span> Int<span class="token punctuation">,</span> id<span class="token operator">:</span> Long<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onListItemClick</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> v<span class="token punctuation">,</span> position<span class="token punctuation">,</span> id<span class="token punctuation">)</span>
       valores<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span> model<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<div class="line-highlight-wrapper"><div aria-hidden="true" class="line-highlight" data-range="1" data-start="1">
</div></div><div class="line-highlight-wrapper">
<div aria-hidden="true" class="line-highlight" data-range="2" data-start="2">
</div></div><div class="line-highlight-wrapper">






<div aria-hidden="true" class="line-highlight" data-range="8" data-start="8">
</div></div><div class="line-highlight-wrapper">









<div aria-hidden="true" class="line-highlight" data-range="11-15" data-start="11" data-end="15">




</div></div><div class="line-highlight-wrapper">












<div aria-hidden="true" class="line-highlight" data-range="14" data-start="14">
</div></div></pre><p>&#x1F4CC;<strong>L&#xED;nia 1</strong> en aquest cas veiem que el fragment hereta de <strong><code>ListFragment</code></strong> en comptes de <strong><code>Fragment</code></strong>, aix&#xF2; permet que el fragment estiga format per una llista d&apos;elements i que no s&apos;haja de crear cap vista espec&#xED;fica per a ell. Per a associar els elements a la llista, haurem de crear un <strong><code>ArrayAdapter</code></strong> indicant els valors i el layout d&apos;eixida (predefinit en els recursos d&apos;Android) <strong>L&#xED;nia 8</strong> (Aquest element es veur&#xE0; m&#xE9;s extensament en temes posteriors). <strong>L&#xED;nia d&apos;11 a 15</strong>, aquesta sobrec&#xE0;rrega del m&#xE8;tode <strong><code>onListItemClick</code></strong> est&#xE0; associada a la pulsaci&#xF3; de qualsevol element de la llista, entrant com a par&#xE0;metres la vista i la posici&#xF3; de l&apos;element premut. <strong>L&#xED;nia 2</strong> es crea una propietat del <strong><code>ViewModel</code></strong> creat amb anterioritat, utilitzant el delegat <strong><code>activityViewModels</code></strong> per a obtindre una refer&#xE8;ncia al ViewModel en l&apos;&#xE0;mbit de la seua activitat i que es puga compartir entre les diferents vistes o fragments, mentre el cicle de vida ho permeta</p>
</blockquote>
<div style="page-break-after:always;"></div>
<blockquote>
<p>&#x1F393; Un altre cas diferent, podem tindre&apos;l quan <strong>el fragment es comunica a trav&#xE9;s de la activity</strong>, mitjan&#xE7;ant el ViewModel. Suposarem, el cas m&#xE9;s com&#xFA; en el qual unisca activity carregar&#xE0; una llista i en pr&#xE9;mer un element d&apos;aquesta es carrega l&apos;altre fragment. El layout del <strong>fragment_secundari.xml</strong> i <strong>MyListFragment.kt</strong> tindran el mateix codi que per a l&apos;anterior exemple.</p>
<p>El layout de l&apos;activitat principal ara nom&#xE9;s tindr&#xE0; un contenidor, <strong>activity_main.xml:</strong></p>
<pre data-role="codeBlock" data-info="xml" class="language-xml"><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.fragment.app.FragmentContainerView</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span>
<span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/contenedor_fragment<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/tools<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>androidx.navigation.fragment.NavHostFragment<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">app:</span>defaultNavHost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">app:</span>navGraph</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@navigation/nav_graf<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">tools:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>.MainActivity<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>androidx.fragment.app.FragmentContainerView</span><span class="token punctuation">&gt;</span></span>
</pre><p>L&apos;activitat principal amb la c&#xE0;rrega del fragment amb la llista i amb l&apos;observador sobre el ViewModel, quedar&#xE0; aix&#xED;  <strong>MainActivity.kt</strong>:</p>
<pre data-role="codeBlock" data-info="kotlin{highlight=[2,[6-15],14]}" class="language-kotlin" data-line="2,6-15,14"><span class="token keyword keyword-class">class</span> MainActivity <span class="token operator">:</span> <span class="token function">AppCompatActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> model<span class="token operator">:</span> ItemViewModel <span class="token keyword keyword-by">by</span> <span class="token function">viewModels</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
       <span class="token function">setContentView</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span>
       <span class="token keyword keyword-val">val</span> nameObserver <span class="token operator">=</span> Observer<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">{</span>cadena <span class="token operator">-&gt;</span>
          <span class="token keyword keyword-val">val</span> bundle<span class="token operator">=</span><span class="token function">Bundle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          bundle<span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span><span class="token string">&quot;DATO&quot;</span><span class="token punctuation">,</span>cadena<span class="token punctuation">)</span>
          <span class="token keyword keyword-var">var</span> navHostFragment <span class="token operator">=</span> supportFragmentManager<span class="token punctuation">.</span>
                <span class="token function">findFragmentById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>contenedor_fragment<span class="token punctuation">)</span> <span class="token keyword keyword-as">as</span> NavHostFragment
          <span class="token keyword keyword-val">val</span> navController <span class="token operator">=</span> navHostFragment<span class="token punctuation">.</span>navController
          <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>navController<span class="token punctuation">.</span>currentDestination<span class="token operator">?</span><span class="token punctuation">.</span>id <span class="token operator">==</span> R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>myListFragment<span class="token punctuation">)</span>
            navController<span class="token punctuation">.</span>
             <span class="token function">navigate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>action_myListFragment_to_fragmentSecundario<span class="token punctuation">,</span> bundle<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      model<span class="token punctuation">.</span>getItem<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">,</span> nameObserver<span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<div class="line-highlight-wrapper">
<div aria-hidden="true" class="line-highlight" data-range="2" data-start="2">
</div></div><div class="line-highlight-wrapper">




<div aria-hidden="true" class="line-highlight" data-range="6-15" data-start="6" data-end="15">









</div></div><div class="line-highlight-wrapper">












<div aria-hidden="true" class="line-highlight" data-range="14" data-start="14">
</div></div></pre><p>&#x1F4CC;<strong>L&#xED;nia 2</strong>, instanciem el ViewModel tenint en compte que per a l&apos;activitat s&apos;associa el delegat <strong><code>viewModels</code></strong>. En el bloc des de la <strong>L&#xED;nia 6 fins a la 15</strong>, constru&#xEF;m un delegat amb l&apos;observador que s&apos;encarregar&#xE0; de carregar el FragmentSecundario amb la informaci&#xF3; passada en un Bundle. <strong>L&#xED;nia 14</strong>, es posa en observaci&#xF3; el ViewModel amb el delegat constru&#xEF;t anteriorment.</p>
<p>En el <strong>FragmentSecundario.kt</strong> s&apos;haur&#xE0; de recuperar el bundle per a poder modificar el TextView amb la dada de l&apos;element premut.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-class">class</span> FragmentSecundario<span class="token operator">:</span><span class="token function">Fragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreateView</span><span class="token punctuation">(</span>
       inflater<span class="token operator">:</span> LayoutInflater<span class="token punctuation">,</span>
       container<span class="token operator">:</span> ViewGroup<span class="token operator">?</span><span class="token punctuation">,</span>
       saveInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span>
   <span class="token punctuation">)</span><span class="token operator">:</span> View<span class="token operator">?</span> <span class="token punctuation">{</span>
       <span class="token keyword keyword-val">val</span> bundle<span class="token operator">=</span>arguments
       <span class="token keyword keyword-val">val</span> view<span class="token operator">:</span> View <span class="token operator">=</span> inflater<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>fragment_secundario<span class="token punctuation">,</span>
                                         container<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
       view<span class="token punctuation">.</span>findViewById<span class="token operator">&lt;</span>TextView<span class="token operator">&gt;</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>texto<span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token operator">=</span>
                                   bundle<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;DATO&quot;</span><span class="token punctuation">)</span>
       <span class="token keyword keyword-return">return</span> view
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre></blockquote>
<p><span style="color: DarkRed; font-weight: bold;">&#x2712;&#xFE0F;Amb la informaci&#xF3; que es passa en els tres casos d&apos;estudi, reconstrueix i prova aquests casos afegint el codi que falte. </span></p>
<h4 class="mume-header" id="comunicaci%C3%B3-mitjan%C3%A7ant-interf%C3%ADcies">Comunicaci&#xF3; mitjan&#xE7;ant Interf&#xED;cies</h4>

<p>La <a href="https://developer.android.com/training/basics/fragments/communicating?hl=es#DefineInterface">implementaci&#xF3; d&apos;una interf&#xED;cie</a>, &#xE9;s l&apos;altra manera correcta per a passar informaci&#xF3; i controlar algun esdeveniment. Es tracta de crear una interf&#xED;cie en el fragment i exigir a la activity que la implemente. D&apos;aquesta manera quan el fragment reba un esdeveniment tamb&#xE9; el far&#xE0; la activity, que s&apos;encarregara de rebre les dades d&apos;aqueix esdeveniment i compartir-los amb altres fragments.</p>
<blockquote>
<p>&#x1F393; Per a aix&#xF2; tornarem a implementar l&apos;&#xFA;ltim exemple. &#xC9;s a dir l&apos;aplicaci&#xF3; que comen&#xE7;a amb el fragment de la llista, i que carrega un altre que mostra el text de l&apos;element premut. En aquest cas solament haurem de modificar el codi de la classe principal i del fragmente de la llista, &#xE9;s resta quedar&#xE0; igual.<br>
Primer crearem la interf&#xED;cie amb el m&#xE8;tode que necessitem, <strong>PasoCadenaInterface.kt</strong></p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-interface">interface</span> PasoCadenaInterface <span class="token punctuation">{</span>
   <span class="token keyword keyword-fun">fun</span> <span class="token function">informacionCadena</span><span class="token punctuation">(</span>dato<span class="token operator">:</span>String<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</pre><p>L&apos;activitat principal <strong>MainActivity.kt</strong>:</p>
<pre data-role="codeBlock" data-info="kotlin{highlight=[0,[5-14]]}" class="language-kotlin" data-line="0,5-14"><span class="token keyword keyword-class">class</span> MainActivity <span class="token operator">:</span> <span class="token function">AppCompatActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> PasoCadenaInterface <span class="token punctuation">{</span>
   <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
       <span class="token function">setContentView</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
   <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">informacionCadena</span><span class="token punctuation">(</span>dato<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword keyword-val">val</span> bundle<span class="token operator">=</span><span class="token function">Bundle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       bundle<span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span><span class="token string">&quot;DATO&quot;</span><span class="token punctuation">,</span>dato<span class="token punctuation">)</span>
       <span class="token keyword keyword-var">var</span> navHostFragment <span class="token operator">=</span> supportFragmentManager<span class="token punctuation">.</span><span class="token function">findFragmentById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>contenedor_fragment<span class="token punctuation">)</span> <span class="token keyword keyword-as">as</span> NavHostFragment
       <span class="token keyword keyword-val">val</span> navController <span class="token operator">=</span> navHostFragment<span class="token punctuation">.</span>navController
       <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>navController<span class="token punctuation">.</span>currentDestination<span class="token operator">?</span><span class="token punctuation">.</span>id <span class="token operator">==</span> R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>myListFragment<span class="token punctuation">)</span>
           navController<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>action_myListFragment_to_fragmentSecundario<span class="token punctuation">,</span> bundle<span class="token punctuation">)</span>

   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<div class="line-highlight-wrapper"><div aria-hidden="true" class="line-highlight" data-range="0" data-start="0">
</div></div><div class="line-highlight-wrapper">



<div aria-hidden="true" class="line-highlight" data-range="5-14" data-start="5" data-end="14">









</div></div></pre><p>&#x1F4CC;<strong>L&#xED;nia 0</strong> obliguem al fet que l&apos;activitat implemente la interf&#xED;cie. <strong>L&#xED;nia 5 a 14</strong>, m&#xE8;tode de la interf&#xED;cie al qual li arriba la dada que manarem al fragment secundari.</p>
<p>Fragment amb la llista, <strong>MyListFragment.kt</strong>:</p>
<pre data-role="codeBlock" data-info="kotlin{highlight=[2,14, [17-20]]}" class="language-kotlin" data-line="2,14,17-20"><span class="token keyword keyword-class">class</span> MyListFragment<span class="token operator">:</span> <span class="token function">ListFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> pasoCadenaInterface<span class="token operator">:</span>PasoCadenaInterface
   <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> valores <span class="token operator">=</span>
             arrayOf<span class="token operator">&lt;</span>String<span class="token operator">?</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">&quot;item1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;item2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;item3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;item4&quot;</span><span class="token punctuation">,</span> 
                           <span class="token string">&quot;item5&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;item6&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;item7&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;item8&quot;</span><span class="token punctuation">)</span>
   <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
       listAdapter <span class="token operator">=</span> ArrayAdapter<span class="token operator">&lt;</span>Any<span class="token operator">?</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token function">requireActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                       android<span class="token punctuation">.</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>simple_list_item_1<span class="token punctuation">,</span> valores<span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
   <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onListItemClick</span><span class="token punctuation">(</span>l<span class="token operator">:</span> ListView<span class="token punctuation">,</span> v<span class="token operator">:</span> View<span class="token punctuation">,</span> 
                                position<span class="token operator">:</span> Int<span class="token punctuation">,</span> id<span class="token operator">:</span> Long<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onListItemClick</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> v<span class="token punctuation">,</span> position<span class="token punctuation">,</span> id<span class="token punctuation">)</span>
       valores<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token operator">?</span>
                 <span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span> pasoCadenaInterface<span class="token punctuation">.</span><span class="token function">informacionCadena</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onAttach</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onAttach</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>
       pasoCadenaInterface<span class="token operator">=</span>context <span class="token keyword keyword-as">as</span> PasoCadenaInterface
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<div class="line-highlight-wrapper">
<div aria-hidden="true" class="line-highlight" data-range="2" data-start="2">
</div></div><div class="line-highlight-wrapper">












<div aria-hidden="true" class="line-highlight" data-range="14" data-start="14">
</div></div><div class="line-highlight-wrapper">















<div aria-hidden="true" class="line-highlight" data-range="17-20" data-start="17" data-end="20">



</div></div></pre><p>&#x1F4CC; <strong>L&#xED;nia 2</strong> es crea una inst&#xE0;ncia de la interface. <strong>L&#xED;nia des de 17 a 20</strong> s&apos;anula el m&#xE8;tode <strong><code>onAttach</code></strong> que &#xE9;s invocat en el moment que el fragment s&apos;enlla&#xE7;a en l&apos;activitat, en aquest m&#xE8;tode assignem el context d&apos;entrada a la inst&#xE0;ncia de la interface creada. <strong>L&#xED;nia 14</strong> amb l&apos;objecte de la interface cridem al seu m&#xE8;tode passant el valor de l&apos;element premut.</p>
</blockquote>
<p><span style="color: DarkRed; font-weight: bold;">&#x2712;&#xFE0F;Reconstrueix l&apos;exemple anterior i prova el seu funcionament</span></p>
<div style="page-break-after:always;"></div>
<h3 class="mume-header" id="pila-dactivitats-i-fragmentmanager-ampliaci%C3%B3">Pila d&apos;activitats i FragmentManager [Ampliaci&#xF3;]</h3>

<h4 class="mume-header" id="tasks-i-backstacks">Tasks i BackStacks</h4>

<p>Una <a href="https://developer.android.com/guide/components/activities/tasks-and-back-stack">tasca</a> &#xE9;s una col&#xB7;lecci&#xF3; de metadades i informaci&#xF3; entorn a un pila d&apos;activitats. Quan iniciem una app el sistema busca si aqueixa tasca ja ha sigut iniciada pr&#xE8;viament i en aqueix cas la repr&#xE9;n i tornar exactament al punt on estava. Si no existeix la tasca la inicia, llan&#xE7;ant l&apos;activitat principal com a base en la <strong>pila de tasques</strong>.</p>
<p>Cada vegada que s&apos;inicia una activitat o es realitza una transacci&#xF3; de fragment afegint la transici&#xF3; a la pila <strong><code>addToBackStack()</code></strong>, s&apos;afig aqueixa activitat/fragment a la tasca el que fa que l&apos;activitat que queda per davall es pause o es detinga si la nova activitat oculta per complet l&apos;anterior.</p>
<div align="center">
    <img height="200" src="./imagenes/tareas1.png">
</div>
<p>El bot&#xF3; de retorn est&#xE0; directament associat a la pila d&apos;activitats. Quan es pressiona aquest bot&#xF3;, s&apos;elimina un fragment o activitat de la pila es restaura l&apos;immediatament inferior en aquesta. La repetici&#xF3; del <strong>BackPressed</strong> eliminar&#xE0; totes les activitats fins que no quede cap i es destru&#xEF;sca l&apos;aplicaci&#xF3; (tasca).</p>
<div align="center">
    <img height="200" src="./imagenes/tareas2.png">
</div>
<h5 class="mume-header" id="gestionar-tasques-program%C3%A0ticament">Gestionar Tasques Program&#xE0;ticament</h5>

<p>Existeixen casos espec&#xED;fics on requerirem manipular la forma en qu&#xE8; una activitat &#xE9;s apilada o retirada en la back stack d&apos;una tasca. El framework ens proveeix atributs del Manifest per a aquesta fi, amb <strong><code>launchMode</code></strong> podrem especificar la manera de llan&#xE7;ament d&apos;una activitat, els seus possibles valors s&#xF3;n els seg&#xFC;ents: <strong><code>standard, singleTop, singleTask i singleInstance</code></strong>, per a m&#xE9;s <a href="https://developer.android.com/guide/topics/manifest/activity-element">informaci&#xF3;</a>.</p>
<h4 class="mume-header" id="fragmentmanager">FragmentManager</h4>

<p><a href="https://developer.android.com/guide/fragments/fragmentmanager?hl=es-419">FragmentManager</a> &#xE9;s la classe responsable de realitzar accions en els fragments de la teua app, com agregar-los, llevar-los o reempla&#xE7;ar-los, aix&#xED; com treballar amb la pila d&apos;activitats. Encara que en el punt seg&#xFC;ent s&apos;explicar&#xE0; la biblioteca <strong>Jetpack Navigation</strong> que facilita el treballa, &#xE9;s important con&#xE9;ixer alguna cosa sobre aquesta classe.</p>
<p>Per a accedir a FragmentManager amb Kotlin, ho farem a traves de <strong><code>supportFragmentManager</code></strong>. FragmentManager agrupa els canvis realitzats en el que es diuen <strong>transaccions</strong> tractades amb la classe <strong><code>FragmentTransaction</code></strong>. Per la qual cosa &#xE9;s com&#xFA; que s&apos;agrupen diverses accions en una sola transacci&#xF3; (agregar o reempla&#xE7;ar diversos fragments en una sola transacci&#xF3;). Per exemple: <em>aquesta agrupaci&#xF3; pot ser &#xFA;til quan t&#xE9; diversos fragments de germans mostrats en la mateixa pantalla, com amb vista dividides</em>.<br>
Per a obtindre una inst&#xE0;ncia de FragmentTransaction utilitzem <strong><code>beginTransaction</code></strong></p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-val">val</span> fragmentTransaction <span class="token operator">=</span> supportFragmentManager<span class="token punctuation">.</span><span class="token function">beginTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><p>Una inst&#xE0;ncia de <strong>FragmentTransaccion</strong> permet realitzar diverses operacions com agregar, reempla&#xE7;ar, eliminar o ocultar fragments. Alguns dels seus m&#xE8;todes principals s&#xF3;n:</p>
<ul>
<li><strong><code>add()</code></strong> rep l&apos;id del contenidor del fragment (ha de ser de tipus <strong><code>FragmentContainerView</code></strong>) i el fragment que desitja agregar. El fragment agregat es trasllada a l&apos;estat de RESUMED a espera del pr&#xF2;xim commit.</li>
<li><strong><code>remove()</code></strong> permet eliminar un fragment que s&apos;ha de recuperar de l&apos;administrador de fragments a trav&#xE9;s de <strong><code>findFragmentById() o findFragmentByTag()</code></strong>. Si la vista del fragment es va agregar pr&#xE8;viament a un contenidor, s&apos;eliminar&#xE0; despr&#xE9;s de l&apos;anomenada a aquest m&#xE8;tode. El fragment eliminat es trasllada a l&apos;estat de DESTROYED.</li>
<li><strong><code>replace()</code></strong> reempla&#xE7;a un fragment existent en un contenidor amb una inst&#xE0;ncia d&apos;un nou que es proporcione com a argument. &#xC9;s equivalent a cridar remove i add en un mateix contenidor.</li>
<li><strong><code>show() i hide()</code></strong> s&#xF3;n m&#xE8;todes que permeten mostrar i ocultar la vista dels fragments que s&apos;han agregat a un contenidor. Aquests m&#xE8;todes estableixen la visibilitat de les vistes del fragment sense afectar el cicle de vida del fragment.</li>
<li><strong><code>addToBackStack()</code></strong> De manera predeterminada, els canvis realitzats en a FragmentTransaction no s&apos;agreguen a la pila d&apos;activitats, cal usar aquest m&#xE8;tode per a fer-lo (es pot afegir un tag identificatiu)</li>
<li><strong><code>commit</code></strong> programa una confirmaci&#xF3; de les transaccions pendents de manera as&#xED;ncrona, que es realitzar&#xE0; la pr&#xF2;xima vegada que aqueix fil estiga llest.</li>
</ul>
<p>FragmentManager tamb&#xE9; t&#xE9; diversos m&#xE8;todes d&apos;utilitat, entre els quals es troben:</p>
<ul>
<li>
<p><strong><code>popBackStack</code></strong> desapila fragments de la pila de retorn,simulant l&apos;&#xFA;s del comando Arrere per part de l&apos;usuari. Tamb&#xE9; es pot seleccionar un fragment en concret per a desapilar.</p>
</li>
<li>
<p>Per a obtindre fragments que ja existeixen en l&apos;activitat amb <strong><code>findFragmentById()</code></strong> (per a fragments que proporcionen una IU en el disseny de l&apos;activitat) o <strong><code>findFragmentByTag()</code></strong> (per a fragments amb o sense IU).</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin">fT<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>contenedor<span class="token punctuation">,</span><span class="token function">Fragment2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;f2&quot;</span><span class="token punctuation">)</span>
<span class="token keyword keyword-val">val</span> f<span class="token operator">=</span>fM<span class="token punctuation">.</span><span class="token function">findFragmentByTag</span><span class="token punctuation">(</span><span class="token string">&quot;f2&quot;</span><span class="token punctuation">)</span>
</pre></li>
</ul>
<h4 class="mume-header" id="gestionar-fragments-amb-fragmentmanager">Gestionar Fragments amb FragmentManager</h4>

<p>En el punt anterior hem parlat de transaccions, una transacci&#xF3; simplement &#xE9;s una acci&#xF3; que ens permet agregar, reempla&#xE7;ar, eliminar o fins i tot realitzar altres accions quan treballem amb fragments. Aquestes transaccions poden ser apilades per la activity d&apos;acolliment, permetent aix&#xED; a l&apos;usuari navegar entre fragments mentre la activity seguisca en execuci&#xF3;.<br>
Cada transacci&#xF3; &#xE9;s un conjunt de canvis que es realitzen al mateix temps. Podrem fer aquests canvis a trav&#xE9;s dels m&#xE8;todes <strong><code>add()</code></strong>, <strong><code>replace()</code></strong>, <strong><code>remove()</code></strong> acabant la transacci&#xF3; amb el m&#xE8;tode <strong><code>commit()</code></strong>.<br>
Per a afegir la transacci&#xF3; a la pila de retorn de la *activity utilitzarem el m&#xE8;tode <strong><code>addToBackStack()</code></strong> per a cada transacci&#xF3; que realitzem. Aquesta pila ser&#xE0; administrada per la activity i permetr&#xE0; a l&apos;usuari tornar a un fragment anterior prement la tecla tornar del tel&#xE8;fon intel&#xB7;ligent o tauleta.<br>
D&apos;altra banda a trav&#xE9;s del m&#xE8;tode <strong><code>setTransaction()</code></strong> podem establir el tipus d&apos;animaci&#xF3; per a cada transacci&#xF3;.</p>
<p>Refarem l&apos;exemple d&apos;intercanviar entre fragments despr&#xE9;s de polsar un bot&#xF3; vist en el punt de Jetpack Navigation, per&#xF2; sense usar esta tecnologia. Li cridarem <strong>EjemploFragmentV2FragmentManager</strong>, el layout continuar&#xE0; tenint un contenidor de fragments <strong><code>FragmenContainerView</code></strong> sense els atributs propis de Jetpack Navigation i un bot&#xF3;. El layout que mostrar&#xE0; l&apos;activity ser&#xE0; el seg&#xFC;ent:</p>
<pre data-role="codeBlock" data-info="xml" class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RelativeLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/tools<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.fragment.app.FragmentContainerView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/fragment_container<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_above</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/boton<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>androidx.fragment.app.FragmentContainerView</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/boton<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>CAMBIAR<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fill_parent<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_alignParentBottom</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RelativeLayout</span><span class="token punctuation">&gt;</span></span>
</pre><div style="page-break-after:always;"></div>
<p>Una vegada creat el layout haurem de crear la seg&#xFC;ent activity:</p>
<h5 class="mume-header" id="mainactivitykt">Mainactivity.kt</h5>

<pre data-role="codeBlock" data-info="kotlin {highlight=[7, 8,10,16,18]}" class="language-kotlin" data-line="7,8,10,16,18"><span class="token keyword keyword-class">class</span> MainActivity <span class="token operator">:</span> <span class="token function">AppCompatActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span>
        <span class="token keyword keyword-val">val</span> f1 <span class="token operator">=</span> <span class="token function">FragmentUno</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-val">val</span> f2 <span class="token operator">=</span> <span class="token function">FragmentDos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-var">var</span> bol<span class="token operator">=</span><span class="token boolean">true</span>
        <span class="token keyword keyword-val">val</span> boton <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>Button<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>boton<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        boton<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">{</span>
                <span class="token keyword keyword-val">val</span> FT <span class="token operator">=</span> <span class="token function">getSupportFragmentManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">beginTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>bol<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    FT<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>fragment_container<span class="token punctuation">,</span> f1<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                    FT<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>fragment_container<span class="token punctuation">,</span> f2<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                FT<span class="token punctuation">.</span><span class="token function">addToBackStack</span><span class="token punctuation">(</span><span class="token keyword keyword-null">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                FT<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                bol <span class="token operator">=</span> <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>bol<span class="token punctuation">)</span><span class="token boolean">false</span> <span class="token keyword keyword-else">else</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<div class="line-highlight-wrapper">





<div aria-hidden="true" class="line-highlight" data-range="7" data-start="7">
</div></div><div class="line-highlight-wrapper">






<div aria-hidden="true" class="line-highlight" data-range="8" data-start="8">
</div></div><div class="line-highlight-wrapper">








<div aria-hidden="true" class="line-highlight" data-range="10" data-start="10">
</div></div><div class="line-highlight-wrapper">














<div aria-hidden="true" class="line-highlight" data-range="16" data-start="16">
</div></div><div class="line-highlight-wrapper">
















<div aria-hidden="true" class="line-highlight" data-range="18" data-start="18">
</div></div></pre><blockquote>
<p>&#x1F4CC;Comentar que pr&#xE8;viament s&apos;han creat dos fragments &quot;FragmentUNO&quot; i &quot;FragmentDOS&quot;, cadascun amb el seu layout.<br>
En la activity primer creem un valor boole&#xE0; que ens servir&#xE0; per a canviar entre un fragment o un altre cada vegada que l&apos;usuari prema el bot&#xF3; <strong>L&#xED;nia 18</strong>.<br>
A m&#xE9;s instanciaremos <strong><code>FragmentManager</code></strong> a trav&#xE9;s del seu m&#xE8;tode <strong><code>getSupportFragmentManaget ()</code></strong>, <strong>L&#xED;nea 10</strong>. D&apos;esta manera estem creant un objecte que ens servir&#xE0; per a manejar els fragments. A continuaci&#xF3; creem una inst&#xE0;ncia de <strong><code>FragmentTransaction</code></strong> per a realitzar la transacci&#xF3; de fragments. A trav&#xE9;s del m&#xE8;tode <strong><code>beginTransaction ()</code></strong> <strong>L&#xED;nea 10</strong>, indiquem que realitzarem una transacci&#xF3; de fragments. El seg&#xFC;ent &#xE9;s crear les inst&#xE0;ncies dels nostres fragments <strong><code>l&#xED;neas 6 i 7</code></strong> i afegir-la a la transacci&#xF3; a trav&#xE9;s del m&#xE8;tode <strong><code>replace ()</code></strong>, que ens demana com a par&#xE0;metres la id del ViewGroup o vista pare on es col&#xB7;locara dit fragment i com a segon par&#xE0;metre ens demana la inst&#xE0;ncia del fragment on es mostrara la vista <strong>L&#xED;nea 12 i 14</strong>. Tot a&#xE7;&#xF2; ho farem en el listener aplicat al nostre bot&#xF3;.<br>
Cada vegada que l&apos;usuari prema el bot&#xF3; es creara una transacci&#xF3; afegint a la pila un fragment o un altre a trav&#xE9;s del m&#xE8;tode <strong><code>addToBackStack()</code></strong> que demana com a par&#xE0;metre un tag o identificador per a la transacci&#xF3; que es realitzar&#xE0; <strong>L&#xED;nia 16</strong>.<br>
Es finalitza la transacci&#xF3; amb el m&#xE8;tode <strong><code>commit()</code></strong> i canviem el valor boole&#xE0;.</p>
</blockquote>
<p><span style="color: DarkRed; font-weight: bold;">&#x2712;&#xFE0F;Prova l&apos;anterior exemple FragmentV2FragmentManager: bot&#xF3; que carregue l&apos;un o l&apos;altre fragment i al mateix temps que s&apos;acumulen en la pila. Provar que en pr&#xE9;mer el bot&#xF3; de retorn, es passa per cadascun dels fragments que s&apos;han carregat anteriorment.</span></p>
<div style="page-break-after:always;"></div>
<h3 class="mume-header" id="dialogfragment">DialogFragment</h3>

<p>Com hem vist al principi del tema, la classe Fragment t&#xE9; diverses classes filles que ens permeten fer tasques concretes, una d&apos;elles &#xE9;s la classe <a href="https://developer.android.com/guide/topics/ui/dialogs">DialogFragment</a>. En heretar d&apos;ella podrem crear diferents tipus de di&#xE0;legs i &#xE9;s la manera aconsellada per a fer-ho. Com hem dit, per a utilitzar aquest tipus de di&#xE0;legs haurem de crear-nos una classe derivada de DialogFragment i implementar en ella el tipus de dialogue que vulguem (com aquesta part ja la coneixem de temes anteriors, nom&#xE9;s comentarem un parell de AlertDialog diferents). Com en aquest cas els di&#xE0;legs estan implementats amb fragments per a mostrar-los necessitarem usar un <strong><code>FragmentManager</code></strong>, no la t&#xED;pica anomenada al m&#xE8;tode show. Passarem a veure un exemple:</p>
<h5 class="mume-header" id="di%C3%A0leg-dalerta">Di&#xE0;leg d&apos;Alerta</h5>

<p>Aquest tipus de di&#xE0;leg es limita a mostrar un missatge senzill a l&apos;usuari, i un &#xFA;nic bot&#xF3; de OK per a confirmar la seua lectura. Vegem un exemple:</p>
<div align="center">
    <img height="100
    " src="./imagenes/dialogfragment1.png">
</div>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-class">class</span> DialogoAlerta<span class="token operator">:</span><span class="token function">DialogFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreateDialog</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> Dialog <span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreateDialog</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        <span class="token keyword keyword-val">val</span> builder<span class="token operator">=</span><span class="token function">MaterialAlertDialogBuilder</span><span class="token punctuation">(</span><span class="token function">requireActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        builder<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token string">&quot;Esto es un mensaje de alerta&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">&quot;INFORMACI&#xD3;N DE ALERTA&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">setPositiveButton</span><span class="token punctuation">(</span><span class="token string">&quot;Avisado&quot;</span><span class="token punctuation">,</span>
                DialogInterface<span class="token punctuation">.</span><span class="token function">OnClickListener</span><span class="token punctuation">{</span>dialogo<span class="token punctuation">,</span>id<span class="token operator">-&gt;</span>dialogo<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-return">return</span> builder<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><blockquote>
<p>&#x1F4CC;Com es pot veure en el codi, la manera de crear el dialogue &#xE9;s igual que la vista en el bloc 6, per&#xF2; en introduir-lo en un fragment ho fem m&#xE9;s reutilitzable.</p>
</blockquote>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin">     <span class="token keyword keyword-val">val</span> dialogoAlerta<span class="token operator">=</span><span class="token function">DialogoAlerta</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        dialogoAlerta<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span>supportFragmentManager<span class="token punctuation">,</span><span class="token string">&quot;DialogoAlerta&quot;</span><span class="token punctuation">)</span>
</pre><blockquote>
<p>&#x1F4CC;Per a llan&#xE7;ar aquest di&#xE0;leg, per exemple, des de la nostra activitat principal, creem un objecte de tipus DialogoAlerta i ho vam mostrar mediant el m&#xE8;tode show(), passant una refer&#xE8;ncia al Fragment Manager mitjan&#xE7;ant una anomenada a la propietat <strong><code>supportFragmentManager</code></strong>, i una etiqueta identificativa del di&#xE0;leg. Aquest segon argument, ha de ser un nom d&apos;etiqueta &#xFA;nic i que el sistema usar&#xE0; per a guardar i restaurar l&apos;estat del fragment quan siga necessari. L&apos;etiqueta tamb&#xE9; permet obtindre un controlador per al fragment cridant a <strong><code>findFragmentByTag()</code></strong>.</p>
</blockquote>
<p>Si per algun motiu es necessita passar informaci&#xF3; al dialogue, podrem crear un constructor al qual li arribe la informaci&#xF3; mitjan&#xE7;ant Bundle o d&apos;una altra manera.En el seg&#xFC;ent codi es pot veure un possible cas:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-class">class</span> <span class="token function">DialogoAlerta</span><span class="token punctuation">(</span>bundle<span class="token operator">:</span> Bundle<span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">DialogFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> bundle<span class="token operator">:</span> Bundle
    <span class="token keyword keyword-init">init</span><span class="token punctuation">{</span>
      <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>bundle<span class="token operator">=</span>bundle
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreateDialog</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> Dialog <span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreateDialog</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        <span class="token keyword keyword-val">val</span> builder<span class="token operator">=</span><span class="token function">MaterialAlertDialogBuilder</span><span class="token punctuation">(</span><span class="token function">requireActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        builder<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span>bundle<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;DATO&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">&quot;INFORMACI&#xD3;N&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">setPositiveButton</span><span class="token punctuation">(</span><span class="token string">&quot;Acceptar&quot;</span><span class="token punctuation">,</span>
                DialogInterface<span class="token punctuation">.</span><span class="token function">OnClickListener</span><span class="token punctuation">{</span>dialogo<span class="token punctuation">,</span>id<span class="token operator">-&gt;</span>dialogo<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-return">return</span> builder<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>I en la creaci&#xF3; del dialog fragment:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"> <span class="token keyword keyword-val">val</span> bundle<span class="token operator">=</span><span class="token function">Bundle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        bundle<span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span><span class="token string">&quot;DATO&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;AVISO DE PROXIMA CONSULTA M&#xC9;DICA&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-val">val</span> dialogoAlerta<span class="token operator">=</span><span class="token function">DialogoAlerta</span><span class="token punctuation">(</span>bundle<span class="token punctuation">)</span>
        dialogoAlerta<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span>supportFragmentManager<span class="token punctuation">,</span><span class="token string">&quot;DialogoAlerta&quot;</span><span class="token punctuation">)</span>
</pre><h5 class="mume-header" id="di%C3%A0leg-de-selecci%C3%B3-m%C3%BAltiple">Di&#xE0;leg de Selecci&#xF3; M&#xFA;ltiple</h5>

<p>Aquest tipus de dialogue ens permet implementar una selecci&#xF3; m&#xFA;ltiple, com podem veure en la seg&#xFC;ent imatge:</p>
<div align="center">
    <img height="150" src="./imagenes/DialogFragment2.png">
</div>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-class">class</span> DialogoSeleccionMultiple<span class="token operator">:</span><span class="token function">DialogFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreateDialog</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> Dialog <span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreateDialog</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        <span class="token keyword keyword-val">val</span> builder<span class="token operator">=</span> <span class="token function">MaterialAlertDialogBuilder</span><span class="token punctuation">(</span><span class="token function">requireActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-val">val</span> datos<span class="token operator">=</span> <span class="token function">arrayOf</span><span class="token punctuation">(</span><span class="token string">&quot;Chino&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Espa&#xF1;o&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Frances&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Ingl&#xE9;s&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Turco&quot;</span><span class="token punctuation">)</span>
        builder<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">&quot;Seleccione idioma&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">setMultiChoiceItems</span><span class="token punctuation">(</span>datos<span class="token punctuation">,</span><span class="token keyword keyword-null">null</span><span class="token punctuation">,</span> 
            DialogInterface<span class="token punctuation">.</span><span class="token function">OnMultiChoiceClickListener</span><span class="token punctuation">{</span>dialogo<span class="token punctuation">,</span>item<span class="token punctuation">,</span>isChecked<span class="token operator">-&gt;</span>
                Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token function">requireActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;Se ha seleccionado &quot;</span>
                <span class="token operator">+</span>datos<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">,</span>Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-return">return</span> builder<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>Cada vegada que se selecciona un element de la llista s&apos;executar&#xE0; el listener <strong><code>OnMultiChoiceClickListener</code></strong>, arribant a aquest el item premut i si est&#xE0; <em>checked</em> o <em>unchecked</em>.</p>
<p><span style="color: DarkRed; font-weight: bold;">&#x2712;&#xFE0F;Ejercicio PropuestoDialogoPersonalizado</span></p>
<div style="page-break-after:always;"></div>
<h3 class="mume-header" id="vistes-lliscants-vistas-deslizantes-y-tabs">Vistes Lliscants (Vistas Deslizantes) y Tabs</h3>

<h4 class="mume-header" id="viewpager">ViewPager</h4>

<p>Les <a href="https://developer.android.com/guide/navigation/navigation-swipe-view-2">vistes lliscants o paginaci&#xF3; horitzontal</a>, permeten navegar entre pantalles relacionades. Per exemple, entre pestanyes, amb un gest horitzontal del dit o un lliscament. Per a crear, hui dia, vistes lliscants s&apos;utilitza l&apos;element <strong><code>ViewPager2</code></strong>.<br>
Reprendrem l&apos;exemple de <strong>FragmentV3ViewModel</strong> i afegir el codi necessari per a aconseguir l&apos;efecte de despla&#xE7;ament entre fragments. Els passos s&#xF3;n els seg&#xFC;ents:</p>
<ol>
<li>
<p>El layout de l&apos;activitat on s&apos;afegiran els fragments, haur&#xE0; d&apos;incloure un <strong><code>ViewPager2</code></strong>. Si la pantalla mostra els fragments complets, aquest element pot ser l&apos;arrel. Per exemple, el <em>.xml</em> del <strong>MainActivity</strong> podria ser:</p>
<pre data-role="codeBlock" data-info="xml" class="language-xml">    <span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.viewpager2.widget.ViewPager2</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com
    /apk/res/android<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/ViewPager<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</pre></li>
<li>
<p>S&apos;haur&#xE0; de crear una classe que manejar&#xE0; la c&#xE0;rrega dels fragments amb el despla&#xE7;ament. Aquesta classe haur&#xE0; d&apos;heretar de la classe abstracta <strong><code>FragmentStateAdapter</code></strong>, per la qual cosa obligar&#xE0; a implementar el m&#xE8;tode <strong><code>createFragment()</code></strong> a fi d&apos;aprovisionar inst&#xE0;ncies de Fragments a la paginaci&#xF3;, i el m&#xE8;tode <strong><code>getItemCount()</code></strong>, que ha de retornar el n&#xFA;mero exacte de fragments que es paginar&#xE0;n.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-class">class</span> <span class="token function">FragmentPageAdapter</span><span class="token punctuation">(</span>fragment<span class="token operator">:</span> FragmentActivity<span class="token punctuation">)</span><span class="token operator">:</span> 
            <span class="token function">FragmentStateAdapter</span><span class="token punctuation">(</span>fragment<span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getItemCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">3</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">createFragment</span><span class="token punctuation">(</span>position<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> Fragment <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-when">when</span> <span class="token punctuation">(</span>position<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token number">0</span> <span class="token operator">-&gt;</span> <span class="token function">MyListFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token number">1</span> <span class="token operator">-&gt;</span> <span class="token function">FragmentSecundario</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token number">2</span> <span class="token operator">-&gt;</span> <span class="token function">FragmentTercero</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-else">else</span> <span class="token operator">-&gt;</span> <span class="token function">MyListFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><blockquote>
<p>&#x270B; L&#xF2;gicament les classes amb els fragments i els seus layouts relacionats han d&apos;existir, en aquest cas s&apos;ha duplicat FragmentSecundario de l&apos;exemple anterior i s&apos;ha canviat de nom a FragmenTercero.</p>
</blockquote>
</li>
<li>
<p>Finalment s&apos;haur&#xE0; de connectar el <strong><code>FragmentStateAdapter</code></strong> als objectes <strong><code>ViewPager2</code></strong>.</p>
<pre data-role="codeBlock" data-info="kotlin{highlight=[7,8,9,[11-13]]}" class="language-kotlin" data-line="7,8,9,11-13"><span class="token keyword keyword-class">class</span> MainActivity <span class="token operator">:</span> <span class="token function">FragmentActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> viewPager<span class="token operator">:</span>ViewPager2
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span>
        viewPager <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>ViewPager<span class="token punctuation">)</span>
        <span class="token keyword keyword-val">val</span> pagerAdapter <span class="token operator">=</span> <span class="token function">FragmentPageAdapter</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span>
        viewPager<span class="token punctuation">.</span>adapter <span class="token operator">=</span> pagerAdapter
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onBackPressed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>viewPager<span class="token punctuation">.</span>currentItem <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onBackPressed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-else">else</span> viewPager<span class="token punctuation">.</span>currentItem <span class="token operator">=</span> viewPager<span class="token punctuation">.</span>currentItem <span class="token operator">-</span> <span class="token number">1</span>  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<div class="line-highlight-wrapper">





<div aria-hidden="true" class="line-highlight" data-range="7" data-start="7">
</div></div><div class="line-highlight-wrapper">






<div aria-hidden="true" class="line-highlight" data-range="8" data-start="8">
</div></div><div class="line-highlight-wrapper">







<div aria-hidden="true" class="line-highlight" data-range="9" data-start="9">
</div></div><div class="line-highlight-wrapper">









<div aria-hidden="true" class="line-highlight" data-range="11-13" data-start="11" data-end="13">


</div></div></pre><blockquote>
<p>&#x1F4CC; En aquest cas ens ha convingut que MainActivity herete de <strong><code>FragmentActivity</code></strong>, perqu&#xE8; d&apos;aquesta manera no ens de problemes l&apos;anomenada al constructor de <strong><code>FragmentStateAdapter</code></strong>.<br>
<strong>L&#xED;nia 7</strong> instanciem l&apos;objecte <strong><code>ViewPager2</code></strong> de <em>activity_main.xml</em>.<br>
<strong>L&#xED;nia 8</strong> instanciem un objecte de la classe que hereta de <strong><code>FragmentStateAdapter</code></strong>.<br>
<strong>L&#xED;nia 9</strong> relacionem tots dos objectes per a fer la connexi&#xF3;. <strong>Bloc 11 a 13</strong>, anul&#xB7;lem el BackPressed perqu&#xE8; realitze el comportament correcte de canvi de fragments. Com es pot veure es fa mitjan&#xE7;ant la propietat <strong><code>currentItem</code></strong> decrementant-la en 1.</p>
</blockquote>
</li>
</ol>
<p><span style="color: DarkRed; font-weight: bold;">&#x2712;&#xFE0F; Reconstrueix l&apos;exemple explicat amb anterioritat per a provar el funcionament del ViewPager. Podr&#xE0;s comprovar que el pas d&apos;informaci&#xF3; amb ViewModel continua funcionant correctament<br>
</span></p>
<div style="page-break-after:always;"></div>
<h4 class="mume-header" id="tabslayout">TabsLayout</h4>

<p>Un objecte <a href="https://developer.android.com/guide/navigation/navigation-swipe-view-2#add_tabs_using_a_tablayout">TabLayout</a> proporciona una forma crear pestanyes horitzontals. Quan s&apos;usa juntament amb un ViewPager2 ens permet el lliscament al mateix temps que es marca la pestanya activa.</p>
<div align="center">
    <img height="120" src="./imagenes/taps1.png">
</div>
<p>Les pestanyes es poden inserir en la ToolBar (la manera m&#xE9;s com&#xFA;) o independents a aquesta. Nosaltres seguirem un exemple que afig les Tabs a la Toolbar i per a aix&#xF2; reprendrem l&apos;anterior exercici, per&#xF2; ara a la <strong>activity_main.xml</strong> li afegirem una <strong><code>MaterialToolBar</code></strong> com ja vam veure en el Bloc 4 i dins d&apos;aquesta ficarem el <strong><code>TabLayout</code></strong>.</p>
<pre data-role="codeBlock" data-info="xml" class="language-xml"><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertical<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.google.android.material.appbar.AppBarLayout</span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>theme</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@style/ThemeOverlay.MaterialComponents.Dark.ActionBar<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.google.android.material.appbar.MaterialToolbar</span>
            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/toolbar<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>?attr/actionBarSize<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.google.android.material.tabs.TabLayout</span>
            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/tabs<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@style/Widget.MaterialComponents.TabLayout.PrimarySurface<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>com.google.android.material.appbar.AppBarLayout</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.viewpager2.widget.ViewPager2</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/viewpager<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">&gt;</span></span>
</pre><p>Les noves l&#xED;nies a afegir en l&apos;activitat principal per a referenciar al TabLayout creat i per a crear un objecte de tipus <a href="https://developer.android.com/reference/com/google/android/material/tabs/tablayoutmediator">TabLayoutMediator</a> encarregat de relacionar el tabLayout amb el ViewPager.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-val">val</span> tabLayout <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>TabLayout<span class="token operator">&gt;</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>tabs<span class="token punctuation">)</span>
<span class="token function">TabLayoutMediator</span><span class="token punctuation">(</span>tabLayout<span class="token punctuation">,</span> viewPager<span class="token punctuation">)</span> <span class="token punctuation">{</span> tab<span class="token punctuation">,</span> position <span class="token operator">-&gt;</span>
             <span class="token keyword keyword-when">when</span> <span class="token punctuation">(</span>position<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token number">0</span> <span class="token operator">-&gt;</span> tab<span class="token punctuation">.</span><span class="token function">setIcon</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>ic_emoticon<span class="token punctuation">)</span>
                <span class="token number">1</span> <span class="token operator">-&gt;</span> tab<span class="token punctuation">.</span>text<span class="token operator">=</span><span class="token string">&quot;Tap 2&quot;</span>
                <span class="token number">2</span> <span class="token operator">-&gt;</span> tab<span class="token punctuation">.</span><span class="token function">setIcon</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>ic_place<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><blockquote>
<p>&#x1F4CC; En crear una inst&#xE0;ncia de la classe <strong>TabLayoutMediator</strong> s&apos;ha d&apos;implementar la interface <strong><code>TabLayoutMediator.TabConfigurationStrategy</code></strong> per a configurar la pestanya de la p&#xE0;gina en la posici&#xF3; especificada (en aquesta interface s&apos;establir&#xE0; el text de la pestanya i qualsevol estil de les pestanyes que es necessite).<br>
<strong><code>TabLayoutMediator</code></strong> sincronitzar&#xE0; la posici&#xF3; de ViewPager2 amb la pestanya seleccionada quan se seleccione una pestanya, i la posici&#xF3; de despla&#xE7;ament de TabLayout quan l&apos;usuari arrossegament ViewPager2.</p>
</blockquote>
<p>A m&#xE9;s <strong><code>TabLayoutMediator</code></strong> escolta diferents elements, per a controlar les diferents situacions:</p>
<ul>
<li><strong><code>OnPageChangeCallback</code></strong> de ViewPager2 per a ajustar la pestanya quan ViewPager2 es moga.</li>
<li><strong><code>OnTabSelectedListener</code></strong> de TabLayout per a ajustar VP2 quan es mou la pestanya.</li>
<li><strong><code>AdapterDataObserver</code></strong> de RecyclerView per a recrear el contingut de la pestanya quan canvia el conjunt de dades.</li>
</ul>
<p>Un exemple del listener del ViewPager2 seria:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin">tabLayout<span class="token punctuation">.</span><span class="token function">addOnTabSelectedListener</span> <span class="token punctuation">(</span><span class="token keyword keyword-object">object</span><span class="token operator">:</span>TabLayout<span class="token punctuation">.</span><span class="token function">OnTabSelectedListener</span><span class="token punctuation">{</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onTabSelected</span><span class="token punctuation">(</span>tab<span class="token operator">:</span> TabLayout<span class="token punctuation">.</span>Tab<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">TODO</span><span class="token punctuation">(</span><span class="token string">&quot;Not yet implemented&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onTabUnselected</span><span class="token punctuation">(</span>tab<span class="token operator">:</span> TabLayout<span class="token punctuation">.</span>Tab<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">TODO</span><span class="token punctuation">(</span><span class="token string">&quot;Not yet implemented&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onTabReselected</span><span class="token punctuation">(</span>tab<span class="token operator">:</span> TabLayout<span class="token punctuation">.</span>Tab<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">TODO</span><span class="token punctuation">(</span><span class="token string">&quot;Not yet implemented&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</pre><p><span style="color: DarkRed; font-weight: bold;">&#x2712;&#xFE0F;Construeix l&apos;exemple i prova el seu funcionament</span></p>

      </div>
      
      
    
    
    
    
    
    
    
    
  
    </body></html>