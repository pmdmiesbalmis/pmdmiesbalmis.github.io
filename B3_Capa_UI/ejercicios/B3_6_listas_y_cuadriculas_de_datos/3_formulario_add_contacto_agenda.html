<!DOCTYPE html><html><head>
      <title>PMDM 2췈 DAM Tema 3</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="formulario-para-a침adir-un-contacto-en-agenda">Formulario para a침adir un contacto en agenda </h1>
<p><a href="./3_formulario_add_contacto_agenda.pdf">Descargar estos apuntes</a></p>
<h2 id="codelab-guiado-para-crear-un-formulario-de-acta-de-un-contacto">'<em>Codelab</em>' guiado para crear un formulario de acta de un contacto. </h2>
<p>En el siguiente ejercicio partiremos del <strong>ejercicio 1</strong> del <strong>Tema 3.6</strong> donde <strong>a침adimos la lista de contactos</strong>. La idea del mismo es poder a침adir o editar un contacto.</p>
<h4 id="paso-1--a침adiendo-di-con-hilt-a-nuestro-proyecto">Paso 1.- A침adiendo DI con Hilt a nuestro proyecto </h4>
<p>En primer lugar vamos a a침adir el soporte para la inyecci칩n de dependencias y as칤 poder gestionar el ciclo de vida los objetos que necesitemos en nuestra aplicaci칩n y de paso practicar un poco m치s su uso. Para ello, vamos a recordar alguno de los pasos descritos en el tema:</p>
<ol>
<li>
<p>A침ade todos los plugins y librer칤as en Gradle, descritas en el Tame 3.5 y sincroniza el proyecto de Gradle.</p>
</li>
<li>
<p>A침adimos la anotaci칩n <strong><code>@HiltAndroidApp</code></strong> en <strong><code>AgendaApplication</code></strong></p>
</li>
<li>
<p>A침adimos la anotaci칩n <strong><code>@AndroidEntryPoint</code></strong> en <strong><code>MainActivity</code></strong>.</p>
</li>
<li>
<p>Vamos a marcar para inyecci칩n los siguientes constructores:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-class">class</span> ContactoDaoMock <span class="token annotation builtin">@Inject</span> <span class="token keyword keyword-constructor">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token keyword keyword-class">class</span> ContactoRepository <span class="token annotation builtin">@Inject</span> <span class="token keyword keyword-constructor">constructor</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> dao<span class="token operator">:</span> ContactoDaoMock
<span class="token punctuation">)</span>
</code></pre></li>
<li>
<p>Vamos a definir el paquete <strong><code>com.pmdm.agenda.di</code></strong> y en 칠l el m칩dulo <strong><code>AppModule.kt</code></strong> donde vamos a definir los servicios que vamos a inyectar en nuestra aplicaci칩n. En este caso, solo tenemos el repositorio de contactos.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Module</span>
<span class="token annotation builtin">@InstallIn</span><span class="token punctuation">(</span>SingletonComponent<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">)</span>
<span class="token keyword keyword-class">class</span> AppModule <span class="token punctuation">{</span>

    <span class="token annotation builtin">@Provides</span>
    <span class="token annotation builtin">@Singleton</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">provideContactoDaoMock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> ContactoDaoMock <span class="token operator">=</span> <span class="token function">ContactoDaoMock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token annotation builtin">@Provides</span>
    <span class="token annotation builtin">@Singleton</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">provideContactoRepository</span><span class="token punctuation">(</span>
        contactoDaoMock<span class="token operator">:</span> ContactoDaoMock
    <span class="token punctuation">)</span> <span class="token operator">:</span> ContactoRepository <span class="token operator">=</span> <span class="token function">ContactoRepository</span><span class="token punctuation">(</span>contactoDaoMock<span class="token punctuation">)</span>
<span class="token punctuation">}</span>    
</code></pre></li>
<li>
<p>Ahora en <strong><code>ListaContactosViewModel</code></strong> vamos inyectar el repositorio y a indicarle a Hilt que hay un <strong><code>@HiltViewModel</code></strong> que cuando inst치ncie lo asocie al ciclo de vida oportuno.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@HiltViewModel</span>
<span class="token keyword keyword-class">class</span> ListaContactosViewModel <span class="token annotation builtin">@Inject</span> <span class="token keyword keyword-constructor">constructor</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> repository<span class="token operator">:</span> ContactoRepository
<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">ViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></li>
</ol>
<h4 id="paso-2--a침adiendo-clases-de-utilidad-para-introducir-campos-de-texto">Paso 2.- A침adiendo clases de utilidad para introducir campos de texto </h4>
<div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px">
<div style="width: 80%">
<p>Descarga el recurso <strong><a href="../../assets/codigo/ejercicios3_6/3_formulario_add_contacto_agenda/validacion_recurso.zip">validacion.zip</a></strong>. Si lo descomprimes te generar치 una carpeta <strong><code>validacion</code></strong> que debes arrastrar a tu proyecto al bajo el paquete <strong><code>com.pmdm.agenda.ui.utilities</code></strong>.</p>
<p>Nos crear치 el paquete validaci칩n en el que podremos encontrar las siguientes clases que se ven en el esquema de la derecha. Algunas de ellas ya las hemos tratado cuando hablamos de <strong><code>TextField</code></strong>.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token comment">// Validacion.kt -----------------------------------------------</span>
<span class="token comment">// Abstracci칩n del resultado de una validaci칩n. </span>
<span class="token comment">// Si hay error, se indica el mensaje de error.</span>
<span class="token comment">// Ser치 el UIState que reciben nuestros TextField para indicar si hay error o no.</span>
<span class="token comment">// Puedo crear una unstancia de Validacion con un objeto an칩nimo que </span>
<span class="token comment">// implemente la interfaz Validacion usando object : Validacion { ... }</span>
<span class="token keyword keyword-interface">interface</span> Validacion <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> hayError<span class="token operator">:</span> Boolean
        <span class="token keyword keyword-get">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword keyword-val">val</span> mensajeError<span class="token operator">:</span> String<span class="token operator">?</span>
        <span class="token keyword keyword-get">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword keyword-null">null</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div style="width: auto">
<p align="center" style="zoom:1" class="puml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="349px" preserveAspectRatio="none" style="width:246px;height:349px;background:#FFFFFF;" version="1.1" viewBox="0 0 246 349" width="246px" zoomAndPan="magnify"><defs></defs><g><rect fill="#EEEEEE" height="18.0938" style="stroke:#000000;stroke-width:1.0;" width="71" x="6" y="6"></rect><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="42" x="8" y="20.457">Android</text><line style="stroke:#000000;stroke-width:1.0;" x1="66" x2="66" y1="6" y2="24.0938"></line><polygon fill="#000000" points="69,12,75,12,72,19.0938" style="stroke:#000000;stroke-width:1.0;"></polygon><path d="M17,31.1875 L17,33.1875 L25,33.1875 L25,32.1875 L20,32.1875 L20,31.1875 L17,31.1875 M17,34.1875 L17,38.6875 C17,38.9675 17.22,39.1875 17.5,39.1875 L24.5,39.1875 C24.78,39.1875 25,38.9675 25,38.6875 L25,34.1875 L17,34.1875 " fill="#000000" style="stroke:;stroke-width:0.0;stroke-dasharray:;"></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="85" x="26" y="39.5508">[com.ahorcado]</text><path d="M27,46.2813 L27,48.2813 L35,48.2813 L35,47.2813 L30,47.2813 L30,46.2813 L27,46.2813 M27,49.2813 L27,53.7813 C27,54.0613 27.22,54.2813 27.5,54.2813 L34.5,54.2813 C34.78,54.2813 35,54.0613 35,53.7813 L35,49.2813 L27,49.2813 " fill="#000000" style="stroke:;stroke-width:0.0;stroke-dasharray:;"></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="30" x="36" y="54.6445">[data]</text><path d="M27,61.375 L27,63.375 L35,63.375 L35,62.375 L30,62.375 L30,61.375 L27,61.375 M27,64.375 L27,68.875 C27,69.155 27.22,69.375 27.5,69.375 L34.5,69.375 C34.78,69.375 35,69.155 35,68.875 L35,64.375 L27,64.375 " fill="#000000" style="stroke:;stroke-width:0.0;stroke-dasharray:;"></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="48" x="36" y="69.7383">[models]</text><path d="M27,76.4688 L27,78.4688 L35,78.4688 L35,77.4688 L30,77.4688 L30,76.4688 L27,76.4688 M27,79.4688 L27,83.9688 C27,84.2488 27.22,84.4688 27.5,84.4688 L34.5,84.4688 C34.78,84.4688 35,84.2488 35,83.9688 L35,79.4688 L27,79.4688 " fill="#000000" style="stroke:;stroke-width:0.0;stroke-dasharray:;"></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="16" x="36" y="84.832">[ui]</text><path d="M27,91.5625 L27,93.5625 L35,93.5625 L35,92.5625 L30,92.5625 L30,91.5625 L27,91.5625 M27,94.5625 L27,99.0625 C27,99.3425 27.22,99.5625 27.5,99.5625 L34.5,99.5625 C34.78,99.5625 35,99.3425 35,99.0625 L35,94.5625 L27,94.5625 " fill="#000000" style="stroke:;stroke-width:0.0;stroke-dasharray:;"></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="45" x="36" y="99.9258">[utilities]</text><path d="M37,106.6563 L37,108.6563 L45,108.6563 L45,107.6563 L40,107.6563 L40,106.6563 L37,106.6563 M37,109.6563 L37,114.1563 C37,114.4363 37.22,114.6563 37.5,114.6563 L44.5,114.6563 C44.78,114.6563 45,114.4363 45,114.1563 L45,109.6563 L37,109.6563 " fill="#000000" style="stroke:;stroke-width:0.0;stroke-dasharray:;"></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="62" x="46" y="115.0195">[imagenes]</text><path d="M37,121.75 L37,123.75 L45,123.75 L45,122.75 L40,122.75 L40,121.75 L37,121.75 M37,124.75 L37,129.25 C37,129.53 37.22,129.75 37.5,129.75 L44.5,129.75 C44.78,129.75 45,129.53 45,129.25 L45,124.75 L37,124.75 " fill="#0000FF" style="stroke:;stroke-width:0.0;stroke-dasharray:;"></path><text fill="#0000FF" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="65" x="46" y="130.1133">[validacion]</text><path d="M47,136.8438 L47,138.8438 L55,138.8438 L55,137.8438 L50,137.8438 L50,136.8438 L47,136.8438 M47,139.8438 L47,144.3438 C47,144.6238 47.22,144.8438 47.5,144.8438 L54.5,144.8438 C54.78,144.8438 55,144.6238 55,144.3438 L55,139.8438 L47,139.8438 " fill="#4169E1" style="stroke:;stroke-width:0.0;stroke-dasharray:;"></path><text fill="#4169E1" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="74" x="56" y="145.207">[validadores]</text><text fill="#4169E1" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="102" x="56" y="160.3008">ValidadorCorreo.kt</text><text fill="#4169E1" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="83" x="56" y="175.3945">ValidadorDni.kt</text><text fill="#4169E1" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="183" x="56" y="190.4883">ValidadorLongitudMaximaTexto.kt</text><text fill="#4169E1" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="181" x="56" y="205.582">ValidadorLongitudMinimaTexto.kt</text><text fill="#4169E1" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="145" x="56" y="220.6758">ValidadorNumeroEntero.kt</text><text fill="#4169E1" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="135" x="56" y="235.7695">ValidadorNumeroReal.kt</text><text fill="#4169E1" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="112" x="56" y="250.8633">ValidadorTelefono.kt</text><text fill="#4169E1" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="123" x="56" y="265.957">ValidadorTextoVacio.kt</text><text fill="#0000FF" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="69" x="46" y="281.0508">Validacion.kt</text><text fill="#0000FF" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="134" x="46" y="296.1445">ValidacionCompuesta.kt</text><text fill="#0000FF" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="64" x="46" y="311.2383">Validador.kt</text><text fill="#0000FF" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="129" x="46" y="326.332">ValidadorCompuesto.kt</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="114" x="26" y="341.4258">AgendaApplication.kt</text><rect fill="none" height="2" style="stroke:#888888;stroke-width:1.0;" width="2" x="9" y="33.6406"></rect><line style="stroke:#888888;stroke-width:1.0;" x1="10" x2="10" y1="36.6406" y2="49.7344"></line><line style="stroke:#888888;stroke-width:1.0;" x1="10" x2="18" y1="49.7344" y2="49.7344"></line><line style="stroke:#888888;stroke-width:1.0;" x1="10" x2="10" y1="36.6406" y2="64.8281"></line><line style="stroke:#888888;stroke-width:1.0;" x1="10" x2="18" y1="64.8281" y2="64.8281"></line><line style="stroke:#888888;stroke-width:1.0;" x1="10" x2="10" y1="36.6406" y2="79.9219"></line><line style="stroke:#888888;stroke-width:1.0;" x1="10" x2="18" y1="79.9219" y2="79.9219"></line><rect fill="none" height="2" style="stroke:#888888;stroke-width:1.0;" width="2" x="19" y="94.0156"></rect><line style="stroke:#888888;stroke-width:1.0;" x1="10" x2="10" y1="36.6406" y2="95.0156"></line><line style="stroke:#888888;stroke-width:1.0;" x1="10" x2="18" y1="95.0156" y2="95.0156"></line><line style="stroke:#888888;stroke-width:1.0;" x1="20" x2="20" y1="97.0156" y2="110.1094"></line><line style="stroke:#888888;stroke-width:1.0;" x1="20" x2="28" y1="110.1094" y2="110.1094"></line><rect fill="none" height="2" style="stroke:#888888;stroke-width:1.0;" width="2" x="29" y="124.2031"></rect><line style="stroke:#888888;stroke-width:1.0;" x1="20" x2="20" y1="97.0156" y2="125.2031"></line><line style="stroke:#888888;stroke-width:1.0;" x1="20" x2="28" y1="125.2031" y2="125.2031"></line><rect fill="none" height="2" style="stroke:#888888;stroke-width:1.0;" width="2" x="39" y="139.2969"></rect><line style="stroke:#888888;stroke-width:1.0;" x1="30" x2="30" y1="127.2031" y2="140.2969"></line><line style="stroke:#888888;stroke-width:1.0;" x1="30" x2="38" y1="140.2969" y2="140.2969"></line><line style="stroke:#888888;stroke-width:1.0;" x1="40" x2="40" y1="142.2969" y2="155.3906"></line><line style="stroke:#888888;stroke-width:1.0;" x1="40" x2="48" y1="155.3906" y2="155.3906"></line><line style="stroke:#888888;stroke-width:1.0;" x1="40" x2="40" y1="142.2969" y2="170.4844"></line><line style="stroke:#888888;stroke-width:1.0;" x1="40" x2="48" y1="170.4844" y2="170.4844"></line><line style="stroke:#888888;stroke-width:1.0;" x1="40" x2="40" y1="142.2969" y2="185.5781"></line><line style="stroke:#888888;stroke-width:1.0;" x1="40" x2="48" y1="185.5781" y2="185.5781"></line><line style="stroke:#888888;stroke-width:1.0;" x1="40" x2="40" y1="142.2969" y2="200.6719"></line><line style="stroke:#888888;stroke-width:1.0;" x1="40" x2="48" y1="200.6719" y2="200.6719"></line><line style="stroke:#888888;stroke-width:1.0;" x1="40" x2="40" y1="142.2969" y2="215.7656"></line><line style="stroke:#888888;stroke-width:1.0;" x1="40" x2="48" y1="215.7656" y2="215.7656"></line><line style="stroke:#888888;stroke-width:1.0;" x1="40" x2="40" y1="142.2969" y2="230.8594"></line><line style="stroke:#888888;stroke-width:1.0;" x1="40" x2="48" y1="230.8594" y2="230.8594"></line><line style="stroke:#888888;stroke-width:1.0;" x1="40" x2="40" y1="142.2969" y2="245.9531"></line><line style="stroke:#888888;stroke-width:1.0;" x1="40" x2="48" y1="245.9531" y2="245.9531"></line><line style="stroke:#888888;stroke-width:1.0;" x1="40" x2="40" y1="142.2969" y2="261.0469"></line><line style="stroke:#888888;stroke-width:1.0;" x1="40" x2="48" y1="261.0469" y2="261.0469"></line><line style="stroke:#888888;stroke-width:1.0;" x1="30" x2="30" y1="127.2031" y2="276.1406"></line><line style="stroke:#888888;stroke-width:1.0;" x1="30" x2="38" y1="276.1406" y2="276.1406"></line><line style="stroke:#888888;stroke-width:1.0;" x1="30" x2="30" y1="127.2031" y2="291.2344"></line><line style="stroke:#888888;stroke-width:1.0;" x1="30" x2="38" y1="291.2344" y2="291.2344"></line><line style="stroke:#888888;stroke-width:1.0;" x1="30" x2="30" y1="127.2031" y2="306.3281"></line><line style="stroke:#888888;stroke-width:1.0;" x1="30" x2="38" y1="306.3281" y2="306.3281"></line><line style="stroke:#888888;stroke-width:1.0;" x1="30" x2="30" y1="127.2031" y2="321.4219"></line><line style="stroke:#888888;stroke-width:1.0;" x1="30" x2="38" y1="321.4219" y2="321.4219"></line><line style="stroke:#888888;stroke-width:1.0;" x1="10" x2="10" y1="36.6406" y2="336.5156"></line><line style="stroke:#888888;stroke-width:1.0;" x1="10" x2="18" y1="336.5156" y2="336.5156"></line><!--SRC=[bPDTIrj148RlzrVCLT68mQIns8E8QH8BQLB57CzDKHZFJjAXUtR2djcWIFzxDpQf8HIDBEp5-pxpiSpiUQqOj4QdnZoPkwwtGTZUcQVS7C3fXwauI-7iHobL4tzAAD7AhJdOj2mgRacLM7BrbXXvMr1sh4pFuAR15Sx8h_L6uxGK9o6xTv7ENgW5EhPOilZRHcD9Rg117j7zbxSIKk9LG2gwpHThgYSXa3H_wPjat_Cks4ZyZ3NQCJwa1-RqeFAkCFRl2ViUAmeoy9hktVbhGhSBdPEZgNZPZKqj5yj1hMdO76ZnRunls3sfvf7Ikhx2fNAlk-iagrwWcnRDOdS-TroYhfhudSvvql_-YYk7Nc_68rXGg1C1hMRxgFsnsMhlNGI6orAXVGIjuwppEJlkG6ymoM49x9kzhrSZg2M6ai1ohO7luxB6lXdY0k4wUkMAChYSan_slwq56FW51_4LUJN3Olm2VEeSVc652ONK2nHZqwSfHgSfeXJBVfR1JNvnU696w6SnVQ8Cg3OzINd3OmQ3oHy0]--></g></svg></p></div>
</div>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token comment">// ValidacionCompuesta.kt -----------------------------------------------</span>
<span class="token comment">// Es una clase de utilidad que tiene una lista de validaciones que debemos pasar antes</span>
<span class="token comment">// de dar por v치lidos los datos de un formulario.</span>
<span class="token comment">// Rehusamos para ello los objetos que representan los estados de validaci칩n de cada campo y si alguno</span>
<span class="token comment">// de ellos tiene error lo indicaremos en la propiedad calculada de solo lectura hayError de esta clase.</span>
<span class="token keyword keyword-open">open</span> <span class="token keyword keyword-class">class</span> ValidacionCompuesta <span class="token operator">:</span> Validacion <span class="token punctuation">{</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> validaciones <span class="token operator">=</span> mutableListOf<span class="token operator">&lt;</span>Validacion<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">add</span><span class="token punctuation">(</span>validacion<span class="token operator">:</span> Validacion<span class="token punctuation">)</span><span class="token operator">:</span> ValidacionCompuesta <span class="token punctuation">{</span>
        validaciones<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>validacion<span class="token punctuation">)</span>
        <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-this">this</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-val">val</span> hayError<span class="token operator">:</span> Boolean
        <span class="token keyword keyword-get">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> validaciones<span class="token punctuation">.</span><span class="token function">any</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span>hayError <span class="token punctuation">}</span>

    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-val">val</span> mensajeError<span class="token operator">:</span> String<span class="token operator">?</span>
        <span class="token keyword keyword-get">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> validaciones<span class="token punctuation">.</span><span class="token function">firstOrNull</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span>hayError <span class="token punctuation">}</span><span class="token operator">?</span><span class="token punctuation">.</span>mensajeError
<span class="token punctuation">}</span>
</code></pre><pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token comment">// Validador.kt -----------------------------------------------</span>
<span class="token comment">// Abstracci칩n de una funci칩n de validadora de datos.</span>
<span class="token comment">// Devuelve un objeto Validacion que devolver치 un estado </span>
<span class="token comment">// de validaci칩n para un TextField o un Snackbar.</span>
<span class="token keyword keyword-interface">interface</span> Validador<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">valida</span><span class="token punctuation">(</span>datos<span class="token operator">:</span> T<span class="token punctuation">)</span><span class="token operator">:</span> Validacion
<span class="token punctuation">}</span>
</code></pre><pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token comment">// ValidadorCompuesto.kt -----------------------------------------------</span>
<span class="token comment">// Implementa la interfaz Validador y es una clase de utilidad que tiene</span>
<span class="token comment">// una lista de validadores que debemos pasar para un conjunto de datos.</span>
<span class="token comment">// Por ejemplo para un tel칠fono, podemos tener una validaci칩n que compruebe</span>
<span class="token comment">// que no est치 vac칤o, otra que compruebe que tiene una longitud m칤nima.</span>
<span class="token comment">// Nota: Las validaciones se ejecutan en orden y si alguna de ellas tiene error</span>
<span class="token comment">// se devuelve el error y no se ejecutan las siguientes.</span>
<span class="token keyword keyword-open">open</span> <span class="token keyword keyword-class">class</span> ValidadorCompuesto<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token operator">:</span> Validador<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> validadores <span class="token operator">=</span> mutableListOf<span class="token operator">&lt;</span>Validador<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword keyword-fun">fun</span> <span class="token function">add</span><span class="token punctuation">(</span>validador<span class="token operator">:</span> Validador<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> ValidadorCompuesto<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        validadores<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>validador<span class="token punctuation">)</span>
        <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-this">this</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">valida</span><span class="token punctuation">(</span>datos<span class="token operator">:</span> T<span class="token punctuation">)</span><span class="token operator">:</span> Validacion <span class="token operator">=</span>
        validadores
            <span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span><span class="token function">valida</span><span class="token punctuation">(</span>datos<span class="token punctuation">)</span> <span class="token punctuation">}</span>
            <span class="token punctuation">.</span><span class="token function">firstOrNull</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span>hayError <span class="token punctuation">}</span>
            <span class="token operator">?:</span> <span class="token keyword keyword-object">object</span> <span class="token operator">:</span> Validacion <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Dentro del paquete <strong><code>validacion</code></strong> encontramos otro paquete <strong><code>validadores</code></strong> que contiene las clases que implementan la interfaz <strong><code>Validador</code></strong>. Estas clases son las que se encargan de validar un campo de texto concreto. Por ejemplo, la clase <strong><code>ValidaCorreo</code></strong> se encarga de validar que un campo de texto es un correo electr칩nico v치lido.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-class">class</span> <span class="token function">ValidadorCorreo</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-val">val</span> error<span class="token operator">:</span> String <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Correo no v치lido"</span></span>
<span class="token punctuation">)</span> <span class="token operator">:</span> Validador<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">valida</span><span class="token punctuation">(</span>texto<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> Validacion <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-object">object</span> <span class="token operator">:</span> Validacion <span class="token punctuation">{</span>
            <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-val">val</span> hayError<span class="token operator">:</span> Boolean
                <span class="token keyword keyword-get">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">!</span><span class="token function">Regex</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"^[A-Za-z](.*)([@]{1})(.{1,})(\\.)(.{1,})$"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>texto<span class="token punctuation">)</span>
            <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-val">val</span> mensajeError<span class="token operator">:</span> String
                <span class="token keyword keyword-get">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> error
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>As칤 vamos a tener validadores para validar que un campo de texto es un correo, un tel칠fono, un n칰mero entero, un n칰mero real, etc.</p>
<div style="page-break-after:always;"></div>
<h4 id="paso-3--definiendo-composables-reutilizables">Paso 3.- Definiendo composables reutilizables </h4>
<div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px">
<div style="width: 80%">
<p>Dentro del paquete <strong><code>ui</code></strong> vamos a crear el paquete <strong><code>composables</code></strong>. Aqu칤 ir치n aquellos composables 'gen칠ricos' creados por nosotros que podamos reutilizar en diferentes partes de nuestra aplicaci칩n o candidatos en otras aplicaciones.</p>
<p>Depender치n 칰nicamente de la <strong>capa de compose</strong> de <strong><code>material</code></strong> y por tanto podremos usar definiciones <strong><code>fundation</code></strong>, <strong><code>ui</code></strong> y <strong><code>runtime</code></strong>.</p>
<blockquote>
<p>游늷 <strong>Nota</strong>: Lo ideal es que se implementar치n en un proyecto a parte y se publicar치n como librer칤as para que puedan ser usadas en otros proyectos.</p>
</blockquote>
</div>
<div style="width: auto">
<p align="center" style="zoom:1" class="puml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="198px" preserveAspectRatio="none" style="width:176px;height:198px;background:#FFFFFF;" version="1.1" viewBox="0 0 176 198" width="176px" zoomAndPan="magnify"><defs></defs><g><rect fill="#EEEEEE" height="18.0938" style="stroke:#000000;stroke-width:1.0;" width="71" x="6" y="6"></rect><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="42" x="8" y="20.457">Android</text><line style="stroke:#000000;stroke-width:1.0;" x1="66" x2="66" y1="6" y2="24.0938"></line><polygon fill="#000000" points="69,12,75,12,72,19.0938" style="stroke:#000000;stroke-width:1.0;"></polygon><path d="M17,31.1875 L17,33.1875 L25,33.1875 L25,32.1875 L20,32.1875 L20,31.1875 L17,31.1875 M17,34.1875 L17,38.6875 C17,38.9675 17.22,39.1875 17.5,39.1875 L24.5,39.1875 C24.78,39.1875 25,38.9675 25,38.6875 L25,34.1875 L17,34.1875 " fill="#000000" style="stroke:;stroke-width:0.0;stroke-dasharray:;"></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="85" x="26" y="39.5508">[com.ahorcado]</text><path d="M27,46.2813 L27,48.2813 L35,48.2813 L35,47.2813 L30,47.2813 L30,46.2813 L27,46.2813 M27,49.2813 L27,53.7813 C27,54.0613 27.22,54.2813 27.5,54.2813 L34.5,54.2813 C34.78,54.2813 35,54.0613 35,53.7813 L35,49.2813 L27,49.2813 " fill="#000000" style="stroke:;stroke-width:0.0;stroke-dasharray:;"></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="30" x="36" y="54.6445">[data]</text><path d="M27,61.375 L27,63.375 L35,63.375 L35,62.375 L30,62.375 L30,61.375 L27,61.375 M27,64.375 L27,68.875 C27,69.155 27.22,69.375 27.5,69.375 L34.5,69.375 C34.78,69.375 35,69.155 35,68.875 L35,64.375 L27,64.375 " fill="#000000" style="stroke:;stroke-width:0.0;stroke-dasharray:;"></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="48" x="36" y="69.7383">[models]</text><path d="M27,76.4688 L27,78.4688 L35,78.4688 L35,77.4688 L30,77.4688 L30,76.4688 L27,76.4688 M27,79.4688 L27,83.9688 C27,84.2488 27.22,84.4688 27.5,84.4688 L34.5,84.4688 C34.78,84.4688 35,84.2488 35,83.9688 L35,79.4688 L27,79.4688 " fill="#000000" style="stroke:;stroke-width:0.0;stroke-dasharray:;"></path><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="18" x="36" y="84.832">[ui]</text><path d="M37,91.5625 L37,93.5625 L45,93.5625 L45,92.5625 L40,92.5625 L40,91.5625 L37,91.5625 M37,94.5625 L37,99.0625 C37,99.3425 37.22,99.5625 37.5,99.5625 L44.5,99.5625 C44.78,99.5625 45,99.3425 45,99.0625 L45,94.5625 L37,94.5625 " fill="#0000FF" style="stroke:;stroke-width:0.0;stroke-dasharray:;"></path><text fill="#0000FF" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="85" x="46" y="99.9258">[composables]</text><text fill="#0000FF" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="123" x="46" y="115.0195">CheckBoxCommon.kt</text><text fill="#0000FF" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="116" x="46" y="130.1133">FieldTextCommon.kt</text><text fill="#0000FF" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="118" x="46" y="145.207">FilterChipCommon.kt</text><path d="M37,151.9375 L37,153.9375 L45,153.9375 L45,152.9375 L40,152.9375 L40,151.9375 L37,151.9375 M37,154.9375 L37,159.4375 C37,159.7175 37.22,159.9375 37.5,159.9375 L44.5,159.9375 C44.78,159.9375 45,159.7175 45,159.4375 L45,154.9375 L37,154.9375 " fill="#000000" style="stroke:;stroke-width:0.0;stroke-dasharray:;"></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="51" x="46" y="160.3008">[features]</text><path d="M27,167.0313 L27,169.0313 L35,169.0313 L35,168.0313 L30,168.0313 L30,167.0313 L27,167.0313 M27,170.0313 L27,174.5313 C27,174.8113 27.22,175.0313 27.5,175.0313 L34.5,175.0313 C34.78,175.0313 35,174.8113 35,174.5313 L35,170.0313 L27,170.0313 " fill="#000000" style="stroke:;stroke-width:0.0;stroke-dasharray:;"></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="45" x="36" y="175.3945">[utilities]</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="114" x="26" y="190.4883">AgendaApplication.kt</text><rect fill="none" height="2" style="stroke:#888888;stroke-width:1.0;" width="2" x="9" y="33.6406"></rect><line style="stroke:#888888;stroke-width:1.0;" x1="10" x2="10" y1="36.6406" y2="49.7344"></line><line style="stroke:#888888;stroke-width:1.0;" x1="10" x2="18" y1="49.7344" y2="49.7344"></line><line style="stroke:#888888;stroke-width:1.0;" x1="10" x2="10" y1="36.6406" y2="64.8281"></line><line style="stroke:#888888;stroke-width:1.0;" x1="10" x2="18" y1="64.8281" y2="64.8281"></line><rect fill="none" height="2" style="stroke:#888888;stroke-width:1.0;" width="2" x="19" y="78.9219"></rect><line style="stroke:#888888;stroke-width:1.0;" x1="10" x2="10" y1="36.6406" y2="79.9219"></line><line style="stroke:#888888;stroke-width:1.0;" x1="10" x2="18" y1="79.9219" y2="79.9219"></line><rect fill="none" height="2" style="stroke:#888888;stroke-width:1.0;" width="2" x="29" y="94.0156"></rect><line style="stroke:#888888;stroke-width:1.0;" x1="20" x2="20" y1="81.9219" y2="95.0156"></line><line style="stroke:#888888;stroke-width:1.0;" x1="20" x2="28" y1="95.0156" y2="95.0156"></line><line style="stroke:#888888;stroke-width:1.0;" x1="30" x2="30" y1="97.0156" y2="110.1094"></line><line style="stroke:#888888;stroke-width:1.0;" x1="30" x2="38" y1="110.1094" y2="110.1094"></line><line style="stroke:#888888;stroke-width:1.0;" x1="30" x2="30" y1="97.0156" y2="125.2031"></line><line style="stroke:#888888;stroke-width:1.0;" x1="30" x2="38" y1="125.2031" y2="125.2031"></line><line style="stroke:#888888;stroke-width:1.0;" x1="30" x2="30" y1="97.0156" y2="140.2969"></line><line style="stroke:#888888;stroke-width:1.0;" x1="30" x2="38" y1="140.2969" y2="140.2969"></line><line style="stroke:#888888;stroke-width:1.0;" x1="20" x2="20" y1="81.9219" y2="155.3906"></line><line style="stroke:#888888;stroke-width:1.0;" x1="20" x2="28" y1="155.3906" y2="155.3906"></line><line style="stroke:#888888;stroke-width:1.0;" x1="10" x2="10" y1="36.6406" y2="170.4844"></line><line style="stroke:#888888;stroke-width:1.0;" x1="10" x2="18" y1="170.4844" y2="170.4844"></line><line style="stroke:#888888;stroke-width:1.0;" x1="10" x2="10" y1="36.6406" y2="185.5781"></line><line style="stroke:#888888;stroke-width:1.0;" x1="10" x2="18" y1="185.5781" y2="185.5781"></line><!--SRC=[XP3RQW8n48RlynHpLJoWgDNIBaNKLGjMKUhXfYZ4pQZ1RB8a4x58txshjMYbK7BtvPj_3Wr7t9BZYXWxi4LJ2skaMB33XENX-Mvbb41RVuzCNEGROoCkp9pbhxy49tw3OYDGkHFCvIxOotakby8JZOmoDbWgZ_LVRHBZ-5AXEwktRhZ1QDio-z34iT75BVsjTIKgCS4z_UifGXjkP78ZNcspGaxUehjPqfDKakIPDzUe1MycYP8H9tbAOf_fQwJy-xmZnJLD1ttOeNMf0ULYfLIvBvOhcQwLC8m8AYKeruBgKr2hGjWPJ-0eP5dcPTG7PxoD48HqPENI7tjaMO_lEBnvJJB608O9wbxxzGT0H- -aDJf6JQmt6ro4XsgX9Gd6QDDPO3PWRLnnhoYjY8oGUXt0TD8jFB8-rslFrsasEXQQDDT-1D0PVm40]--></g></svg></p></div>
</div>
<p>En nuestro caso tenemos:</p>
<blockquote>
<p>九 <strong>Importante:</strong> T칩mate unos minutos en examinar el c칩digo de estos composables y entender como funcionan. Prueba las previews para ver como se ven.</p>
</blockquote>
<ul>
<li>
<p><strong><a href="../../assets/codigo/ejercicios3_6/3_formulario_add_contacto_agenda/CheckBoxCommon.kt">CheckBoxCommon.kt 游댕</a></strong>: Composable que nos permite crear un <strong><code>CheckBox</code></strong> con una etiqueta.</p>
</li>
<li>
<p><strong><a href="../../assets/codigo/ejercicios3_6/3_formulario_add_contacto_agenda/FieldTextCommon.kt">FieldTextCommon.kt 游댕</a></strong>: Composables de utilidad que me van a permitir introducir un campo de texto con una etiqueta, una validaci칩n y en ocasiones un icono. Como por ejemplo...</p>
<ul>
<li><strong><code>OutlinedTextFieldEmail</code></strong> para introducir un email.</li>
<li><strong><code>OutlinedTextFieldPhone</code></strong> para introducir un tel칠fono.</li>
<li><strong><code>OutlinedTextFieldPassword</code></strong> para introducir una contrase침a.</li>
<li>etc.</li>
</ul>
<p>Puedes ver en la funci칩n <strong><code>@Composable</code></strong> con la previsualizaci칩n para tests un ejemplo de como usar estos componentes junto a las clase con la <strong>validacion</strong> y los diferentes <strong>validadores</strong> que hemos definido en el paso anterior.</p>
</li>
</ul>
<div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px; margin-left: 5px">
<div style="width: 70%">
<ul>
<li><strong><a href="../../assets/codigo/ejercicios3_6/3_formulario_add_contacto_agenda/FilterChipCommon.kt">FilterChipCommon.kt 游댕</a></strong>: Composable que nos permite crear un <strong><code>Chip</code></strong> con un texto y un icono para filtrar, tal y como indica en Material3. De momento no lo vamos a usar pero a침치delo tambi칠n a tu proyecto. Como puedes ver en las im치genes de ejemplo, el chip tiene dos estados. Uno que indica que el filtro se puede aplicar y otro que indica que el filtro est치 aplicado.</li>
</ul>
</div>
<div style="width: auto">
<img height="50px" src="../../assets/imagenes/ejercicios3_6/3_formulario_add_contacto_agenda/filterchip_unchecked.png">
<img style="margin-top: 5px" height="50px" src="../../assets/imagenes/ejercicios3_6/3_formulario_add_contacto_agenda/filterchip_checked.png">
</div>
</div>
<p>Estos <em>composables</em> junto a <strong><code>ImagenContacto.kt</code></strong> que ya deber칤a estar incluido en el proyecto, los usaremos en el siguiente paso para crear el formulario de contacto.</p>
<div style="page-break-after:always;"></div>
<h4 id="paso-4--creando-componente-de-seleccion-de-categor칤as">Paso 4.- Creando componente de seleccion de categor칤as </h4>
<div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px">
<div style="width: 80%">
<p>En ocasiones necesitamos crear componentes que no son gen칠ricos y que solo se van a usar en un sitio concreto de nuestra aplicaci칩n. Este es el caso de la selecci칩n de categor칤as que vamos a usar en el formulario de contacto. Sin embargo, el hacerlo nos va a permitir reutilizarlo y descomponer un estado complejo en estados m치s simples como pudiera ser el que guarda la selecci칩n de categor칤as.</p>
<p>En este caso vamos a crearlo dentro de la carpeta <strong><code>features</code></strong> y dentro <strong>vamos a crear el paquete</strong> <strong><code>formcontacto</code></strong> donde va a ir la implementaci칩n del mismo. Como la selecci칩n de categor칤as es un sub-componente del mismo, lo vamos a crear a su vez en un paquete denominado <strong><code>formcontacto.seleccioncategorias</code></strong>.</p>
</div>
<div style="width: auto">
<p align="center" style="zoom:1" class="puml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="274px" preserveAspectRatio="none" style="width:205px;height:274px;background:#FFFFFF;" version="1.1" viewBox="0 0 205 274" width="205px" zoomAndPan="magnify"><defs></defs><g><rect fill="#EEEEEE" height="18.0938" style="stroke:#000000;stroke-width:1.0;" width="71" x="6" y="6"></rect><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="42" x="8" y="20.457">Android</text><line style="stroke:#000000;stroke-width:1.0;" x1="66" x2="66" y1="6" y2="24.0938"></line><polygon fill="#000000" points="69,12,75,12,72,19.0938" style="stroke:#000000;stroke-width:1.0;"></polygon><path d="M17,31.1875 L17,33.1875 L25,33.1875 L25,32.1875 L20,32.1875 L20,31.1875 L17,31.1875 M17,34.1875 L17,38.6875 C17,38.9675 17.22,39.1875 17.5,39.1875 L24.5,39.1875 C24.78,39.1875 25,38.9675 25,38.6875 L25,34.1875 L17,34.1875 " fill="#000000" style="stroke:;stroke-width:0.0;stroke-dasharray:;"></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="85" x="26" y="39.5508">[com.ahorcado]</text><path d="M27,46.2813 L27,48.2813 L35,48.2813 L35,47.2813 L30,47.2813 L30,46.2813 L27,46.2813 M27,49.2813 L27,53.7813 C27,54.0613 27.22,54.2813 27.5,54.2813 L34.5,54.2813 C34.78,54.2813 35,54.0613 35,53.7813 L35,49.2813 L27,49.2813 " fill="#000000" style="stroke:;stroke-width:0.0;stroke-dasharray:;"></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="30" x="36" y="54.6445">[data]</text><path d="M27,61.375 L27,63.375 L35,63.375 L35,62.375 L30,62.375 L30,61.375 L27,61.375 M27,64.375 L27,68.875 C27,69.155 27.22,69.375 27.5,69.375 L34.5,69.375 C34.78,69.375 35,69.155 35,68.875 L35,64.375 L27,64.375 " fill="#000000" style="stroke:;stroke-width:0.0;stroke-dasharray:;"></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="48" x="36" y="69.7383">[models]</text><path d="M27,76.4688 L27,78.4688 L35,78.4688 L35,77.4688 L30,77.4688 L30,76.4688 L27,76.4688 M27,79.4688 L27,83.9688 C27,84.2488 27.22,84.4688 27.5,84.4688 L34.5,84.4688 C34.78,84.4688 35,84.2488 35,83.9688 L35,79.4688 L27,79.4688 " fill="#000000" style="stroke:;stroke-width:0.0;stroke-dasharray:;"></path><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="18" x="36" y="84.832">[ui]</text><path d="M37,91.5625 L37,93.5625 L45,93.5625 L45,92.5625 L40,92.5625 L40,91.5625 L37,91.5625 M37,94.5625 L37,99.0625 C37,99.3425 37.22,99.5625 37.5,99.5625 L44.5,99.5625 C44.78,99.5625 45,99.3425 45,99.0625 L45,94.5625 L37,94.5625 " fill="#000000" style="stroke:;stroke-width:0.0;stroke-dasharray:;"></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="82" x="46" y="99.9258">[composables]</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="119" x="46" y="115.0195">CheckBoxCommon.kt</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="120" x="46" y="130.1133">FieldTextsCommon.kt</text><path d="M37,136.8438 L37,138.8438 L45,138.8438 L45,137.8438 L40,137.8438 L40,136.8438 L37,136.8438 M37,139.8438 L37,144.3438 C37,144.6238 37.22,144.8438 37.5,144.8438 L44.5,144.8438 C44.78,144.8438 45,144.6238 45,144.3438 L45,139.8438 L37,139.8438 " fill="#000000" style="stroke:;stroke-width:0.0;stroke-dasharray:;"></path><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="56" x="46" y="145.207">[features]</text><path d="M47,151.9375 L47,153.9375 L55,153.9375 L55,152.9375 L50,152.9375 L50,151.9375 L47,151.9375 M47,154.9375 L47,159.4375 C47,159.7175 47.22,159.9375 47.5,159.9375 L54.5,159.9375 C54.78,159.9375 55,159.7175 55,159.4375 L55,154.9375 L47,154.9375 " fill="#000000" style="stroke:;stroke-width:0.0;stroke-dasharray:;"></path><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="79" x="56" y="160.3008">[components]</text><path d="M47,167.0313 L47,169.0313 L55,169.0313 L55,168.0313 L50,168.0313 L50,167.0313 L47,167.0313 M47,170.0313 L47,174.5313 C47,174.8113 47.22,175.0313 47.5,175.0313 L54.5,175.0313 C54.78,175.0313 55,174.8113 55,174.5313 L55,170.0313 L47,170.0313 " fill="#0000FF" style="stroke:;stroke-width:0.0;stroke-dasharray:;"></path><text fill="#0000FF" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="85" x="56" y="175.3945">[formcontacto]</text><path d="M57,182.125 L57,184.125 L65,184.125 L65,183.125 L60,183.125 L60,182.125 L57,182.125 M57,185.125 L57,189.625 C57,189.905 57.22,190.125 57.5,190.125 L64.5,190.125 C64.78,190.125 65,189.905 65,189.625 L65,185.125 L57,185.125 " fill="#4169E1" style="stroke:;stroke-width:0.0;stroke-dasharray:;"></path><text fill="#4169E1" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="124" x="66" y="190.4883">[seleccioncategorias]</text><text fill="#4169E1" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="132" x="66" y="205.582">SeleccionCategorias.kt</text><path d="M47,212.3125 L47,214.3125 L55,214.3125 L55,213.3125 L50,213.3125 L50,212.3125 L47,212.3125 M47,215.3125 L47,219.8125 C47,220.0925 47.22,220.3125 47.5,220.3125 L54.5,220.3125 C54.78,220.3125 55,220.0925 55,219.8125 L55,215.3125 L47,215.3125 " fill="#000000" style="stroke:;stroke-width:0.0;stroke-dasharray:;"></path><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="83" x="56" y="220.6758">[vercontactos]</text><text fill="#0000FF" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="110" x="46" y="235.7695">CategoriaUiState.kt</text><path d="M27,242.5 L27,244.5 L35,244.5 L35,243.5 L30,243.5 L30,242.5 L27,242.5 M27,245.5 L27,250 C27,250.28 27.22,250.5 27.5,250.5 L34.5,250.5 C34.78,250.5 35,250.28 35,250 L35,245.5 L27,245.5 " fill="#000000" style="stroke:;stroke-width:0.0;stroke-dasharray:;"></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="45" x="36" y="250.8633">[utilities]</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="114" x="26" y="265.957">AgendaApplication.kt</text><rect fill="none" height="2" style="stroke:#888888;stroke-width:1.0;" width="2" x="9" y="33.6406"></rect><line style="stroke:#888888;stroke-width:1.0;" x1="10" x2="10" y1="36.6406" y2="49.7344"></line><line style="stroke:#888888;stroke-width:1.0;" x1="10" x2="18" y1="49.7344" y2="49.7344"></line><line style="stroke:#888888;stroke-width:1.0;" x1="10" x2="10" y1="36.6406" y2="64.8281"></line><line style="stroke:#888888;stroke-width:1.0;" x1="10" x2="18" y1="64.8281" y2="64.8281"></line><rect fill="none" height="2" style="stroke:#888888;stroke-width:1.0;" width="2" x="19" y="78.9219"></rect><line style="stroke:#888888;stroke-width:1.0;" x1="10" x2="10" y1="36.6406" y2="79.9219"></line><line style="stroke:#888888;stroke-width:1.0;" x1="10" x2="18" y1="79.9219" y2="79.9219"></line><rect fill="none" height="2" style="stroke:#888888;stroke-width:1.0;" width="2" x="29" y="94.0156"></rect><line style="stroke:#888888;stroke-width:1.0;" x1="20" x2="20" y1="81.9219" y2="95.0156"></line><line style="stroke:#888888;stroke-width:1.0;" x1="20" x2="28" y1="95.0156" y2="95.0156"></line><line style="stroke:#888888;stroke-width:1.0;" x1="30" x2="30" y1="97.0156" y2="110.1094"></line><line style="stroke:#888888;stroke-width:1.0;" x1="30" x2="38" y1="110.1094" y2="110.1094"></line><line style="stroke:#888888;stroke-width:1.0;" x1="30" x2="30" y1="97.0156" y2="125.2031"></line><line style="stroke:#888888;stroke-width:1.0;" x1="30" x2="38" y1="125.2031" y2="125.2031"></line><rect fill="none" height="2" style="stroke:#888888;stroke-width:1.0;" width="2" x="29" y="139.2969"></rect><line style="stroke:#888888;stroke-width:1.0;" x1="20" x2="20" y1="81.9219" y2="140.2969"></line><line style="stroke:#888888;stroke-width:1.0;" x1="20" x2="28" y1="140.2969" y2="140.2969"></line><line style="stroke:#888888;stroke-width:1.0;" x1="30" x2="30" y1="142.2969" y2="155.3906"></line><line style="stroke:#888888;stroke-width:1.0;" x1="30" x2="38" y1="155.3906" y2="155.3906"></line><rect fill="none" height="2" style="stroke:#888888;stroke-width:1.0;" width="2" x="39" y="169.4844"></rect><line style="stroke:#888888;stroke-width:1.0;" x1="30" x2="30" y1="142.2969" y2="170.4844"></line><line style="stroke:#888888;stroke-width:1.0;" x1="30" x2="38" y1="170.4844" y2="170.4844"></line><rect fill="none" height="2" style="stroke:#888888;stroke-width:1.0;" width="2" x="49" y="184.5781"></rect><line style="stroke:#888888;stroke-width:1.0;" x1="40" x2="40" y1="172.4844" y2="185.5781"></line><line style="stroke:#888888;stroke-width:1.0;" x1="40" x2="48" y1="185.5781" y2="185.5781"></line><line style="stroke:#888888;stroke-width:1.0;" x1="50" x2="50" y1="187.5781" y2="200.6719"></line><line style="stroke:#888888;stroke-width:1.0;" x1="50" x2="58" y1="200.6719" y2="200.6719"></line><line style="stroke:#888888;stroke-width:1.0;" x1="30" x2="30" y1="142.2969" y2="215.7656"></line><line style="stroke:#888888;stroke-width:1.0;" x1="30" x2="38" y1="215.7656" y2="215.7656"></line><line style="stroke:#888888;stroke-width:1.0;" x1="30" x2="30" y1="142.2969" y2="230.8594"></line><line style="stroke:#888888;stroke-width:1.0;" x1="30" x2="38" y1="230.8594" y2="230.8594"></line><line style="stroke:#888888;stroke-width:1.0;" x1="10" x2="10" y1="36.6406" y2="245.9531"></line><line style="stroke:#888888;stroke-width:1.0;" x1="10" x2="18" y1="245.9531" y2="245.9531"></line><line style="stroke:#888888;stroke-width:1.0;" x1="10" x2="10" y1="36.6406" y2="261.0469"></line><line style="stroke:#888888;stroke-width:1.0;" x1="10" x2="18" y1="261.0469" y2="261.0469"></line><!--SRC=[TLBTIYCn5BxFK-HAj6AnjIwxmoBMiHLgYxBJUhCed2QdOp2JKvAJeeZllh53QwUupCtm_Kyobu71Sm3BGhoBfxxJden-4kzJSIn_7op8QlGNVnLLRNWchq3JepZUfJGmx44LQRHX3RPQNt0qZwrM0lU2bnHWRd6jJrp-ZEhbYbvpgYfoxHUkuQ51gwVuog51D0eM21nzIgfhckIwoQ7Z1gt8ai_cDkB5JWxvIf5ZK4mRyOxQqnlOFKj0YqePSWeOI_86jZNVMukD8TyQqYTzDto5VZFcVzEt6JDJS7glavgN4jbOmwO-PzalqMdeBvVMfCMcFi-Fz5mclFuTxYqudat6CWq8II4xxUvfzwpTwHuElP5tYcNtL7REizwlxBmdyq4nbP-28t5uSp-MWQ9NABK9xCqyVdOSYH6iGFw9Zas5cRnReXjTtsu0EN0huybLwPB4w67o9VZHExaoB0lqQOjyc8XhN42qd1oAj75b9cVJuSbFCGPNHYXJDWQHKyhrRvaS5Fy0]--></g></svg></p></div>
</div>
<p>Adem치s, vamos a reutilizar la clase de estado <strong><code>CatergoriaUiState.kt</code></strong> que definimos en el ejercicio 1 del tema 3.6 y que me permit칤a tener un estado para las categor칤as de un contacto y asociarlo a un icono. Deber칤as tenerla ya definida en <strong><code>ui.features.vercontactos</code></strong>. Puesto que ahora la vamos a usar en m치s sitios vamos a moverla a <strong><code>ui.features</code></strong> como se muestra en el esquema de carpetas para que su alcance abarque ambos componentes.</p>
<ul>
<li>
<p><strong>CatergoriaUiState.kt</strong>: Nos define un estado para dicho componente.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">CatergoriaUiState</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-val">val</span> amigos<span class="token operator">:</span> Boolean <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> amigosIcon <span class="token operator">:</span> ImageVector <span class="token operator">=</span> Icons<span class="token punctuation">.</span>Filled<span class="token punctuation">.</span>SportsEsports<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> trabajo<span class="token operator">:</span> Boolean <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> trabajoIcon <span class="token operator">:</span> ImageVector <span class="token operator">=</span> Icons<span class="token punctuation">.</span>Filled<span class="token punctuation">.</span>Work<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> familia<span class="token operator">:</span> Boolean <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> familiaIcon <span class="token operator">:</span> ImageVector <span class="token operator">=</span> Icons<span class="token punctuation">.</span>Filled<span class="token punctuation">.</span>FamilyRestroom<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> emergencias<span class="token operator">:</span> Boolean <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> emergenciasIcon <span class="token operator">:</span> ImageVector <span class="token operator">=</span> Icons<span class="token punctuation">.</span>Filled<span class="token punctuation">.</span>MedicalServices
<span class="token punctuation">)</span>
</code></pre></li>
</ul>
<p>La implementaci칩n del componente de selecci칩n de categor칤as es la siguiente:</p>
<div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px">
<div style="width: 70%">
<ul>
<li><strong><a href="../../assets/codigo/ejercicios3_6/3_formulario_add_contacto_agenda/SeleccionCategorias.kt">SeleccionCategorias.kt 游댕</a></strong>: Encapsula o <em>modulariza</em> la funcionalidad de seleccionar una categor칤a para el contacto en un componente. Para ello, define dos <em>composables</em> <strong><code>SeleccionCategoriasConCheckBox</code></strong> y <strong><code>SeleccionCategoriasConFilterChip</code></strong> que me van a permitir marcar o demarcar una determinada categor칤a para el contacto. En el caso de los checks para asign치rsela o no y en el segundo para una futura funcionalidad de filtrado por categor칤as.</li>
</ul>
</div>
<div style="width: auto">
<img height="175px" src="../../assets/imagenes/ejercicios3_6/3_formulario_add_contacto_agenda/seleccion_categorias_portrait.png">
</div>
</div>
<p>El interfaz de usuario del componente <strong><code>SeleccionCategoriasConCheckBox</code></strong> es el siguiente:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">SeleccionCategoriasConCheckBox</span><span class="token punctuation">(</span>
    modifier<span class="token operator">:</span> Modifier <span class="token operator">=</span> Modifier<span class="token punctuation">,</span>
    etiquetaGrupoState<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token comment">// Recibe el estado de las categor칤as</span>
    categoriaState<span class="token operator">:</span> CatergoriaUiState<span class="token punctuation">,</span>
    <span class="token comment">// Eleva cualquier cambio en el estado de las categor칤as.</span>
    onCategoriaChanged<span class="token operator">:</span> <span class="token punctuation">(</span>CatergoriaUiState<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit
<span class="token punctuation">)</span>
</code></pre><p>Para poder mostrar los checks sin repetir el c칩digo. Definiremos la clase <strong><code>CheckBoxUiState</code></strong> que encapsula el estado de un check. De esta forma, podemos definir una lista de <strong><code>CheckBoxUiState</code></strong> y recorrerla para mostrar los checks. Para ello, el componente <strong><code>CheckBoxCommon</code></strong> que definimos en el paso anterior.</p>
<blockquote>
<p>游늷 <strong>Nota</strong>: En este caso el coste de eficiencia de crear la lista al recomponerse el componente por un cambio de estado en las categor칤as es m칤nimo y no afecta al rendimiento. Adem치s, es compensado al no tener que <strong>repetir el c칩digo de cada check</strong>.</p>
</blockquote>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">CheckBoxUiState</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-val">val</span> label <span class="token operator">:</span> String <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">""</span></span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> selected<span class="token operator">:</span> Boolean <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> icon<span class="token operator">:</span> ImageVector<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> onClick<span class="token operator">:</span> <span class="token punctuation">(</span>Boolean<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token keyword keyword-val">val</span> contenido <span class="token operator">=</span> <span class="token function">listOf</span><span class="token punctuation">(</span>
    <span class="token function">CheckBoxUiState</span><span class="token punctuation">(</span>
        label <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Familia"</span></span><span class="token punctuation">,</span>
        selected <span class="token operator">=</span> categoriaState<span class="token punctuation">.</span>familia<span class="token punctuation">,</span>
        icon <span class="token operator">=</span> categoriaState<span class="token punctuation">.</span>familiaIcon<span class="token punctuation">,</span>
        <span class="token comment">// Cambiamos toda la clase de estado de categor칤as</span>
        onClick <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">onCategoriaChanged</span><span class="token punctuation">(</span>categoriaState<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>familia <span class="token operator">=</span> it<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">CheckBoxUiState</span><span class="token punctuation">(</span>
        label <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Amigos"</span></span><span class="token punctuation">,</span>
        selected <span class="token operator">=</span> categoriaState<span class="token punctuation">.</span>amigos<span class="token punctuation">,</span>
        icon <span class="token operator">=</span> categoriaState<span class="token punctuation">.</span>amigosIcon<span class="token punctuation">,</span>
        onClick <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">onCategoriaChanged</span><span class="token punctuation">(</span>categoriaState<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>amigos <span class="token operator">=</span> it<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span>
</code></pre><div style="page-break-after:always;"></div>
<p>Ahora podemos pasar la lista de <strong><code>CheckBoxUiState</code></strong> a un <strong><code>LazyVerticalGrid</code></strong> de tal manera que se muestren en una <strong>cuadricula adaptable al ancho</strong> y como hemos comentado nos evitar repetir el c칩digo de cada check, adem치s de, no tener que hacer una maquetaci칩n compleja para mostrarlos.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token function">Column</span><span class="token punctuation">(</span>modifier <span class="token operator">=</span> modifier<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Text</span><span class="token punctuation">(</span>text <span class="token operator">=</span> etiquetaGrupoState<span class="token punctuation">)</span>

    <span class="token function">LazyVerticalGrid</span><span class="token punctuation">(</span>
        columns <span class="token operator">=</span> GridCells<span class="token punctuation">.</span><span class="token function">Adaptive</span><span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span><span class="token punctuation">,</span>
        contentPadding <span class="token operator">=</span> <span class="token function">PaddingValues</span><span class="token punctuation">(</span>all <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span><span class="token punctuation">,</span>
        horizontalArrangement <span class="token operator">=</span> Arrangement<span class="token punctuation">.</span><span class="token function">spacedBy</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">items</span><span class="token punctuation">(</span>contenido<span class="token punctuation">)</span> <span class="token punctuation">{</span> item <span class="token operator">-&gt;</span>
            <span class="token function">CheckboxWithLabel</span><span class="token punctuation">(</span>
                label <span class="token operator">=</span> item<span class="token punctuation">.</span>label<span class="token punctuation">,</span>
                checkedState <span class="token operator">=</span> item<span class="token punctuation">.</span>selected<span class="token punctuation">,</span>
                enabledState <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                onStateChange <span class="token operator">=</span> item<span class="token punctuation">.</span>onClick
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>F칤jate en la imagen de abajo como al ser el ancho de las columnas adaptable, se ajustan al ancho de la pantalla. Adem치s, al ser un <strong><code>LazyVerticalGrid</code></strong> se ajusta a la altura de los elementos que contiene.</p>
<div style="display: flex; justify-content: center; align-items: center; margin-top: 15px; margin-bottom: 15px">
<img height="125px" src="../../assets/imagenes/ejercicios3_6/3_formulario_add_contacto_agenda/seleccion_categorias_landscape.png">
</div>
<div style="page-break-after:always;"></div>
<h4 id="paso-5--creando-el-formulario-de-contacto">Paso 5.- Creando el formulario de contacto </h4>
<div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px">
<div style="width: 70%">
<p>Ya tenemos todos los elementos necesarios para crear el formulario de contacto. Para ello, vamos a crear el componente <strong><code>FormContactoScreen</code></strong> dentro del paquete <strong><code>ui.features.formcontacto</code></strong> que hemos creado en el pasos anteriores. En 칠l vamos a tener pues los siguientes elementos como se muestra en la im치genes de ejemplo:</p>
<ol>
<li>Una <strong><code>ImagenContacto</code></strong> que creamos en ejercicios anteriores, que adem치s ir치 en un <strong><code>Box</code></strong> con dos <strong><code>OutlinedIconButton</code></strong> de <strong>Material3</strong> que <strong>en el futuro</strong> nos permitir치n cambiar la imagen del contacto ya sea haciendo una foto o seleccion치ndola de la galer칤a de im치genes.</li>
<li>El componente <strong><code>SeleccionCategoriasConCheckBox</code></strong> que acabamos de crear para seleccionar las categor칤as.</li>
<li>Varios <strong><code>OutlinedTextField</code></strong> definidos en <strong><code>FieldTextCommon.kt</code></strong> para introducir los datos del contacto.</li>
<li>Un FAB que nos permitir치 guardar las modificaciones.</li>
<li>Por 칰ltimo, un <strong><code>SnackBar</code></strong> que nos indicar치 si tenemos alg칰n error de validaci칩n a resolver.</li>
</ol>
</div>
<div style="width: auto">
<img height="400px" src="../../assets/imagenes/ejercicios3_6/3_formulario_add_contacto_agenda/form_contacto_portrait.png">
</div>
</div>
<div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px">
<div style="width: 50%">
<p>Adem치s, para mejorar la experiencia de usuario y como ya vimos en el el juego del ahorcado. Vamos a usar un <strong><code>BoxWithConstraints</code></strong> para en el caso de que giremos el dispositivo a horizontal, mostrar el formulario en dos columnas. Teniendo en cuenta la introducci칩n de datos deber칤a ser <em>Scrollable</em> verticalmente.</p>
</div>
<div style="width: auto">
<img height="175px" src="../../assets/imagenes/ejercicios3_6/3_formulario_add_contacto_agenda/form_contacto_landscape.png">
</div>
</div>
<p>Sin embargo, antes de empezar a definir el interfaz. Vamos a concretar las clases de estado que vamos a necesitar para el formulario y de gesti칩n de eventos sobre el mismo.</p>
<ol>
<li>
<p><strong><code>ContactoUiState.kt</code></strong> que guardaba el estado de un contacto en la lista y que ten칤amos en el paquete <strong><code>ui.features.vercontactos</code></strong>. La reutilizaremos ahora para guardar los datos del contacto en el formulario por tanto la moveremos a <strong><code>ui.features</code></strong> junto a <strong><code>CatergoriaUiState.kt</code></strong></p>
</li>
<li>
<p>Adem치s del estado de un estado de los datos del contacto, vamos a necesitar un estado que gestione la validaci칩n de los mismos. Para segregar responsabilidades, vamos a definirlo en una clase de estado propia denominada <strong><a href="../../assets/codigo/ejercicios3_6/3_formulario_add_contacto_agenda/ValidacionContactoUiState.kt">ValidacionContactoUiState.kt</a></strong> la cual, adem치s de tener un estado de validaci칩n para cada campo de texto, va tambi칠n concretar la abstracci칩n <strong><code>Validacion</code></strong> para el conjunto de datos de un contacto. Esto es, el formulario completo.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">ValidacionContactoUiState</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-val">val</span> validacionNombre<span class="token operator">:</span> Validacion <span class="token operator">=</span> <span class="token keyword keyword-object">object</span> <span class="token operator">:</span> Validacion <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> validacionApellidos<span class="token operator">:</span> Validacion <span class="token operator">=</span> <span class="token keyword keyword-object">object</span> <span class="token operator">:</span> Validacion <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> validacionCorreo<span class="token operator">:</span> Validacion <span class="token operator">=</span> <span class="token keyword keyword-object">object</span> <span class="token operator">:</span> Validacion <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> validacionTelefono<span class="token operator">:</span> Validacion <span class="token operator">=</span> <span class="token keyword keyword-object">object</span> <span class="token operator">:</span> Validacion <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span> <span class="token operator">:</span> Validacion <span class="token punctuation">{</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-var">var</span> validacionCompuesta<span class="token operator">:</span> ValidacionCompuesta<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword keyword-null">null</span>

    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">componerValidacion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> ValidacionCompuesta <span class="token punctuation">{</span>
        validacionCompuesta <span class="token operator">=</span> <span class="token function">ValidacionCompuesta</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>validacionNombre<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>validacionApellidos<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>validacionCorreo<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>validacionTelefono<span class="token punctuation">)</span>
        <span class="token keyword keyword-return">return</span> validacionCompuesta<span class="token operator">!!</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Puesto que la validaci칩n se compone de otras validaciones,</span>
    <span class="token comment">// delegamos en la validaci칩n compuesta. Que calculamos en el momento del acceso.</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-val">val</span> hayError<span class="token operator">:</span> Boolean
        <span class="token keyword keyword-get">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> validacionCompuesta<span class="token operator">?</span><span class="token punctuation">.</span>hayError <span class="token operator">?:</span> <span class="token function">componerValidacion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hayError
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-val">val</span> mensajeError<span class="token operator">:</span> String<span class="token operator">?</span>
<span class="token comment">//        get() = "Revisa los datos del contacto"</span>
        <span class="token keyword keyword-get">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> validacionCompuesta<span class="token operator">?</span><span class="token punctuation">.</span>mensajeError <span class="token operator">?:</span> <span class="token function">componerValidacion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mensajeError
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p>Vamos a definir otra clase denominada <strong><a href="../../assets/codigo/ejercicios3_6/3_formulario_add_contacto_agenda/ValidadorContacto.kt">ValidadorContacto.kt</a></strong> que encapsule la l칩gica de validaci칩n de los datos del contacto a trav칠s de la clase de estado definida anteriormente. Para ello:</p>
<ol>
<li>
<p>Definiremos la clase que concrete la interfaz <strong><code>Validador</code></strong> para el conjunto de datos de un contacto. Esto es, el formulario completo. Para ello haremos:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-class">class</span> ValidadorContacto <span class="token annotation builtin">@Inject</span> <span class="token keyword keyword-constructor">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> Validador<span class="token operator">&lt;</span>ContactoUiState<span class="token operator">&gt;</span> 
</code></pre><blockquote>
<p>游늷 <strong>Nota</strong>: F칤jate que si estamos usando Hilt, hemos preparado la clase para ser inyectada posteriomente como clase colaboradora en el <strong>ViewModel</strong> y as칤 segregar responsabilidades del mismo.</p>
</blockquote>
</li>
<li>
<p>vamos a definir los <em><strong>'Validadores'</strong></em> que necesitamos para cada campo de <strong>texto</strong>.</p>
<p>Por ejemplo, para el texto introducido en el <strong>TextField</strong> de <strong>tel칠fono</strong> vamos a tener la siguiente <em>'validador'</em>:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-val">val</span> validadorTelefono <span class="token operator">=</span> ValidadorCompuesto<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">ValidadorTextoNoVacio</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"El tel칠fono puede estar vac칤o"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">ValidadorLongitudMinimaTexto</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"El tel칠fono debe tener 9 caracteres"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">ValidadorLongitudMaximaTexto</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"El tel칠fono debe tener 18 caracteres"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">ValidadorTelefono</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"El tel칠fono no es v치lido"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><blockquote>
<p>游늷 <strong>Nota</strong>: F칤jate que el tipo parametrizado es de tipo texto <strong><code>ValidadorCompuesto&lt;String&gt;</code></strong> por que es lo que se va a validar de forma compuesta.</p>
</blockquote>
</li>
<li>
<p>Por 칰ltimo, debemos invalidar el m칠todo <strong><code>valida</code></strong> de la interfaz <strong><code>Validador</code></strong> para el conjunto de datos de un contacto. El cual como indicaba el tipo parametrizado, aceptar치 los datos de un <strong><code>ContactoUiState</code></strong> y devolver치 un <strong><code>ValidacionContactoUiState</code></strong> que recordemos que implementa la interfaz <strong><code>Validacion</code></strong>. Para ello, haremos:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">valida</span><span class="token punctuation">(</span>contatoState <span class="token operator">:</span> ContactoUiState<span class="token punctuation">)</span><span class="token operator">:</span> ValidacionContactoUiState <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> validacionNombre <span class="token operator">=</span> validadorNombre<span class="token punctuation">.</span><span class="token function">valida</span><span class="token punctuation">(</span>contatoState<span class="token punctuation">.</span>nombre<span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> validacionApellidos <span class="token operator">=</span> validadorApellidos<span class="token punctuation">.</span><span class="token function">valida</span><span class="token punctuation">(</span>contatoState<span class="token punctuation">.</span>apellidos<span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> validacionCorreo <span class="token operator">=</span> validadorCorreo<span class="token punctuation">.</span><span class="token function">valida</span><span class="token punctuation">(</span>contatoState<span class="token punctuation">.</span>correo<span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> validacionTelefono <span class="token operator">=</span> validadorTelefono<span class="token punctuation">.</span><span class="token function">valida</span><span class="token punctuation">(</span>contatoState<span class="token punctuation">.</span>telefono<span class="token punctuation">)</span>

    <span class="token keyword keyword-return">return</span> <span class="token function">ValidacionContactoUiState</span><span class="token punctuation">(</span>
        validacionNombre <span class="token operator">=</span> validacionNombre<span class="token punctuation">,</span>
        validacionApellidos <span class="token operator">=</span> validacionApellidos<span class="token punctuation">,</span>
        validacionCorreo <span class="token operator">=</span> validacionCorreo<span class="token punctuation">,</span>
        validacionTelefono <span class="token operator">=</span> validacionTelefono
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></li>
</ol>
<p>Como ya veremos, posteriormente en el <strong>ViewModel</strong> que gestione el formulario, podremos usarlo de la siguiente forma:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-var">var</span> validacionContactoState <span class="token operator">=</span> <span class="token function">mutableStateOf</span><span class="token punctuation">(</span><span class="token function">ValidacionContactoUiState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword keyword-var">var</span> validadorContacto <span class="token operator">=</span> <span class="token function">ValidadorContacto</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Ser치 inyectado</span>

<span class="token comment">// Para validar en el evento dse cambio en un campo concreto </span>
<span class="token comment">// como por ejemplo el tel칠fono haremos.</span>
<span class="token comment">// Nota: F칤jate que actualizamos en el estado solo la validaci칩n del tel칠fono.</span>
validacionContactoState <span class="token operator">=</span> validacionContactoState<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>
    validacionTelefono <span class="token operator">=</span> validadorContacto<span class="token punctuation">.</span>validadorTelefono<span class="token punctuation">.</span><span class="token function">valida</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>telefono<span class="token punctuation">)</span>
<span class="token punctuation">)</span>

<span class="token comment">// Para validar el formulario completo haremos...</span>
validacionContactoState <span class="token operator">=</span> validadorContacto<span class="token punctuation">.</span><span class="token function">valida</span><span class="token punctuation">(</span>contactoState<span class="token punctuation">)</span>
</code></pre></li>
<li>
<p>Definiremos un interfaz sellado <strong><a href="../../assets/codigo/ejercicios3_6/3_formulario_add_contacto_agenda/ContactoEvent.kt">ContactoEvent.kt</a></strong> dentro de <strong><code>ui.features.formcontacto</code></strong>, que abstraiga los eventos que se pueden producir en el formulario.</p>
<p>Vamos a tener en cuenta los siguientes eventos. Aunque ahora mismo no los vamos a gestionar todos de momento.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-sealed">sealed</span> <span class="token keyword keyword-interface">interface</span> ContactoEvent <span class="token punctuation">{</span>
    <span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">OnChangeCategoria</span><span class="token punctuation">(</span><span class="token keyword keyword-val">val</span> categoria<span class="token operator">:</span> CatergoriaUiState<span class="token punctuation">)</span> <span class="token operator">:</span> ContactoEvent
    <span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">OnChangeNombre</span><span class="token punctuation">(</span><span class="token keyword keyword-val">val</span> nombre<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token operator">:</span> ContactoEvent
    <span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">OnChangeApellidos</span><span class="token punctuation">(</span><span class="token keyword keyword-val">val</span> apellidos<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token operator">:</span> ContactoEvent
    <span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">OnChangeCorreo</span><span class="token punctuation">(</span><span class="token keyword keyword-val">val</span> correo<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token operator">:</span> ContactoEvent
    <span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">OnChangeTelefono</span><span class="token punctuation">(</span><span class="token keyword keyword-val">val</span> telefono<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token operator">:</span> ContactoEvent
    <span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">OnChangeFoto</span><span class="token punctuation">(</span><span class="token keyword keyword-val">val</span> foto<span class="token operator">:</span> ImageBitmap<span class="token punctuation">)</span> <span class="token operator">:</span> ContactoEvent
    <span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">OnSaveContacto</span><span class="token punctuation">(</span>
        <span class="token keyword keyword-val">val</span> onNavigateTrasFormContacto<span class="token operator">:</span> <span class="token punctuation">(</span>actualizaContactos <span class="token operator">:</span> Boolean<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit<span class="token punctuation">)</span> 
    <span class="token operator">:</span> ContactoEvent
    <span class="token keyword keyword-data">data</span> <span class="token keyword keyword-object">object</span> OnDismissError <span class="token operator">:</span> ContactoEvent
<span class="token punctuation">}</span>
</code></pre></li>
</ol>
<p>Con todo esto ya podemos definir el interfaz de usuario del formulario de contacto. Para ello, vamos a crear el componente <strong><code>FormContactoScreen</code></strong> dentro del paquete <strong><code>ui.features.formcontacto</code></strong>.</p>
<p>El interfaz de usuario del mismo es el siguiente:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">FormContactoScreen</span><span class="token punctuation">(</span>
    contactoState<span class="token operator">:</span> ContactoUiState<span class="token punctuation">,</span>
    validacionContactoState<span class="token operator">:</span> ValidacionContactoUiState<span class="token punctuation">,</span>
    onContactoEvent<span class="token operator">:</span> <span class="token punctuation">(</span>ContactoEvent<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit<span class="token punctuation">,</span>
    onNavigateTrasFormContacto<span class="token operator">:</span> <span class="token punctuation">(</span>actualizaContactos<span class="token operator">:</span> Boolean<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit
<span class="token punctuation">)</span>
</code></pre><p>Como ves, hemos agrupado estados relacionados y hemos intentado separar la gesti칩n de los eventos. Por 칰ltimo, recibiremos una funci칩n <strong><code>onNavigateTrasFormContacto</code></strong> que nos permitir치 navegar a la pantalla de lista de contactos una vez guardado el contacto y que de momento no vamos a darle funcionalidad.</p>
<p>Puedes descargarte del siguiente enlace el c칩digo de este componente y a침adirlo a tu proyecto. <strong><a href="../../assets/codigo/ejercicios3_6/3_formulario_add_contacto_agenda/FormContactoScreen.kt">FormContactoScreen.kt 游댕</a></strong> y a continuaci칩n vamos a describir su funcionamiento antes de integrarlo en con su <strong>ViewModel</strong>.</p>
<p>Hemos dividido el componente en dos partes principales. Una es la Cabecera y otra el Cuerpo del formulario. Que distribuiremos dependiendo de la orientaci칩n del dispositivo con <strong><code>BoxWithConstraints</code></strong>. Adem치s, <strong>cada componente descompone el estado, pasando solo los datos que necesita y los eventos que gestiona</strong>.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">FormContactoScreenVertical</span><span class="token punctuation">(</span><span class="token operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Column <span class="token punctuation">{</span>
        <span class="token function">CabeceraFoto</span><span class="token punctuation">(</span><span class="token operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
        <span class="token function">CuerpoFormulario</span><span class="token punctuation">(</span><span class="token operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p><strong><code>CuerpoFormulario</code></strong> es un <strong>box</strong> que contiene:</p>
<ol>
<li>Un column con scroll vertical que contendr치 el componente de selecci칩n de categor칤as y los <strong><code>OutlinedTextField</code></strong> para introducir los datos del contacto.</li>
<li>Un <strong>pie</strong> que mostrar치 superpuesto al column un <strong><code>FAB</code></strong> que nos permitir치 guardar los cambios o un <strong><code>SnackBar</code></strong> que nos indicar치 si tenemos alg칰n error de validaci칩n a resolver.</li>
</ol>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">CuerpoFormulario</span><span class="token punctuation">(</span><span class="token operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Box <span class="token punctuation">{</span>        
        <span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
        <span class="token function">Pie</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><blockquote>
<p>九 <strong>Importante</strong>: Se presenta un problema y es que los componentes que contiene <strong><code>Pie</code></strong> pueden tener una alineaci칩n diferente dentro del BoxScope del <strong><code>Box</code></strong> que contiene a <strong><code>Pie</code></strong>, pero si definimos <strong><code>Pie</code></strong> como un composable <em>'<strong>normal</strong>'</em> no podemos acceder al <strong><code>BoxScope</code></strong> del <strong><code>Box</code></strong> que lo contiene. Es por eso que haremos que <strong><code>Pie</code></strong> sea una funci칩n de extensi칩n (composable) de <strong><code>BoxScope</code></strong>. Esto, me permitir치 acceder al <strong><code>BoxScope</code></strong> del <strong><code>Box</code></strong> que lo contiene y por tanto alinear los componentes que contiene de la forma que queramos. Eso s칤, es f치cil de deducir que <strong>nuestro componente <code>Pie</code> solo podr치 ser usado dentro de un <code>Box</code></strong>.</p>
</blockquote>
<pre data-role="codeBlock" data-info="kotlin {highlight=[5,9]}" class="language-kotlin kotlin" data-line="5,9"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> BoxScope<span class="token punctuation">.</span><span class="token function">Pie</span><span class="token punctuation">(</span><span class="token operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>validacionContactoState<span class="token punctuation">.</span>validacionContacto<span class="token punctuation">.</span>hayError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Snackbar</span><span class="token punctuation">(</span>
            modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">align</span><span class="token punctuation">(</span>Alignment<span class="token punctuation">.</span>BottomCenter<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">..</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
        <span class="token function">ExtendedFloatingActionButton</span><span class="token punctuation">(</span>
            modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">align</span><span class="token punctuation">(</span>Alignment<span class="token punctuation">.</span>BottomEnd<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token operator">..</span><span class="token punctuation">.</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="line-highlight-wrapper">



<div aria-hidden="true" class="line-highlight" data-range="5" data-start="5">
</div></div><div class="line-highlight-wrapper">







<div aria-hidden="true" class="line-highlight" data-range="9" data-start="9">
</div></div></pre><p>Termina de echarle un vistazo al c칩digo y ver치s que el resto es f치cil de entender. Adem치s se ha incorporado el componente de M3 <strong><code>OutlinedIconButton</code></strong> para cambiar la imagen del contacto. Sin embargo, de momento no tienen funcionalidad.</p>
<div style="page-break-after:always;"></div>
<h4 id="paso-6--creando-el-viewmodel-del-formulario-de-contacto">Paso 6.- Creando el ViewModel del formulario de contacto </h4>
<p>B치sicamente deberemos pasar la funcionalidad del <em>'preview'</em> de test promocionado <strong><code>FormContactoScreenTest</code></strong> al mismo. Vemos</p>
<p>Crearemos la clase pues <strong><a href="../../assets/codigo/ejercicios3_6/3_formulario_add_contacto_agenda/ContactoViewModel.kt">ContactoViewModel.kt 游댕</a></strong> junto a su screen en el paquete <strong><code>ui.features.formcontacto</code></strong>. Veamos el c칩digo comentado...</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@HiltViewModel</span>
<span class="token keyword keyword-class">class</span> ContactoViewModel <span class="token annotation builtin">@Inject</span> <span class="token keyword keyword-constructor">constructor</span><span class="token punctuation">(</span>
    <span class="token comment">// Inyectamos el repositorio y el validador de contactos</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> contactoRepository<span class="token operator">:</span> ContactoRepository<span class="token punctuation">,</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> validadorContacto<span class="token operator">:</span> ValidadorContacto
<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">ViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-class">class</span> <span class="token function">ContactoViewModelException</span><span class="token punctuation">(</span>message<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">Exception</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>

    <span class="token comment">// Este estado me indicar치 si estoy editando un contacto existente o creando uno nuevo</span>
    <span class="token keyword keyword-var">var</span> editandoContactoExistenteState<span class="token operator">:</span> Boolean <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-set">set</span>

    <span class="token comment">// Estados para el contacto y su validaci칩n. Solo son modificables desde el ViewModel</span>
    <span class="token keyword keyword-var">var</span> contactoState <span class="token keyword keyword-by">by</span> <span class="token function">mutableStateOf</span><span class="token punctuation">(</span><span class="token function">ContactoUiState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-set">set</span>
    <span class="token keyword keyword-var">var</span> validacionContactoState <span class="token keyword keyword-by">by</span> <span class="token function">mutableStateOf</span><span class="token punctuation">(</span><span class="token function">ValidacionContactoUiState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-set">set</span>
    <span class="token keyword keyword-var">var</span> verSnackBarState <span class="token keyword keyword-by">by</span> <span class="token function">mutableStateOf</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-set">set</span>

    <span class="token comment">// Este m칠todo se llamar치 cuando queramos editar un contacto ya existente</span>
    <span class="token comment">// justo antes de navegar o cargar el formulario FormContactoScreen.</span>
    <span class="token comment">// Recibimos el id del contacto a editar y lo buscamos en el repositorio.</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">setContactoState</span><span class="token punctuation">(</span>idContacto<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Indicamos que estamos editando un contacto existente, para hacer un update al guardar.</span>
        editandoContactoExistenteState <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword keyword-val">val</span> c<span class="token operator">:</span> Contacto <span class="token operator">=</span> contactoRepository<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>idContacto<span class="token punctuation">)</span>
            <span class="token operator">?:</span> <span class="token keyword keyword-throw">throw</span> <span class="token function">ContactoViewModelException</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"El id </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">idContacto</span></span><span class="token string"> no existe en la base de datos"</span></span><span class="token punctuation">)</span>
        <span class="token comment">// Tras buscarlo en el repositorio, lo convertimos a ContactoUiState y lo asignamos al estado.</span>
        contactoState <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">toContactoUiState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// Se actualiza el estado de validaci칩n, aunque no deber칤a haber errores.</span>
        validacionContactoState <span class="token operator">=</span> validadorContacto<span class="token punctuation">.</span><span class="token function">valida</span><span class="token punctuation">(</span>contactoState<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Este m칠todo se llamar치 cuando queramos crear un nuevo contacto.</span>
    <span class="token comment">// O borrar su estado.</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">clearContactoState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        editandoContactoExistenteState <span class="token operator">=</span> <span class="token boolean">false</span>
        contactoState <span class="token operator">=</span> <span class="token function">ContactoUiState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        validacionContactoState <span class="token operator">=</span> <span class="token function">ValidacionContactoUiState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token operator">..</span><span class="token punctuation">.</span>
</code></pre><p>Por 칰ltimo vamos a definir el m칠todo que gestiona los eventos que se producen en el formulario. Para ello, vamos a definir el m칠todo <strong><code>onContactoEvent</code></strong> que recibe un evento de tipo <strong><code>ContactoEvent</code></strong> y que se encarga de gestionarlo.</p>
<div style="page-break-after:always;"></div>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code>    <span class="token keyword keyword-fun">fun</span> <span class="token function">onContactoEvent</span><span class="token punctuation">(</span>e<span class="token operator">:</span> ContactoEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-when">when</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-is">is</span> ContactoEvent<span class="token punctuation">.</span>OnChangeCategoria <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                contactoState <span class="token operator">=</span> contactoState<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>categorias <span class="token operator">=</span> e<span class="token punctuation">.</span>categoria<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-is">is</span> ContactoEvent<span class="token punctuation">.</span>OnChangeNombre <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                contactoState <span class="token operator">=</span> contactoState<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>nombre <span class="token operator">=</span> e<span class="token punctuation">.</span>nombre<span class="token punctuation">)</span>
                validacionContactoState <span class="token operator">=</span> validacionContactoState<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>
                    validacionNombre <span class="token operator">=</span> validadorContacto<span class="token punctuation">.</span>validadorNombre<span class="token punctuation">.</span><span class="token function">valida</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>nombre<span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-is">is</span> ContactoEvent<span class="token punctuation">.</span>OnChangeApellidos <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                contactoState <span class="token operator">=</span> contactoState<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>apellidos <span class="token operator">=</span> e<span class="token punctuation">.</span>apellidos<span class="token punctuation">)</span>
                validacionContactoState <span class="token operator">=</span> validacionContactoState<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>
                    validacionApellidos <span class="token operator">=</span> validadorContacto<span class="token punctuation">.</span>validadorApellidos<span class="token punctuation">.</span><span class="token function">valida</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>apellidos<span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-is">is</span> ContactoEvent<span class="token punctuation">.</span>OnChangeCorreo <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                contactoState <span class="token operator">=</span> contactoState<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>correo <span class="token operator">=</span> e<span class="token punctuation">.</span>correo<span class="token punctuation">)</span>
                validacionContactoState <span class="token operator">=</span> validacionContactoState<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>
                    validacionCorreo <span class="token operator">=</span> validadorContacto<span class="token punctuation">.</span>validadorCorreo<span class="token punctuation">.</span><span class="token function">valida</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>correo<span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-is">is</span> ContactoEvent<span class="token punctuation">.</span>OnChangeTelefono <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                contactoState <span class="token operator">=</span> contactoState<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>telefono <span class="token operator">=</span> e<span class="token punctuation">.</span>telefono<span class="token punctuation">)</span>
                validacionContactoState <span class="token operator">=</span> validacionContactoState<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>
                    validacionTelefono <span class="token operator">=</span> validadorContacto<span class="token punctuation">.</span>validadorTelefono<span class="token punctuation">.</span><span class="token function">valida</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>telefono<span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-is">is</span> ContactoEvent<span class="token punctuation">.</span>OnChangeFoto <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                contactoState <span class="token operator">=</span> contactoState<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>foto <span class="token operator">=</span> e<span class="token punctuation">.</span>foto<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-is">is</span> ContactoEvent<span class="token punctuation">.</span>OnDismissError <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                verSnackBarState <span class="token operator">=</span> <span class="token boolean">false</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-is">is</span> ContactoEvent<span class="token punctuation">.</span>OnSaveContacto <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// Validamos todo el contacto</span>
                validacionContactoState <span class="token operator">=</span> validadorContacto<span class="token punctuation">.</span><span class="token function">valida</span><span class="token punctuation">(</span>contactoState<span class="token punctuation">)</span>
                <span class="token comment">// Si no hay errores, lo guardamos o actualizamos en el repositorio</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>validacionContactoState<span class="token punctuation">.</span>hayError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-val">val</span> c<span class="token operator">:</span> Contacto <span class="token operator">=</span> contactoState<span class="token punctuation">.</span><span class="token function">toContacto</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>editandoContactoExistenteState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        contactoRepository<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                        contactoRepository<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment">// Tras guardar seguiremos iremos a la pantalla correspondiente</span>
                    <span class="token comment">// por ahora no hacemos nada</span>
                    e<span class="token punctuation">.</span><span class="token function">onNavigateTrasFormContacto</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                    <span class="token comment">// Si hay errores, mostramos el snackbar</span>
                    verSnackBarState <span class="token operator">=</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div style="page-break-after:always;"></div>
<p>Si no tenemos la funciones <strong><code>insert</code></strong> y <strong><code>update</code></strong> definidas deberemos a침adirlas al repositorio y al dao correspondiente.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token comment">// ContactoRepository.kt -----------------------------------------------</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">insert</span><span class="token punctuation">(</span>contacto<span class="token operator">:</span> Contacto<span class="token punctuation">)</span> <span class="token operator">=</span> dao<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>contacto<span class="token punctuation">.</span><span class="token function">toContactoMock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">update</span><span class="token punctuation">(</span>contacto<span class="token operator">:</span> Contacto<span class="token punctuation">)</span> <span class="token operator">=</span> dao<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>contacto<span class="token punctuation">.</span><span class="token function">toContactoMock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// ContactoDaoMock.kt -----------------------------------------------</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">insert</span><span class="token punctuation">(</span>contacto<span class="token operator">:</span> ContactoMock<span class="token punctuation">)</span> <span class="token operator">=</span> contactos<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>contacto<span class="token punctuation">)</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">update</span><span class="token punctuation">(</span>contacto<span class="token operator">:</span> ContactoMock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-val">val</span> index <span class="token operator">=</span> contactos<span class="token punctuation">.</span><span class="token function">indexOfFirst</span> <span class="token punctuation">{</span> u <span class="token operator">-&gt;</span> u<span class="token punctuation">.</span>id <span class="token operator">==</span> contacto<span class="token punctuation">.</span>id <span class="token punctuation">}</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>index <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> contactos<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> contacto
    <span class="token punctuation">}</span>
</code></pre><h4 id="paso-7--sustituyendo-en-el-mainactivity-la-lista-por-el-formulario">Paso 7.- Sustituyendo en el MainActivity la Lista por el Formulario </h4>
<p>Cambiamos la creaci칩n del vm por el del <strong><code>ContactoViewModel</code></strong> y le indicamos que queremos editar un contacto existente con id 1.</p>
<div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px">
<div style="width: 75%">
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> vm <span class="token operator">:</span> ContactoViewModel <span class="token keyword keyword-by">by</span> <span class="token function">viewModels</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Creamos el ViewModel</span>
    <span class="token comment">// Le indicamos que queremos editar un contacto existente con id 1</span>
    vm<span class="token punctuation">.</span><span class="token function">setContactoState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    setContent <span class="token punctuation">{</span>
        AgendaTheme <span class="token punctuation">{</span>
            <span class="token function">Surface</span><span class="token punctuation">(</span>
                modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">fillMaxSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                color <span class="token operator">=</span> MaterialTheme<span class="token punctuation">.</span>colorScheme<span class="token punctuation">.</span>background
            <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">FormContactoScreen</span><span class="token punctuation">(</span>
                    contactoState <span class="token operator">=</span> vm<span class="token punctuation">.</span>contactoState<span class="token punctuation">,</span>
                    validacionContactoState <span class="token operator">=</span> vm<span class="token punctuation">.</span>validacionContactoState<span class="token punctuation">,</span>
                    onContactoEvent <span class="token operator">=</span> vm<span class="token operator">::</span>onContactoEvent<span class="token punctuation">,</span>
                    onNavigateTrasFormContacto <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div style="width: auto">
<img height="400px" src="../../assets/imagenes/ejercicios3_6/3_formulario_add_contacto_agenda/form_contacto_editar.png">
</div>
</div>

      </div>
      
      
    
    
    
    
    
    
  
    </body></html>