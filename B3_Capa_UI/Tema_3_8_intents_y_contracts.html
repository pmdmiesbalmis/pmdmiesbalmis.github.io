<!DOCTYPE html><html><head>
      <title>PMDM 2&#xBA; DAM  Tema 3.8 - Intents y Contracts</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.3/dist/katex.min.css">
      
      
      
      
      
      
      
      
      
      <style>
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}

/* highlight */
pre[data-line] {
  position: relative;
  padding: 1em 0 1em 3em;
}
pre[data-line] .line-highlight-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  background-color: transparent;
  display: block;
  width: 100%;
}

pre[data-line] .line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: hsla(24, 20%, 50%,.08);
  background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}

pre[data-line] .line-highlight:before, 
pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-start);
  position: absolute;
  top: .4em;
  left: .6em;
  min-width: 1em;
  padding: 0 .5em;
  background-color: hsla(24, 20%, 50%,.4);
  color: hsl(24, 20%, 95%);
  font: bold 65%/1.5 sans-serif;
  text-align: center;
  vertical-align: .3em;
  border-radius: 999px;
  text-shadow: none;
  box-shadow: 0 1px white;
}

pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-end);
  top: auto;
  bottom: .4em;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}@font-face {
  font-family: "Material Icons";
  font-style: normal;
  font-weight: 400;
  src: local("Material Icons"), local("MaterialIcons-Regular"), url("data:application/x-font-woff;charset=utf-8;base64,d09GRgABAAAAAAfIAAsAAAAADDAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAADMAAABCsP6z7U9TLzIAAAE8AAAARAAAAFZW7kosY21hcAAAAYAAAADTAAACjtP6ytBnbHlmAAACVAAAAxgAAAQ4zRtvlGhlYWQAAAVsAAAALwAAADYRwZsnaGhlYQAABZwAAAAcAAAAJAeKAzxobXR4AAAFuAAAABIAAAA8OGQAAGxvY2EAAAXMAAAAIAAAACAG5AfwbWF4cAAABewAAAAfAAAAIAEfAERuYW1lAAAGDAAAAVcAAAKFkAhoC3Bvc3QAAAdkAAAAYgAAAK2vz7wkeJxjYGRgYOBikGPQYWB0cfMJYeBgYGGAAJAMY05meiJQDMoDyrGAaQ4gZoOIAgCKIwNPAHicY2BkPsQ4gYGVgYOpk+kMAwNDP4RmfM1gxMjBwMDEwMrMgBUEpLmmMDgwVLy4xKzzX4chhrmK4QpQmBEkBwAZygyweJzFkr0NwjAQhZ+TEP6CRUfHBEwRUWaQTICyQbpMwRCskA5RUIONxG0RnnNpKAIV4qzPku/8c353ACYAYrIjCWCuMAh2ptf0/hiL3p/gyPUWa3osqlt0L1zu9r71z8dGrJRykFoauXQd932Lj5vhG+MjxGeYI8MKETObMpslf5EyP8tg+vHun5r539PvlvXzaVhRFVQDTPEWKVQR90KhnnC5Ek67vUKN4VuFasM/ldARj43CCkCsEjpJSoVVgRyU0GVSK6wUpFFCx8lFgX0BiXpRPQB4nE2TTWjcRhTH3xttpDhxN7uxPlp3u/FK7moRPixafRijNosxSw/LUsIwNcaEHPZggo/FmEKMCKWU4kNOOftQSlhE8alnH0Ix9BqWnHooPRrTQ0+mnu2bXTu2pPdGM9LM/6c3fwECTM4gBBMYQNqxzLrZAjqYSlqu2TAHZQA0/DQJH6FtzqGDnvbt4Ggwvzw/nL8EfH8kW0fsuRqhgWXZnY7M1picaUL7Du5BHeDzMIl83dAt016wH1qmvtSMo5R6YRJHTR//FXsff/nj/tc/5K9P5d+nP22+fFK5u7v3K39SW3y+OtDKO3L85vD09PD9z5X17a2N1g4tqk01RlqX7gyoEmnsWQtVr4rtZMmukEaFBZxzefkCn11cyKMLZgshRwgTYNoLNXCBz2ja7HvZG7hDpPSNfoo5vs0knK/9hb+rNpu+8kHPgk/Ao4kK3tWtTpSEtvkA9c+wE6UaUdwieNkaHg55tBEtRiEPw1s0+FtrtTcc9two2lhMknV7PZF/cs6+uUFTmpTGbEx7sQCPSLOttHS3GRltqp7SNzVSKzl6aWnZT/CX5k6/v9N3Hh8fHBwffJVjhrC6OgH5dkIt/tPsq+d/PD5Qz7G7efzq1THFjdZVPe/N6ulQ3JnDWSE5junsFsVIiFwL/htf1S5gJ3BfOcUxfHKLnzqpFpyfZ9cX+/5WB6a+Y0pHpzkNrYNVDwMsikK+y7WuLCRg/oFHkA8VT3rDg5ZnU6ktzzINymV0m74Xd5pfIGXyFeVEQSShkzqG7TBBa2OxVRKitLXv7h3uuftXnXq7lz2tZ/WnWa9dx9dCjDhHzmuVQATlmljr9dZErUydSo2Hbi/b1vXtrOeGCk2/8s3ZlO8+ueJT8BVlw5pGw2oYccdSiHHqx0RlabHqdNR9jAETl6PreJcPBnnfpTLnOQ8C3OV8AmQGzouV1iZdeb5SSIoVc8W8/kcDtksUH5FrU6/aqBqNWcMEzxG4DAQ14qRQhi9mWU0rzepKezbjfgCwQKxVYq5ajRgpRqy45CqwkJydcEkbTkvRz8P5/2ZpDTN4nGNgZGBgAOKb6v+/xvPbfGXgZmEAgeuB2kkI+v8bFgbmKiCXg4EJJAoAPyAKhQB4nGNgZGBg1vmvwxDDwgACQJKRARXwAwAzZQHQeJxjYQCCFAYGFgbSMQAcWACdAAAAAAAAAAwALgBgAIQAmADSAQgBIgE8AVABoAHeAfwCHHicY2BkYGDgZ7BgYGMAASYg5gJCBob/YD4DAA/hAWQAeJxlkbtuwkAURMc88gApQomUJoq0TdIQzEOpUDokKCNR0BuzBiO/tF6QSJcPyHflE9Klyyekz2CuG8cr7547M3d9JQO4xjccnJ57vid2cMHqxDWc40G4Tv1JuEF+Fm6ijRfhM+oz4Ra6eBVu4wZvvMFpXLIa40PYQQefwjVc4Uu4Tv1HuEH+FW7i1mkKn6Hj3Am3sHC6wm08Ou8tpSZGe1av1PKggjSxPd8zJtSGTuinyVGa6/Uu8kxZludCmzxMEzV0B6U004k25W35fj2yNlCBSWM1paujKFWZSbfat+7G2mzc7weiu34aczzFNYGBhgfLfcV6iQP3ACkSaj349AxXSN9IT0j16JepOb01doiKbNWt1ovippz6sVYYwsXgX2rGVFIkq7Pl2PNrI6qW6eOshj0xaSq9mpNEZIWs8LZUfOouNkVXxp/d5woqebeYIf4D2J1ywQB4nG3LOw6AIBAE0B384B+PAkgEa+QwNnYmHt+EpXSal5lkSBBnoP8oCFSo0aCFRIceA0ZMmLFAYSW88rmvtMUjG3RiQ9HvpfusM6zWNmtc5H/iPewha50tOt5PS/QBx2IeSwAA") format("woff");
}

.admonition {
  box-shadow: 0 2px 2px 0 rgba(0, 0, 0, .14), 0 1px 5px 0 rgba(0, 0, 0, .12), 0 3px 1px -2px rgba(0, 0, 0, .2);
  position: relative;
  margin: 1.5625em 0;
  padding: 0 1.2rem;
  border-left: .4rem solid rgba(68, 138, 255, .8);
  border-radius: .2rem;
  background-color: rgba(255, 255, 255, 0.05);
  overflow: auto;
}

.admonition>p {
  margin-top: .8rem;
}

.admonition>.admonition-title {
  margin: 0 -1.2rem;
  padding: .8rem 1.2rem .8rem 3.6rem;
  border-bottom: 1px solid rgba(68, 138, 255, .2);
  background-color: rgba(68, 138, 255, .1);
  font-weight: 700;
}

.admonition>.admonition-title:before {
  position: absolute;
  left: 1.2rem;
  font-size: 1.5rem;
  color: rgba(68, 138, 255, .8);
  content: "\E3C9";
}

.admonition>.admonition-title:before {
  font-family: Material Icons;
  font-style: normal;
  font-variant: normal;
  font-weight: 400;
  line-height: 2rem;
  text-transform: none;
  white-space: nowrap;
  speak: none;
  word-wrap: normal;
  direction: ltr;
}

.admonition.summary,
.admonition.abstract,
.admonition.tldr {
  border-left-color: rgba(0, 176, 255, .8);
}

.admonition.summary>.admonition-title,
.admonition.abstract>.admonition-title,
.admonition.tldr>.admonition-title {
  background-color: rgba(0, 176, 255, .1);
  border-bottom-color: rgba(0, 176, 255, .2);
}

.admonition.summary>.admonition-title:before,
.admonition.abstract>.admonition-title:before,
.admonition.tldr>.admonition-title:before {
  color: rgba(0, 176, 255, 1);
  ;
  content: "\E8D2";
}

.admonition.hint,
.admonition.tip {
  border-left-color: rgba(0, 191, 165, .8);
}

.admonition.hint>.admonition-title,
.admonition.tip>.admonition-title {
  background-color: rgba(0, 191, 165, .1);
  border-bottom-color: rgba(0, 191, 165, .2);
}

.admonition.hint>.admonition-title:before,
.admonition.tip>.admonition-title:before {
  color: rgba(0, 191, 165, 1);
  content: "\E80E";
}

.admonition.info,
.admonition.todo {
  border-left-color: rgba(0, 184, 212, .8);
}

.admonition.info>.admonition-title,
.admonition.todo>.admonition-title {
  background-color: rgba(0, 184, 212, .1);
  border-bottom-color: rgba(0, 184, 212, .2);
}

.admonition.info>.admonition-title:before,
.admonition.todo>.admonition-title:before {
  color: rgba(0, 184, 212, 1);
  ;
  content: "\E88E";
}

.admonition.success,
.admonition.check,
.admonition.done {
  border-left-color: rgba(0, 200, 83, .8);
}

.admonition.success>.admonition-title,
.admonition.check>.admonition-title,
.admonition.done>.admonition-title {
  background-color: rgba(0, 200, 83, .1);
  border-bottom-color: rgba(0, 200, 83, .2);
}

.admonition.success>.admonition-title:before,
.admonition.check>.admonition-title:before,
.admonition.done>.admonition-title:before {
  color: rgba(0, 200, 83, 1);
  ;
  content: "\E876";
}

.admonition.question,
.admonition.help,
.admonition.faq {
  border-left-color: rgba(100, 221, 23, .8);
}

.admonition.question>.admonition-title,
.admonition.help>.admonition-title,
.admonition.faq>.admonition-title {
  background-color: rgba(100, 221, 23, .1);
  border-bottom-color: rgba(100, 221, 23, .2);
}

.admonition.question>.admonition-title:before,
.admonition.help>.admonition-title:before,
.admonition.faq>.admonition-title:before {
  color: rgba(100, 221, 23, 1);
  ;
  content: "\E887";
}

.admonition.warning,
.admonition.attention,
.admonition.caution {
  border-left-color: rgba(255, 145, 0, .8);
}

.admonition.warning>.admonition-title,
.admonition.attention>.admonition-title,
.admonition.caution>.admonition-title {
  background-color: rgba(255, 145, 0, .1);
  border-bottom-color: rgba(255, 145, 0, .2);
}

.admonition.attention>.admonition-title:before {
  color: rgba(255, 145, 0, 1);
  content: "\E417";
}

.admonition.warning>.admonition-title:before,
.admonition.caution>.admonition-title:before {
  color: rgba(255, 145, 0, 1);
  content: "\E002";
}

.admonition.failure,
.admonition.fail,
.admonition.missing {
  border-left-color: rgba(255, 82, 82, .8);
}

.admonition.failure>.admonition-title,
.admonition.fail>.admonition-title,
.admonition.missing>.admonition-title {
  background-color: rgba(255, 82, 82, .1);
  border-bottom-color: rgba(255, 82, 82, .2);
}

.admonition.failure>.admonition-title:before,
.admonition.fail>.admonition-title:before,
.admonition.missing>.admonition-title:before {
  color: rgba(255, 82, 82, 1);
  ;
  content: "\E14C";
}

.admonition.danger,
.admonition.error,
.admonition.bug {
  border-left-color: rgba(255, 23, 68, .8);
}

.admonition.danger>.admonition-title,
.admonition.error>.admonition-title,
.admonition.bug>.admonition-title {
  background-color: rgba(255, 23, 68, .1);
  border-bottom-color: rgba(255, 23, 68, .2);
}

.admonition.danger>.admonition-title:before {
  color: rgba(255, 23, 68, 1);
  content: "\E3E7";
}

.admonition.error>.admonition-title:before {
  color: rgba(255, 23, 68, 1);
  content: "\E14C";
}

.admonition.bug>.admonition-title:before {
  color: rgba(255, 23, 68, 1);
  content: "\E868";
}

.admonition.example,
.admonition.snippet {
  border-left-color: rgba(0, 184, 212, .8);
}

.admonition.example>.admonition-title,
.admonition.snippet>.admonition-title {
  background-color: rgba(0, 184, 212, .1);
  border-bottom-color: rgba(0, 184, 212, .2);
}

.admonition.example>.admonition-title:before,
.admonition.snippet>.admonition-title:before {
  color: rgba(0, 184, 212, 1);
  ;
  content: "\E242";
}

.admonition.quote,
.admonition.cite {
  border-left-color: rgba(158, 158, 158, .8);
}

.admonition.quote>.admonition-title,
.admonition.cite>.admonition-title {
  background-color: rgba(158, 158, 158, .1);
  border-bottom-color: rgba(158, 158, 158, .2);
}

.admonition.quote>.admonition-title:before,
.admonition.cite>.admonition-title:before {
  color: rgba(158, 158, 158, 1);
  ;
  content: "\E244";
}

/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
.markdown-preview.markdown-preview {
  background-color: #FFFF;
}

      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview  ">
      <style>/* 
Añade 

@import "../EstilosPersonalizadosMarkdownEnhanced.less"

justo después del front matter 
*/
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
@font-face {
  font-family: 'Catamaran';
  font-style: normal;
  font-weight: 400;
  src: url(https://fonts.gstatic.com/s/catamaran/v19/o-0bIpQoyXQa2RxT7-5B6Ryxs2E_6n1iPHjd5a7dvg.ttf) format('truetype');
}
.contenedor {
  display: flex;
  justify-content: center;
  margin: 30px auto 30px auto;
}
.fondo {
  background: url(https://programacioniesbalmis.github.io/Imagenes/BannersMoodle/banner.png);
  background-size: cover;
  width: 75%;
  height: 160px;
  border-radius: 10px;
  position: relative;
}
.cita {
  font-family: Arial;
  font-style: italic;
  font-weight: 600;
  text-align: justify;
  line-height: 1.5rem;
  opacity: 0.6;
  color: white;
  padding: 5rem;
  position: relative;
  top: 50%;
  left: 50%;
  font-size: 1.3rem;
  transform: translate(-50%, -50%);
}
.abre_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-left: 30px;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, -15%);
}
.cierra_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-right: 30px;
  right: 0%;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, 55%);
}
.autor {
  font-family: Arial;
  color: white;
  margin: 0px;
  padding-left: 30px;
  position: absolute;
  top: 83%;
  font-size: 1rem;
}
</style>
<h1 class="mume-header undefined" id="tema-38-intents-y-contracts">Tema 3.8 - Intents y Contracts</h1>

<p>Descargar estos apuntes <a href="./Tema_3_8_intents_y_contracts.pdf">pdf</a> o <a href="./Tema_3_8_intents_y_contracts.html">html</a></p>
<h2 class="mume-header undefined" id="%C3%ADndice">&#xCD;ndice</h2>

<ol>
<li><a href="#introducci%C3%B3n">Introducci&#xF3;n</a></li>
<li><a href="#tipos-de-intents">Tipos de Intents</a>
<ol>
<li><a href="#intents-expl%C3%ADcitos">Intents Expl&#xED;citos</a>
<ol>
<li><a href="#abriendo-otra-aplicaci%C3%B3n-desde-nuestra-aplicaci%C3%B3n">Abriendo otra aplicaci&#xF3;n desde nuestra aplicaci&#xF3;n</a></li>
</ol>
</li>
<li><a href="#intents-impl%C3%ADcitos">Intents Impl&#xED;citos</a>
<ol>
<li><a href="#enviar-un-correo-electr%C3%B3nico-escogiendo-la-aplicaci%C3%B3n">Enviar un correo electr&#xF3;nico escogiendo la aplicaci&#xF3;n</a></li>
<li><a href="#abrir-una-localizaci%C3%B3n-en-google-maps">Abrir una localizaci&#xF3;n en Google Maps</a></li>
<li><a href="#obtener-el-resultado-de-un-intent-registrando-un-contrato">Obtener el resultado de un Intent registrando un &apos;<em>contrato</em>&apos;</a></li>
<li><a href="#registrando-contratos-dentro-de-un-composable">Registrando contratos dentro de un <code>@Composable</code></a></li>
</ol>
</li>
</ol>
</li>
<li><a href="#gestion-de-permisos">Gestion de Permisos</a>
<ol>
<li><a href="#gestionar-intent-impl%C3%ADcito-de-llamada-telef%C3%B3nica">Gestionar intent impl&#xED;cito de llamada telef&#xF3;nica</a></li>
<li><a href="#gestionar-intent-impl%C3%ADcito-para-hacer-un-foto">Gestionar intent impl&#xED;cito para hacer un foto</a></li>
<li><a href="#gestionar-registro-hacer-foto-con-takepicture">Gestionar registro hacer foto con TakePicture</a></li>
<li><a href="#gestionar-registro-para-obtener-una-imagen-de-la-galer%C3%ADa">Gestionar registro para obtener una imagen de la galer&#xED;a</a></li>
</ol>
</li>
<li><a href="#conclusi%C3%B3n">Conclusi&#xF3;n</a></li>
</ol>
<div style="page-break-after:always;"></div>
<h2 class="mume-header" id="introducci%C3%B3n">Introducci&#xF3;n</h2>

<ul>
<li>
<p><strong>Intents</strong></p>
<ul>
<li>Documentaci&#xF3;n oficial: <strong><a href="https://developer.android.com/guide/components/intents-filters?hl=es-419">Intents</a></strong></li>
<li>Documentaci&#xF3;n oficial: <strong><a href="https://developer.android.com/training/basics/intents?hl=es-419">Interactuando con otras Apps</a></strong></li>
<li>V&#xED;deo Intents: <strong><a href="https://www.youtube.com/watch?v=2hIY1xuImuQ">Philipp Lackner (Ingl&#xE9;s)</a></strong></li>
</ul>
</li>
<li>
<p><strong>Permissions</strong></p>
<ul>
<li>Documentaci&#xF3;n oficial: <strong><a href="https://developer.android.com/guide/topics/permissions/overview?hl=es-419">Permisos</a></strong></li>
<li>V&#xED;deo Permisos 1: <strong><a href="https://www.youtube.com/watch?v=zCAx4WZ98rs">Android Developers</a></strong></li>
<li>V&#xED;deo Permisos 2: <strong><a href="https://www.youtube.com/watch?v=x38dYUm7tCY">Android Developers</a></strong></li>
<li>V&#xED;deo Permisos: <strong><a href="https://www.youtube.com/watch?v=D3JCtaK8LSU">Philipp Lackner (Ingl&#xE9;s)</a></strong></li>
</ul>
</li>
<li>
<p><strong>Permissions in Compose con Accompanist Library</strong> (Experimental)</p>
<ul>
<li>V&#xED;deo: <strong><a href="https://www.youtube.com/watch?v=imFJZ4Kbv_g">Martin Kiperszmid (Castellano)</a></strong></li>
<li>V&#xED;deo: <strong><a href="https://www.youtube.com/watch?v=uO6igFsa5y0">Stevdza-San (Ingl&#xE9;s)</a></strong></li>
<li>Documentaci&#xF3;n librer&#xED;a: <strong><a href="https://google.github.io/accompanist/permissions/">Accompanist</a></strong></li>
</ul>
</li>
</ul>
<p>Una <strong>Intent</strong> es un <strong>objeto de mensajer&#xED;a</strong> que puedes usar para solicitar una acci&#xF3;n de otro componente de una app. Si bien las intents facilitan la comunicaci&#xF3;n entre componentes de varias formas, existen tres casos de uso principales:</p>
<ol>
<li>Iniciar una actividad de la propia app o de otra app.</li>
<li>Iniciar un servicio.</li>
<li>Transmitir una emisi&#xF3;n o broadcast.</li>
</ol>
<p>Nosotros en este tema vamos a centrarnos en el primer caso de uso que es, <strong>Iniciar una actividad</strong>. Como se puede deducir es una funcionalidad del API de Android que nos permite iniciar una actividad desde otra actividad incluso si la actividad pertenece a otra aplicaci&#xF3;n diferente como por ejemplos hacer una llamada telef&#xF3;nica, enviar un correo electr&#xF3;nico, abrir una p&#xE1;gina web, etc.</p>
<blockquote>
<p>&#x1F4E3; <strong>Resumen</strong>: Por expresarlo con otras palabras, podemos decir que una <strong>Intent</strong> es un objeto que proporciona en su interior una descripci&#xF3;n de la operaci&#xF3;n que queremos &apos;intentar&apos; ya sea de forma impl&#xED;cita o expl&#xED;cita y adem&#xE1;s podemos pasarle datos que se usar&#xE1;n en la operaci&#xF3;n. Cuidado puede parecernos que es la intent la que lanza una actividad pero no es as&#xED;, contiene solo la descripci&#xF3;n de la operaci&#xF3;n y los datos necesarios para realizarla.</p>
</blockquote>
<blockquote>
<p>&#x1F517; <strong>Dercarga</strong>: El proyecto con el c&#xF3;digo delos ejemplos de este tema en el siguiente <strong><a href="assets/codigo/tema_3_8/intents_ejemplo.zip">enlace</a></strong></p>
</blockquote>
<div style="page-break-after:always;"></div>
<h2 class="mume-header" id="tipos-de-intents">Tipos de Intents</h2>

<h3 class="mume-header" id="intents-expl%C3%ADcitos">Intents Expl&#xED;citos</h3>

<p>Especifican qu&#xE9; aplicaci&#xF3;n las administrar&#xE1;, ya sea incluyendo el <strong>nombre del paquete de la app de destino</strong> o el nombre de clase del componente completamente calificado. Normalmente, el usuario usa una intent expl&#xED;cita para iniciar un componente en su propia aplicaci&#xF3;n porque conoce el nombre de clase de la actividad o el servicio que desea iniciar. Por ejemplo, puedes utilizarla para iniciar una actividad nueva en respuesta a una acci&#xF3;n del usuario o iniciar un servicio para descargar un archivo en segundo plano.</p>
<h4 class="mume-header" id="abriendo-otra-aplicaci%C3%B3n-desde-nuestra-aplicaci%C3%B3n">Abriendo otra aplicaci&#xF3;n desde nuestra aplicaci&#xF3;n</h4>

<p>Para abrir otra aplicaci&#xF3;n desde nuestra aplicaci&#xF3;n, debemos crear un objeto <strong>Intent</strong> y especificar el <strong>nombre del paquete de la aplicaci&#xF3;n de destino</strong>. Por ejemplo, si queremos abrir la aplicaci&#xF3;n de <strong>Chrome</strong> desde nuestra aplicaci&#xF3;n, debemos crear un objeto <strong>Intent</strong> y especificar el nombre del paquete de la aplicaci&#xF3;n de destino que en este caso es <strong><code>com.android.chrome</code></strong>. Para ello usaremos el m&#xE9;todo <strong><code>setPackage()</code></strong> del objeto <strong>Intent</strong>. Una vez creado el objeto <strong>Intent</strong> lo pasaremos como par&#xE1;metro al m&#xE9;todo <strong><code>startActivity()</code></strong>. Como el m&#xE9;todo <strong><code>startActivity()</code></strong> es un m&#xE9;todo de la clase <strong>Context</strong>, necesitamos un objeto de esta clase para poder llamar al m&#xE9;todo. Para ello usaremos el <strong><code>LocalContext.current</code></strong> que nos proporciona <strong>Jetpack Compose</strong>. El c&#xF3;digo ser&#xED;a el siguiente...</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token comment">// IntentExplicito.kt</span>

<span class="token keyword keyword-fun">fun</span> Context<span class="token punctuation">.</span><span class="token function">openChrome</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Creamos un Intent con la acci&#xF3;n ACTION_MAIN</span>
    <span class="token comment">// que es abrir una actividad principal de la aplicaci&#xF3;n Chrome.</span>
    <span class="token function">Intent</span><span class="token punctuation">(</span>Intent<span class="token punctuation">.</span>ACTION_MAIN<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">also</span> <span class="token punctuation">{</span>
        it<span class="token punctuation">.</span>`<span class="token keyword keyword-package">package</span>` <span class="token operator">=</span> <span class="token string">&quot;com.android.chrome&quot;</span>
        <span class="token comment">// Lanza ActivityNotFoundException si no est&#xE1; instalada la aplicaci&#xF3;n.</span>
        <span class="token function">startActivity</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">IntentOpenChrome</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> context <span class="token operator">=</span> LocalContext<span class="token punctuation">.</span>current
    <span class="token function">Box</span><span class="token punctuation">(</span>modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">fillMaxSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        contentAlignment <span class="token operator">=</span> androidx<span class="token punctuation">.</span>compose<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>Alignment<span class="token punctuation">.</span>Center<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Button</span><span class="token punctuation">(</span>onClick <span class="token operator">=</span> <span class="token punctuation">{</span> context<span class="token punctuation">.</span><span class="token function">openChrome</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">Text</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string">&quot;Open Chrome&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><h5 class="mume-header" id="saber-el-nombre-del-paquete-de-la-app-de-destino">Saber el nombre del paquete de la app de destino</h5>

<p>Para saber el nombre del paquete de la app de destino, podemos usar la herramienta <strong>adb.exe</strong> (<a href="https://developer.android.com/studio/command-line/adb?hl=es-419">Android Debug Bridge</a>) instalada junto al SDK de Android. Para ello debemos abrir una consola de comandos e ir a la carpeta <strong><code>platform-tools</code></strong> donde est&#xE9; instalado el SDK para nuestro usuario. (Ej: <strong><code>C:\Users\alumno\AppData\Local\Android\Sdk\platform-tools&gt;</code></strong>). Otras opci&#xF3;n es a&#xF1;adir esta carpeta al <strong>Path</strong> de nuestro usuario para que podamos ejecutar los comandos desde cualquier ubicaci&#xF3;n, incluso desde la ventana del terminal de AndroidStudio.<br>
Una vez tenemos acceso a la herramienta <strong>adb.exe</strong> seguiremos estos pasos:</p>
<ol>
<li>
<p>Arrancaremos la m&#xE1;quina virtual de nuestro emulador de Android <strong>desde el mismo Android Studio</strong> o desde un terminal si sabemos el nombre de la m&#xE1;quina. Por ejemplo, si nuestro emulador se llama <strong>Pixel_3a_API_33</strong> ejecutaremos el comando:</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash">C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>alumno<span class="token punctuation">\</span>AppData<span class="token punctuation">\</span>Local<span class="token punctuation">\</span>Android<span class="token punctuation">\</span>Sdk<span class="token punctuation">\</span>tools<span class="token punctuation">\</span>emulator.exe -avd Pixel_3a_API_33
</pre></li>
<li>
<p><strong>Con el emulador arrancado</strong>, ejecutaremos el comando <strong><code>adb shell</code></strong> para acceder a la consola del emulador. Por ejemplo:</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash">C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>alumno<span class="token punctuation">\</span>AppData<span class="token punctuation">\</span>Local<span class="token punctuation">\</span>Android<span class="token punctuation">\</span>Sdk<span class="token punctuation">\</span>platform-tools<span class="token operator">&gt;</span>adb shell
emu64x:/ $
</pre></li>
<li>
<p>Ahora ejecutaremos el comando <strong><code>pm list packages</code></strong> para listar todos los paquetes de aplicaciones instaladas en el emulador y si queremos buscar una aplicaci&#xF3;n en concreto podemos usar el comando <strong><code>grep</code></strong>. Por ejemplo, si queremos saber el nombre del paquete de la app de <strong>Chrome</strong>, ejecutaremos el comando:</p>
<pre data-role="codeBlock" data-info="bash {highlight=2}" class="language-bash" data-line="2">emu64x:/ $ pm list packages <span class="token operator">|</span> <span class="token function">grep</span> chrome
package:com.android.chrome
emu64x:/ $
<div class="line-highlight-wrapper">
<div aria-hidden="true" class="line-highlight" data-range="2" data-start="2">
</div></div></pre></li>
</ol>
<div style="display: flex; justify-content: space-between; align-items: top; margin-top: 15px">
<div style="width: 50%">
<p>Otra forma m&#xE1;s sencilla es a trav&#xE9;s de <strong>Android Studio</strong>. Una vez arrancado el emulador, abriremos la ventana <strong>Device File Explorer</strong> situado a la derecha como se muestra en la imagen de ejemplo y navegaremos hasta la carpeta <strong><code>data/data</code></strong> donde se encuentran todas las aplicaciones instaladas en el emulador. Ahora solo tenemos que buscar la carpeta de la aplicaci&#xF3;n que nos interese que se corresponde con el nombre del paquete de la aplicaci&#xF3;n.</p>
</div>
<div style="width: auto">
<img height="600px" src="assets/imagenes/tema_3_8/ubicacion_aplicaciones.png">
</div>
</div>
<div style="page-break-after:always;"></div>
<h3 class="mume-header" id="intents-impl%C3%ADcitos">Intents Impl&#xED;citos</h3>

<p>Son los que m&#xE1;s interesantes para nosotros. Puesto que no siempre sabemos que aplicaciones vamos a tener instaladas.</p>
<p>No nombran el componente espec&#xED;fico, pero en cambio declaran una acci&#xF3;n general para realizar, lo cual permite que un componente de otra aplicaci&#xF3;n la maneje. Por ejemplo, si quieres enviar un correo electr&#xF3;nico no necesitas saber qu&#xE9; aplicaci&#xF3;n de correo electr&#xF3;nico tiene el usuario instalada, simplemente debes enviar una intent impl&#xED;cita para que cualquier aplicaci&#xF3;n de correo electr&#xF3;nico pueda responderla. Es m&#xE1;s, puedes preguntarle al sistema si existe una actividad que pueda responder a tu intent antes de iniciarla y <strong>ofrecerle la posibilidad al usuario de elegir qu&#xE9; aplicaci&#xF3;n usar</strong>.</p>
<h4 class="mume-header" id="enviar-un-correo-electr%C3%B3nico-escogiendo-la-aplicaci%C3%B3n">Enviar un correo electr&#xF3;nico escogiendo la aplicaci&#xF3;n</h4>

<p>Veamos un ejemplo de un <strong>Intent impl&#xED;cito</strong> para solicitar al sistema enviar un correo electr&#xF3;nico con un texto plano. Adem&#xE1;s, al Intent le pasaremos una serie de par&#xE1;metros como el asunto, el texto del correo y los destinatarios. Para ello usaremos el m&#xE9;todo <strong><code>putExtra()</code></strong> del objeto <strong>Intent</strong>. El c&#xF3;digo ser&#xED;a el siguiente...</p>
<p><strong>Aunque no es necesario</strong>, podemos indicar a Android que tipo de intents vamos a usar en nuestra aplicaci&#xF3;n al final de Manifest de la aplicaci&#xF3;n con la etiqueta <strong><code>&lt;queries&gt;</code></strong>.</p>
<pre data-role="codeBlock" data-info="xml" class="language-xml"><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>manifest</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/tools<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    ...

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>queries</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.intent.action.SEND<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name"><span class="token namespace">android:</span>mimeType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/plain<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>queries</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>manifest</span><span class="token punctuation">&gt;</span></span>
</pre><pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token comment">// IntentsImplicitos.kt</span>

<span class="token keyword keyword-fun">fun</span> Context<span class="token punctuation">.</span><span class="token function">sendMail</span><span class="token punctuation">(</span>
    correos<span class="token operator">:</span> Array<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">,</span>
    asunto<span class="token operator">:</span> String<span class="token punctuation">,</span>
    texto<span class="token operator">:</span> String<span class="token punctuation">,</span>
    forzarEleccion<span class="token operator">:</span> Boolean <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> intent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span>Intent<span class="token punctuation">.</span>ACTION_SEND<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">{</span>
        type <span class="token operator">=</span> <span class="token string">&quot;text/plain&quot;</span>
        <span class="token comment">// A&#xF1;adimos los datos del correo.</span>
        <span class="token function">putExtra</span><span class="token punctuation">(</span>Intent<span class="token punctuation">.</span>EXTRA_EMAIL<span class="token punctuation">,</span> correos<span class="token punctuation">)</span>
        <span class="token function">putExtra</span><span class="token punctuation">(</span>Intent<span class="token punctuation">.</span>EXTRA_SUBJECT<span class="token punctuation">,</span> asunto<span class="token punctuation">)</span>
        <span class="token function">putExtra</span><span class="token punctuation">(</span>Intent<span class="token punctuation">.</span>EXTRA_TEXT<span class="token punctuation">,</span> texto<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-val">val</span> chooser <span class="token operator">=</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>forzarEleccion<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-val">val</span> title<span class="token operator">:</span> String <span class="token operator">=</span> resources<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>string<span class="token punctuation">.</span>enviar_correo<span class="token punctuation">)</span>
        Intent<span class="token punctuation">.</span><span class="token function">createChooser</span><span class="token punctuation">(</span>intent<span class="token punctuation">,</span> title<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-null">null</span>

    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>intent<span class="token punctuation">.</span><span class="token function">resolveActivity</span><span class="token punctuation">(</span>packageManager<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">startActivity</span><span class="token punctuation">(</span>chooser <span class="token operator">?:</span> intent<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">IntentSendMail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> context <span class="token operator">=</span> LocalContext<span class="token punctuation">.</span>current
    <span class="token function">Box</span><span class="token punctuation">(</span>modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">fillMaxSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        contentAlignment <span class="token operator">=</span> androidx<span class="token punctuation">.</span>compose<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>Alignment<span class="token punctuation">.</span>Center<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Button</span><span class="token punctuation">(</span>onClick <span class="token operator">=</span> <span class="token punctuation">{</span> context<span class="token punctuation">.</span><span class="token function">sendMail</span><span class="token punctuation">(</span>
            correos <span class="token operator">=</span> <span class="token function">arrayOf</span><span class="token punctuation">(</span><span class="token string">&quot;correo@alu.edu.gva.es&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            asunto <span class="token operator">=</span> <span class="token string">&quot;Asunto del correo&quot;</span><span class="token punctuation">,</span>
            texto <span class="token operator">=</span> <span class="token string">&quot;Texto del correo&quot;</span>
        <span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">Text</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string">&quot;Send Mail&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><div style="page-break-after:always;"></div>
<div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px">
<div style="width: 70%">
<p>Al usar <strong><code>ACTION_SEND</code></strong> con esos par&#xE1;metros. <strong><code>Android</code></strong> nos ofrecer&#xE1; varias opciones para enviar el correo. Si seleccionamos <strong><code>Gmail</code></strong> + <strong><code>Always</code></strong> la siguiente vez que queramos enviar un correo, <strong>no nos preguntar&#xE1;</strong>.</p>
<p>Realmente el sistema <strong>Android busca el componente apropiado</strong> para iniciar comparando el contenido de la intent con los <strong><a href="https://developer.android.com/guide/topics/manifest/intent-filter-element?hl=es-419">filtros de intents</a></strong> declarados en el archivo de manifiesto de otras aplicaciones en el dispositivo. Si la intent coincide con un filtro de intents, el sistema inicia ese componente y le entrega el objeto Intent. <strong>Si varios filtros de intents son compatibles</strong>, el sistema muestra un cuadro de di&#xE1;logo para que el usuario pueda elegir la aplicaci&#xF3;n que se debe usar.</p>
</div>
<div style="width: auto">
<img height="200px" src="assets/imagenes/tema_3_8/email_opciones.png">
</div>
</div>
<p>En nuestro caso, la App debe tener una actividad que acepte los par&#xE1;metros que le pasamos y tener un filtro similar al siguiente:</p>
<pre data-role="codeBlock" data-info="xml" class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>.ClaseQueDefineLaActividad<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    &lt;android:exported=&quot;true&quot;&gt; <span class="token comment">&lt;!-- Necesario para que otras apps puedan usarla --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.intent.action.SEND<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>category</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.intent.category.DEFAULT<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name"><span class="token namespace">android:</span>mimeType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/plain<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent-filter</span><span class="token punctuation">&gt;</span></span>   
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activity</span><span class="token punctuation">&gt;</span></span>
</pre><p>Puedes consultar la <strong><a href="https://developer.android.com/guide/components/intents-filters?hl=es-419#Receiving">documentaci&#xF3;n oficial</a></strong> para m&#xE1;s informaci&#xF3;n.</p>
<blockquote>
<p>&#x1F4CC; <strong>Nota</strong>: Si no declaras ning&#xFA;n filtro de intent para una actividad, esta solo se puede iniciar con un <strong>intent expl&#xED;cito</strong>.</p>
</blockquote>
<div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px">
<div style="width: 70%">
<p>Si queremos que el sistema nos pregunte siempre que aplicaci&#xF3;n queremos usar para enviar el correo independientemente de si la hemos predeterminado o no. Deberemos usar el m&#xE9;todo <strong><code>createChooser()</code></strong> del objeto <strong>Intent</strong> como se ve en el c&#xF3;digo de ejemplo.</p>
</div>
<div style="width: auto">
<img height="200px" src="assets/imagenes/tema_3_8/email_forzado.png">
</div>
</div>
<div style="page-break-after:always;"></div>
<h4 class="mume-header" id="abrir-una-localizaci%C3%B3n-en-google-maps">Abrir una localizaci&#xF3;n en Google Maps</h4>

<p>Veamos algunos ejemplos m&#xE1;s de <strong>Intents impl&#xED;citos</strong> extra&#xED;dos de la documentaci&#xF3;n oficial <strong><a href="https://developer.android.com/guide/components/intents-common?hl=es-419">aqu&#xED;</a></strong> o <strong><a href="https://developer.android.com/training/basics/intents/sending?hl=es-419">aqu&#xED;</a></strong> ...</p>
<p>En este caso vamos a visualizar una geolocalizaci&#xF3;n y la aplicaci&#xF3;n de <strong><code>Maps</code></strong> tiene un filtro que acepta este tipo de intents. F&#xED;jate que en este caso hemos controlado la excepci&#xF3;n <strong><code>ActivityNotFoundException</code></strong> que se lanza si no tenemos instalada la aplicaci&#xF3;n de <strong><code>Maps</code></strong> mostrando un mensaje temporal.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-fun">fun</span> Context<span class="token punctuation">.</span><span class="token function">buscaEnMaps</span><span class="token punctuation">(</span>lugar<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> intent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span>Intent<span class="token punctuation">.</span>ACTION_VIEW<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-data">data</span> <span class="token operator">=</span> Uri<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;geo:0,0?q=<span class="token interpolation variable">$lugar</span>&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-try">try</span> <span class="token punctuation">{</span>
        <span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> ActivityNotFoundException<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">,</span> <span class="token string">&quot;No se puede abrir Maps&quot;</span><span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">IntentBuscaEnMaps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> context <span class="token operator">=</span> LocalContext<span class="token punctuation">.</span>current
    <span class="token function">Button</span><span class="token punctuation">(</span>onClick <span class="token operator">=</span> <span class="token punctuation">{</span>
        context<span class="token punctuation">.</span><span class="token function">buscaEnMaps</span><span class="token punctuation">(</span><span class="token string">&quot;I.E.S Doctor Balmis, +Alicante&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Text</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string">&quot;Ver Balmis en Maps&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><div style="page-break-after:always;"></div>
<h4 class="mume-header" id="obtener-el-resultado-de-un-intent-registrando-un-contrato">Obtener el resultado de un Intent registrando un &apos;<em>contrato</em>&apos;</h4>

<p>Iniciar otra actividad, ya sea dentro de tu app o desde otra, no tiene por qu&#xE9; ser una operaci&#xF3;n unidireccional, tambi&#xE9;n puedes iniciar una actividad y recibir un resultado. Por ejemplo, tu app puede iniciar una app de c&#xE1;mara y <strong>recibir la foto tomada como resultado</strong>. Tambi&#xE9;n puedes iniciar la app de Contactos para que el usuario <strong>seleccione un contacto y, luego, recibir los detalles correspondientes</strong> como resultado.</p>
<p>Deberemos tener en cuenta que:</p>
<ul>
<li>El resultado no es inmediato y <strong>deberemos definir alg&#xFA;n tipo de callback para recibirlo</strong>.</li>
<li>La gesti&#xF3;n de ese callback deber&#xE1; ser <strong>as&#xED;ncrona</strong> y no bloquear la UI.</li>
<li>Este callback debe estar ligado al ciclo de vida de la actividad que lo recibe. Esto es, si lanzamos un Intent con respuesta desde una actividad, el callback no se debe gestionar si esta ha finalizado.</li>
</ul>
<p>Para gestionar todo esto Android ha definido una <strong><a href="https://developer.android.com/training/basics/intents/result?hl=es-419#launch">serie de clases</a></strong>.</p>
<p>Para simplificar, vamos a realizar este proceso creando un <strong>Intent</strong> lanzar otra <strong>Activity</strong> de nuestra propia aplicaci&#xF3;n de ejemplo <strong>que recibir&#xE1; un texto y adem&#xE1;s nos devolver&#xE1; otro intent con el texto introducido</strong>.</p>
<blockquote>
<p>&#x270B; <strong>Importante</strong>: Si el intent lo hici&#xE9;ramos sobre <strong>una actividad de otra aplicaci&#xF3;n</strong> el proceso de comunicaci&#xF3;n ser&#xE1; el mismo de nuestro ejemplo.</p>
</blockquote>
<p>Para ello, nos situamos sobre el paquete <strong><code>views</code></strong> seleccionamos bot&#xF3;n derecho y crear una nueva clase que represente una actividad llamada <strong><code>ActivityQueProduceUnTexto</code></strong>. Recuerda que para usar compose debe heredar de la clase <strong><code>ComponentActivity</code></strong>. El c&#xF3;digo ser&#xED;a el siguiente...</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-class">class</span> ActivityQueProduceUnTexto <span class="token operator">:</span> <span class="token function">ComponentActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        setContent <span class="token punctuation">{</span>
            EjemplosIntentsTheme <span class="token punctuation">{</span>
                <span class="token function">Surface</span><span class="token punctuation">(</span>
                    modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">fillMaxSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    color <span class="token operator">=</span> MaterialTheme<span class="token punctuation">.</span>colorScheme<span class="token punctuation">.</span>background
                <span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>Adem&#xE1;s, en el <strong>manifest.xml</strong> vamos a a&#xF1;adir la actividad que acabamos de crear. El c&#xF3;digo ser&#xED;a el siguiente, dentro de la etiqueta <strong><code>&lt;application&gt;</code></strong> bajo la etiqueta <strong><code>&lt;activity&gt;</code></strong> que define nuestro <strong><code>MainActivity</code></strong> ...</p>
<blockquote>
<p>&#x1F4CC; <strong>Nota</strong>: F&#xED;jate que hemos definido el recurso cadena <strong><code>title_activity_que_produce_un_texto</code></strong>. Haz <strong><code>Ctrl+.</code></strong> para definirlo con el texto <strong><code>&quot;ActivityQueProduceUnTexto&quot;</code></strong></p>
</blockquote>
<pre data-role="codeBlock" data-info="xml" class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span>
    <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>.ui.views.ActivityQueProduceUnTexto<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>exported</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@string/title_activity_que_produce_un_texto<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>theme</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@style/Theme.EjemplosIntents<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.intent.action.SEND<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>category</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.intent.category.DEFAULT<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name"><span class="token namespace">android:</span>mimeType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/plain<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activity</span><span class="token punctuation">&gt;</span></span>
</pre><blockquote>
<p>&#x270B; <strong>Importante</strong>: F&#xED;jate adem&#xE1;s, que hemos a&#xF1;adido el atributo <strong><code>android:exported=&quot;true&quot;</code></strong>. Esto es necesario para que <strong>otras aplicaciones</strong> puedan usar esta actividad y adem&#xE1;s hemos expuesto a Android que podemos recibir intents de tipo <strong><code>SEND</code></strong> con datos de tipo <strong><code>text/plain</code></strong> para que nos ofrezca a otras Apps en ese caso.</p>
</blockquote>
<p>Podemos ahora definir la siguiente UI con Compose para <strong><code>ActivityQueProduceUnTexto</code></strong> en la cual mostramos el dato de texto recibido desde el <strong><code>MainActivity</code></strong> y adem&#xE1;s tenemos un campo de texto para que el usuario introduzca un texto y lo devuelva al <strong><code>MainActivity</code></strong> a trav&#xE9;s del manejador <strong><code>onClickDevolver</code></strong>. El c&#xF3;digo puede ser el siguiente...</p>
<pre data-role="codeBlock" data-info="kotlin {highlight=25}" class="language-kotlin" data-line="25"><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">PideTexto</span><span class="token punctuation">(</span>
    textoRecibidoPorLlamador<span class="token operator">:</span> String <span class="token operator">=</span> <span class="token string">&quot;Sin llamador&quot;</span><span class="token punctuation">,</span>
    onClickDevolver<span class="token operator">:</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-var">var</span> texto <span class="token keyword keyword-by">by</span> rememberSaveable <span class="token punctuation">{</span> <span class="token function">mutableStateOf</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token function">Column</span><span class="token punctuation">(</span>modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">fillMaxSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        horizontalAlignment <span class="token operator">=</span> Alignment<span class="token punctuation">.</span>CenterHorizontally<span class="token punctuation">,</span>
        verticalArrangement <span class="token operator">=</span> Arrangement<span class="token punctuation">.</span>Center<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Text</span><span class="token punctuation">(</span>
            text <span class="token operator">=</span> textoRecibidoPorLlamador<span class="token punctuation">,</span>
            modifier <span class="token operator">=</span> Modifier
                <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">fillMaxWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            style <span class="token operator">=</span> MaterialTheme<span class="token punctuation">.</span>typography<span class="token punctuation">.</span>titleLarge<span class="token punctuation">,</span>
            textAlign <span class="token operator">=</span> TextAlign<span class="token punctuation">.</span>Center
        <span class="token punctuation">)</span>
        <span class="token function">Spacer</span><span class="token punctuation">(</span>modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">OutlinedTextField</span><span class="token punctuation">(</span>
            label <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">Text</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string">&quot;Texto a devolver&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            value <span class="token operator">=</span> texto<span class="token punctuation">,</span>
            onValueChange <span class="token operator">=</span> <span class="token punctuation">{</span> texto <span class="token operator">=</span> it <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
        <span class="token function">Spacer</span><span class="token punctuation">(</span>modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">Button</span><span class="token punctuation">(</span>onClick <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">onClickDevolver</span><span class="token punctuation">(</span>texto<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">Text</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string">&quot;Devolver texto&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<div class="line-highlight-wrapper">























<div aria-hidden="true" class="line-highlight" data-range="25" data-start="25">
</div></div></pre><p>Veamos ahora c&#xF3;mo quedar&#xED;a el c&#xF3;digo definitivo de <strong><code>ActivityQueProduceUnTexto</code></strong>.</p>
<div style="page-break-after:always;"></div>
<pre data-role="codeBlock" data-info="kotlin {highlight=[4-10, 13-22]}" class="language-kotlin" data-line="4-10,13-22"><span class="token keyword keyword-class">class</span> ActivityQueProduceUnTexto <span class="token operator">:</span> <span class="token function">ComponentActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        <span class="token comment">// Recuperamos el texto que nos ha pasado el llamador y que est&#xE1; en</span>
        <span class="token comment">// la propiedad intent de la actividad que contiene los datos </span>
        <span class="token comment">// que se han pasado desde el llamador.</span>
        <span class="token comment">// Los asignamos en un estado usado por la interfaz en la composici&#xF3;n.</span>
        <span class="token keyword keyword-val">val</span> textoRecibidoPorLlamador <span class="token keyword keyword-by">by</span> <span class="token function">mutableStateOf</span><span class="token punctuation">(</span>
            intent<span class="token punctuation">.</span><span class="token function">getStringExtra</span><span class="token punctuation">(</span><span class="token string">&quot;TEXTO&quot;</span><span class="token punctuation">)</span> <span class="token operator">?:</span> <span class="token string">&quot;&quot;</span>
        <span class="token punctuation">)</span>

        <span class="token keyword keyword-val">val</span> onClickDevolver<span class="token operator">:</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit <span class="token operator">=</span> <span class="token punctuation">{</span> texto <span class="token operator">-&gt;</span>
            <span class="token comment">// Para devolver datos al llamador, los empaquetamos en un </span>
            <span class="token comment">// Intent le a&#xF1;adimos los datos y lo pasamos como par&#xE1;metro </span>
            <span class="token comment">// al m&#xE9;todo setResult, que crea un objeto ActivityResult que</span>
            <span class="token comment">// es lo que espera recibir el llamador en su &apos;contrato&apos;. </span>
            <span class="token function">Intent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">also</span> <span class="token punctuation">{</span>intento <span class="token operator">-&gt;</span>
                intento<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">&quot;TEXTODEVUELTO&quot;</span><span class="token punctuation">,</span> texto<span class="token punctuation">)</span>
                <span class="token function">setResult</span><span class="token punctuation">(</span>RESULT_OK<span class="token punctuation">,</span> intento<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// Finalizamos la actividad tras poner los datos de resultado en el intent</span>
            <span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        setContent <span class="token punctuation">{</span>
            EjemplosIntentsTheme <span class="token punctuation">{</span>
                <span class="token function">Surface</span><span class="token punctuation">(</span>
                    modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">fillMaxSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    color <span class="token operator">=</span> MaterialTheme<span class="token punctuation">.</span>colorScheme<span class="token punctuation">.</span>background
                <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">PideTexto</span><span class="token punctuation">(</span>
                        textoRecibidoPorLlamador <span class="token operator">=</span> textoRecibidoPorLlamador<span class="token punctuation">,</span>
                        onClickDevolver <span class="token operator">=</span> onClickDevolver
                    <span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<div class="line-highlight-wrapper">


<div aria-hidden="true" class="line-highlight" data-range="4-10" data-start="4" data-end="10">






</div></div><div class="line-highlight-wrapper">











<div aria-hidden="true" class="line-highlight" data-range="13-22" data-start="13" data-end="22">









</div></div></pre><p>Veamos ahora c&#xF3;mo ser&#xED;a el proceso de llamar a <strong><code>ActivityQueProduceUnTexto</code></strong> con un Intent expl&#xED;cito con un texto y recibir el resultado en otro intent envuelto en un <strong><code>ActivityResult</code></strong>.</p>
<p>En primer lugar definimos una interfaz <strong><code>@Composable</code></strong> en <strong><code>MainActivity</code></strong> (fuera de la clase) que nos permita lanzar la actividad y gestionar su respuesta denominado <strong><code>InterfaceParaLanzarActivityQueProduceUnTexto</code></strong></p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">InterfaceParaLanzarActivityQueProduceUnTexto</span><span class="token punctuation">(</span>
    textoDevueltoPorIntent<span class="token operator">:</span> String <span class="token operator">=</span> <span class="token string">&quot;No has llamado a&#xFA;n&quot;</span><span class="token punctuation">,</span>
    onClickLanzar<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Column</span><span class="token punctuation">(</span>modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">fillMaxSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        horizontalAlignment <span class="token operator">=</span> Alignment<span class="token punctuation">.</span>CenterHorizontally<span class="token punctuation">,</span>
        verticalArrangement <span class="token operator">=</span> Arrangement<span class="token punctuation">.</span>Center<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Button</span><span class="token punctuation">(</span>onClick <span class="token operator">=</span> onClickLanzar<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">Text</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string">&quot;Llama a ActivityQueProduceUnTexto&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token function">Text</span><span class="token punctuation">(</span>
            text <span class="token operator">=</span> textoDevueltoPorIntent<span class="token punctuation">,</span>
            modifier <span class="token operator">=</span> Modifier
                <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">fillMaxWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            style <span class="token operator">=</span> MaterialTheme<span class="token punctuation">.</span>typography<span class="token punctuation">.</span>titleLarge<span class="token punctuation">,</span>
            textAlign <span class="token operator">=</span> TextAlign<span class="token punctuation">.</span>Center
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>Ahora usarmos el m&#xE9;todo <strong><code>registerForActivityResult()</code></strong> de la clase <strong><code>ComponentActivity</code></strong> para registrar un <strong><code>ActivityResultLauncher</code></strong> que se encargar&#xE1; de gestionar la respuesta del intent. El c&#xF3;digo ser&#xED;a el siguiente:</p>
<div style="page-break-after:always;"></div>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-class">class</span> MainActivity <span class="token operator">:</span> <span class="token function">ComponentActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-var">var</span> textoDevueltoPorIntent <span class="token keyword keyword-by">by</span> <span class="token function">mutableStateOf</span><span class="token punctuation">(</span><span class="token string">&quot;No has llamdo a&#xFA;n&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">// Definimos un lanzador con el contrato ActivityResultContracts.StartActivityForResult</span>
    <span class="token comment">// que recibir&#xE1; (ENTRADA) el intent expl&#xED;cito sobre la actividad secuendaria </span>
    <span class="token comment">// y devolver&#xE1; (SALIDA) un objeto ActivityResult que contiene el intent de respuesta</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> launcherActivityQueProduceUnTexto<span class="token operator">:</span> ActivityResultLauncher<span class="token operator">&lt;</span>Intent<span class="token operator">&gt;</span> <span class="token operator">=</span>
        <span class="token function">registerForActivityResult</span><span class="token punctuation">(</span>ActivityResultContracts<span class="token punctuation">.</span><span class="token function">StartActivityForResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span> result <span class="token operator">-&gt;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>resultCode <span class="token operator">==</span> Activity<span class="token punctuation">.</span>RESULT_OK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                textoDevueltoPorIntent <span class="token operator">=</span> result<span class="token punctuation">.</span>data<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">getStringExtra</span><span class="token punctuation">(</span><span class="token string">&quot;TEXTODEVUELTO&quot;</span><span class="token punctuation">)</span>
                    <span class="token operator">?:</span> <span class="token string">&quot;Nada retornado&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        setContent <span class="token punctuation">{</span>
            EjemplosIntentsTheme <span class="token punctuation">{</span>
                <span class="token function">Surface</span><span class="token punctuation">(</span>modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">fillMaxSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-val">val</span> context <span class="token operator">=</span> LocalContext<span class="token punctuation">.</span>current
                    <span class="token function">InterfaceParaLanzarActivityQueProduceUnTexto</span><span class="token punctuation">(</span>
                        textoDevueltoPorIntent <span class="token operator">=</span> textoDevueltoPorIntent<span class="token punctuation">,</span>
                        onClickLanzar <span class="token operator">=</span> <span class="token punctuation">{</span>
                            <span class="token comment">// En lanzado con el contrato encargado de gestionar una</span>
                            <span class="token comment">// respuesta ActivityResult. Para ello crea el </span>
                            <span class="token comment">// Intent expl&#xED;cito pas&#xE1;ndole un texto como par&#xE1;metro</span>
                            <span class="token comment">// indic&#xE1;ndole por quien es llamada.</span>
                            <span class="token comment">// El contexto se puede sacar de LocalContext.current y tambi&#xE9;n</span>
                            <span class="token comment">// claurur&#xE1;ndo el propio contexto de la actividad.</span>
                            launcherActivityQueProduceUnTexto<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>
                                <span class="token function">Intent</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> ActivityQueProduceUnTexto<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">{</span>
                                        <span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">&quot;TEXTO&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Te llamo desde MainActivity&quot;</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">}</span>
                            <span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>Vemos con m&#xE1;s detalle el c&#xF3;digo de la llamada ...</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> launcherActivityQueProduceUnTexto<span class="token operator">:</span> ActivityResultLauncher<span class="token operator">&lt;</span>Intent<span class="token operator">&gt;</span> <span class="token operator">=</span>
        <span class="token function">registerForActivityResult</span><span class="token punctuation">(</span>ActivityResultContracts<span class="token punctuation">.</span><span class="token function">StartActivityForResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span> result <span class="token operator">-&gt;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>resultCode <span class="token operator">==</span> Activity<span class="token punctuation">.</span>RESULT_OK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                textoDevueltoPorIntent <span class="token operator">=</span> result<span class="token punctuation">.</span>data<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">getStringExtra</span><span class="token punctuation">(</span><span class="token string">&quot;TEXTODEVUELTO&quot;</span><span class="token punctuation">)</span>
                    <span class="token operator">?:</span> <span class="token string">&quot;Nada retornado&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
</pre><p>Vamos a separar la respuesta de la llamada porque despu&#xE9;s de acabar la actividad se destruir&#xE1;.</p>
<ul>
<li>
<p><strong>Paso 1</strong>: Crearemos un objeto <strong><code>ActivityResultLauncher</code></strong> mediante el m&#xE9;todo <strong><code>registerForActivityResult()</code></strong> de la clase <strong><code>ComponentActivity</code></strong>. Este m&#xE9;todo recibe dos par&#xE1;metros:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-final">final</span> <span class="token operator">&lt;</span>I<span class="token punctuation">,</span> O<span class="token operator">&gt;</span> ActivityResultLauncher<span class="token operator">&lt;</span>I<span class="token operator">&gt;</span> <span class="token function">registerForActivityResult</span><span class="token punctuation">(</span>
        <span class="token annotation builtin">@NonNull</span> ActivityResultContract<span class="token operator">&lt;</span>I<span class="token punctuation">,</span> O<span class="token operator">&gt;</span> contract<span class="token punctuation">,</span>
        <span class="token annotation builtin">@NonNull</span> ActivityResultCallback<span class="token operator">&lt;</span>O<span class="token operator">&gt;</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span> <span class="token function">registerForActivityResult</span><span class="token punctuation">(</span>contract<span class="token punctuation">,</span> mActivityResultRegistry<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><p>Donde ...</p>
<ul>
<li>
<p><strong><code>ActivityResultContract</code></strong> es un &apos;contrato&apos; que especifica que una actividad se puede llamar con una entrada de tipo I y producir una salida de tipo O. Aunque se pueden crear contratos personalizados, la API proporciona contratos predeterminados para acciones de intent b&#xE1;sicas, como tomar una foto, solicitar permisos, etc.</p>
<p>Por ejemplo, <strong><code>ActivityResultContracts.StartActivityForResult()</code></strong> es una contrato que especifica que una actividad se puede llamar con una <strong>entrada de tipo <code>Intent</code></strong> y producir una <strong>salida de tipo <code>ActivityResult</code></strong>.</p>
</li>
<li>
<p><strong><code>ActivityResultCallback</code></strong> es un <em>callback</em> al que le llega un objeto de tipo O, para nuestro contrato un <strong><code>ActivityResult</code></strong> y hace una determinada acci&#xF3;n sin retornar o &apos;<em>producir</em>&apos; nada. <strong><code>result : ActivityResult -&gt; void</code></strong></p>
<div class="admonition warning">
<p class="admonition-title">Aviso</p>
<p>Los <strong><code>registerForActivityResult</code></strong> deben hacerse en el <strong><code>onCreate</code></strong> de la actividad.</p>
</div>
</li>
</ul>
</li>
<li>
<p><strong>Paso 2</strong>: Crearemos un Intent con los datos y el nombre de la Activity como siempre y despu&#xE9;s con el objeto <strong><code>launcherActivityQueProduceUnTexto</code></strong> lanzaremos en Intent seg&#xFA;n lo establecido en el contrato del lanzador. El c&#xF3;digo ser&#xED;a el siguiente:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin">launcherActivityQueProduceUnTexto<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>
        <span class="token function">Intent</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> ActivityQueProduceUnTexto<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">{</span>
                <span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">&quot;TEXTO&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Te llamo desde MainActivity&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
</pre></li>
</ul>
<h4 class="mume-header" id="registrando-contratos-dentro-de-un-composable">Registrando contratos dentro de un <code>@Composable</code></h4>

<p>La API de <strong><code>rememberLauncherForActivityResult</code></strong> es an&#xE1;loga a <strong><code>registerForActivityResult</code></strong> pero permite registrar un contrato dentro de un <strong><code>@Composable</code></strong> y guardarlo como un estado que sobrevive a las recomposiciones. Veamos el siguiente ejemplo extrado de la <strong><a href="https://developer.android.com/jetpack/compose/libraries?hl=es-419#activity_result">documentaci&#xF3;n oficial</a></strong> ...</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">GetContentExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-var">var</span> imageUri <span class="token keyword keyword-by">by</span> remember <span class="token punctuation">{</span> mutableStateOf<span class="token operator">&lt;</span>Uri<span class="token operator">?</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token keyword keyword-val">val</span> launcher <span class="token operator">=</span> <span class="token function">rememberLauncherForActivityResult</span><span class="token punctuation">(</span><span class="token function">GetContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> uri<span class="token operator">:</span> Uri<span class="token operator">?</span> <span class="token operator">-&gt;</span>
        imageUri <span class="token operator">=</span> uri
    <span class="token punctuation">}</span>
    Column <span class="token punctuation">{</span>
        <span class="token function">Button</span><span class="token punctuation">(</span>onClick <span class="token operator">=</span> <span class="token punctuation">{</span> launcher<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token string">&quot;image\*&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">Text</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string">&quot;Load Image&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token function">Image</span><span class="token punctuation">(</span>
            painter <span class="token operator">=</span> <span class="token function">rememberImagePainter</span><span class="token punctuation">(</span>imageUri<span class="token punctuation">)</span><span class="token punctuation">,</span>
            contentDescription <span class="token operator">=</span> <span class="token string">&quot;My Image&quot;</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p><strong><code>GetContent()</code></strong> es un contrato que especifica que se puede llamar a una actividad de selecci&#xF3;n de im&#xE1;genes con una entrada de tipo <strong><code>String</code></strong>, que es la ruta de donde escogerlas y producir una salida de tipo <strong><code>Uri</code></strong> que es la ruta a ella.</p>
<div style="page-break-after:always;"></div>
<h2 class="mume-header" id="gestion-de-permisos">Gestion de Permisos</h2>

<p>Para realizar lanzar algunos intents sobre actividades y servicios del sistema necesitaremos de ciertos permisos. Por ejemplo, para abrir la c&#xE1;mara, para leer la agenda de contactos, etc.</p>
<p>La forma de gestionar los permisos ha cambiado en las &#xFA;ltimas versiones de Android. En versiones anteriores a <strong>Android 6.0 (API nivel 23)</strong>, los usuarios conced&#xED;an todos los permisos solicitados en el manifiesto por una app en el momento de la instalaci&#xF3;n.</p>
<p>Ahora en Android, el <strong>sistema gestiona los permisos de las apps mientras se ejecutan</strong> y los usuarios pueden revocar cualquier permiso en cualquier momento.</p>
<p>El esquema para definir permisos es:</p>
<ol>
<li>
<p>Definiremos los requerimientos de permisos en el <strong><code>AndroidManifest.xml</code></strong> de la aplicaci&#xF3;n.</p>
</li>
<li>
<p>Registraremos un contrato de solicitud de permisos <strong><code>ActivityResultContracts.RequestPermission()</code></strong> con el m&#xE9;todo <strong><code>registerForActivityResult</code></strong> o <strong><code>rememberLauncherForActivityResult</code></strong> de la clase <strong><code>ComponentActivity</code></strong>.</p>
<p>El manejador del resultado de los permisos crear&#xE1; el intent para el servicio o activity y se pueden dar dos casos:</p>
<ol>
<li>Que el servicio no retorne nada por ejemplo una llamada telef&#xF3;nica.<br>
En este caso, desde el manejador si el permiso ha sido concedido lanzaremos el intent de llamada con el m&#xE9;todo <strong><code>startActivity()</code></strong> como ya hemos visto.</li>
<li>Que el servicio retorne un resultado por ejemplo una foto.<br>
En este caso, desde el manejador si el permiso ha sido concedido lanzaremos el <strong><code>launch</code></strong> de del registro de un contrato que se encargar&#xE1; de gestionar la respuesta con el resultado.</li>
</ol>
</li>
</ol>
<div style="page-break-after:always;"></div>
<h3 class="mume-header" id="gestionar-intent-impl%C3%ADcito-de-llamada-telef%C3%B3nica">Gestionar intent impl&#xED;cito de llamada telef&#xF3;nica</h3>

<ol>
<li>
<p>A&#xF1;adimos en el <strong><code>AndroidManifest.xml</code></strong> el permiso <strong><code>CALL_PHONE</code></strong>. Estas etiquetas ir&#xE1;n dentro de la etiqueta <strong><code>&lt;manifest&gt;</code></strong>:</p>
<pre data-role="codeBlock" data-info="xml" class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-feature</span>
    <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.hardware.telephony<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>required</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.permission.CALL_PHONE<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</pre></li>
<li>
<p>Por ejemplo, si queremos que el m&#xE9;todo de registro sea <strong><code>@Composable</code></strong> haremos.</p>
<pre data-role="codeBlock" data-info="kotlin {highlight=[6-7, 10]}" class="language-kotlin" data-line="6-7,10"><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">registroLlamarPorTelefonoIntent</span><span class="token punctuation">(</span>
    telefono<span class="token operator">:</span> String
<span class="token punctuation">)</span><span class="token operator">:</span> ManagedActivityResultLauncher<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Boolean<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> context <span class="token operator">=</span> LocalContext<span class="token punctuation">.</span>current
    <span class="token keyword keyword-return">return</span> <span class="token function">rememberLauncherForActivityResult</span><span class="token punctuation">(</span>
        ActivityResultContracts<span class="token punctuation">.</span><span class="token function">RequestPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span> success <span class="token operator">-&gt;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">Intent</span><span class="token punctuation">(</span>Intent<span class="token punctuation">.</span>ACTION_CALL<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">also</span> <span class="token punctuation">{</span>
                callIntent <span class="token operator">-&gt;</span>
                callIntent<span class="token punctuation">.</span>data <span class="token operator">=</span> Uri<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;tel:<span class="token interpolation variable">$telefono</span>&quot;</span><span class="token punctuation">)</span>
                context<span class="token punctuation">.</span><span class="token function">startActivity</span><span class="token punctuation">(</span>callIntent<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<div class="line-highlight-wrapper">




<div aria-hidden="true" class="line-highlight" data-range="6-7" data-start="6" data-end="7">

</div></div><div class="line-highlight-wrapper">








<div aria-hidden="true" class="line-highlight" data-range="10" data-start="10">
</div></div></pre><p>Posteriormente podemos hacer ...</p>
<pre data-role="codeBlock" data-info="kotlin {highlight=[3, 5]}" class="language-kotlin" data-line="3,5"><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">IntentLlamadaConPermisos</span><span class="token punctuation">(</span>telefono<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> launcherTelefono <span class="token operator">=</span> <span class="token function">registroLlamarPorTelefonoIntent</span><span class="token punctuation">(</span>telefono<span class="token punctuation">)</span>
    <span class="token function">Button</span><span class="token punctuation">(</span>onClick <span class="token operator">=</span> <span class="token punctuation">{</span>
        launcherTelefono<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>android<span class="token punctuation">.</span>Manifest<span class="token punctuation">.</span>permission<span class="token punctuation">.</span>CALL_PHONE<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Text</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string">&quot;Llamar al <span class="token interpolation variable">$telefono</span>&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<div class="line-highlight-wrapper">

<div aria-hidden="true" class="line-highlight" data-range="3" data-start="3">
</div></div><div class="line-highlight-wrapper">



<div aria-hidden="true" class="line-highlight" data-range="5" data-start="5">
</div></div></pre></li>
</ol>
<div style="page-break-after:always;"></div>
<h3 class="mume-header" id="gestionar-intent-impl%C3%ADcito-para-hacer-un-foto">Gestionar intent impl&#xED;cito para hacer un foto</h3>

<ol>
<li>
<p>A&#xF1;adimos en el <strong><code>AndroidManifest.xml</code></strong> el permiso <strong><code>CAMERA</code></strong>. Estas etiquetas ir&#xE1;n dentro de la etiqueta <strong><code>&lt;manifest&gt;</code></strong>:</p>
<pre data-role="codeBlock" data-info="xml" class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-feature</span>
    <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.hardware.camera.any<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>required</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.permission.CAMERA<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</pre></li>
<li>
<p>Por ejemplo, si queremos que el m&#xE9;todo de registro sea <strong><code>@Composable</code></strong> haremos.</p>
<pre data-role="codeBlock" data-info="kotlin {highlight=[6-12, 14-21]}" class="language-kotlin" data-line="6-12,14-21"><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">registroHacerFotoConIntent</span><span class="token punctuation">(</span>
    onFotoCambiada<span class="token operator">:</span> <span class="token punctuation">(</span>ImageBitmap<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit
<span class="token punctuation">)</span><span class="token operator">:</span> ManagedActivityResultLauncher<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Boolean<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> cameraLauncher <span class="token operator">=</span>
        <span class="token function">rememberLauncherForActivityResult</span><span class="token punctuation">(</span>ActivityResultContracts
        <span class="token punctuation">.</span><span class="token function">StartActivityForResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> result <span class="token operator">-&gt;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>resultCode <span class="token operator">==</span> Activity<span class="token punctuation">.</span>RESULT_OK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-val">val</span> androidBitmap <span class="token operator">=</span> result<span class="token punctuation">.</span>data<span class="token operator">?</span><span class="token punctuation">.</span>extras<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">)</span> <span class="token keyword keyword-as">as</span> Bitmap
                <span class="token function">onFotoCambiada</span><span class="token punctuation">(</span>androidBitmap<span class="token operator">!!</span><span class="token punctuation">.</span><span class="token function">asImageBitmap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

    <span class="token keyword keyword-return">return</span> <span class="token function">rememberLauncherForActivityResult</span><span class="token punctuation">(</span>
        ActivityResultContracts<span class="token punctuation">.</span><span class="token function">RequestPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span> success <span class="token operator">-&gt;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-val">val</span> cameraIntent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span>MediaStore<span class="token punctuation">.</span>ACTION_IMAGE_CAPTURE_SECURE<span class="token punctuation">)</span>
            cameraLauncher<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>cameraIntent<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<div class="line-highlight-wrapper">




<div aria-hidden="true" class="line-highlight" data-range="6-12" data-start="6" data-end="12">






</div></div><div class="line-highlight-wrapper">












<div aria-hidden="true" class="line-highlight" data-range="14-21" data-start="14" data-end="21">







</div></div></pre> <div style="page-break-after:always;"></div>
<p>Posteriormente podemos hacer ...</p>
<pre data-role="codeBlock" data-info="kotlin {highlight=[5, 7]}" class="language-kotlin" data-line="5,7"><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">IntentFotoConPermisos</span><span class="token punctuation">(</span>
    onFotoCambiada<span class="token operator">:</span> <span class="token punctuation">(</span>ImageBitmap<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> launcherHacerFoto <span class="token operator">=</span> <span class="token function">registroHacerFotoConIntent</span><span class="token punctuation">(</span>onFotoCambiada<span class="token punctuation">)</span>
    <span class="token function">Button</span><span class="token punctuation">(</span>onClick <span class="token operator">=</span> <span class="token punctuation">{</span>
        launcherHacerFoto<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>android<span class="token punctuation">.</span>Manifest<span class="token punctuation">.</span>permission<span class="token punctuation">.</span>CAMERA<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Text</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string">&quot;Hacer foto&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<div class="line-highlight-wrapper">



<div aria-hidden="true" class="line-highlight" data-range="5" data-start="5">
</div></div><div class="line-highlight-wrapper">





<div aria-hidden="true" class="line-highlight" data-range="7" data-start="7">
</div></div></pre></li>
</ol>
<div style="page-break-after:always;"></div>
<h3 class="mume-header" id="gestionar-registro-hacer-foto-con-takepicture">Gestionar registro hacer foto con TakePicture</h3>

<p>Esta forma de hacer fotos nos permitir&#xE1; guardarla foto en una cach&#xE9; local como JPG y lo que recibir&#xE1; el callback ser&#xE1; la ruta de la foto.</p>
<ol>
<li>
<p>Adem&#xE1;s de a&#xF1;adir los permisos de acceso a la c&#xE1;mara como hemos hecho antes. A&#xF1;adimos en el <strong><code>AndroidManifest.xml</code></strong> un proveedor de ficheros para que la aplicaci&#xF3;n pueda acceder a la cach&#xE9; de la aplicaci&#xF3;n. Estas etiquetas ir&#xE1;n dentro de la etiqueta <strong><code>&lt;application&gt;</code></strong>:</p>
<pre data-role="codeBlock" data-info="xml {highlight=10}" class="language-xml" data-line="10"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>application</span><span class="token punctuation">&gt;</span></span>
    ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>provider</span>
        <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>androidx.core.content.FileProvider<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>authorities</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${applicationId}.provider<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>exported</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>grantUriPermissions</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta-data</span>
            <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.support.FILE_PROVIDER_PATHS<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@xml/path_provider<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>provider</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>application</span><span class="token punctuation">&gt;</span></span>
<div class="line-highlight-wrapper">








<div aria-hidden="true" class="line-highlight" data-range="10" data-start="10">
</div></div></pre></li>
<li>
<p>Definiremos el recurso XML <strong><code>path_provider.xml</code></strong> en <strong><code>res/xml</code></strong>. Donde definimos que las im&#xE1;genes se guardar&#xE1;n en la carpeta <strong><code>cache</code></strong> de la aplicaci&#xF3;n situada en <strong><code>/sdcard/Android/data/&lt;package_name&gt;/cache</code></strong>. En esta ubicaci&#xF3;n encontraremos los JPG que se vayan generando.</p>
<pre data-role="codeBlock" data-info="xml" class="language-xml"><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>paths</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>external-cache-path</span>
        <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>my_images<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>paths</span><span class="token punctuation">&gt;</span></span>
</pre></li>
<li>
<p>Ya solo nos queda definir el contrato <strong><code>ActivityResultContracts.TakePicture()</code></strong> cuyo callback, a trav&#xE9;s del <strong><code>FileProvider</code></strong> definido nos permitir&#xE1; obtener la ruta de la foto en la cach&#xE9;.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> Context<span class="token punctuation">.</span><span class="token function">toImageBitmap</span><span class="token punctuation">(</span>uri<span class="token operator">:</span> Uri<span class="token punctuation">)</span><span class="token operator">:</span> ImageBitmap <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> contextResolver <span class="token operator">=</span> <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>contentResolver
    <span class="token keyword keyword-val">val</span> source <span class="token operator">=</span> ImageDecoder<span class="token punctuation">.</span><span class="token function">createSource</span><span class="token punctuation">(</span>contextResolver<span class="token punctuation">,</span> uri<span class="token punctuation">)</span>
    <span class="token keyword keyword-return">return</span> ImageDecoder<span class="token punctuation">.</span><span class="token function">decodeBitmap</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asImageBitmap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">registroHacerFotoConTakePicture</span><span class="token punctuation">(</span>
    onFotoCambiada<span class="token operator">:</span> <span class="token punctuation">(</span>ImageBitmap<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit
<span class="token punctuation">)</span><span class="token operator">:</span> ManagedActivityResultLauncher<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Boolean<span class="token operator">&gt;</span> <span class="token punctuation">{</span>

    <span class="token keyword keyword-val">val</span> context <span class="token operator">=</span> LocalContext<span class="token punctuation">.</span>current
    <span class="token keyword keyword-val">val</span> ficheroTemporal <span class="token operator">=</span> File<span class="token punctuation">.</span><span class="token function">createTempFile</span><span class="token punctuation">(</span>
        <span class="token string">&quot;JPEG_${SimpleDateFormat(&quot;</span>yyyyMMdd_HHmmss<span class="token string">&quot;).format(Date())}_&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;.jpg&quot;</span><span class="token punctuation">,</span>
        context<span class="token punctuation">.</span>externalCacheDir
    <span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> uri <span class="token operator">=</span> FileProvider<span class="token punctuation">.</span><span class="token function">getUriForFile</span><span class="token punctuation">(</span>
        context<span class="token punctuation">,</span>
        <span class="token string">&quot;<span class="token interpolation"><span class="token delimiter variable">${</span>context<span class="token punctuation">.</span>packageName<span class="token delimiter variable">}</span></span>.provider&quot;</span><span class="token punctuation">,</span>
        ficheroTemporal
    <span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> cameraLauncher <span class="token operator">=</span>
        <span class="token function">rememberLauncherForActivityResult</span><span class="token punctuation">(</span>
            ActivityResultContracts<span class="token punctuation">.</span><span class="token function">TakePicture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> success <span class="token operator">-&gt;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">onFotoCambiada</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">toImageBitmap</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> <span class="token function">rememberLauncherForActivityResult</span><span class="token punctuation">(</span>
        ActivityResultContracts<span class="token punctuation">.</span><span class="token function">RequestPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span> success <span class="token operator">-&gt;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cameraLauncher<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre></li>
</ol>
<div style="page-break-after:always;"></div>
<h3 class="mume-header" id="gestionar-registro-para-obtener-una-imagen-de-la-galer%C3%ADa">Gestionar registro para obtener una imagen de la galer&#xED;a</h3>

<p>En el punto Registrando contratos dentro de un <code>@Composable</code> ya hemos visto un ejemplo de como hacerlo. Veamos como concretarlo para seguir el mismo esquema que hemos seguido en los ejemplos anteriores.</p>
<ol>
<li>
<p>Definimos el contrato <strong><code>ActivityResultContracts.GetContent()</code></strong> que especifica que que se puede llamar a una actividad de selecci&#xF3;n de im&#xE1;genes con una entrada de tipo <strong><code>String</code></strong> que es la ruta de donde escogerlas y producir una salida de tipo <strong><code>Uri</code></strong> que es ruta a ella.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">registroSelectorDeImagenesConGetContent</span><span class="token punctuation">(</span>
    onFotoCambiada<span class="token operator">:</span> <span class="token punctuation">(</span>ImageBitmap<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit
<span class="token punctuation">)</span><span class="token operator">:</span> ManagedActivityResultLauncher<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Uri<span class="token operator">?</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> context <span class="token operator">=</span> LocalContext<span class="token punctuation">.</span>current
    <span class="token keyword keyword-return">return</span> <span class="token function">rememberLauncherForActivityResult</span><span class="token punctuation">(</span>
        ActivityResultContracts<span class="token punctuation">.</span><span class="token function">GetContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> uri <span class="token operator">-&gt;</span>
        uri<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span>
            <span class="token function">onFotoCambiada</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">toImageBitmap</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre></li>
<li>
<p>Posteriormente podemos hacer ...</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">IntentImagenGaleria</span><span class="token punctuation">(</span>
    onFotoCambiada<span class="token operator">:</span> <span class="token punctuation">(</span>ImageBitmap<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> launcherFotoGaleria <span class="token operator">=</span> <span class="token function">registroSelectorDeImagenesConGetContent</span><span class="token punctuation">(</span>onFotoCambiada<span class="token punctuation">)</span>
    <span class="token function">Button</span><span class="token punctuation">(</span>onClick <span class="token operator">=</span> <span class="token punctuation">{</span>
        launcherFotoGaleria<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token string">&quot;image/*&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Text</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string">&quot;Foto galer&#xED;a&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre></li>
</ol>
<div style="page-break-after:always;"></div>
<h2 class="mume-header" id="conclusi%C3%B3n">Conclusi&#xF3;n</h2>

<p>Como has podido observar gestionar permisos y lanzar intents es un proceso que puede ser complejo y que requiere de un conocimiento profundo de la API de Android. Por ello, en ocasiones es recomendable utilizar librer&#xED;as de terceros que nos faciliten el trabajo. Por ejemplo dispones de la librer&#xED;a <strong><a href="https://google.github.io/accompanist/permissions/">accompanist</a></strong> que ofrece compatibilidad con Compose para gestionar permisos y lanzar intents.</p>
<p>Puedes descargarte alguna de las funciones a modo de utilidad de <strong><a href="assets/codigo/tema_3_8/RegistroContratosCompose.kt">RegistroContratosCompose.kt</a></strong> para utilizar en tus proyectos incluyendo el fuente en un nuevo paquete denominado <strong><code>.utilities.devices</code></strong> de tu proyecto.</p>

      </div>
      
      
    
    
    
    
    
    
    
    
  
    </body></html>