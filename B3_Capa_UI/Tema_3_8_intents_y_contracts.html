<!DOCTYPE html><html><head>
      <title>PMDM 2ยบ DAM  Tema 3.8 - Intents y Contracts</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}@font-face{font-family:"Material Icons";font-style:normal;font-weight:400;src:local("Material Icons"),local("MaterialIcons-Regular"),url("data:application/x-font-woff;charset=utf-8;base64,d09GRgABAAAAAAfIAAsAAAAADDAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAADMAAABCsP6z7U9TLzIAAAE8AAAARAAAAFZW7kosY21hcAAAAYAAAADTAAACjtP6ytBnbHlmAAACVAAAAxgAAAQ4zRtvlGhlYWQAAAVsAAAALwAAADYRwZsnaGhlYQAABZwAAAAcAAAAJAeKAzxobXR4AAAFuAAAABIAAAA8OGQAAGxvY2EAAAXMAAAAIAAAACAG5AfwbWF4cAAABewAAAAfAAAAIAEfAERuYW1lAAAGDAAAAVcAAAKFkAhoC3Bvc3QAAAdkAAAAYgAAAK2vz7wkeJxjYGRgYOBikGPQYWB0cfMJYeBgYGGAAJAMY05meiJQDMoDyrGAaQ4gZoOIAgCKIwNPAHicY2BkPsQ4gYGVgYOpk+kMAwNDP4RmfM1gxMjBwMDEwMrMgBUEpLmmMDgwVLy4xKzzX4chhrmK4QpQmBEkBwAZygyweJzFkr0NwjAQhZ+TEP6CRUfHBEwRUWaQTICyQbpMwRCskA5RUIONxG0RnnNpKAIV4qzPku/8c353ACYAYrIjCWCuMAh2ptf0/hiL3p/gyPUWa3osqlt0L1zu9r71z8dGrJRykFoauXQd932Lj5vhG+MjxGeYI8MKETObMpslf5EyP8tg+vHun5r539PvlvXzaVhRFVQDTPEWKVQR90KhnnC5Ek67vUKN4VuFasM/ldARj43CCkCsEjpJSoVVgRyU0GVSK6wUpFFCx8lFgX0BiXpRPQB4nE2TTWjcRhTH3xttpDhxN7uxPlp3u/FK7moRPixafRijNosxSw/LUsIwNcaEHPZggo/FmEKMCKWU4kNOOftQSlhE8alnH0Ix9BqWnHooPRrTQ0+mnu2bXTu2pPdGM9LM/6c3fwECTM4gBBMYQNqxzLrZAjqYSlqu2TAHZQA0/DQJH6FtzqGDnvbt4Ggwvzw/nL8EfH8kW0fsuRqhgWXZnY7M1picaUL7Du5BHeDzMIl83dAt016wH1qmvtSMo5R6YRJHTR//FXsff/nj/tc/5K9P5d+nP22+fFK5u7v3K39SW3y+OtDKO3L85vD09PD9z5X17a2N1g4tqk01RlqX7gyoEmnsWQtVr4rtZMmukEaFBZxzefkCn11cyKMLZgshRwgTYNoLNXCBz2ja7HvZG7hDpPSNfoo5vs0knK/9hb+rNpu+8kHPgk/Ao4kK3tWtTpSEtvkA9c+wE6UaUdwieNkaHg55tBEtRiEPw1s0+FtrtTcc9two2lhMknV7PZF/cs6+uUFTmpTGbEx7sQCPSLOttHS3GRltqp7SNzVSKzl6aWnZT/CX5k6/v9N3Hh8fHBwffJVjhrC6OgH5dkIt/tPsq+d/PD5Qz7G7efzq1THFjdZVPe/N6ulQ3JnDWSE5junsFsVIiFwL/htf1S5gJ3BfOcUxfHKLnzqpFpyfZ9cX+/5WB6a+Y0pHpzkNrYNVDwMsikK+y7WuLCRg/oFHkA8VT3rDg5ZnU6ktzzINymV0m74Xd5pfIGXyFeVEQSShkzqG7TBBa2OxVRKitLXv7h3uuftXnXq7lz2tZ/WnWa9dx9dCjDhHzmuVQATlmljr9dZErUydSo2Hbi/b1vXtrOeGCk2/8s3ZlO8+ueJT8BVlw5pGw2oYccdSiHHqx0RlabHqdNR9jAETl6PreJcPBnnfpTLnOQ8C3OV8AmQGzouV1iZdeb5SSIoVc8W8/kcDtksUH5FrU6/aqBqNWcMEzxG4DAQ14qRQhi9mWU0rzepKezbjfgCwQKxVYq5ajRgpRqy45CqwkJydcEkbTkvRz8P5/2ZpDTN4nGNgZGBgAOKb6v+/xvPbfGXgZmEAgeuB2kkI+v8bFgbmKiCXg4EJJAoAPyAKhQB4nGNgZGBg1vmvwxDDwgACQJKRARXwAwAzZQHQeJxjYQCCFAYGFgbSMQAcWACdAAAAAAAAAAwALgBgAIQAmADSAQgBIgE8AVABoAHeAfwCHHicY2BkYGDgZ7BgYGMAASYg5gJCBob/YD4DAA/hAWQAeJxlkbtuwkAURMc88gApQomUJoq0TdIQzEOpUDokKCNR0BuzBiO/tF6QSJcPyHflE9Klyyekz2CuG8cr7547M3d9JQO4xjccnJ57vid2cMHqxDWc40G4Tv1JuEF+Fm6ijRfhM+oz4Ra6eBVu4wZvvMFpXLIa40PYQQefwjVc4Uu4Tv1HuEH+FW7i1mkKn6Hj3Am3sHC6wm08Ou8tpSZGe1av1PKggjSxPd8zJtSGTuinyVGa6/Uu8kxZludCmzxMEzV0B6U004k25W35fj2yNlCBSWM1paujKFWZSbfat+7G2mzc7weiu34aczzFNYGBhgfLfcV6iQP3ACkSaj349AxXSN9IT0j16JepOb01doiKbNWt1ovippz6sVYYwsXgX2rGVFIkq7Pl2PNrI6qW6eOshj0xaSq9mpNEZIWs8LZUfOouNkVXxp/d5woqebeYIf4D2J1ywQB4nG3LOw6AIBAE0B384B+PAkgEa+QwNnYmHt+EpXSal5lkSBBnoP8oCFSo0aCFRIceA0ZMmLFAYSW88rmvtMUjG3RiQ9HvpfusM6zWNmtc5H/iPewha50tOt5PS/QBx2IeSwAA") format("woff")}.admonition{box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12),0 3px 1px -2px rgba(0,0,0,.2);position:relative;margin:1.5625em 0;padding:0 1.2rem;border-left:.4rem solid rgba(68,138,255,.8);border-radius:.2rem;background-color:rgba(255,255,255,.05);overflow:auto}.admonition>p{margin-top:.8rem}.admonition>.admonition-title{margin:0 -1.2rem;padding:.8rem 1.2rem .8rem 3.6rem;border-bottom:1px solid rgba(68,138,255,.2);background-color:rgba(68,138,255,.1);font-weight:700}.admonition>.admonition-title:before{position:absolute;left:1.2rem;font-size:1.5rem;color:rgba(68,138,255,.8);content:"\E3C9"}.admonition>.admonition-title:before{font-family:Material Icons;font-style:normal;font-variant:normal;font-weight:400;line-height:2rem;text-transform:none;white-space:nowrap;speak:none;word-wrap:normal;direction:ltr}.admonition.abstract,.admonition.summary,.admonition.tldr{border-left-color:rgba(0,176,255,.8)}.admonition.abstract>.admonition-title,.admonition.summary>.admonition-title,.admonition.tldr>.admonition-title{background-color:rgba(0,176,255,.1);border-bottom-color:rgba(0,176,255,.2)}.admonition.abstract>.admonition-title:before,.admonition.summary>.admonition-title:before,.admonition.tldr>.admonition-title:before{color:#00b0ff;content:"\E8D2"}.admonition.hint,.admonition.tip{border-left-color:rgba(0,191,165,.8)}.admonition.hint>.admonition-title,.admonition.tip>.admonition-title{background-color:rgba(0,191,165,.1);border-bottom-color:rgba(0,191,165,.2)}.admonition.hint>.admonition-title:before,.admonition.tip>.admonition-title:before{color:#00bfa5;content:"\E80E"}.admonition.info,.admonition.todo{border-left-color:rgba(0,184,212,.8)}.admonition.info>.admonition-title,.admonition.todo>.admonition-title{background-color:rgba(0,184,212,.1);border-bottom-color:rgba(0,184,212,.2)}.admonition.info>.admonition-title:before,.admonition.todo>.admonition-title:before{color:#00b8d4;content:"\E88E"}.admonition.check,.admonition.done,.admonition.success{border-left-color:rgba(0,200,83,.8)}.admonition.check>.admonition-title,.admonition.done>.admonition-title,.admonition.success>.admonition-title{background-color:rgba(0,200,83,.1);border-bottom-color:rgba(0,200,83,.2)}.admonition.check>.admonition-title:before,.admonition.done>.admonition-title:before,.admonition.success>.admonition-title:before{color:#00c853;content:"\E876"}.admonition.faq,.admonition.help,.admonition.question{border-left-color:rgba(100,221,23,.8)}.admonition.faq>.admonition-title,.admonition.help>.admonition-title,.admonition.question>.admonition-title{background-color:rgba(100,221,23,.1);border-bottom-color:rgba(100,221,23,.2)}.admonition.faq>.admonition-title:before,.admonition.help>.admonition-title:before,.admonition.question>.admonition-title:before{color:#64dd17;content:"\E887"}.admonition.attention,.admonition.caution,.admonition.warning{border-left-color:rgba(255,145,0,.8)}.admonition.attention>.admonition-title,.admonition.caution>.admonition-title,.admonition.warning>.admonition-title{background-color:rgba(255,145,0,.1);border-bottom-color:rgba(255,145,0,.2)}.admonition.attention>.admonition-title:before{color:#ff9100;content:"\E417"}.admonition.caution>.admonition-title:before,.admonition.warning>.admonition-title:before{color:#ff9100;content:"\E002"}.admonition.fail,.admonition.failure,.admonition.missing{border-left-color:rgba(255,82,82,.8)}.admonition.fail>.admonition-title,.admonition.failure>.admonition-title,.admonition.missing>.admonition-title{background-color:rgba(255,82,82,.1);border-bottom-color:rgba(255,82,82,.2)}.admonition.fail>.admonition-title:before,.admonition.failure>.admonition-title:before,.admonition.missing>.admonition-title:before{color:#ff5252;content:"\E14C"}.admonition.bug,.admonition.danger,.admonition.error{border-left-color:rgba(255,23,68,.8)}.admonition.bug>.admonition-title,.admonition.danger>.admonition-title,.admonition.error>.admonition-title{background-color:rgba(255,23,68,.1);border-bottom-color:rgba(255,23,68,.2)}.admonition.danger>.admonition-title:before{color:#ff1744;content:"\E3E7"}.admonition.error>.admonition-title:before{color:#ff1744;content:"\E14C"}.admonition.bug>.admonition-title:before{color:#ff1744;content:"\E868"}.admonition.example,.admonition.snippet{border-left-color:rgba(0,184,212,.8)}.admonition.example>.admonition-title,.admonition.snippet>.admonition-title{background-color:rgba(0,184,212,.1);border-bottom-color:rgba(0,184,212,.2)}.admonition.example>.admonition-title:before,.admonition.snippet>.admonition-title:before{color:#00b8d4;content:"\E242"}.admonition.cite,.admonition.quote{border-left-color:rgba(158,158,158,.8)}.admonition.cite>.admonition-title,.admonition.quote>.admonition-title{background-color:rgba(158,158,158,.1);border-bottom-color:rgba(158,158,158,.2)}.admonition.cite>.admonition-title:before,.admonition.quote>.admonition-title:before{color:#9e9e9e;content:"\E244"}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<p><style>/* 
Aรฑade 

@import "../EstilosPersonalizadosMarkdownEnhanced.less"

justo despuรฉs del front matter 
*/
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
@font-face {
  font-family: 'Catamaran';
  font-style: normal;
  font-weight: 400;
  src: url(https://fonts.gstatic.com/s/catamaran/v19/o-0bIpQoyXQa2RxT7-5B6Ryxs2E_6n1iPHjd5a7dvg.ttf) format('truetype');
}
.contenedor {
  display: flex;
  justify-content: center;
  margin: 30px auto 30px auto;
}
.fondo {
  background: url(https://programacioniesbalmis.github.io/Imagenes/BannersMoodle/banner.png);
  background-size: cover;
  width: 75%;
  height: 160px;
  border-radius: 10px;
  position: relative;
}
.cita {
  font-family: Arial;
  font-style: italic;
  font-weight: 600;
  text-align: justify;
  line-height: 1.5rem;
  opacity: 0.6;
  color: white;
  padding: 5rem;
  position: relative;
  top: 50%;
  left: 50%;
  font-size: 1.3rem;
  transform: translate(-50%, -50%);
}
.abre_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-left: 30px;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, -15%);
}
.cierra_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-right: 30px;
  right: 0%;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, 55%);
}
.autor {
  font-family: Arial;
  color: white;
  margin: 0px;
  padding-left: 30px;
  position: absolute;
  top: 83%;
  font-size: 1rem;
}
</style></p>
<h1 id="tema-38---intents-y-contracts">Tema 3.8 - Intents y Contracts </h1>
<p>Descargar estos apuntes <a href="./Tema_3_8_intents_y_contracts.pdf">pdf</a> o <a href="./Tema_3_8_intents_y_contracts.html">html</a></p>
<h2 id="รญndice">รndice </h2>

<div class="md-toc">
<div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:18px">
          <a href="#introducciรณn" class="md-toc-link">
            <p>Introducciรณn</p>

          </a></div><details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#tipos-de-intents" class="md-toc-link"><p>Tipos de Intents</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#intents-explรญcitos" class="md-toc-link"><p>Intents Explรญcitos</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#abriendo-otra-aplicaciรณn-desde-nuestra-aplicaciรณn" class="md-toc-link">
            <p>Abriendo otra aplicaciรณn desde nuestra aplicaciรณn</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#intents-implรญcitos" class="md-toc-link"><p>Intents Implรญcitos</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#enviar-un-correo-electrรณnico-escogiendo-la-aplicaciรณn" class="md-toc-link">
            <p>Enviar un correo electrรณnico escogiendo la aplicaciรณn</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#abrir-una-localizaciรณn-en-google-maps" class="md-toc-link">
            <p>Abrir una localizaciรณn en Google Maps</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#obtener-el-resultado-de-un-intent-registrando-un-contrato" class="md-toc-link">
            <p>Obtener el resultado de un Intent registrando un '<em>contrato</em>'</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#registrando-contratos-dentro-de-un-composable" class="md-toc-link">
            <p>Registrando contratos dentro de un <code>@Composable</code></p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#gestion-de-permisos" class="md-toc-link"><p>Gestion de Permisos</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#gestionar-intent-implรญcito-de-llamada-telefรณnica" class="md-toc-link">
            <p>Gestionar intent implรญcito de llamada telefรณnica</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#gestionar-intent-implรญcito-para-hacer-un-foto" class="md-toc-link">
            <p>Gestionar intent implรญcito para hacer un foto</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#gestionar-registro-hacer-foto-con-takepicture" class="md-toc-link">
            <p>Gestionar registro hacer foto con TakePicture</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#gestionar-registro-para-obtener-una-imagen-de-la-galerรญa" class="md-toc-link">
            <p>Gestionar registro para obtener una imagen de la galerรญa</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:18px">
          <a href="#conclusiรณn" class="md-toc-link">
            <p>Conclusiรณn</p>

          </a></div>
</div>
<div style="page-break-after:always;"></div>
<h2 id="introducciรณn">Introducciรณn </h2>
<ul>
<li>
<p><strong>Intents</strong></p>
<ul>
<li>Documentaciรณn oficial: <strong><a href="https://developer.android.com/guide/components/intents-filters?hl=es-419">Intents</a></strong></li>
<li>Documentaciรณn oficial: <strong><a href="https://developer.android.com/training/basics/intents?hl=es-419">Interactuando con otras Apps</a></strong></li>
<li>Vรญdeo Intents: <strong><a href="https://www.youtube.com/watch?v=2hIY1xuImuQ">Philipp Lackner (Inglรฉs)</a></strong></li>
</ul>
</li>
<li>
<p><strong>Permissions</strong></p>
<ul>
<li>Documentaciรณn oficial: <strong><a href="https://developer.android.com/guide/topics/permissions/overview?hl=es-419">Permisos</a></strong></li>
<li>Vรญdeo Permisos 1: <strong><a href="https://www.youtube.com/watch?v=zCAx4WZ98rs">Android Developers</a></strong></li>
<li>Vรญdeo Permisos 2: <strong><a href="https://www.youtube.com/watch?v=x38dYUm7tCY">Android Developers</a></strong></li>
<li>Vรญdeo Permisos: <strong><a href="https://www.youtube.com/watch?v=D3JCtaK8LSU">Philipp Lackner (Inglรฉs)</a></strong></li>
</ul>
</li>
<li>
<p><strong>Permissions in Compose con Accompanist Library</strong> (Experimental)</p>
<ul>
<li>Vรญdeo: <strong><a href="https://www.youtube.com/watch?v=imFJZ4Kbv_g">Martin Kiperszmid (Castellano)</a></strong></li>
<li>Vรญdeo: <strong><a href="https://www.youtube.com/watch?v=uO6igFsa5y0">Stevdza-San (Inglรฉs)</a></strong></li>
<li>Documentaciรณn librerรญa: <strong><a href="https://google.github.io/accompanist/permissions/">Accompanist</a></strong></li>
</ul>
</li>
</ul>
<p>Una <strong>Intent</strong> es un <strong>objeto de mensajerรญa</strong> que puedes usar para solicitar una acciรณn de otro componente de una app. Si bien las intents facilitan la comunicaciรณn entre componentes de varias formas, existen tres casos de uso principales:</p>
<ol>
<li>Iniciar una actividad de la propia app o de otra app.</li>
<li>Iniciar un servicio.</li>
<li>Transmitir una emisiรณn o broadcast.</li>
</ol>
<p>Nosotros en este tema vamos a centrarnos en el primer caso de uso que es, <strong>Iniciar una actividad</strong>. Como se puede deducir es una funcionalidad del API de Android que nos permite iniciar una actividad desde otra actividad incluso si la actividad pertenece a otra aplicaciรณn diferente como por ejemplos hacer una llamada telefรณnica, enviar un correo electrรณnico, abrir una pรกgina web, etc.</p>
<blockquote>
<p>๐ฃ <strong>Resumen</strong>: Por expresarlo con otras palabras, podemos decir que una <strong>Intent</strong> es un objeto que proporciona en su interior una descripciรณn de la operaciรณn que queremos 'intentar' ya sea de forma implรญcita o explรญcita y ademรกs podemos pasarle datos que se usarรกn en la operaciรณn. Cuidado puede parecernos que es la intent la que lanza una actividad pero no es asรญ, contiene solo la descripciรณn de la operaciรณn y los datos necesarios para realizarla.</p>
<p>๐ <strong>Dercarga</strong>: El proyecto con el cรณdigo de los ejemplos de este tema en el siguiente <strong><a href="assets/codigo/tema_3_8/intents_ejemplos_apuntes_recurso.zip">enlace</a></strong></p>
</blockquote>
<div style="page-break-after:always;"></div>
<h2 id="tipos-de-intents">Tipos de Intents </h2>
<h3 id="intents-explรญcitos">Intents Explรญcitos </h3>
<p>Especifican quรฉ aplicaciรณn las administrarรก, ya sea incluyendo el <strong>nombre del paquete de la app de destino</strong> o el nombre de clase del componente completamente calificado. Normalmente, el usuario usa una intent explรญcita para iniciar un componente en su propia aplicaciรณn porque conoce el nombre de clase de la actividad o el servicio que desea iniciar. Por ejemplo, puedes utilizarla para iniciar una actividad nueva en respuesta a una acciรณn del usuario o iniciar un servicio para descargar un archivo en segundo plano.</p>
<h4 id="abriendo-otra-aplicaciรณn-desde-nuestra-aplicaciรณn">Abriendo otra aplicaciรณn desde nuestra aplicaciรณn </h4>
<p>Para abrir otra aplicaciรณn desde nuestra aplicaciรณn, debemos crear un objeto <strong>Intent</strong> y especificar el <strong>nombre del paquete de la aplicaciรณn de destino</strong>. Por ejemplo, si queremos abrir la aplicaciรณn de <strong>Chrome</strong> desde nuestra aplicaciรณn, debemos crear un objeto <strong>Intent</strong> y especificar el nombre del paquete de la aplicaciรณn de destino que en este caso es <strong><code>com.android.chrome</code></strong>. Para ello usaremos el mรฉtodo <strong><code>setPackage()</code></strong> del objeto <strong>Intent</strong>. Una vez creado el objeto <strong>Intent</strong> lo pasaremos como parรกmetro al mรฉtodo <strong><code>startActivity()</code></strong>. Como el mรฉtodo <strong><code>startActivity()</code></strong> es un mรฉtodo de la clase <strong>Context</strong>, necesitamos un objeto de esta clase para poder llamar al mรฉtodo. Para ello usaremos el <strong><code>LocalContext.current</code></strong> que nos proporciona <strong>Jetpack Compose</strong>. El cรณdigo serรญa el siguiente...</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token comment">// IntentExplicito.kt</span>

<span class="token keyword keyword-fun">fun</span> Context<span class="token punctuation">.</span><span class="token function">openChrome</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Creamos un Intent con la acciรณn ACTION_MAIN</span>
    <span class="token comment">// que es abrir una actividad principal de la aplicaciรณn Chrome.</span>
    <span class="token function">Intent</span><span class="token punctuation">(</span>Intent<span class="token punctuation">.</span>ACTION_MAIN<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">also</span> <span class="token punctuation">{</span>
        it<span class="token punctuation">.</span>`<span class="token keyword keyword-package">package</span>` <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"com.android.chrome"</span></span>
        <span class="token comment">// Lanza ActivityNotFoundException si no estรก instalada la aplicaciรณn.</span>
        <span class="token function">startActivity</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">IntentOpenChrome</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> context <span class="token operator">=</span> LocalContext<span class="token punctuation">.</span>current
    <span class="token function">Box</span><span class="token punctuation">(</span>modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">fillMaxSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        contentAlignment <span class="token operator">=</span> androidx<span class="token punctuation">.</span>compose<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>Alignment<span class="token punctuation">.</span>Center<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Button</span><span class="token punctuation">(</span>onClick <span class="token operator">=</span> <span class="token punctuation">{</span> context<span class="token punctuation">.</span><span class="token function">openChrome</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">Text</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Open Chrome"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h5 id="saber-el-nombre-del-paquete-de-la-app-de-destino">Saber el nombre del paquete de la app de destino </h5>
<p>Para saber el nombre del paquete de la app de destino, podemos usar la herramienta <strong>adb.exe</strong> (<a href="https://developer.android.com/studio/command-line/adb?hl=es-419">Android Debug Bridge</a>) instalada junto al SDK de Android. Para ello debemos abrir una consola de comandos e ir a la carpeta <strong><code>platform-tools</code></strong> donde estรฉ instalado el SDK para nuestro usuario. (Ej: <strong><code>C:\Users\alumno\AppData\Local\Android\Sdk\platform-tools&gt;</code></strong>). Otras opciรณn es aรฑadir esta carpeta al <strong>Path</strong> de nuestro usuario para que podamos ejecutar los comandos desde cualquier ubicaciรณn, incluso desde la ventana del terminal de AndroidStudio.<br>
Una vez tenemos acceso a la herramienta <strong>adb.exe</strong> seguiremos estos pasos:</p>
<ol>
<li>
<p>Arrancaremos la mรกquina virtual de nuestro emulador de Android <strong>desde el mismo Android Studio</strong> o desde un terminal si sabemos el nombre de la mรกquina. Por ejemplo, si nuestro emulador se llama <strong>Pixel_3a_API_33</strong> ejecutaremos el comando:</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>alumno<span class="token punctuation">\</span>AppData<span class="token punctuation">\</span>Local<span class="token punctuation">\</span>Android<span class="token punctuation">\</span>Sdk<span class="token punctuation">\</span>tools<span class="token punctuation">\</span>emulator.exe <span class="token parameter variable">-avd</span> Pixel_3a_API_33
</code></pre></li>
<li>
<p><strong>Con el emulador arrancado</strong>, ejecutaremos el comando <strong><code>adb shell</code></strong> para acceder a la consola del emulador. Por ejemplo:</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>alumno<span class="token punctuation">\</span>AppData<span class="token punctuation">\</span>Local<span class="token punctuation">\</span>Android<span class="token punctuation">\</span>Sdk<span class="token punctuation">\</span>platform-tools<span class="token operator">&gt;</span>adb shell
emu64x:/ $
</code></pre></li>
<li>
<p>Ahora ejecutaremos el comando <strong><code>pm list packages</code></strong> para listar todos los paquetes de aplicaciones instaladas en el emulador y si queremos buscar una aplicaciรณn en concreto podemos usar el comando <strong><code>grep</code></strong>. Por ejemplo, si queremos saber el nombre del paquete de la app de <strong>Chrome</strong>, ejecutaremos el comando:</p>
<pre data-role="codeBlock" data-info="bash {highlight=2}" class="language-bash bash" data-line="2"><code>emu64x:/ $ pm list packages <span class="token operator">|</span> <span class="token function">grep</span> chrome
package:com.android.chrome
emu64x:/ $
</code><div class="line-highlight-wrapper">
<div aria-hidden="true" class="line-highlight" data-range="2" data-start="2">
</div></div></pre></li>
</ol>
<div style="display: flex; justify-content: space-between; align-items: top; margin-top: 15px">
<div style="width: 50%">
<p>Otra forma mรกs sencilla es a travรฉs de <strong>Android Studio</strong>. Una vez arrancado el emulador, abriremos la ventana <strong>Device File Explorer</strong> situado a la derecha como se muestra en la imagen de ejemplo y navegaremos hasta la carpeta <strong><code>data/data</code></strong> donde se encuentran todas las aplicaciones instaladas en el emulador. Ahora solo tenemos que buscar la carpeta de la aplicaciรณn que nos interese que se corresponde con el nombre del paquete de la aplicaciรณn.</p>
</div>
<div style="width: auto">
<img height="600px" src="assets/imagenes/tema_3_8/ubicacion_aplicaciones.png">
</div>
</div>
<div style="page-break-after:always;"></div>
<h3 id="intents-implรญcitos">Intents Implรญcitos </h3>
<p>Son los que mรกs interesantes para nosotros. Puesto que no siempre sabemos que aplicaciones vamos a tener instaladas.</p>
<p>No nombran el componente especรญfico, pero en cambio declaran una acciรณn general para realizar, lo cual permite que un componente de otra aplicaciรณn la maneje. Por ejemplo, si quieres enviar un correo electrรณnico no necesitas saber quรฉ aplicaciรณn de correo electrรณnico tiene el usuario instalada, simplemente debes enviar una intent implรญcita para que cualquier aplicaciรณn de correo electrรณnico pueda responderla. Es mรกs, puedes preguntarle al sistema si existe una actividad que pueda responder a tu intent antes de iniciarla y <strong>ofrecerle la posibilidad al usuario de elegir quรฉ aplicaciรณn usar</strong>.</p>
<h4 id="enviar-un-correo-electrรณnico-escogiendo-la-aplicaciรณn">Enviar un correo electrรณnico escogiendo la aplicaciรณn </h4>
<p>Veamos un ejemplo de un <strong>Intent implรญcito</strong> para solicitar al sistema enviar un correo electrรณnico con un texto plano. Ademรกs, al Intent le pasaremos una serie de parรกmetros como el asunto, el texto del correo y los destinatarios. Para ello usaremos el mรฉtodo <strong><code>putExtra()</code></strong> del objeto <strong>Intent</strong>. El cรณdigo serรญa el siguiente...</p>
<p><strong>Aunque no es necesario</strong>, podemos indicar a Android que tipo de intents vamos a usar en nuestra aplicaciรณn al final de Manifest de la aplicaciรณn con la etiqueta <strong><code>&lt;queries&gt;</code></strong>.</p>
<pre data-role="codeBlock" data-info="xml" class="language-xml xml"><code><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>manifest</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

    ...

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>queries</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.intent.action.SEND<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name"><span class="token namespace">android:</span>mimeType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/plain<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>queries</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>manifest</span><span class="token punctuation">&gt;</span></span>
</code></pre><pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token comment">// IntentsImplicitos.kt</span>

<span class="token keyword keyword-fun">fun</span> Context<span class="token punctuation">.</span><span class="token function">sendMail</span><span class="token punctuation">(</span>
    correos<span class="token operator">:</span> Array<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">,</span>
    asunto<span class="token operator">:</span> String<span class="token punctuation">,</span>
    texto<span class="token operator">:</span> String<span class="token punctuation">,</span>
    forzarEleccion<span class="token operator">:</span> Boolean <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> intent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span>Intent<span class="token punctuation">.</span>ACTION_SEND<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">{</span>
        type <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"text/plain"</span></span>
        <span class="token comment">// Aรฑadimos los datos del correo.</span>
        <span class="token function">putExtra</span><span class="token punctuation">(</span>Intent<span class="token punctuation">.</span>EXTRA_EMAIL<span class="token punctuation">,</span> correos<span class="token punctuation">)</span>
        <span class="token function">putExtra</span><span class="token punctuation">(</span>Intent<span class="token punctuation">.</span>EXTRA_SUBJECT<span class="token punctuation">,</span> asunto<span class="token punctuation">)</span>
        <span class="token function">putExtra</span><span class="token punctuation">(</span>Intent<span class="token punctuation">.</span>EXTRA_TEXT<span class="token punctuation">,</span> texto<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-val">val</span> chooser <span class="token operator">=</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>forzarEleccion<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-val">val</span> title<span class="token operator">:</span> String <span class="token operator">=</span> resources<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>string<span class="token punctuation">.</span>enviar_correo<span class="token punctuation">)</span>
        Intent<span class="token punctuation">.</span><span class="token function">createChooser</span><span class="token punctuation">(</span>intent<span class="token punctuation">,</span> title<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-null">null</span>

    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>intent<span class="token punctuation">.</span><span class="token function">resolveActivity</span><span class="token punctuation">(</span>packageManager<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">startActivity</span><span class="token punctuation">(</span>chooser <span class="token operator">?:</span> intent<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">IntentSendMail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> context <span class="token operator">=</span> LocalContext<span class="token punctuation">.</span>current
    <span class="token function">Box</span><span class="token punctuation">(</span>modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">fillMaxSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        contentAlignment <span class="token operator">=</span> androidx<span class="token punctuation">.</span>compose<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>Alignment<span class="token punctuation">.</span>Center<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Button</span><span class="token punctuation">(</span>onClick <span class="token operator">=</span> <span class="token punctuation">{</span> context<span class="token punctuation">.</span><span class="token function">sendMail</span><span class="token punctuation">(</span>
            correos <span class="token operator">=</span> <span class="token function">arrayOf</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"correo@alu.edu.gva.es"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            asunto <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Asunto del correo"</span></span><span class="token punctuation">,</span>
            texto <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Texto del correo"</span></span>
        <span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">Text</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Send Mail"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div style="page-break-after:always;"></div>
<div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px">
<div style="width: 70%">
<p>Al usar <strong><code>ACTION_SEND</code></strong> con esos parรกmetros. <strong><code>Android</code></strong> nos ofrecerรก varias opciones para enviar el correo. Si seleccionamos <strong><code>Gmail</code></strong> + <strong><code>Always</code></strong> la siguiente vez que queramos enviar un correo, <strong>no nos preguntarรก</strong>.</p>
<p>Realmente el sistema <strong>Android busca el componente apropiado</strong> para iniciar comparando el contenido de la intent con los <strong><a href="https://developer.android.com/guide/topics/manifest/intent-filter-element?hl=es-419">filtros de intents</a></strong> declarados en el archivo de manifiesto de otras aplicaciones en el dispositivo. Si la intent coincide con un filtro de intents, el sistema inicia ese componente y le entrega el objeto Intent. <strong>Si varios filtros de intents son compatibles</strong>, el sistema muestra un cuadro de diรกlogo para que el usuario pueda elegir la aplicaciรณn que se debe usar.</p>
</div>
<div style="width: auto">
<img height="200px" src="assets/imagenes/tema_3_8/email_opciones.png">
</div>
</div>
<p>En nuestro caso, la App debe tener una actividad que acepte los parรกmetros que le pasamos y tener un filtro similar al siguiente:</p>
<pre data-role="codeBlock" data-info="xml" class="language-xml xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.ClaseQueDefineLaActividad<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    &lt;android:exported="true"&gt; <span class="token comment">&lt;!-- Necesario para que otras apps puedan usarla --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.intent.action.SEND<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>category</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.intent.category.DEFAULT<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name"><span class="token namespace">android:</span>mimeType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/plain<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent-filter</span><span class="token punctuation">&gt;</span></span>   
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activity</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>Puedes consultar la <strong><a href="https://developer.android.com/guide/components/intents-filters?hl=es-419#Receiving">documentaciรณn oficial</a></strong> para mรกs informaciรณn.</p>
<blockquote>
<p>๐ <strong>Nota</strong>: Si no declaras ningรบn filtro de intent para una actividad, esta solo se puede iniciar con un <strong>intent explรญcito</strong>.</p>
</blockquote>
<div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px">
<div style="width: 70%">
<p>Si queremos que el sistema nos pregunte siempre que aplicaciรณn queremos usar para enviar el correo independientemente de si la hemos predeterminado o no. Deberemos usar el mรฉtodo <strong><code>createChooser()</code></strong> del objeto <strong>Intent</strong> como se ve en el cรณdigo de ejemplo.</p>
</div>
<div style="width: auto">
<img height="200px" src="assets/imagenes/tema_3_8/email_forzado.png">
</div>
</div>
<div style="page-break-after:always;"></div>
<h4 id="abrir-una-localizaciรณn-en-google-maps">Abrir una localizaciรณn en Google Maps </h4>
<p>Veamos algunos ejemplos mรกs de <strong>Intents implรญcitos</strong> extraรญdos de la documentaciรณn oficial <strong><a href="https://developer.android.com/guide/components/intents-common?hl=es-419">aquรญ</a></strong> o <strong><a href="https://developer.android.com/training/basics/intents/sending?hl=es-419">aquรญ</a></strong> ...</p>
<p>En este caso vamos a visualizar una geolocalizaciรณn y la aplicaciรณn de <strong><code>Maps</code></strong> tiene un filtro que acepta este tipo de intents. Fรญjate que en este caso hemos controlado la excepciรณn <strong><code>ActivityNotFoundException</code></strong> que se lanza si no tenemos instalada la aplicaciรณn de <strong><code>Maps</code></strong> mostrando un mensaje temporal.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-fun">fun</span> Context<span class="token punctuation">.</span><span class="token function">buscaEnMaps</span><span class="token punctuation">(</span>lugar<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> intent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span>Intent<span class="token punctuation">.</span>ACTION_VIEW<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-data">data</span> <span class="token operator">=</span> Uri<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"geo:0,0?q=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">lugar</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-try">try</span> <span class="token punctuation">{</span>
        <span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> ActivityNotFoundException<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"No se puede abrir Maps"</span></span><span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">IntentBuscaEnMaps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> context <span class="token operator">=</span> LocalContext<span class="token punctuation">.</span>current
    <span class="token function">Button</span><span class="token punctuation">(</span>onClick <span class="token operator">=</span> <span class="token punctuation">{</span>
        context<span class="token punctuation">.</span><span class="token function">buscaEnMaps</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"I.E.S Doctor Balmis, +Alicante"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Text</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Ver Balmis en Maps"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div style="page-break-after:always;"></div>
<h4 id="obtener-el-resultado-de-un-intent-registrando-un-contrato">Obtener el resultado de un Intent registrando un '<em>contrato</em>' </h4>
<p>Iniciar otra actividad, ya sea dentro de tu app o desde otra, no tiene por quรฉ ser una operaciรณn unidireccional, tambiรฉn puedes iniciar una actividad y recibir un resultado. Por ejemplo, tu app puede iniciar una app de cรกmara y <strong>recibir la foto tomada como resultado</strong>. Tambiรฉn puedes iniciar la app de Contactos para que el usuario <strong>seleccione un contacto y, luego, recibir los detalles correspondientes</strong> como resultado.</p>
<p>Deberemos tener en cuenta que:</p>
<ul>
<li>El resultado no es inmediato y <strong>deberemos definir algรบn tipo de callback para recibirlo</strong>.</li>
<li>La gestiรณn de ese callback deberรก ser <strong>asรญncrona</strong> y no bloquear la UI.</li>
<li>Este callback debe estar ligado al ciclo de vida de la actividad que lo recibe. Esto es, si lanzamos un Intent con respuesta desde una actividad, el callback no se debe gestionar si esta ha finalizado.</li>
</ul>
<p>Para gestionar todo esto Android ha definido una <strong><a href="https://developer.android.com/training/basics/intents/result?hl=es-419#launch">serie de clases</a></strong>.</p>
<p>Para simplificar, vamos a realizar este proceso creando un <strong>Intent</strong> lanzar otra <strong>Activity</strong> de nuestra propia aplicaciรณn de ejemplo <strong>que recibirรก un texto y ademรกs nos devolverรก otro intent con el texto introducido</strong>.</p>
<blockquote>
<p>โ <strong>Importante</strong>: Si el intent lo hiciรฉramos sobre <strong>una actividad de otra aplicaciรณn</strong> el proceso de comunicaciรณn serรก el mismo de nuestro ejemplo.</p>
</blockquote>
<p>Para ello, nos situamos sobre el paquete <strong><code>views</code></strong> seleccionamos botรณn derecho y crear una nueva clase que represente una actividad llamada <strong><code>ActivityQueProduceUnTexto</code></strong>. Recuerda que para usar compose debe heredar de la clase <strong><code>ComponentActivity</code></strong>. El cรณdigo serรญa el siguiente...</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-class">class</span> ActivityQueProduceUnTexto <span class="token operator">:</span> <span class="token function">ComponentActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        setContent <span class="token punctuation">{</span>
            EjemplosIntentsTheme <span class="token punctuation">{</span>
                <span class="token function">Surface</span><span class="token punctuation">(</span>
                    modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">fillMaxSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    color <span class="token operator">=</span> MaterialTheme<span class="token punctuation">.</span>colorScheme<span class="token punctuation">.</span>background
                <span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Ademรกs, en el <strong>manifest.xml</strong> vamos a aรฑadir la actividad que acabamos de crear. El cรณdigo serรญa el siguiente, dentro de la etiqueta <strong><code>&lt;application&gt;</code></strong> bajo la etiqueta <strong><code>&lt;activity&gt;</code></strong> que define nuestro <strong><code>MainActivity</code></strong> ...</p>
<blockquote>
<p>๐ <strong>Nota</strong>: Fรญjate que hemos definido el recurso cadena <strong><code>title_activity_que_produce_un_texto</code></strong>. Haz <strong><code>Ctrl+.</code></strong> para definirlo con el texto <strong><code>"ActivityQueProduceUnTexto"</code></strong></p>
</blockquote>
<pre data-role="codeBlock" data-info="xml" class="language-xml xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span>
    <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.ui.views.ActivityQueProduceUnTexto<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>exported</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@string/title_activity_que_produce_un_texto<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>theme</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@style/Theme.EjemplosIntents<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.intent.action.SEND<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>category</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.intent.category.DEFAULT<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name"><span class="token namespace">android:</span>mimeType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/plain<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activity</span><span class="token punctuation">&gt;</span></span>
</code></pre><blockquote>
<p>โ <strong>Importante</strong>: Fรญjate ademรกs, que hemos aรฑadido el atributo <strong><code>android:exported="true"</code></strong>. Esto es necesario para que <strong>otras aplicaciones</strong> puedan usar esta actividad y ademรกs hemos expuesto a Android que podemos recibir intents de tipo <strong><code>SEND</code></strong> con datos de tipo <strong><code>text/plain</code></strong> para que nos ofrezca a otras Apps en ese caso.</p>
</blockquote>
<p>Podemos ahora definir la siguiente UI con Compose para <strong><code>ActivityQueProduceUnTexto</code></strong> en la cual mostramos el dato de texto recibido desde el <strong><code>MainActivity</code></strong> y ademรกs tenemos un campo de texto para que el usuario introduzca un texto y lo devuelva al <strong><code>MainActivity</code></strong> a travรฉs del manejador <strong><code>onClickDevolver</code></strong>. El cรณdigo puede ser el siguiente...</p>
<pre data-role="codeBlock" data-info="kotlin {highlight=25}" class="language-kotlin kotlin" data-line="25"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">PideTexto</span><span class="token punctuation">(</span>
    textoRecibidoPorLlamador<span class="token operator">:</span> String <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Sin llamador"</span></span><span class="token punctuation">,</span>
    onClickDevolver<span class="token operator">:</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-var">var</span> texto <span class="token keyword keyword-by">by</span> rememberSaveable <span class="token punctuation">{</span> <span class="token function">mutableStateOf</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">""</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token function">Column</span><span class="token punctuation">(</span>modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">fillMaxSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        horizontalAlignment <span class="token operator">=</span> Alignment<span class="token punctuation">.</span>CenterHorizontally<span class="token punctuation">,</span>
        verticalArrangement <span class="token operator">=</span> Arrangement<span class="token punctuation">.</span>Center<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Text</span><span class="token punctuation">(</span>
            text <span class="token operator">=</span> textoRecibidoPorLlamador<span class="token punctuation">,</span>
            modifier <span class="token operator">=</span> Modifier
                <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">fillMaxWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            style <span class="token operator">=</span> MaterialTheme<span class="token punctuation">.</span>typography<span class="token punctuation">.</span>titleLarge<span class="token punctuation">,</span>
            textAlign <span class="token operator">=</span> TextAlign<span class="token punctuation">.</span>Center
        <span class="token punctuation">)</span>
        <span class="token function">Spacer</span><span class="token punctuation">(</span>modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">OutlinedTextField</span><span class="token punctuation">(</span>
            label <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">Text</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Texto a devolver"</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            value <span class="token operator">=</span> texto<span class="token punctuation">,</span>
            onValueChange <span class="token operator">=</span> <span class="token punctuation">{</span> texto <span class="token operator">=</span> it <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
        <span class="token function">Spacer</span><span class="token punctuation">(</span>modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">Button</span><span class="token punctuation">(</span>onClick <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">onClickDevolver</span><span class="token punctuation">(</span>texto<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">Text</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Devolver texto"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="line-highlight-wrapper">























<div aria-hidden="true" class="line-highlight" data-range="25" data-start="25">
</div></div></pre><p>Veamos ahora cรณmo quedarรญa el cรณdigo definitivo de <strong><code>ActivityQueProduceUnTexto</code></strong>.</p>
<div style="page-break-after:always;"></div>
<pre data-role="codeBlock" data-info="kotlin {highlight=[4-10, 13-22]}" class="language-kotlin kotlin" data-line="4-10,13-22"><code><span class="token keyword keyword-class">class</span> ActivityQueProduceUnTexto <span class="token operator">:</span> <span class="token function">ComponentActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        <span class="token comment">// Recuperamos el texto que nos ha pasado el llamador y que estรก en</span>
        <span class="token comment">// la propiedad intent de la actividad que contiene los datos </span>
        <span class="token comment">// que se han pasado desde el llamador.</span>
        <span class="token comment">// Los asignamos en un estado usado por la interfaz en la composiciรณn.</span>
        <span class="token keyword keyword-val">val</span> textoRecibidoPorLlamador <span class="token keyword keyword-by">by</span> <span class="token function">mutableStateOf</span><span class="token punctuation">(</span>
            intent<span class="token punctuation">.</span><span class="token function">getStringExtra</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"TEXTO"</span></span><span class="token punctuation">)</span> <span class="token operator">?:</span> <span class="token string-literal singleline"><span class="token string">""</span></span>
        <span class="token punctuation">)</span>

        <span class="token keyword keyword-val">val</span> onClickDevolver<span class="token operator">:</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit <span class="token operator">=</span> <span class="token punctuation">{</span> texto <span class="token operator">-&gt;</span>
            <span class="token comment">// Para devolver datos al llamador, los empaquetamos en un </span>
            <span class="token comment">// Intent le aรฑadimos los datos y lo pasamos como parรกmetro </span>
            <span class="token comment">// al mรฉtodo setResult, que crea un objeto ActivityResult que</span>
            <span class="token comment">// es lo que espera recibir el llamador en su 'contrato'. </span>
            <span class="token function">Intent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">also</span> <span class="token punctuation">{</span>intento <span class="token operator">-&gt;</span>
                intento<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"TEXTODEVUELTO"</span></span><span class="token punctuation">,</span> texto<span class="token punctuation">)</span>
                <span class="token function">setResult</span><span class="token punctuation">(</span>RESULT_OK<span class="token punctuation">,</span> intento<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// Finalizamos la actividad tras poner los datos de resultado en el intent</span>
            <span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        setContent <span class="token punctuation">{</span>
            EjemplosIntentsTheme <span class="token punctuation">{</span>
                <span class="token function">Surface</span><span class="token punctuation">(</span>
                    modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">fillMaxSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    color <span class="token operator">=</span> MaterialTheme<span class="token punctuation">.</span>colorScheme<span class="token punctuation">.</span>background
                <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">PideTexto</span><span class="token punctuation">(</span>
                        textoRecibidoPorLlamador <span class="token operator">=</span> textoRecibidoPorLlamador<span class="token punctuation">,</span>
                        onClickDevolver <span class="token operator">=</span> onClickDevolver
                    <span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="line-highlight-wrapper">


<div aria-hidden="true" class="line-highlight" data-range="4-10" data-start="4" data-end="10">






</div></div><div class="line-highlight-wrapper">











<div aria-hidden="true" class="line-highlight" data-range="13-22" data-start="13" data-end="22">









</div></div></pre><p>Veamos ahora cรณmo serรญa el proceso de llamar a <strong><code>ActivityQueProduceUnTexto</code></strong> con un Intent explรญcito con un texto y recibir el resultado en otro intent envuelto en un <strong><code>ActivityResult</code></strong>.</p>
<p>En primer lugar definimos una interfaz <strong><code>@Composable</code></strong> en <strong><code>MainActivity</code></strong> (fuera de la clase) que nos permita lanzar la actividad y gestionar su respuesta denominado <strong><code>InterfaceParaLanzarActivityQueProduceUnTexto</code></strong></p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">InterfaceParaLanzarActivityQueProduceUnTexto</span><span class="token punctuation">(</span>
    textoDevueltoPorIntent<span class="token operator">:</span> String <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"No has llamado aรบn"</span></span><span class="token punctuation">,</span>
    onClickLanzar<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Column</span><span class="token punctuation">(</span>modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">fillMaxSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        horizontalAlignment <span class="token operator">=</span> Alignment<span class="token punctuation">.</span>CenterHorizontally<span class="token punctuation">,</span>
        verticalArrangement <span class="token operator">=</span> Arrangement<span class="token punctuation">.</span>Center<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Button</span><span class="token punctuation">(</span>onClick <span class="token operator">=</span> onClickLanzar<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">Text</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Llama a ActivityQueProduceUnTexto"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token function">Text</span><span class="token punctuation">(</span>
            text <span class="token operator">=</span> textoDevueltoPorIntent<span class="token punctuation">,</span>
            modifier <span class="token operator">=</span> Modifier
                <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">fillMaxWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            style <span class="token operator">=</span> MaterialTheme<span class="token punctuation">.</span>typography<span class="token punctuation">.</span>titleLarge<span class="token punctuation">,</span>
            textAlign <span class="token operator">=</span> TextAlign<span class="token punctuation">.</span>Center
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Ahora usarmos el mรฉtodo <strong><code>registerForActivityResult()</code></strong> de la clase <strong><code>ComponentActivity</code></strong> para registrar un <strong><code>ActivityResultLauncher</code></strong> que se encargarรก de gestionar la respuesta del intent. El cรณdigo serรญa el siguiente:</p>
<div style="page-break-after:always;"></div>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-class">class</span> MainActivity <span class="token operator">:</span> <span class="token function">ComponentActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-var">var</span> textoDevueltoPorIntent <span class="token keyword keyword-by">by</span> <span class="token function">mutableStateOf</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"No has llamdo aรบn"</span></span><span class="token punctuation">)</span>
    <span class="token comment">// Definimos un lanzador con el contrato ActivityResultContracts.StartActivityForResult</span>
    <span class="token comment">// que recibirรก (ENTRADA) el intent explรญcito sobre la actividad secuendaria </span>
    <span class="token comment">// y devolverรก (SALIDA) un objeto ActivityResult que contiene el intent de respuesta</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> launcherActivityQueProduceUnTexto<span class="token operator">:</span> ActivityResultLauncher<span class="token operator">&lt;</span>Intent<span class="token operator">&gt;</span> <span class="token operator">=</span>
        <span class="token function">registerForActivityResult</span><span class="token punctuation">(</span>ActivityResultContracts<span class="token punctuation">.</span><span class="token function">StartActivityForResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span> result <span class="token operator">-&gt;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>resultCode <span class="token operator">==</span> Activity<span class="token punctuation">.</span>RESULT_OK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                textoDevueltoPorIntent <span class="token operator">=</span> result<span class="token punctuation">.</span>data<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">getStringExtra</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"TEXTODEVUELTO"</span></span><span class="token punctuation">)</span>
                    <span class="token operator">?:</span> <span class="token string-literal singleline"><span class="token string">"Nada retornado"</span></span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        setContent <span class="token punctuation">{</span>
            EjemplosIntentsTheme <span class="token punctuation">{</span>
                <span class="token function">Surface</span><span class="token punctuation">(</span>modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">fillMaxSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-val">val</span> context <span class="token operator">=</span> LocalContext<span class="token punctuation">.</span>current
                    <span class="token function">InterfaceParaLanzarActivityQueProduceUnTexto</span><span class="token punctuation">(</span>
                        textoDevueltoPorIntent <span class="token operator">=</span> textoDevueltoPorIntent<span class="token punctuation">,</span>
                        onClickLanzar <span class="token operator">=</span> <span class="token punctuation">{</span>
                            <span class="token comment">// En lanzado con el contrato encargado de gestionar una</span>
                            <span class="token comment">// respuesta ActivityResult. Para ello crea el </span>
                            <span class="token comment">// Intent explรญcito pasรกndole un texto como parรกmetro</span>
                            <span class="token comment">// indicรกndole por quien es llamada.</span>
                            <span class="token comment">// El contexto se puede sacar de LocalContext.current y tambiรฉn</span>
                            <span class="token comment">// claururรกndo el propio contexto de la actividad.</span>
                            launcherActivityQueProduceUnTexto<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>
                                <span class="token function">Intent</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> ActivityQueProduceUnTexto<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">{</span>
                                        <span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"TEXTO"</span></span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"Te llamo desde MainActivity"</span></span><span class="token punctuation">)</span>
                                    <span class="token punctuation">}</span>
                            <span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Vemos con mรกs detalle el cรณdigo de la llamada ...</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> launcherActivityQueProduceUnTexto<span class="token operator">:</span> ActivityResultLauncher<span class="token operator">&lt;</span>Intent<span class="token operator">&gt;</span> <span class="token operator">=</span>
        <span class="token function">registerForActivityResult</span><span class="token punctuation">(</span>ActivityResultContracts<span class="token punctuation">.</span><span class="token function">StartActivityForResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span> result <span class="token operator">-&gt;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>resultCode <span class="token operator">==</span> Activity<span class="token punctuation">.</span>RESULT_OK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                textoDevueltoPorIntent <span class="token operator">=</span> result<span class="token punctuation">.</span>data<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">getStringExtra</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"TEXTODEVUELTO"</span></span><span class="token punctuation">)</span>
                    <span class="token operator">?:</span> <span class="token string-literal singleline"><span class="token string">"Nada retornado"</span></span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
</code></pre><p>Vamos a separar la respuesta de la llamada porque despuรฉs de acabar la actividad se destruirรก.</p>
<ul>
<li>
<p><strong>Paso 1</strong>: Crearemos un objeto <strong><code>ActivityResultLauncher</code></strong> mediante el mรฉtodo <strong><code>registerForActivityResult()</code></strong> de la clase <strong><code>ComponentActivity</code></strong>. Este mรฉtodo recibe dos parรกmetros:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-final">final</span> <span class="token operator">&lt;</span>I<span class="token punctuation">,</span> O<span class="token operator">&gt;</span> ActivityResultLauncher<span class="token operator">&lt;</span>I<span class="token operator">&gt;</span> <span class="token function">registerForActivityResult</span><span class="token punctuation">(</span>
        <span class="token annotation builtin">@NonNull</span> ActivityResultContract<span class="token operator">&lt;</span>I<span class="token punctuation">,</span> O<span class="token operator">&gt;</span> contract<span class="token punctuation">,</span>
        <span class="token annotation builtin">@NonNull</span> ActivityResultCallback<span class="token operator">&lt;</span>O<span class="token operator">&gt;</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span> <span class="token function">registerForActivityResult</span><span class="token punctuation">(</span>contract<span class="token punctuation">,</span> mActivityResultRegistry<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>Donde ...</p>
<ul>
<li>
<p><strong><code>ActivityResultContract</code></strong> es un 'contrato' que especifica que una actividad se puede llamar con una entrada de tipo I y producir una salida de tipo O. Aunque se pueden crear contratos personalizados, la API proporciona contratos predeterminados para acciones de intent bรกsicas, como tomar una foto, solicitar permisos, etc.</p>
<p>Por ejemplo, <strong><code>ActivityResultContracts.StartActivityForResult()</code></strong> es una contrato que especifica que una actividad se puede llamar con una <strong>entrada de tipo <code>Intent</code></strong> y producir una <strong>salida de tipo <code>ActivityResult</code></strong>.</p>
</li>
<li>
<p><strong><code>ActivityResultCallback</code></strong> es un <em>callback</em> al que le llega un objeto de tipo O, para nuestro contrato un <strong><code>ActivityResult</code></strong> y hace una determinada acciรณn sin retornar o '<em>producir</em>' nada. <strong><code>result : ActivityResult -&gt; void</code></strong></p>
<div class="admonition warning">
<p class="admonition-title">Aviso</p>
<p>Los <strong><code>registerForActivityResult</code></strong> deben hacerse en el <strong><code>onCreate</code></strong> de la actividad.</p>
</div>
</li>
</ul>
</li>
<li>
<p><strong>Paso 2</strong>: Crearemos un Intent con los datos y el nombre de la Activity como siempre y despuรฉs con el objeto <strong><code>launcherActivityQueProduceUnTexto</code></strong> lanzaremos en Intent segรบn lo establecido en el contrato del lanzador. El cรณdigo serรญa el siguiente:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code>launcherActivityQueProduceUnTexto<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>
        <span class="token function">Intent</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> ActivityQueProduceUnTexto<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">{</span>
                <span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"TEXTO"</span></span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"Te llamo desde MainActivity"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
</code></pre></li>
</ul>
<h4 id="registrando-contratos-dentro-de-un-composable">Registrando contratos dentro de un <code>@Composable</code> </h4>
<p>La API de <strong><code>rememberLauncherForActivityResult</code></strong> es anรกloga a <strong><code>registerForActivityResult</code></strong> pero permite registrar un contrato dentro de un <strong><code>@Composable</code></strong> y guardarlo como un estado que sobrevive a las recomposiciones. Veamos el siguiente ejemplo extrado de la <strong><a href="https://developer.android.com/jetpack/compose/libraries?hl=es-419#activity_result">documentaciรณn oficial</a></strong> ...</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">GetContentExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-var">var</span> imageUri <span class="token keyword keyword-by">by</span> remember <span class="token punctuation">{</span> mutableStateOf<span class="token operator">&lt;</span>Uri<span class="token operator">?</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token keyword keyword-val">val</span> launcher <span class="token operator">=</span> <span class="token function">rememberLauncherForActivityResult</span><span class="token punctuation">(</span><span class="token function">GetContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> uri<span class="token operator">:</span> Uri<span class="token operator">?</span> <span class="token operator">-&gt;</span>
        imageUri <span class="token operator">=</span> uri
    <span class="token punctuation">}</span>
    Column <span class="token punctuation">{</span>
        <span class="token function">Button</span><span class="token punctuation">(</span>onClick <span class="token operator">=</span> <span class="token punctuation">{</span> launcher<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"image\*"</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">Text</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Load Image"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token function">Image</span><span class="token punctuation">(</span>
            painter <span class="token operator">=</span> <span class="token function">rememberImagePainter</span><span class="token punctuation">(</span>imageUri<span class="token punctuation">)</span><span class="token punctuation">,</span>
            contentDescription <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"My Image"</span></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p><strong><code>GetContent()</code></strong> es un contrato que especifica que se puede llamar a una actividad de selecciรณn de imรกgenes con una entrada de tipo <strong><code>String</code></strong>, que es la ruta de donde escogerlas y producir una salida de tipo <strong><code>Uri</code></strong> que es la ruta a ella.</p>
<div style="page-break-after:always;"></div>
<h2 id="gestion-de-permisos">Gestion de Permisos </h2>
<p>Para realizar lanzar algunos intents sobre actividades y servicios del sistema necesitaremos de ciertos permisos. Por ejemplo, para abrir la cรกmara, para leer la agenda de contactos, etc.</p>
<p>La forma de gestionar los permisos ha cambiado en las รบltimas versiones de Android. En versiones anteriores a <strong>Android 6.0 (API nivel 23)</strong>, los usuarios concedรญan todos los permisos solicitados en el manifiesto por una app en el momento de la instalaciรณn.</p>
<p>Ahora en Android, el <strong>sistema gestiona los permisos de las apps mientras se ejecutan</strong> y los usuarios pueden revocar cualquier permiso en cualquier momento.</p>
<p>El esquema para definir permisos es:</p>
<ol>
<li>
<p>Definiremos los requerimientos de permisos en el <strong><code>AndroidManifest.xml</code></strong> de la aplicaciรณn.</p>
</li>
<li>
<p>Registraremos un contrato de solicitud de permisos <strong><code>ActivityResultContracts.RequestPermission()</code></strong> con el mรฉtodo <strong><code>registerForActivityResult</code></strong> o <strong><code>rememberLauncherForActivityResult</code></strong> de la clase <strong><code>ComponentActivity</code></strong>.</p>
<p>El manejador del resultado de los permisos crearรก el intent para el servicio o activity y se pueden dar dos casos:</p>
<ol>
<li>Que el servicio no retorne nada por ejemplo una llamada telefรณnica.<br>
En este caso, desde el manejador si el permiso ha sido concedido lanzaremos el intent de llamada con el mรฉtodo <strong><code>startActivity()</code></strong> como ya hemos visto.</li>
<li>Que el servicio retorne un resultado por ejemplo una foto.<br>
En este caso, desde el manejador si el permiso ha sido concedido lanzaremos el <strong><code>launch</code></strong> de del registro de un contrato que se encargarรก de gestionar la respuesta con el resultado.</li>
</ol>
</li>
</ol>
<div style="page-break-after:always;"></div>
<h3 id="gestionar-intent-implรญcito-de-llamada-telefรณnica">Gestionar intent implรญcito de llamada telefรณnica </h3>
<ol>
<li>
<p>Aรฑadimos en el <strong><code>AndroidManifest.xml</code></strong> el permiso <strong><code>CALL_PHONE</code></strong>. Estas etiquetas irรกn dentro de la etiqueta <strong><code>&lt;manifest&gt;</code></strong>:</p>
<pre data-role="codeBlock" data-info="xml" class="language-xml xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-feature</span>
    <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.hardware.telephony<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>required</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.CALL_PHONE<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre></li>
<li>
<p>Por ejemplo, si queremos que el mรฉtodo de registro sea <strong><code>@Composable</code></strong> haremos.</p>
<pre data-role="codeBlock" data-info="kotlin {highlight=[6-7, 10]}" class="language-kotlin kotlin" data-line="6-7,10"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">registroLlamarPorTelefonoIntent</span><span class="token punctuation">(</span>
    telefono<span class="token operator">:</span> String
<span class="token punctuation">)</span><span class="token operator">:</span> ManagedActivityResultLauncher<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Boolean<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> context <span class="token operator">=</span> LocalContext<span class="token punctuation">.</span>current
    <span class="token keyword keyword-return">return</span> <span class="token function">rememberLauncherForActivityResult</span><span class="token punctuation">(</span>
        ActivityResultContracts<span class="token punctuation">.</span><span class="token function">RequestPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span> success <span class="token operator">-&gt;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">Intent</span><span class="token punctuation">(</span>Intent<span class="token punctuation">.</span>ACTION_CALL<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">also</span> <span class="token punctuation">{</span>
                callIntent <span class="token operator">-&gt;</span>
                callIntent<span class="token punctuation">.</span>data <span class="token operator">=</span> Uri<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"tel:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">telefono</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                context<span class="token punctuation">.</span><span class="token function">startActivity</span><span class="token punctuation">(</span>callIntent<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="line-highlight-wrapper">




<div aria-hidden="true" class="line-highlight" data-range="6-7" data-start="6" data-end="7">

</div></div><div class="line-highlight-wrapper">








<div aria-hidden="true" class="line-highlight" data-range="10" data-start="10">
</div></div></pre><p>Posteriormente podemos hacer ...</p>
<pre data-role="codeBlock" data-info="kotlin {highlight=[3, 5]}" class="language-kotlin kotlin" data-line="3,5"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">IntentLlamadaConPermisos</span><span class="token punctuation">(</span>telefono<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> launcherTelefono <span class="token operator">=</span> <span class="token function">registroLlamarPorTelefonoIntent</span><span class="token punctuation">(</span>telefono<span class="token punctuation">)</span>
    <span class="token function">Button</span><span class="token punctuation">(</span>onClick <span class="token operator">=</span> <span class="token punctuation">{</span>
        launcherTelefono<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>android<span class="token punctuation">.</span>Manifest<span class="token punctuation">.</span>permission<span class="token punctuation">.</span>CALL_PHONE<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Text</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Llamar al </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">telefono</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="line-highlight-wrapper">

<div aria-hidden="true" class="line-highlight" data-range="3" data-start="3">
</div></div><div class="line-highlight-wrapper">



<div aria-hidden="true" class="line-highlight" data-range="5" data-start="5">
</div></div></pre></li>
</ol>
<div style="page-break-after:always;"></div>
<h3 id="gestionar-intent-implรญcito-para-hacer-un-foto">Gestionar intent implรญcito para hacer un foto </h3>
<ol>
<li>
<p>Aรฑadimos en el <strong><code>AndroidManifest.xml</code></strong> el permiso <strong><code>CAMERA</code></strong>. Estas etiquetas irรกn dentro de la etiqueta <strong><code>&lt;manifest&gt;</code></strong>:</p>
<pre data-role="codeBlock" data-info="xml" class="language-xml xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-feature</span>
    <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.hardware.camera.any<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>required</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.CAMERA<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre></li>
<li>
<p>Por ejemplo, si queremos que el mรฉtodo de registro sea <strong><code>@Composable</code></strong> haremos.</p>
<pre data-role="codeBlock" data-info="kotlin {highlight=[6-12, 14-21]}" class="language-kotlin kotlin" data-line="6-12,14-21"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">registroHacerFotoConIntent</span><span class="token punctuation">(</span>
    onFotoCambiada<span class="token operator">:</span> <span class="token punctuation">(</span>ImageBitmap<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit
<span class="token punctuation">)</span><span class="token operator">:</span> ManagedActivityResultLauncher<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Boolean<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> cameraLauncher <span class="token operator">=</span>
        <span class="token function">rememberLauncherForActivityResult</span><span class="token punctuation">(</span>ActivityResultContracts
        <span class="token punctuation">.</span><span class="token function">StartActivityForResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> result <span class="token operator">-&gt;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>resultCode <span class="token operator">==</span> Activity<span class="token punctuation">.</span>RESULT_OK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-val">val</span> androidBitmap <span class="token operator">=</span> result<span class="token punctuation">.</span>data<span class="token operator">?</span><span class="token punctuation">.</span>extras<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"data"</span></span><span class="token punctuation">)</span> <span class="token keyword keyword-as">as</span> Bitmap
                <span class="token function">onFotoCambiada</span><span class="token punctuation">(</span>androidBitmap<span class="token operator">!!</span><span class="token punctuation">.</span><span class="token function">asImageBitmap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

    <span class="token keyword keyword-return">return</span> <span class="token function">rememberLauncherForActivityResult</span><span class="token punctuation">(</span>
        ActivityResultContracts<span class="token punctuation">.</span><span class="token function">RequestPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span> success <span class="token operator">-&gt;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-val">val</span> cameraIntent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span>MediaStore<span class="token punctuation">.</span>ACTION_IMAGE_CAPTURE_SECURE<span class="token punctuation">)</span>
            cameraLauncher<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>cameraIntent<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="line-highlight-wrapper">




<div aria-hidden="true" class="line-highlight" data-range="6-12" data-start="6" data-end="12">






</div></div><div class="line-highlight-wrapper">












<div aria-hidden="true" class="line-highlight" data-range="14-21" data-start="14" data-end="21">







</div></div></pre> <div style="page-break-after:always;"></div>
<p>Posteriormente podemos hacer ...</p>
<pre data-role="codeBlock" data-info="kotlin {highlight=[5, 7]}" class="language-kotlin kotlin" data-line="5,7"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">IntentFotoConPermisos</span><span class="token punctuation">(</span>
    onFotoCambiada<span class="token operator">:</span> <span class="token punctuation">(</span>ImageBitmap<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> launcherHacerFoto <span class="token operator">=</span> <span class="token function">registroHacerFotoConIntent</span><span class="token punctuation">(</span>onFotoCambiada<span class="token punctuation">)</span>
    <span class="token function">Button</span><span class="token punctuation">(</span>onClick <span class="token operator">=</span> <span class="token punctuation">{</span>
        launcherHacerFoto<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>android<span class="token punctuation">.</span>Manifest<span class="token punctuation">.</span>permission<span class="token punctuation">.</span>CAMERA<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Text</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Hacer foto"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="line-highlight-wrapper">



<div aria-hidden="true" class="line-highlight" data-range="5" data-start="5">
</div></div><div class="line-highlight-wrapper">





<div aria-hidden="true" class="line-highlight" data-range="7" data-start="7">
</div></div></pre></li>
</ol>
<div style="page-break-after:always;"></div>
<h3 id="gestionar-registro-hacer-foto-con-takepicture">Gestionar registro hacer foto con TakePicture </h3>
<p>Esta forma de hacer fotos nos permitirรก guardarla foto en una cachรฉ local como JPG y lo que recibirรก el callback serรก la ruta de la foto.</p>
<ol>
<li>
<p>Ademรกs de aรฑadir los permisos de acceso a la cรกmara como hemos hecho antes. Aรฑadimos en el <strong><code>AndroidManifest.xml</code></strong> un proveedor de ficheros para que la aplicaciรณn pueda acceder a la cachรฉ de la aplicaciรณn. Estas etiquetas irรกn dentro de la etiqueta <strong><code>&lt;application&gt;</code></strong>:</p>
<pre data-role="codeBlock" data-info="xml {highlight=10}" class="language-xml xml" data-line="10"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>application</span><span class="token punctuation">&gt;</span></span>
    ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>provider</span>
        <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>androidx.core.content.FileProvider<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>authorities</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>${applicationId}.provider<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>exported</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>grantUriPermissions</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta-data</span>
            <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.support.FILE_PROVIDER_PATHS<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@xml/path_provider<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>provider</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>application</span><span class="token punctuation">&gt;</span></span>
</code><div class="line-highlight-wrapper">








<div aria-hidden="true" class="line-highlight" data-range="10" data-start="10">
</div></div></pre></li>
<li>
<p>Definiremos el recurso XML <strong><code>path_provider.xml</code></strong> en <strong><code>res/xml</code></strong>. Donde definimos que las imรกgenes se guardarรกn en la carpeta <strong><code>cache</code></strong> de la aplicaciรณn situada en <strong><code>/sdcard/Android/data/&lt;package_name&gt;/cache</code></strong>. En esta ubicaciรณn encontraremos los JPG que se vayan generando.</p>
<pre data-role="codeBlock" data-info="xml" class="language-xml xml"><code><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>paths</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>external-cache-path</span>
        <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>my_images<span class="token punctuation">"</span></span>
        <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>paths</span><span class="token punctuation">&gt;</span></span>
</code></pre></li>
<li>
<p>Ya solo nos queda definir el contrato <strong><code>ActivityResultContracts.TakePicture()</code></strong> cuyo callback, a travรฉs del <strong><code>FileProvider</code></strong> definido nos permitirรก obtener la ruta de la foto en la cachรฉ.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> Context<span class="token punctuation">.</span><span class="token function">toImageBitmap</span><span class="token punctuation">(</span>uri<span class="token operator">:</span> Uri<span class="token punctuation">)</span><span class="token operator">:</span> ImageBitmap <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> contextResolver <span class="token operator">=</span> <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>contentResolver
    <span class="token keyword keyword-val">val</span> source <span class="token operator">=</span> ImageDecoder<span class="token punctuation">.</span><span class="token function">createSource</span><span class="token punctuation">(</span>contextResolver<span class="token punctuation">,</span> uri<span class="token punctuation">)</span>
    <span class="token keyword keyword-return">return</span> ImageDecoder<span class="token punctuation">.</span><span class="token function">decodeBitmap</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asImageBitmap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">registroHacerFotoConTakePicture</span><span class="token punctuation">(</span>
    onFotoCambiada<span class="token operator">:</span> <span class="token punctuation">(</span>ImageBitmap<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit
<span class="token punctuation">)</span><span class="token operator">:</span> ManagedActivityResultLauncher<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Boolean<span class="token operator">&gt;</span> <span class="token punctuation">{</span>

    <span class="token keyword keyword-val">val</span> context <span class="token operator">=</span> LocalContext<span class="token punctuation">.</span>current
    <span class="token keyword keyword-val">val</span> ficheroTemporal <span class="token operator">=</span> File<span class="token punctuation">.</span><span class="token function">createTempFile</span><span class="token punctuation">(</span>
        <span class="token string-literal singleline"><span class="token string">"JPEG_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression"><span class="token function">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"yyyyMMdd_HHmmss"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token function">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">_"</span></span><span class="token punctuation">,</span>
        <span class="token string-literal singleline"><span class="token string">".jpg"</span></span><span class="token punctuation">,</span>
        context<span class="token punctuation">.</span>externalCacheDir
    <span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> uri <span class="token operator">=</span> FileProvider<span class="token punctuation">.</span><span class="token function">getUriForFile</span><span class="token punctuation">(</span>
        context<span class="token punctuation">,</span>
        <span class="token string-literal singleline"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">context<span class="token punctuation">.</span>packageName</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.provider"</span></span><span class="token punctuation">,</span>
        ficheroTemporal
    <span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> cameraLauncher <span class="token operator">=</span>
        <span class="token function">rememberLauncherForActivityResult</span><span class="token punctuation">(</span>
            ActivityResultContracts<span class="token punctuation">.</span><span class="token function">TakePicture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> success <span class="token operator">-&gt;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">onFotoCambiada</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">toImageBitmap</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> <span class="token function">rememberLauncherForActivityResult</span><span class="token punctuation">(</span>
        ActivityResultContracts<span class="token punctuation">.</span><span class="token function">RequestPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span> success <span class="token operator">-&gt;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cameraLauncher<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></li>
</ol>
<div style="page-break-after:always;"></div>
<h3 id="gestionar-registro-para-obtener-una-imagen-de-la-galerรญa">Gestionar registro para obtener una imagen de la galerรญa </h3>
<p>En el punto Registrando contratos dentro de un <code>@Composable</code> ya hemos visto un ejemplo de como hacerlo. Veamos como concretarlo para seguir el mismo esquema que hemos seguido en los ejemplos anteriores.</p>
<ol>
<li>
<p>Definimos el contrato <strong><code>ActivityResultContracts.GetContent()</code></strong> que especifica que que se puede llamar a una actividad de selecciรณn de imรกgenes con una entrada de tipo <strong><code>String</code></strong> que es la ruta de donde escogerlas y producir una salida de tipo <strong><code>Uri</code></strong> que es ruta a ella.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">registroSelectorDeImagenesConGetContent</span><span class="token punctuation">(</span>
    onFotoCambiada<span class="token operator">:</span> <span class="token punctuation">(</span>ImageBitmap<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit
<span class="token punctuation">)</span><span class="token operator">:</span> ManagedActivityResultLauncher<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Uri<span class="token operator">?</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> context <span class="token operator">=</span> LocalContext<span class="token punctuation">.</span>current
    <span class="token keyword keyword-return">return</span> <span class="token function">rememberLauncherForActivityResult</span><span class="token punctuation">(</span>
        ActivityResultContracts<span class="token punctuation">.</span><span class="token function">GetContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> uri <span class="token operator">-&gt;</span>
        uri<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span>
            <span class="token function">onFotoCambiada</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">toImageBitmap</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p>Posteriormente podemos hacer ...</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">IntentImagenGaleria</span><span class="token punctuation">(</span>
    onFotoCambiada<span class="token operator">:</span> <span class="token punctuation">(</span>ImageBitmap<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> launcherFotoGaleria <span class="token operator">=</span> <span class="token function">registroSelectorDeImagenesConGetContent</span><span class="token punctuation">(</span>onFotoCambiada<span class="token punctuation">)</span>
    <span class="token function">Button</span><span class="token punctuation">(</span>onClick <span class="token operator">=</span> <span class="token punctuation">{</span>
        launcherFotoGaleria<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>"image<span class="token comment">/*")
    }) {
        Text(text = "Foto galerรญa")
    }
}
</span></code></pre></li>
</ol>
<div style="page-break-after:always;"></div>
<h2 id="conclusiรณn">Conclusiรณn </h2>
<p>Como has podido observar gestionar permisos y lanzar intents es un proceso que puede ser complejo y que requiere de un conocimiento profundo de la API de Android. Por ello, en ocasiones es recomendable utilizar librerรญas de terceros que nos faciliten el trabajo. Por ejemplo dispones de la librerรญa <strong><a href="https://google.github.io/accompanist/permissions/">accompanist</a></strong> que ofrece compatibilidad con Compose para gestionar permisos y lanzar intents.</p>
<p>Puedes descargarte alguna de las funciones a modo de utilidad de <strong><a href="assets/codigo/tema_3_8/RegistroContratosCompose.kt">RegistroContratosCompose.kt</a></strong> para utilizar en tus proyectos incluyendo el fuente en un nuevo paquete denominado <strong><code>.utilities.devices</code></strong> de tu proyecto.</p>

      </div>
      
      
    
    
    
    
    
    
  
    </body></html>