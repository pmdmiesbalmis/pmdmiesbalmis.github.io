<!DOCTYPE html><html><head>
      <title>PMDM 2º DAM  Tema 5.1 - Room</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.25/dist/katex.min.css">
      
      
      
      
      
      <style>
      @import url(https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css);
code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}@font-face{font-family:"Material Icons";font-style:normal;font-weight:400;src:local("Material Icons"),local("MaterialIcons-Regular"),url("data:application/x-font-woff;charset=utf-8;base64,d09GRgABAAAAAAfIAAsAAAAADDAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAADMAAABCsP6z7U9TLzIAAAE8AAAARAAAAFZW7kosY21hcAAAAYAAAADTAAACjtP6ytBnbHlmAAACVAAAAxgAAAQ4zRtvlGhlYWQAAAVsAAAALwAAADYRwZsnaGhlYQAABZwAAAAcAAAAJAeKAzxobXR4AAAFuAAAABIAAAA8OGQAAGxvY2EAAAXMAAAAIAAAACAG5AfwbWF4cAAABewAAAAfAAAAIAEfAERuYW1lAAAGDAAAAVcAAAKFkAhoC3Bvc3QAAAdkAAAAYgAAAK2vz7wkeJxjYGRgYOBikGPQYWB0cfMJYeBgYGGAAJAMY05meiJQDMoDyrGAaQ4gZoOIAgCKIwNPAHicY2BkPsQ4gYGVgYOpk+kMAwNDP4RmfM1gxMjBwMDEwMrMgBUEpLmmMDgwVLy4xKzzX4chhrmK4QpQmBEkBwAZygyweJzFkr0NwjAQhZ+TEP6CRUfHBEwRUWaQTICyQbpMwRCskA5RUIONxG0RnnNpKAIV4qzPku/8c353ACYAYrIjCWCuMAh2ptf0/hiL3p/gyPUWa3osqlt0L1zu9r71z8dGrJRykFoauXQd932Lj5vhG+MjxGeYI8MKETObMpslf5EyP8tg+vHun5r539PvlvXzaVhRFVQDTPEWKVQR90KhnnC5Ek67vUKN4VuFasM/ldARj43CCkCsEjpJSoVVgRyU0GVSK6wUpFFCx8lFgX0BiXpRPQB4nE2TTWjcRhTH3xttpDhxN7uxPlp3u/FK7moRPixafRijNosxSw/LUsIwNcaEHPZggo/FmEKMCKWU4kNOOftQSlhE8alnH0Ix9BqWnHooPRrTQ0+mnu2bXTu2pPdGM9LM/6c3fwECTM4gBBMYQNqxzLrZAjqYSlqu2TAHZQA0/DQJH6FtzqGDnvbt4Ggwvzw/nL8EfH8kW0fsuRqhgWXZnY7M1picaUL7Du5BHeDzMIl83dAt016wH1qmvtSMo5R6YRJHTR//FXsff/nj/tc/5K9P5d+nP22+fFK5u7v3K39SW3y+OtDKO3L85vD09PD9z5X17a2N1g4tqk01RlqX7gyoEmnsWQtVr4rtZMmukEaFBZxzefkCn11cyKMLZgshRwgTYNoLNXCBz2ja7HvZG7hDpPSNfoo5vs0knK/9hb+rNpu+8kHPgk/Ao4kK3tWtTpSEtvkA9c+wE6UaUdwieNkaHg55tBEtRiEPw1s0+FtrtTcc9two2lhMknV7PZF/cs6+uUFTmpTGbEx7sQCPSLOttHS3GRltqp7SNzVSKzl6aWnZT/CX5k6/v9N3Hh8fHBwffJVjhrC6OgH5dkIt/tPsq+d/PD5Qz7G7efzq1THFjdZVPe/N6ulQ3JnDWSE5junsFsVIiFwL/htf1S5gJ3BfOcUxfHKLnzqpFpyfZ9cX+/5WB6a+Y0pHpzkNrYNVDwMsikK+y7WuLCRg/oFHkA8VT3rDg5ZnU6ktzzINymV0m74Xd5pfIGXyFeVEQSShkzqG7TBBa2OxVRKitLXv7h3uuftXnXq7lz2tZ/WnWa9dx9dCjDhHzmuVQATlmljr9dZErUydSo2Hbi/b1vXtrOeGCk2/8s3ZlO8+ueJT8BVlw5pGw2oYccdSiHHqx0RlabHqdNR9jAETl6PreJcPBnnfpTLnOQ8C3OV8AmQGzouV1iZdeb5SSIoVc8W8/kcDtksUH5FrU6/aqBqNWcMEzxG4DAQ14qRQhi9mWU0rzepKezbjfgCwQKxVYq5ajRgpRqy45CqwkJydcEkbTkvRz8P5/2ZpDTN4nGNgZGBgAOKb6v+/xvPbfGXgZmEAgeuB2kkI+v8bFgbmKiCXg4EJJAoAPyAKhQB4nGNgZGBg1vmvwxDDwgACQJKRARXwAwAzZQHQeJxjYQCCFAYGFgbSMQAcWACdAAAAAAAAAAwALgBgAIQAmADSAQgBIgE8AVABoAHeAfwCHHicY2BkYGDgZ7BgYGMAASYg5gJCBob/YD4DAA/hAWQAeJxlkbtuwkAURMc88gApQomUJoq0TdIQzEOpUDokKCNR0BuzBiO/tF6QSJcPyHflE9Klyyekz2CuG8cr7547M3d9JQO4xjccnJ57vid2cMHqxDWc40G4Tv1JuEF+Fm6ijRfhM+oz4Ra6eBVu4wZvvMFpXLIa40PYQQefwjVc4Uu4Tv1HuEH+FW7i1mkKn6Hj3Am3sHC6wm08Ou8tpSZGe1av1PKggjSxPd8zJtSGTuinyVGa6/Uu8kxZludCmzxMEzV0B6U004k25W35fj2yNlCBSWM1paujKFWZSbfat+7G2mzc7weiu34aczzFNYGBhgfLfcV6iQP3ACkSaj349AxXSN9IT0j16JepOb01doiKbNWt1ovippz6sVYYwsXgX2rGVFIkq7Pl2PNrI6qW6eOshj0xaSq9mpNEZIWs8LZUfOouNkVXxp/d5woqebeYIf4D2J1ywQB4nG3LOw6AIBAE0B384B+PAkgEa+QwNnYmHt+EpXSal5lkSBBnoP8oCFSo0aCFRIceA0ZMmLFAYSW88rmvtMUjG3RiQ9HvpfusM6zWNmtc5H/iPewha50tOt5PS/QBx2IeSwAA") format("woff")}.admonition{box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12),0 3px 1px -2px rgba(0,0,0,.2);position:relative;margin:1.5625em 0;padding:0 1.2rem;border-left:.4rem solid rgba(68,138,255,.8);border-radius:.2rem;background-color:rgba(255,255,255,.05);overflow:auto}.admonition>p{margin-top:.8rem}.admonition>.admonition-title{margin:0 -1.2rem;padding:.8rem 1.2rem .8rem 3.6rem;border-bottom:1px solid rgba(68,138,255,.2);background-color:rgba(68,138,255,.1);font-weight:700}.admonition>.admonition-title:before{position:absolute;left:1.2rem;font-size:1.5rem;color:rgba(68,138,255,.8);content:"\E3C9"}.admonition>.admonition-title:before{font-family:Material Icons;font-style:normal;font-variant:normal;font-weight:400;line-height:2rem;text-transform:none;white-space:nowrap;speak:none;word-wrap:normal;direction:ltr}.admonition.abstract,.admonition.summary,.admonition.tldr{border-left-color:rgba(0,176,255,.8)}.admonition.abstract>.admonition-title,.admonition.summary>.admonition-title,.admonition.tldr>.admonition-title{background-color:rgba(0,176,255,.1);border-bottom-color:rgba(0,176,255,.2)}.admonition.abstract>.admonition-title:before,.admonition.summary>.admonition-title:before,.admonition.tldr>.admonition-title:before{color:#00b0ff;content:"\E8D2"}.admonition.hint,.admonition.tip{border-left-color:rgba(0,191,165,.8)}.admonition.hint>.admonition-title,.admonition.tip>.admonition-title{background-color:rgba(0,191,165,.1);border-bottom-color:rgba(0,191,165,.2)}.admonition.hint>.admonition-title:before,.admonition.tip>.admonition-title:before{color:#00bfa5;content:"\E80E"}.admonition.info,.admonition.todo{border-left-color:rgba(0,184,212,.8)}.admonition.info>.admonition-title,.admonition.todo>.admonition-title{background-color:rgba(0,184,212,.1);border-bottom-color:rgba(0,184,212,.2)}.admonition.info>.admonition-title:before,.admonition.todo>.admonition-title:before{color:#00b8d4;content:"\E88E"}.admonition.check,.admonition.done,.admonition.success{border-left-color:rgba(0,200,83,.8)}.admonition.check>.admonition-title,.admonition.done>.admonition-title,.admonition.success>.admonition-title{background-color:rgba(0,200,83,.1);border-bottom-color:rgba(0,200,83,.2)}.admonition.check>.admonition-title:before,.admonition.done>.admonition-title:before,.admonition.success>.admonition-title:before{color:#00c853;content:"\E876"}.admonition.faq,.admonition.help,.admonition.question{border-left-color:rgba(100,221,23,.8)}.admonition.faq>.admonition-title,.admonition.help>.admonition-title,.admonition.question>.admonition-title{background-color:rgba(100,221,23,.1);border-bottom-color:rgba(100,221,23,.2)}.admonition.faq>.admonition-title:before,.admonition.help>.admonition-title:before,.admonition.question>.admonition-title:before{color:#64dd17;content:"\E887"}.admonition.attention,.admonition.caution,.admonition.warning{border-left-color:rgba(255,145,0,.8)}.admonition.attention>.admonition-title,.admonition.caution>.admonition-title,.admonition.warning>.admonition-title{background-color:rgba(255,145,0,.1);border-bottom-color:rgba(255,145,0,.2)}.admonition.attention>.admonition-title:before{color:#ff9100;content:"\E417"}.admonition.caution>.admonition-title:before,.admonition.warning>.admonition-title:before{color:#ff9100;content:"\E002"}.admonition.fail,.admonition.failure,.admonition.missing{border-left-color:rgba(255,82,82,.8)}.admonition.fail>.admonition-title,.admonition.failure>.admonition-title,.admonition.missing>.admonition-title{background-color:rgba(255,82,82,.1);border-bottom-color:rgba(255,82,82,.2)}.admonition.fail>.admonition-title:before,.admonition.failure>.admonition-title:before,.admonition.missing>.admonition-title:before{color:#ff5252;content:"\E14C"}.admonition.bug,.admonition.danger,.admonition.error{border-left-color:rgba(255,23,68,.8)}.admonition.bug>.admonition-title,.admonition.danger>.admonition-title,.admonition.error>.admonition-title{background-color:rgba(255,23,68,.1);border-bottom-color:rgba(255,23,68,.2)}.admonition.danger>.admonition-title:before{color:#ff1744;content:"\E3E7"}.admonition.error>.admonition-title:before{color:#ff1744;content:"\E14C"}.admonition.bug>.admonition-title:before{color:#ff1744;content:"\E868"}.admonition.example,.admonition.snippet{border-left-color:rgba(0,184,212,.8)}.admonition.example>.admonition-title,.admonition.snippet>.admonition-title{background-color:rgba(0,184,212,.1);border-bottom-color:rgba(0,184,212,.2)}.admonition.example>.admonition-title:before,.admonition.snippet>.admonition-title:before{color:#00b8d4;content:"\E242"}.admonition.cite,.admonition.quote{border-left-color:rgba(158,158,158,.8)}.admonition.cite>.admonition-title,.admonition.quote>.admonition-title{background-color:rgba(158,158,158,.1);border-bottom-color:rgba(158,158,158,.2)}.admonition.cite>.admonition-title:before,.admonition.quote>.admonition-title:before{color:#9e9e9e;content:"\E244"}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

@font-face {
  font-family: 'Catamaran';
  font-style: normal;
  font-weight: 400;
  src: url(https://fonts.gstatic.com/s/catamaran/v28/o-0bIpQoyXQa2RxT7-5B6Ryxs2E_6n1iPHjd5a7dvg.ttf) format('truetype');
}
@page a4landscape {
  size: A4 landscape;
  margin: 1cm;
}
@page a4portrait {
  size: A4 portrait;
  margin: 1cm 1cm 2.5cm 1cm;
}
.markdown-preview.markdown-preview .landscape {
  page: a4landscape;
}
.markdown-preview.markdown-preview .portrait {
  page: a4portrait;
}
.markdown-preview.markdown-preview .box_bg_lightgray {
  background-color: #f5f5f5;
  border: 2px solid #969696;
  padding: 15px;
  margin-top: 15px;
  margin-bottom: 15px;
  border-radius: 5px;
  box-shadow: 0 0 7px 0 rgba(78, 120, 158, 0.1);
}
.markdown-preview.markdown-preview .box_bg_lightgreen {
  background-color: #f5faf5;
  border: 2px solid #969b96;
  padding-left: 15px;
  padding-right: 15px;
  margin-top: 15px;
  margin-bottom: 15px;
  border-radius: 5px;
  box-shadow: 0 0 7px 0 rgba(78, 120, 158, 0.1);
}
.markdown-preview.markdown-preview .salida_consola {
  background-color: #000000;
  color: aquamarine;
  border: 3px solid slategrey;
  padding-top: 15px;
  padding-bottom: 15px;
  padding-left: 10px;
  padding-right: 10px;
  margin-top: 10px;
  margin-bottom: 10px;
  border-radius: 5px;
  box-shadow: 3px 3px 6px 0 slategrey;
  font-family: "Lucida Console", Courier, monospace;
  font-size: 0.8rem;
}
.markdown-preview.markdown-preview .contenedor {
  display: flex;
  justify-content: center;
  margin: 30px auto 30px auto;
}
.markdown-preview.markdown-preview .fondo {
  background: url(https://balmisdigigs.github.io/digitalizacion.github.io/imagenes/fondos/quote.png);
  background-size: cover;
  width: 75%;
  height: 160px;
  border-radius: 10px;
  position: relative;
}
.markdown-preview.markdown-preview .cita {
  font-family: Arial;
  font-style: italic;
  font-weight: 600;
  text-align: justify;
  line-height: 1.5rem;
  opacity: 0.6;
  color: white;
  padding: 5rem;
  position: relative;
  top: 50%;
  left: 50%;
  font-size: 1.3rem;
  transform: translate(-50%, -50%);
}
.markdown-preview.markdown-preview .abre_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-left: 30px;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, -15%);
}
.markdown-preview.markdown-preview .cierra_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-right: 30px;
  right: 0%;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, 55%);
}
.markdown-preview.markdown-preview .autor {
  font-family: Arial;
  color: white;
  margin: 0px;
  padding-left: 30px;
  position: absolute;
  top: 83%;
  font-size: 1rem;
}
.markdown-preview.markdown-preview .flotante {
  display: flex;
  margin-top: 15px;
  margin-bottom: 15px;
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .flotante {
    justify-content: center;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .flotante {
    justify-content: space-between;
  }
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .flotante {
    flex-direction: column;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .flotante {
    flex-direction: row;
  }
}
.markdown-preview.markdown-preview .flotante_izq {
  margin-right: 15px;
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .flotante_izq {
    width: 100%;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .flotante_izq {
    width: auto;
  }
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .flotante_der {
    width: 100%;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .flotante_der {
    width: auto;
  }
}
.markdown-preview.markdown-preview .galeria_imagenes {
  display: flex;
  justify-content: space-evenly;
  align-items: center;
  margin-top: 15px;
  margin-bottom: 15px;
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .galeria_imagenes {
    flex-direction: column;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .galeria_imagenes {
    flex-direction: row;
  }
}

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
    const configureMermaidIconPacks = () => {
        window["mermaid"].registerIconPacks([
            {
                name: "logos",
                loader: () =>
                    fetch("https://unpkg.com/@iconify-json/logos@1/icons.json").then(
                        (res) => res.json()
                    ),
            },
        ]);
    };

    if (document.readyState !== 'loading') {
        configureMermaidIconPacks();
    } else {
        document.addEventListener("DOMContentLoaded", () => {
            configureMermaidIconPacks();
        });
    }
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="tema-51---room">Tema 5.1 - Room </h1>
<p>Descargar estos apuntes <a href="./Tema_5_1_room.pdf">pdf</a> o <a href="./Tema_5_1_room.html">html</a></p>
<h2 id="índice">Índice </h2>

<div class="md-toc">
<div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:18px">
          <a href="#introducción" class="md-toc-link">
            <p>Introducción</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:18px">
          <a href="#dependencias" class="md-toc-link">
            <p>Dependencias</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:18px">
          <a href="#componentes-de-room" class="md-toc-link">
            <p>Componentes de Room</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:18px">
          <a href="#añadiendo-paquete-room-al-proyecto" class="md-toc-link">
            <p>Añadiendo paquete room al proyecto</p>

          </a></div><details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#crear-las-entidades-que-definen-nuestro-modelo" class="md-toc-link"><p>Crear las entidades que definen nuestro modelo</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#definiendo-relaciones-entre-objetos" class="md-toc-link"><p>Definiendo relaciones entre Objetos</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#relaciones-uno-a-muchos-entre-objetos" class="md-toc-link">
            <p>Relaciones Uno a Muchos entre objetos</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#crear-los-objetos-de-acceso-a-la-base-de-datos" class="md-toc-link"><p>Crear los Objetos de Acceso a la Base de Datos</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#métodos-de-conveniencia" class="md-toc-link">
            <p>Métodos de conveniencia</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#métodos-de-búsqueda" class="md-toc-link"><p>Métodos de búsqueda</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#selección-de-un-subconjunto-de-columnas" class="md-toc-link">
            <p>Selección de un subconjunto de columnas</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:18px">
          <a href="#crear-la-base-de-datos-room-y-consumirla" class="md-toc-link">
            <p>Crear la Base de Datos Room y consumirla</p>

          </a></div><details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#instanciar-la-roomdatabase-para-su-posterior-funcionamiento" class="md-toc-link"><p>Instanciar la RoomDatabase para su posterior funcionamiento</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#preparando-la-base-de-datos-y-los-daos-con-hilt" class="md-toc-link">
            <p>Preparando la Base de Datos y los DAOs con Hilt</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#inyectando-los-daos-en-los-repositorios" class="md-toc-link">
            <p>Inyectando los DAOs en los repositorios</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#cargando-datos-de-prueba-en-la-bd" class="md-toc-link">
            <p>Cargando datos de prueba en la BD</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:18px">
          <a href="#ubicación-de-la-base-de-datos-en-el-dispositivo" class="md-toc-link">
            <p>Ubicación de la Base de Datos en el dispositivo</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:18px">
          <a href="#inspeccionando-y-depurando-la-bd-con-database-inspector" class="md-toc-link">
            <p>Inspeccionando y depurando la BD con Database Inspector</p>

          </a></div>
</div>
<div style="page-break-after:always;"></div>
<h2 id="introducción">Introducción </h2>
<ul>
<li>
<p><strong>Persistencia local con Room</strong></p>
<ul>
<li>Documentación oficial: <strong><a href="https://developer.android.com/training/data-storage/room">Save data in a local database using Room</a></strong></li>
<li>Documentación oficial versiones librería: <strong><a href="https://developer.android.com/jetpack/androidx/releases/room">Room</a></strong></li>
<li>Video Tutorial (Inglés): <strong><a href="https://www.youtube.com/watch?v=bOd3wO0uFr8">Philipp Lackner</a></strong></li>
<li>Video Tutorial (Castellano): <strong><a href="https://www.youtube.com/watch?v=TKZRiq4GDuc">Martin Kiperszmid</a></strong></li>
<li>Video Tutorial (Castellano): <strong><a href="https://www.youtube.com/watch?v=lYBb4QedYH8">AristiDevs</a></strong></li>
<li>Video Tutorial (Castellano): <strong><a href="https://www.youtube.com/watch?v=Yu-Ty8T28ag">Gibrán García</a></strong></li>
</ul>
</li>
</ul>
<p>La plataforma Android proporciona <strong>dos herramientas</strong> principales para el almacenamiento y consulta de datos estructurados: la base de datos <strong>SQLite</strong> y <strong>Content Providers</strong>.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Existen otras opciones de terceros como <strong><a href="https://sqldelight.github.io/sqldelight/2.0.2/android_sqlite/">SQLDelight</a></strong> (<strong>SQLite</strong>) pero no están tan integradas Android Studio como Room. Aunque, es una opción muy válida otros SO <strong><a href="https://www.youtube.com/watch?v=nmKyP-uEUXs">Kotlin Multipltaform</a></strong>. Incluso si nos decidimos por usar <strong><a href="https://firebase.google.com/docs/firestore/quickstart?hl=es-419#android">Firestore</a></strong>, existe la posibilidad de <strong><a href="https://cloud.google.com/firestore/docs/manage-data/enable-offline?hl=es-419#kotlin+ktxandroid">usarlo de forma offline</a></strong></p>
</div>
<p>Nosotros vamos a centrarnos en <strong><a href="https://developer.android.com/training/data-storage/sqlite?hl=es">SQLite</a></strong>, aunque no entraremos ni en el diseño de BBDD relacionales ni en el uso avanzado de la BBDD. Para conocer toda la funcionalidad de SQLite se recomienda usar la documentación oficial. <strong>El problema de trabajar directamente con esta API es que es un trabajo a bajo nivel que puede llevar a errores en tiempo de ejecución</strong>.</p>
<p>Por este motivo Android Jetpack ha proporcionado ORM a modo de capa de abstracción que facilita enormemente el proceso de codificación La biblioteca que nos va a permitir esta abstracción y se distribuye como <strong><a href="https://developer.android.com/training/data-storage/room">Room</a></strong>.</p>
<h2 id="dependencias">Dependencias </h2>
<p>Para poder usar la funcionalidad de Room y las anotaciones, deberemos añadir una serie de dependencias y plugins.</p>
<p>Al igual que sucedía con <strong>Hilt</strong>, en <strong>Room</strong> vamos a necesitar algún tipo de procesador de anotaciones. Las primeras versiones usaban<br>
<strong>KAPT</strong>, pero como con Hilt, <strong>Room</strong> ya está migrado a <strong>KSP</strong>. Por tanto, si ya estamos usando <strong>Hilt</strong> no necesitaremos añadir el plugin de <strong>KSP</strong>. No obstante vamos a recordar los pasos...</p>
<p>En el catálogo de versiones <strong><code>lib.versions.toml</code></strong> deberemos comprobar que hemos definido tener:</p>
<pre data-role="codeBlock" data-info="toml" class="language-toml toml"><code><span class="token punctuation">[</span><span class="token table class-name">versions</span><span class="token punctuation">]</span>
<span class="token key property">kotlin</span> <span class="token punctuation">=</span> <span class="token string">"2.0.20"</span>
<span class="token key property">ksp</span> <span class="token punctuation">=</span> <span class="token string">"2.0.20-1.0.25"</span>
<span class="token key property">room</span> <span class="token punctuation">=</span> <span class="token string">"2.6.1"</span>

<span class="token punctuation">[</span><span class="token table class-name">libraries</span><span class="token punctuation">]</span>
<span class="token key property">androidx-room-ktx</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">group</span> <span class="token punctuation">=</span> <span class="token string">"androidx.room"</span><span class="token punctuation">,</span> <span class="token key property">name</span> <span class="token punctuation">=</span> <span class="token string">"room-ktx"</span><span class="token punctuation">,</span> <span class="token key property">version.ref</span> <span class="token punctuation">=</span> <span class="token string">"room"</span> <span class="token punctuation">}</span>
<span class="token key property">androidx-room-compiler</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">group</span> <span class="token punctuation">=</span> <span class="token string">"androidx.room"</span><span class="token punctuation">,</span> <span class="token key property">name</span> <span class="token punctuation">=</span> <span class="token string">"room-compiler"</span><span class="token punctuation">,</span> <span class="token key property">version.ref</span> <span class="token punctuation">=</span> <span class="token string">"room"</span> <span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token table class-name">plugins</span><span class="token punctuation">]</span>
<span class="token key property">devtools-ksp</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">id</span> <span class="token punctuation">=</span> <span class="token string">"com.google.devtools.ksp"</span><span class="token punctuation">,</span> <span class="token key property">version.ref</span> <span class="token punctuation">=</span> <span class="token string">"ksp"</span> <span class="token punctuation">}</span>
</code></pre><p>En el <strong><code>build.gradle.kts</code></strong> raíz del proyecto añadiremos el siguiente plugin:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code>plugins <span class="token punctuation">{</span>
    <span class="token function">alias</span><span class="token punctuation">(</span>libs<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span>devtools<span class="token punctuation">.</span>ksp<span class="token punctuation">)</span> apply <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre><p>En el <strong><code>build.gradle.kts</code></strong> del <strong>módulo de la aplicación</strong> (app) añadiremos:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code>plugins <span class="token punctuation">{</span>
    <span class="token function">alias</span><span class="token punctuation">(</span>libs<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span>devtools<span class="token punctuation">.</span>ksp<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token operator">..</span><span class="token punctuation">.</span>
dependencies <span class="token punctuation">{</span>
    <span class="token function">implementation</span><span class="token punctuation">(</span>libs<span class="token punctuation">.</span>androidx<span class="token punctuation">.</span>room<span class="token punctuation">.</span>ktx<span class="token punctuation">)</span>
    <span class="token function">ksp</span><span class="token punctuation">(</span>libs<span class="token punctuation">.</span>androidx<span class="token punctuation">.</span>room<span class="token punctuation">.</span>compiler<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><p>La versión de la librería puede cambiar, pero puedes ver los últimos releases de la misma en el siguiente enlace: <strong><a href="https://developer.android.com/jetpack/androidx/releases/room">Room</a></strong></p>
<h2 id="componentes-de-room">Componentes de Room </h2>
<div class="flotante" ,="" style="align-items: center;">
<div class="flotante_izq">
<p>Para trabajar con Room debemos familiarizarnos con su arquitectura que está compuesta por tres partes principales:</p>
<ul>
<li><strong>Entity</strong> (Entities), serán las clases que definirán las entidades de nuestra Base de datos, que corresponden con cada tabla que la forman.</li>
<li><strong>DAOs</strong> (Data Access Objects), en este caso serán las clases abstractas o interfaces donde estarán definidos los métodos que nos permitirán la operatividad (inserción, consulta, etc) con cada una de las tablas de la Base de Datos.</li>
<li><strong>RoomDatabase</strong> (Room Database), contiene la Base de Datos y el acceso a esta, a la vez que une los dos anteriores conceptos.</li>
</ul>
</div>
<div class="flotante_der">
<img width="800px" src="assets/imagenes/tema_5_1/imagen1_room.png">
</div>
</div>
<p>Una vez que se creen estos tres elementos, la app podrá acceder a los DAOs a través de las instancias de Room Database que creemos, de forma más estable que con el acceso directo a la API de SQLite.</p>
<p>El uso de Room se hace a través de <strong>Anotaciones</strong> añadidas a las clases e interfaces, las principales son:</p>
<ul>
<li><strong><code>@Entity</code></strong>, indica que la clase a la que se atribuye debe ser tratada como una entidad.</li>
<li><strong><code>@Dao</code></strong>, debe de añadirse a las interfaces que queremos que sean nuestras Daos. Dentro de estas interfaces se utilizan otras anotaciones que veremos más adelante.</li>
<li><strong><code>@Database</code></strong>, se añadirá a las Room Database he indicará que es una Database, estas clases deben ser abstractas y heredar de RoomDatabase.</li>
</ul>
<h2 id="añadiendo-paquete-room-al-proyecto">Añadiendo paquete room al proyecto </h2>
<p>Recuerda que en la distribución de paquetes que se propuso a principio de curso. Dentro del paquete <strong><code>.data</code></strong> vamos a crear un paquete por cada una de las fuentes de datos que tengamos. En este caso, como vamos a usar Room, crearemos un paquete denominado <strong><code>.data.room</code></strong> y dentro del él vamos a crear los componentes que hemos mencionado y que concretaremos a continuación.</p>
<div style="page-break-after:always;"></div>
<div class="admonition info">
<p class="admonition-title">Código de los ejemplos</p>
<p>Si te surge alguna duda o tienes dificultades para completar este tema. Puedes descargar el proyecto con el código de mismo del siguiente enlace: <strong><a href="room_ejemplo_apuntes_recurso.zip">Proyecto ejemplos</a></strong></p>
</div>
<h2 id="crear-las-entidades-que-definen-nuestro-modelo">Crear las entidades que definen nuestro modelo </h2>
<p>Para definir la persistencia con Room, utilizaremos lo que denominaremos <em>'Code First'</em>, <em>'Model First'</em> o <em>'Entity First'</em>, es decir, primero definiremos las entidades que queremos persistir y sus relaciones. Posteriormente, a partir de estas definiciones, se creará la base de datos.</p>
<p>Para ello pues, el primer paso a realizar será el de crear las distintas tablas que tendrá nuestra base de datos. Cada tabla corresponderá con una clase <strong><a href="https://developer.android.com/training/data-storage/room/defining-data">Entity</a></strong> etiquetada como <strong><code>@Entity</code></strong> en la que añadiremos los campos correspondiente a la tabla. Vamos a usar un ejemplo sencillo para entender el funcionamiento:</p>
<ol>
<li>
<p>Por ejemplo, si queremos crear una tabla de <strong><code>clientes</code></strong> con los campos <strong><code>dni</code></strong>, <strong><code>nombre</code></strong> y <strong><code>apellidos</code></strong>. Crearemos una <strong><code>data class</code></strong> denominada <strong><code>ClienteEntity</code></strong> dentro del paquete <strong><code>.data.room.ClienteEntity.kt</code></strong>.</p>
<p>A esta, le añadiremos a la anotación <strong><code>@Entity</code></strong> la propiedad <strong><code>tableName</code></strong> con el nombre de la tabla: <strong><code>@Entity(tableName = "idTabla")</code></strong>. Si no lo hiciéramos, la tabla tomaría el nombre de nuestra entidad.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Entity</span><span class="token punctuation">(</span>tableName <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"clientes"</span></span><span class="token punctuation">)</span>
<span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">ClienteEntity</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-val">val</span> dni<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> nombre<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> apellidos<span class="token operator">:</span> String<span class="token punctuation">)</span>
</code></pre></li>
<li>
<p>Deberemos decidir cual será nuestra <strong>clave primaria</strong> para añadir la anotación <strong><code>@PrimaryKey</code></strong> a la propiedad que decidamos.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Entity</span><span class="token punctuation">(</span>tableName <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"clientes"</span></span><span class="token punctuation">)</span>
<span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">ClienteEntity</span><span class="token punctuation">(</span>
    <span class="token annotation builtin">@PrimaryKey</span> <span class="token keyword keyword-val">val</span> dni<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> nombre<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> apellidos<span class="token operator">:</span> String<span class="token punctuation">)</span>
</code></pre><p>Si necesitáramos una clave primaria compuesta por más de un campo, tendríamos que indicarlo con la propiedad <strong><a href="https://developer.android.com/training/data-storage/room/defining-data#composite-key">primaryKeys</a></strong> de la anotación <strong><code>@Entity</code></strong>. De igual manera lo haríamos en el caso de necesitar una <strong>clave ajena</strong>, pero en este caso con la propiedad <strong><a href="https://developer.android.com/reference/kotlin/androidx/room/ForeignKey">foreignKeys</a></strong>.</p>
<p>Por ejemplo, si tuviéramos otra tabla <strong><code>pedidos</code></strong> en la que relacionáramos el <strong><code>dni</code></strong> de la tabla <strong><code>clientes</code></strong> con el <strong><code>dni</code></strong> ajeno de los registros de esta tabla, <strong><code>parentColumns</code></strong> se referiría al <strong><code>dni</code></strong> de <strong><code>clientes</code></strong> mientras que <strong><code>dni_cliente</code></strong> en <strong><code>childColumns</code></strong> sería al de <strong><code>pedidos</code></strong>.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token comment">// Expresaríamos que un pedidos define una clave ajena dni en clientes.</span>
<span class="token annotation builtin">@Entity</span><span class="token punctuation">(</span>tableName <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"pedidos"</span></span><span class="token punctuation">,</span>
        foreignKeys <span class="token operator">=</span> <span class="token function">arrayOf</span><span class="token punctuation">(</span>
            <span class="token function">ForeignKey</span><span class="token punctuation">(</span>
                entity <span class="token operator">=</span> ClienteEntity<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">,</span>
                parentColumns <span class="token operator">=</span> <span class="token function">arrayOf</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"dni"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token comment">// Nombre de la columna en la tabla pedidos</span>
                childColumns <span class="token operator">=</span> <span class="token function">arrayOf</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"dni_cliente"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
                onDelete <span class="token operator">=</span> CASCADE<span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
<span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">PedidoEntity</span><span class="token punctuation">(</span><span class="token operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
</code></pre><p>No obstante, más adelante veremos como definir relaciones entre objetos en lugar de tablas. Además, ten en cuenta que la definición correcta de índices nos va a proporcionar mucha velocidad.</p>
</li>
<li>
<p>Es muy <strong>buena práctica</strong> usar la etiqueta <strong><code>@ColumnInfo</code></strong> <strong>para que futuras modificaciones en la BD no afecten a mis entidades</strong>. Esta propiedad sirve para personalizar la columna de la base de datos del atributo asociado. Podemos indicar, entre otras cosas, un nombre para la columna diferente al del atributo. Esto nos permite hacer más independiente la app de la BD. Además nos permite pasar del <em><strong>camelCasing</strong></em> que el como tendremos los nombres de propiedades compuestos en Kotlin a <em><strong>snake_casing</strong></em> que es el convenio estándar en las bases de datos. Por ejemplo, la clave ajena anterior de pedidos sería ...</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code>    <span class="token annotation builtin">@ColumnInfo</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"dni_cliente"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> dniCliente<span class="token operator">:</span> String<span class="token punctuation">,</span>
</code></pre><p>En nuestro ejemplo, al final la <strong><code>Entity</code></strong> quedaría de la siguiente manera:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Entity</span><span class="token punctuation">(</span>tableName <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"clientes"</span></span><span class="token punctuation">)</span>
<span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">ClienteEntity</span><span class="token punctuation">(</span>
    <span class="token annotation builtin">@PrimaryKey</span>
    <span class="token annotation builtin">@ColumnInfo</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"dni"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> dni<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token annotation builtin">@ColumnInfo</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"nombre"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> nombre<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token annotation builtin">@ColumnInfo</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"apellidos"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> apellidos<span class="token operator">:</span> String<span class="token punctuation">)</span>
</code></pre></li>
<li>
<p>Es posible que, a veces, quieras expresar una entidad o un objeto de datos como un solo elemento integral en la lógica de la base de datos, incluso si el objeto contiene varios campos. En esas situaciones, puedes usar la anotación <strong><code>@Embedded</code></strong> para representar <strong>un objeto cuyos subcampos quieras desglosar en una tabla</strong>. Luego, puedes buscar los campos integrados tal como lo harías con otras columnas individuales. A este tipo de objetos, los denominaremos '<em><strong>objetos incorporados</strong></em>'</p>
<p>Podemos hacer una analogía entre los '<em><strong>objetos incorporados</strong></em>' con los que definimos en las BDOR (Bases de Datos Bbjeto-Relacionales de Oracle o PostgreSQL)</p>
<p>Por ejemplo, la clase <strong><code>ClienteEntity</code></strong> puede incluir un campo de tipo <strong><code>Direccion</code></strong>, que representa una composición de propiedades llamadas <strong><code>calle</code></strong>, <strong><code>ciudad</code></strong>, <strong><code>pais</code></strong> y <strong><code>codigoPostal</code></strong>. Para almacenar las <strong>columnas compuestas por separado</strong> en la tabla, incluye un campo <strong><code>Direccion</code></strong> en la clase <strong><code>ClienteEntity</code></strong> con anotaciones <strong><code>@Embedded</code></strong>, como se muestra en el siguiente fragmento de código:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">Direccion</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-val">val</span> calle<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> ciudad<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> pais<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>
    <span class="token annotation builtin">@ColumnInfo</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"codigo_postal"</span></span><span class="token punctuation">)</span> 
    <span class="token keyword keyword-val">val</span> codigoPostal<span class="token operator">:</span> String<span class="token operator">?</span>
<span class="token punctuation">)</span>

<span class="token annotation builtin">@Entity</span><span class="token punctuation">(</span>tableName <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"clientes"</span></span><span class="token punctuation">)</span>
<span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">ClienteEntity</span><span class="token punctuation">(</span>
    <span class="token annotation builtin">@PrimaryKey</span>
    <span class="token annotation builtin">@ColumnInfo</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"dni"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> dni<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token annotation builtin">@ColumnInfo</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"nombre"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> nombre<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token annotation builtin">@ColumnInfo</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"apellidos"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> apellidos<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token comment">// Marcamos como embebe @Embedded el campo a descomponer en la tabla</span>
    <span class="token annotation builtin">@Embedded</span> <span class="token keyword keyword-val">val</span> direccion<span class="token operator">:</span> Direccion<span class="token operator">?</span>
<span class="token punctuation">)</span> 
</code></pre><p>Del código anterior, la tabla que representa un objeto <strong><code>ClienteEntity</code></strong> contendrá columnas con los siguientes nombres:</p>
<table>
<thead>
<tr>
<th>dni</th>
<th>nombre</th>
<th>apellidos</th>
<th>calle</th>
<th>ciudad</th>
<th>pais</th>
<th>codigo_postal</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>A veces, necesitas que la app almacene un tipo de datos personalizado en una sola columna de base de datos. Para admitir tipos personalizados, debes proporcionar convertidores de tipo, que son métodos que indican a Room cómo convertir tipos personalizados en tipos conocidos que Room pueda tratar. Para identificar los conversores de tipo, puedes usar la anotación <strong><code>@TypeConverter</code></strong>.</p>
<p>Supongamos que necesitas conservar instancias del tipo <strong><code>LocalDate</code></strong> definido en <strong><code>org.jetbrains.kotlinx:kotlinx-datetime</code></strong> para saber la <strong>fecha</strong> en que se hizo un pedido. Pero la base de datos para guardar fechas lo hace mediante un <strong><code>Int</code></strong> que representa el <strong>TIMESTAMP</strong>.</p>
<p>Definiremos primero una clase denominada <strong><code>RoomConverters</code></strong> dentro del paquete <strong><code>.data.room</code></strong> con todos los métodos convertidores. Ojo, no importa el nombre del método, <strong>sino su signatura</strong> (parámetro de entrada y de salida). Por ejemplo para fecha podría ser:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token comment">// Estamos presuponiendo que nuestras fechas nunca son nulas.</span>
<span class="token keyword keyword-class">class</span> RoomConverters <span class="token punctuation">{</span>
    <span class="token annotation builtin">@TypeConverter</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">fromTimestamp</span><span class="token punctuation">(</span>value<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> LocalDate <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> LocalDate<span class="token punctuation">.</span><span class="token function">fromEpochDays</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token annotation builtin">@TypeConverter</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">dateToTimestamp</span><span class="token punctuation">(</span>date<span class="token operator">:</span> LocalDate<span class="token punctuation">)</span><span class="token operator">:</span> Int <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> date<span class="token punctuation">.</span><span class="token function">toEpochDays</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="admonition tip">
<p class="admonition-title">Importante</p>
<p>Cuando definamos la BD ya veremos como indicarle que aplique todas las conversiones definidas.</p>
</div>
<p>Ahora ya podemos definir nuestra clase <strong><code>PedidoEntity</code></strong> dentro del paquete <strong><code>.data.room</code></strong> ...</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Entity</span><span class="token punctuation">(</span>tableName <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"pedidos"</span></span><span class="token punctuation">,</span>
        foreignKeys <span class="token operator">=</span> <span class="token function">arrayOf</span><span class="token punctuation">(</span>
            <span class="token function">ForeignKey</span><span class="token punctuation">(</span>
                entity <span class="token operator">=</span> ClienteEntity<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">,</span>
                parentColumns <span class="token operator">=</span> <span class="token function">arrayOf</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"dni"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                childColumns <span class="token operator">=</span> <span class="token function">arrayOf</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"dni_cliente"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
                onDelete <span class="token operator">=</span> CASCADE<span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
<span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">PedidoEntity</span><span class="token punctuation">(</span>
    <span class="token comment">// El id será autogenerado insertando un 0.        </span>
    <span class="token annotation builtin">@PrimaryKey</span> <span class="token punctuation">(</span>autoGenerate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>         
    <span class="token annotation builtin">@ColumnInfo</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"id"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> id<span class="token operator">:</span> Int<span class="token punctuation">,</span>
    
    <span class="token annotation builtin">@ColumnInfo</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"dni_cliente"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> dniCliente<span class="token operator">:</span> Int<span class="token punctuation">,</span>

    <span class="token comment">// Indicamos que siempre debe tener una fecha.</span>
    <span class="token comment">// Esta en la DB se guardará como un Int.</span>
    <span class="token annotation builtin">@NonNull</span>                 
    <span class="token annotation builtin">@ColumnInfo</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"fecha"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> fecha<span class="token operator">:</span> LocalDate
<span class="token punctuation">)</span>
</code></pre></li>
</ol>
<div style="page-break-after:always;"></div>
<h3 id="definiendo-relaciones-entre-objetos">Definiendo relaciones entre Objetos </h3>
<p>Usando los '<em><strong>objetos incorporados</strong></em>' podremos hacerlo de forma sencilla.</p>
<h4 id="relaciones-uno-a-muchos-entre-objetos">Relaciones Uno a Muchos entre objetos </h4>
<p>Supongamos que queremos definir un nuevo objeto a recuparar que no es una entidad en la BD, pero <strong>quiero que contenga un cliente con todos sus pedidos</strong>. De forma análoga a los que tenemos en las entidades de <strong>JPA</strong>.</p>
<p>Deberemos definir la clase que exprese la relación y que se completará <em>'mapeará'</em> automáticamente cuando la usemos en nuestro <strong>DAO</strong>.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">ClienteConPedidos</span><span class="token punctuation">(</span>
    <span class="token comment">// Sabe recuperar el objeto embebido.</span>
    <span class="token annotation builtin">@Embedded</span> <span class="token keyword keyword-val">val</span> cliente<span class="token operator">:</span> ClienteEntity<span class="token punctuation">,</span>
    <span class="token annotation builtin">@Relation</span><span class="token punctuation">(</span>
          parentColumn <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"dni"</span></span><span class="token punctuation">,</span>
          <span class="token comment">// Nombre de la columna en la parte del muchos</span>
          entityColumn <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"dni_cliente"</span></span>
    <span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> pedidos<span class="token operator">:</span> List<span class="token operator">&lt;</span>PedidoEntity<span class="token operator">&gt;</span>
<span class="token punctuation">)</span>
</code></pre><p>Más adelante, veremos su utilidad y que hay formas más '<em>simples</em>' de hacerlo.</p>
<div class="admonition info">
<p class="admonition-title">Información</p>
<p>Puedes saber más sobre como definir otros tipos de <strong>relaciones entre objetos</strong> con room en el siguiente <strong><a href="https://developer.android.com/training/data-storage/room/relationships">enlace</a></strong></p>
</div>
<div style="page-break-after:always;"></div>
<h2 id="crear-los-objetos-de-acceso-a-la-base-de-datos">Crear los Objetos de Acceso a la Base de Datos </h2>
<p>Los <strong><a href="https://developer.android.com/training/data-storage/room/accessing-data">DAO</a></strong> serán elementos de tipo <strong>Interfaz</strong>, en los cuales incluiremos los métodos necesarios de acceso y gestión a las entidades de la Base de Datos. En tiempo de compilación, Room generará automáticamente la implementaciones de DAOs que hayamos definido.</p>
<p>Es buena práctica, <strong>definir un DAO por cada entidad que tengamos</strong>, y en este definir las funcionalidades asociadas a esta entidad.</p>
<p>Para que una interfaz sea gestionada como DAO, habrá que añadir la anotación <strong><code>@Dao</code></strong>, siguiendo nuestro ejemplo tendríamos:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Dao</span>
<span class="token keyword keyword-interface">interface</span> ClienteDao 
<span class="token punctuation">{</span>
    <span class="token operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><p>Para poder operar con la funcionalidad de Room, se necesitará hacer las llamadas fuera del hilo principal ya que las instancias de <strong><code>RoomDatabase</code></strong> son costosas en cuanto a tiempo, por lo que será necesario lanzar estas llamadas mediante corrutinas. <strong>La manera recomendada es la de crear los métodos de la interfaces DAO como métodos de suspensión</strong>.</p>
<p>Dentro de un DAO podemos crear dos tipos distintos de métodos, de conveniencia y de búsqueda.</p>
<div style="page-break-after:always;"></div>
<h3 id="métodos-de-conveniencia">Métodos de conveniencia </h3>
<p>Estos métodos nos permiten realizar las operaciones básicas de <strong>inserción</strong>, <strong>modificación</strong> y <strong>eliminación</strong> de registros en la BD sin tener que escribir ningún tipo de código SQL. A estos métodos se le pasa la entidad sobre la que se quiera trabajar y es la propia librería Room la encargada de crear la sentencia SQL usando la clave primaria para la identificación del registro sobre el que se quiere operar. Deberán ir precedidos por las anotaciones <strong>@Insert, @Delete o @Update</strong> dependiendo de la necesidad. Por ejemplo, en nuestro caso, para la entidad <strong><code>ClienteEntity</code></strong> crearemos <strong><code>ClienteDao</code></strong> en su mismo paquete de la siguiente manera...</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Dao</span>
<span class="token keyword keyword-interface">interface</span> ClienteDao <span class="token punctuation">{</span>
    <span class="token annotation builtin">@Insert</span><span class="token punctuation">(</span>onConflict <span class="token operator">=</span> OnConflictStrategy<span class="token punctuation">.</span>REPLACE<span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">insert</span><span class="token punctuation">(</span>cliente <span class="token operator">:</span> ClienteEntity<span class="token punctuation">)</span>

    <span class="token annotation builtin">@Delete</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">delete</span><span class="token punctuation">(</span>cliente <span class="token operator">:</span> ClienteEntity<span class="token punctuation">)</span>

    <span class="token annotation builtin">@Update</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">update</span><span class="token punctuation">(</span>cliente <span class="token operator">:</span> ClienteEntity<span class="token punctuation">)</span>

    <span class="token comment">// Si no pasamos la entidad y lo que tenemos </span>
    <span class="token comment">// es la PK deberemos hacer una consulta con @Query</span>
    <span class="token comment">// pasando la PK como parámetro.</span>
    <span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"DELETE FROM clientes WHERE dni = :dni"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">deleteByDni</span><span class="token punctuation">(</span>dni<span class="token operator">:</span> String<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><p>Como se puede ver en el anterior código, es una manera muy sencilla de realizar las operaciones básicas usando las anotaciones correspondientes y pasando como parámetro al método la Entidad sobre la que queremos operar. En el caso de la inserción podemos ver que se puede utilizar la propiedad <strong><code>onConflict</code></strong> para indicar si queremos reemplazar el elemento existente por el nuevo en caso de que coincida la <strong>clave primaria</strong> (en este caso el dni).</p>
<div style="page-break-after:always;"></div>
<h3 id="métodos-de-búsqueda">Métodos de búsqueda </h3>
<p>Estos métodos serán los que crearemos para realizar consultas sobre la BD y tendrán que ir precedidos por la anotación <strong>@Query</strong>. Esta anotación permite que se añada como parámetro una cadena con la sentencia SQL para la consulta. Por ejemplo, podemos completar nuestro DAO de la siguiente manera....</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Dao</span>
<span class="token keyword keyword-interface">interface</span> ClienteDao <span class="token punctuation">{</span>
    <span class="token comment">// ... aquí van los métodos de conveniencia CRUD</span>

    <span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"SELECT * FROM clientes"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>ClienteEntity<span class="token operator">&gt;</span>

    <span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"SELECT * FROM clientes WHERE dni IN (:dni)"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getFromDni</span><span class="token punctuation">(</span>dni <span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> ClienteEntity

    <span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"SELECT COUNT(*) FROM clientes"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Int
<span class="token punctuation">}</span>
</code></pre><p>Los dos primeros métodos de nuestro DAO, son dos métodos de consulta, el primero devuelve una <strong>lista de Clientes</strong> mientras que el segundo devuelve <strong>un solo cliente</strong>. Como ya hemos visto, Room permite pasar un parámetro o una lista de parámetros dentro de la propia consulta siempre que lo precedamos con <strong><code>:</code></strong> y que coincida en nombre con el parámetro que le llega al método.</p>
<h4 id="selección-de-un-subconjunto-de-columnas">Selección de un subconjunto de columnas </h4>
<p>En muchas ocasiones no será necesaria toda la información de la tabla, sino que solo necesitaremos recuperar algunas de las columnas a modo de <strong>DTO</strong>. Aunque se puede recuperar toda la informació y posteriormente realizar un filtrado de esta, para ahorrar recursos es interesante consultar solamente los campos que se necesitan. Para ello, necesitaremos crear un objeto del tipo de columnas que queramos devolver, esto se podrá hacer usando una <strong><code>data class</code></strong> nueva para esos datos:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">NombreApellidosDTO</span><span class="token punctuation">(</span>
    <span class="token annotation builtin">@ColumnInfo</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"nombre"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> nombre<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token annotation builtin">@ColumnInfo</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"apellidos"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> apellidos<span class="token operator">:</span> String
<span class="token punctuation">)</span>
</code></pre><p>Y solamente se tendrá que indicar en el Dao que el método correspondiente devolverá los datos de este tipo:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"SELECT nombre, apellidos FROM clientes"</span></span><span class="token punctuation">)</span>
<span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getNombreApellido</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>NombreApellidosDTO<span class="token operator">&gt;</span>
</code></pre><p>Por ejemplo, si quisiéramos recuperar el mapeo de la clase <strong><code>ClienteConPedidos</code></strong> que definimos en la relación uno a muchos entre objetos. Deberíamos marcar el método con anotación <strong><code>@Transaction</code></strong>, pues en su interior hay una anotación <strong><code>@Relation</code></strong> que se deberá completar antes de devolver la instancia del objetos.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Transaction</span>
<span class="token comment">// Fíjate que no indicamos la relación en la consulta ya está definida</span>
<span class="token comment">// en el objeto a recuperar.</span>
<span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"SELECT * FROM clientes"</span></span><span class="token punctuation">)</span>
<span class="token comment">// Fíjate que devuelve una lista de objetos ClienteConPedidos</span>
<span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getPedidos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>ClienteConPedidos<span class="token operator">&gt;</span> 
</code></pre><p>Sin embargo si la relación ya la definimos al definir las entidades podemos hacerlo mediante un <strong><code>JOIN</code></strong> sin necesidad de definir el objeto <strong><code>ClienteConPedidos</code></strong> ni ningún tipo de DTO de la siguiente manera.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"SELECT * FROM clientes JOIN pedidos ON clientes.dni = pedidos.dni_cliente"</span></span><span class="token punctuation">)</span>
<span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">obtenerClientesConPedidos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Map<span class="token operator">&lt;</span>ClienteEntity<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>PedidoEntity<span class="token operator">&gt;</span><span class="token operator">&gt;</span>
</code></pre><p>Fíjate que en este caso, el método devuelve un <strong><code>Map</code></strong> en el que la clave es un <strong><code>ClienteEntity</code></strong> y el valor todos los <strong><code>PedidoEntity</code></strong> asociados a este.</p>
<div style="page-break-after:always;"></div>
<h2 id="crear-la-base-de-datos-room-y-consumirla">Crear la Base de Datos Room y consumirla </h2>
<p>El último elemento que quedaría por crear sería la <a href="https://developer.android.com/training/data-storage/room#database">RoomDatabase</a>. Este elemento es el que <strong>se encargará de crear la base de datos a partir de las entidades definidas</strong> y las operaciones que se realizarán sobre estas a partir de los DAOs de nuestra app. Por tanto, es el elemento que enlaza a los dos anteriores. Para ello crearemos una clase abstracta que deberá de heredar de <strong><code>RoomDatabase</code></strong> y a la que etiquetaremos con la anotación <strong><code>@Database</code></strong> con las propiedades versión y entities. La primera propiedad especificará la versión de la BD, mientras que en entities indicaremos la entidad o entidades asociadas a esta.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Database</span><span class="token punctuation">(</span>
    entities <span class="token operator">=</span> <span class="token punctuation">[</span>ClienteEntity<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">,</span> PedidoEntity<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    version <span class="token operator">=</span> <span class="token number">1</span>
<span class="token punctuation">)</span>
<span class="token comment">// Indicaremos las conversiones de tipos que hemos definido para </span>
<span class="token comment">// nuestra base de datos si las hay. Ej. LocalDate ↔ Long o Bitmap ↔ byte[]</span>
<span class="token annotation builtin">@TypeConverters</span><span class="token punctuation">(</span>RoomConverters<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">)</span>
<span class="token keyword keyword-abstract">abstract</span> <span class="token keyword keyword-class">class</span> TiendaDB<span class="token operator">:</span> <span class="token function">RoomDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// Cada RoomDatabase definirá métodos abstractos que devolverá </span>
    <span class="token comment">// los tipos de **`DAO`** definidos y cuando instanciemos </span>
    <span class="token comment">// la base de datos, obtendremos una instancia de </span>
    <span class="token comment">// estos DAOs a través de ellos.</span>
    <span class="token keyword keyword-abstract">abstract</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">clienteDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> ClienteDao
    <span class="token keyword keyword-abstract">abstract</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">pedidoDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> PedidoDao
<span class="token punctuation">}</span>
</code></pre><h2 id="instanciar-la-roomdatabase-para-su-posterior-funcionamiento">Instanciar la RoomDatabase para su posterior funcionamiento </h2>
<p>Una vez creados todos los componentes necesarios para el funcionamiento de Room Database, deberemos poder crear una instancias de la misma. Para ello, podemos definir un método de clase denominado <strong><code>fun getDatabase(context: Context)</code></strong> que usaremos posteriormente para que <strong>Hilt</strong> sepa crear una instancia del mismo e inyectarlo al obtener el DAO como veremos más adelante.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Database</span><span class="token punctuation">(</span>
    entities <span class="token operator">=</span> <span class="token punctuation">[</span>ClienteEntity<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">,</span> PedidoEntity<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    version <span class="token operator">=</span> <span class="token number">1</span>
<span class="token punctuation">)</span>
<span class="token annotation builtin">@TypeConverters</span><span class="token punctuation">(</span>RoomConverters<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">)</span>
<span class="token keyword keyword-abstract">abstract</span> <span class="token keyword keyword-class">class</span> TiendaDB<span class="token operator">:</span> <span class="token function">RoomDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-abstract">abstract</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">clienteDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> ClienteDao
    <span class="token keyword keyword-abstract">abstract</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">pedidoDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> PedidoDao

    <span class="token keyword keyword-companion">companion</span> <span class="token keyword keyword-object">object</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-fun">fun</span> <span class="token function">getDatabase</span><span class="token punctuation">(</span>
            context<span class="token operator">:</span> Context
        <span class="token punctuation">)</span> <span class="token operator">=</span> Room<span class="token punctuation">.</span><span class="token function">databaseBuilder</span><span class="token punctuation">(</span>
            context<span class="token punctuation">,</span>
            TiendaDB<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">.</span>java<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"tienda"</span></span>
        <span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowMainThreadQueries</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">fallbackToDestructiveMigration</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Si te fijas <strong><code>Room.databaseBuilder</code></strong> precisa del <strong>contexto</strong> de la aplicación para poder crear el fichero <strong><code>tienda</code></strong> que contendrá la BD.</p>
<h3 id="preparando-la-base-de-datos-y-los-daos-con-hilt">Preparando la Base de Datos y los DAOs con Hilt </h3>
<p>En el fichero <strong><code>AppModule.kt</code></strong> dentro del paquete <strong><code>.di</code></strong> prepararemos la inyección de dependencias de la siguiente manera:</p>
<ol>
<li>
<p>Para inyectar la BD definimos <strong><code>provideTiendaDatabase</code></strong> que llama al método estático <strong><code>TiendaDB.getDatabase(context)</code></strong> para instanciarla. Fíjate que el contexto de la aplicación se inyecta usando la anotación <strong><code>@ApplicationContext</code></strong> de Hilt.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Provides</span>
<span class="token annotation builtin">@Singleton</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">provideTiendaDatabase</span><span class="token punctuation">(</span>
    <span class="token annotation builtin">@ApplicationContext</span> context<span class="token operator">:</span> Context
<span class="token punctuation">)</span><span class="token operator">:</span> TiendaDB <span class="token operator">=</span> TiendaDB<span class="token punctuation">.</span><span class="token function">getDatabase</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>
</code></pre></li>
<li>
<p>Para inyectar los DAOs, definimos <strong><code>provideClienteDao</code></strong> y <strong><code>providePedidoDao</code></strong> que inyectan los DAOs de la BD. Fíjate que se inyecta la BD y se llama a los métodos abstractos que devuelven los DAOs.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Provides</span>
<span class="token annotation builtin">@Singleton</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">provideClienteDao</span><span class="token punctuation">(</span>
    tiendaDB<span class="token operator">:</span> TiendaDB
<span class="token punctuation">)</span><span class="token operator">:</span> ClienteDao <span class="token operator">=</span> tiendaDB<span class="token punctuation">.</span><span class="token function">clienteDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token annotation builtin">@Provides</span>
<span class="token annotation builtin">@Singleton</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">providePedidoDao</span><span class="token punctuation">(</span>
    tiendaDB<span class="token operator">:</span> TiendaDB
<span class="token punctuation">)</span><span class="token operator">:</span> PedidoDao <span class="token operator">=</span> tiendaDB<span class="token punctuation">.</span><span class="token function">pedidoDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></li>
</ol>
<h3 id="inyectando-los-daos-en-los-repositorios">Inyectando los DAOs en los repositorios </h3>
<p>Para inyectar los DAOs en los repositorios, deberemos añadirlos como propiedades privadas en los constructores de estos. Por ejemplo, en el caso del repositorio de <strong><code>ClienteRepository</code></strong> deberemos añadir el DAO de <strong><code>ClienteDao</code></strong> como parámetro del constructor.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-class">class</span> ClienteRepository <span class="token annotation builtin">@Inject</span> <span class="token keyword keyword-constructor">constructor</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> clienteDao<span class="token operator">:</span> ClienteDao
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="admonition tip">
<p class="admonition-title">Importante</p>
<p>Recuerda que, tal y como hicimos a principio de curso con las clases de prueba. Deberemos definir los métodos de extensión que transformen un <strong><code>ClienteEntity</code></strong> en un objeto <strong><code>Cliente</code></strong> del modelo para su uso en el ViewModel y viceversa.</p>
</div>
<h3 id="cargando-datos-de-prueba-en-la-bd">Cargando datos de prueba en la BD </h3>
<p>Este proceso se puede realizar de diferentes maneras, pero una forma de hacerlo de manera centralizada es en el momento de carga de la aplicación, por ejemplo invalidando el método <strong><code>onCreate</code></strong> de la clase <strong><code>TiendaAplication</code></strong> que recordemos hereda de <strong><code>Application</code></strong>.</p>
<p>Fíjate que a través de la anotación <strong><code>@Inject</code></strong> <strong>Hilt</strong> será capaz de crear una instancia de <strong><code>ClienteDao</code></strong> y por ende de <strong><code>TiendaDB</code></strong> en la propiedad <strong><code>daoClientes</code></strong> la primera vez que se use al ejecutar el método <strong><code>onCreate</code></strong> para cargar los datos de prueba.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@HiltAndroidApp</span>
<span class="token keyword keyword-class">class</span> TiendaAplication<span class="token operator">:</span> <span class="token function">Application</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token annotation builtin">@Inject</span>
    <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> daoClientes<span class="token operator">:</span> ClienteDao

    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        runBlocking <span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>daoClientes<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                daoClientes<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>
                    <span class="token function">ClienteEntity</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"12345678A"</span></span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"Juan"</span></span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"Pérez"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                daoClientes<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>
                    <span class="token function">ClienteEntity</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"87654321B"</span></span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"María"</span></span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"García"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="ubicación-de-la-base-de-datos-en-el-dispositivo">Ubicación de la Base de Datos en el dispositivo </h2>
<div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px">
<div style="width: 70%">
<p>Si abrimos el <strong>Device Explorer</strong> de Android Studio, podremos ver que se ha creado un fichero <strong><code>tienda</code></strong> en la ruta <strong><code>data/data/&lt;nombre_paquete&gt;/databases</code></strong>. Este fichero es la base de datos que hemos creado y que se ha guardado en el dispositivo. Podremos ver su contenido si la copiamos con cualquier herramienta de gestión de bases de datos SQLite como <strong>DBeaver</strong>.</p>
</div>
<div style="width: auto">
<p align="center" class="puml"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" data-diagram-type="SALT" height="138px" preserveAspectRatio="none" style="width:155px;height:138px;background:#FFFFFF;" version="1.1" viewBox="0 0 155 138" width="155px" zoomAndPan="magnify"><defs></defs><g><rect fill="#EEEEEE" height="18.0938" style="stroke:#000000;stroke-width:1;" width="79" x="6" y="6"></rect><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="42.6914" x="8" y="20.457">Pixel 3a</text><line style="stroke:#000000;stroke-width:1;" x1="74" x2="74" y1="6" y2="24.0938"></line><polygon fill="#000000" points="77,12,83,12,80,19.0938" style="stroke:#000000;stroke-width:1;"></polygon><path d="M17,31.1875 L17,32.1875 L25,32.1875 L25,31.1875 L17,31.1875 M17,33.1875 L17,39.0975 C17,39.1475 17.04,39.1875 17.09,39.1875 L24.9,39.1875 C24.95,39.1875 24.99,39.1475 24.99,39.0975 L24.99,33.1875 L22.02,33.1875 L22.02,34.2175 L19.99,34.2175 L19.99,33.1875 L16.99,33.1875" fill="#000000"></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="30.0234" x="26" y="39.5508">[data]</text><path d="M27,46.2813 L27,47.2813 L35,47.2813 L35,46.2813 L27,46.2813 M27,48.2813 L27,54.1913 C27,54.2413 27.04,54.2813 27.09,54.2813 L34.9,54.2813 C34.95,54.2813 34.99,54.2413 34.99,54.1913 L34.99,48.2813 L32.02,48.2813 L32.02,49.3113 L29.99,49.3113 L29.99,48.2813 L26.99,48.2813" fill="#000000"></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="30.0234" x="36" y="54.6445">[data]</text><path d="M37,61.375 L37,62.375 L45,62.375 L45,61.375 L37,61.375 M37,63.375 L37,69.285 C37,69.335 37.04,69.375 37.09,69.375 L44.9,69.375 C44.95,69.375 44.99,69.335 44.99,69.285 L44.99,63.375 L42.02,63.375 L42.02,64.405 L39.99,64.405 L39.99,63.375 L36.99,63.375" fill="#000000"></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="102.041" x="46" y="69.7383">[com.pmdm.tienda]</text><path d="M47,76.4688 L47,77.4688 L55,77.4688 L55,76.4688 L47,76.4688 M47,78.4688 L47,84.3788 C47,84.4288 47.04,84.4688 47.09,84.4688 L54.9,84.4688 C54.95,84.4688 54.99,84.4288 54.99,84.3788 L54.99,78.4688 L52.02,78.4688 L52.02,79.4988 L49.99,79.4988 L49.99,78.4688 L46.99,78.4688" fill="#000000"></path><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="62.0449" x="56" y="84.832">[databases]</text><text fill="#0000FF" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="35.3379" x="56" y="99.9258">tienda</text><text fill="#0000FF" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="64.0078" x="56" y="115.0195">tienda-shm</text><text fill="#0000FF" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="58.6758" x="56" y="130.1133">tienda-wal</text><rect fill="none" height="2" style="stroke:#888888;stroke-width:1;" width="2" x="9" y="33.6406"></rect><rect fill="none" height="2" style="stroke:#888888;stroke-width:1;" width="2" x="19" y="48.7344"></rect><line style="stroke:#888888;stroke-width:1;" x1="10" x2="10" y1="36.6406" y2="49.7344"></line><line style="stroke:#888888;stroke-width:1;" x1="10" x2="18" y1="49.7344" y2="49.7344"></line><rect fill="none" height="2" style="stroke:#888888;stroke-width:1;" width="2" x="29" y="63.8281"></rect><line style="stroke:#888888;stroke-width:1;" x1="20" x2="20" y1="51.7344" y2="64.8281"></line><line style="stroke:#888888;stroke-width:1;" x1="20" x2="28" y1="64.8281" y2="64.8281"></line><rect fill="none" height="2" style="stroke:#888888;stroke-width:1;" width="2" x="39" y="78.9219"></rect><line style="stroke:#888888;stroke-width:1;" x1="30" x2="30" y1="66.8281" y2="79.9219"></line><line style="stroke:#888888;stroke-width:1;" x1="30" x2="38" y1="79.9219" y2="79.9219"></line><line style="stroke:#888888;stroke-width:1;" x1="40" x2="40" y1="81.9219" y2="95.0156"></line><line style="stroke:#888888;stroke-width:1;" x1="40" x2="48" y1="95.0156" y2="95.0156"></line><line style="stroke:#888888;stroke-width:1;" x1="40" x2="40" y1="81.9219" y2="110.1094"></line><line style="stroke:#888888;stroke-width:1;" x1="40" x2="48" y1="110.1094" y2="110.1094"></line><line style="stroke:#888888;stroke-width:1;" x1="40" x2="40" y1="81.9219" y2="125.2031"></line><line style="stroke:#888888;stroke-width:1;" x1="40" x2="48" y1="125.2031" y2="125.2031"></line><!--SRC=[VO_TQi9048NlvodcgcZ4eB5Q2KMaDcqH0w69tfGAcsHh5pQxiZj9BT9txsfeeHHahiuvt_pDBJ53bac28y0s4GSkSSIs0CSCUdXxbUl3xALan5wXzq__6eMk_7rLLZu9hies-qFdp7BRsiuljDGcp6NDPvxNjdZUXR1ltwlBm0UJ3lXoDNVw_0yaaYbQnojikB52AnpwmI0O-q4dgpakcSB13GwduMWSZYQuY38ynLteF2Qh9a2hQrDmB8Kb8_AQt8GkB5d3yBbM92eUuabrihYBQVHZOgGQORIgk29ORk8MmYTDwLxJ6PvSz-y4OSgDEmmtCTppDrPBSgs5BeNQXRZE7lfJM36rgzdEBU8M5jejC9yXHkat]--></g></svg></p></div>
</div>
<p>Aunque hay formas de mantener versiones de la BD y <strong><a href="https://developer.android.com/training/data-storage/room/migrating-db-versions">migrar de una a otra</a></strong>. La opción más sencilla es ante un cambio en alguna de las entidades sería eliminar la BD y volver a crearla. Para ello, podemos usar la propiedad <strong><code>fallbackToDestructiveMigration()</code></strong> en el método <strong><code>databaseBuilder</code></strong> que hemos usado para crear la BD o símplmente borrarla usando el <strong>Device Explorer</strong> y volver a ejecutar la app.</p>
<h2 id="inspeccionando-y-depurando-la-bd-con-database-inspector">Inspeccionando y depurando la BD con Database Inspector </h2>
<p>Existe la posibilidad de probar las consultas e inspeccionar la base de datos en tiempo de ejecución. Para ello, la herramienta de Android Studio <strong><a href="https://developer.android.com/studio/inspect/database">Database Inspector</a></strong>.</p>

      </div>
      
      
    
    
    
    
    
    
  
    </body></html>