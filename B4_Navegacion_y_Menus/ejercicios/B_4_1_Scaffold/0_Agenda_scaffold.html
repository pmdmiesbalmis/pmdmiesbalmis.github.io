<!DOCTYPE html><html><head>
      <title>PMDM 2췈 DAM Tema 4</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}@font-face{font-family:"Material Icons";font-style:normal;font-weight:400;src:local("Material Icons"),local("MaterialIcons-Regular"),url("data:application/x-font-woff;charset=utf-8;base64,d09GRgABAAAAAAfIAAsAAAAADDAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAADMAAABCsP6z7U9TLzIAAAE8AAAARAAAAFZW7kosY21hcAAAAYAAAADTAAACjtP6ytBnbHlmAAACVAAAAxgAAAQ4zRtvlGhlYWQAAAVsAAAALwAAADYRwZsnaGhlYQAABZwAAAAcAAAAJAeKAzxobXR4AAAFuAAAABIAAAA8OGQAAGxvY2EAAAXMAAAAIAAAACAG5AfwbWF4cAAABewAAAAfAAAAIAEfAERuYW1lAAAGDAAAAVcAAAKFkAhoC3Bvc3QAAAdkAAAAYgAAAK2vz7wkeJxjYGRgYOBikGPQYWB0cfMJYeBgYGGAAJAMY05meiJQDMoDyrGAaQ4gZoOIAgCKIwNPAHicY2BkPsQ4gYGVgYOpk+kMAwNDP4RmfM1gxMjBwMDEwMrMgBUEpLmmMDgwVLy4xKzzX4chhrmK4QpQmBEkBwAZygyweJzFkr0NwjAQhZ+TEP6CRUfHBEwRUWaQTICyQbpMwRCskA5RUIONxG0RnnNpKAIV4qzPku/8c353ACYAYrIjCWCuMAh2ptf0/hiL3p/gyPUWa3osqlt0L1zu9r71z8dGrJRykFoauXQd932Lj5vhG+MjxGeYI8MKETObMpslf5EyP8tg+vHun5r539PvlvXzaVhRFVQDTPEWKVQR90KhnnC5Ek67vUKN4VuFasM/ldARj43CCkCsEjpJSoVVgRyU0GVSK6wUpFFCx8lFgX0BiXpRPQB4nE2TTWjcRhTH3xttpDhxN7uxPlp3u/FK7moRPixafRijNosxSw/LUsIwNcaEHPZggo/FmEKMCKWU4kNOOftQSlhE8alnH0Ix9BqWnHooPRrTQ0+mnu2bXTu2pPdGM9LM/6c3fwECTM4gBBMYQNqxzLrZAjqYSlqu2TAHZQA0/DQJH6FtzqGDnvbt4Ggwvzw/nL8EfH8kW0fsuRqhgWXZnY7M1picaUL7Du5BHeDzMIl83dAt016wH1qmvtSMo5R6YRJHTR//FXsff/nj/tc/5K9P5d+nP22+fFK5u7v3K39SW3y+OtDKO3L85vD09PD9z5X17a2N1g4tqk01RlqX7gyoEmnsWQtVr4rtZMmukEaFBZxzefkCn11cyKMLZgshRwgTYNoLNXCBz2ja7HvZG7hDpPSNfoo5vs0knK/9hb+rNpu+8kHPgk/Ao4kK3tWtTpSEtvkA9c+wE6UaUdwieNkaHg55tBEtRiEPw1s0+FtrtTcc9two2lhMknV7PZF/cs6+uUFTmpTGbEx7sQCPSLOttHS3GRltqp7SNzVSKzl6aWnZT/CX5k6/v9N3Hh8fHBwffJVjhrC6OgH5dkIt/tPsq+d/PD5Qz7G7efzq1THFjdZVPe/N6ulQ3JnDWSE5junsFsVIiFwL/htf1S5gJ3BfOcUxfHKLnzqpFpyfZ9cX+/5WB6a+Y0pHpzkNrYNVDwMsikK+y7WuLCRg/oFHkA8VT3rDg5ZnU6ktzzINymV0m74Xd5pfIGXyFeVEQSShkzqG7TBBa2OxVRKitLXv7h3uuftXnXq7lz2tZ/WnWa9dx9dCjDhHzmuVQATlmljr9dZErUydSo2Hbi/b1vXtrOeGCk2/8s3ZlO8+ueJT8BVlw5pGw2oYccdSiHHqx0RlabHqdNR9jAETl6PreJcPBnnfpTLnOQ8C3OV8AmQGzouV1iZdeb5SSIoVc8W8/kcDtksUH5FrU6/aqBqNWcMEzxG4DAQ14qRQhi9mWU0rzepKezbjfgCwQKxVYq5ajRgpRqy45CqwkJydcEkbTkvRz8P5/2ZpDTN4nGNgZGBgAOKb6v+/xvPbfGXgZmEAgeuB2kkI+v8bFgbmKiCXg4EJJAoAPyAKhQB4nGNgZGBg1vmvwxDDwgACQJKRARXwAwAzZQHQeJxjYQCCFAYGFgbSMQAcWACdAAAAAAAAAAwALgBgAIQAmADSAQgBIgE8AVABoAHeAfwCHHicY2BkYGDgZ7BgYGMAASYg5gJCBob/YD4DAA/hAWQAeJxlkbtuwkAURMc88gApQomUJoq0TdIQzEOpUDokKCNR0BuzBiO/tF6QSJcPyHflE9Klyyekz2CuG8cr7547M3d9JQO4xjccnJ57vid2cMHqxDWc40G4Tv1JuEF+Fm6ijRfhM+oz4Ra6eBVu4wZvvMFpXLIa40PYQQefwjVc4Uu4Tv1HuEH+FW7i1mkKn6Hj3Am3sHC6wm08Ou8tpSZGe1av1PKggjSxPd8zJtSGTuinyVGa6/Uu8kxZludCmzxMEzV0B6U004k25W35fj2yNlCBSWM1paujKFWZSbfat+7G2mzc7weiu34aczzFNYGBhgfLfcV6iQP3ACkSaj349AxXSN9IT0j16JepOb01doiKbNWt1ovippz6sVYYwsXgX2rGVFIkq7Pl2PNrI6qW6eOshj0xaSq9mpNEZIWs8LZUfOouNkVXxp/d5woqebeYIf4D2J1ywQB4nG3LOw6AIBAE0B384B+PAkgEa+QwNnYmHt+EpXSal5lkSBBnoP8oCFSo0aCFRIceA0ZMmLFAYSW88rmvtMUjG3RiQ9HvpfusM6zWNmtc5H/iPewha50tOt5PS/QBx2IeSwAA") format("woff")}.admonition{box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12),0 3px 1px -2px rgba(0,0,0,.2);position:relative;margin:1.5625em 0;padding:0 1.2rem;border-left:.4rem solid rgba(68,138,255,.8);border-radius:.2rem;background-color:rgba(255,255,255,.05);overflow:auto}.admonition>p{margin-top:.8rem}.admonition>.admonition-title{margin:0 -1.2rem;padding:.8rem 1.2rem .8rem 3.6rem;border-bottom:1px solid rgba(68,138,255,.2);background-color:rgba(68,138,255,.1);font-weight:700}.admonition>.admonition-title:before{position:absolute;left:1.2rem;font-size:1.5rem;color:rgba(68,138,255,.8);content:"\E3C9"}.admonition>.admonition-title:before{font-family:Material Icons;font-style:normal;font-variant:normal;font-weight:400;line-height:2rem;text-transform:none;white-space:nowrap;speak:none;word-wrap:normal;direction:ltr}.admonition.abstract,.admonition.summary,.admonition.tldr{border-left-color:rgba(0,176,255,.8)}.admonition.abstract>.admonition-title,.admonition.summary>.admonition-title,.admonition.tldr>.admonition-title{background-color:rgba(0,176,255,.1);border-bottom-color:rgba(0,176,255,.2)}.admonition.abstract>.admonition-title:before,.admonition.summary>.admonition-title:before,.admonition.tldr>.admonition-title:before{color:#00b0ff;content:"\E8D2"}.admonition.hint,.admonition.tip{border-left-color:rgba(0,191,165,.8)}.admonition.hint>.admonition-title,.admonition.tip>.admonition-title{background-color:rgba(0,191,165,.1);border-bottom-color:rgba(0,191,165,.2)}.admonition.hint>.admonition-title:before,.admonition.tip>.admonition-title:before{color:#00bfa5;content:"\E80E"}.admonition.info,.admonition.todo{border-left-color:rgba(0,184,212,.8)}.admonition.info>.admonition-title,.admonition.todo>.admonition-title{background-color:rgba(0,184,212,.1);border-bottom-color:rgba(0,184,212,.2)}.admonition.info>.admonition-title:before,.admonition.todo>.admonition-title:before{color:#00b8d4;content:"\E88E"}.admonition.check,.admonition.done,.admonition.success{border-left-color:rgba(0,200,83,.8)}.admonition.check>.admonition-title,.admonition.done>.admonition-title,.admonition.success>.admonition-title{background-color:rgba(0,200,83,.1);border-bottom-color:rgba(0,200,83,.2)}.admonition.check>.admonition-title:before,.admonition.done>.admonition-title:before,.admonition.success>.admonition-title:before{color:#00c853;content:"\E876"}.admonition.faq,.admonition.help,.admonition.question{border-left-color:rgba(100,221,23,.8)}.admonition.faq>.admonition-title,.admonition.help>.admonition-title,.admonition.question>.admonition-title{background-color:rgba(100,221,23,.1);border-bottom-color:rgba(100,221,23,.2)}.admonition.faq>.admonition-title:before,.admonition.help>.admonition-title:before,.admonition.question>.admonition-title:before{color:#64dd17;content:"\E887"}.admonition.attention,.admonition.caution,.admonition.warning{border-left-color:rgba(255,145,0,.8)}.admonition.attention>.admonition-title,.admonition.caution>.admonition-title,.admonition.warning>.admonition-title{background-color:rgba(255,145,0,.1);border-bottom-color:rgba(255,145,0,.2)}.admonition.attention>.admonition-title:before{color:#ff9100;content:"\E417"}.admonition.caution>.admonition-title:before,.admonition.warning>.admonition-title:before{color:#ff9100;content:"\E002"}.admonition.fail,.admonition.failure,.admonition.missing{border-left-color:rgba(255,82,82,.8)}.admonition.fail>.admonition-title,.admonition.failure>.admonition-title,.admonition.missing>.admonition-title{background-color:rgba(255,82,82,.1);border-bottom-color:rgba(255,82,82,.2)}.admonition.fail>.admonition-title:before,.admonition.failure>.admonition-title:before,.admonition.missing>.admonition-title:before{color:#ff5252;content:"\E14C"}.admonition.bug,.admonition.danger,.admonition.error{border-left-color:rgba(255,23,68,.8)}.admonition.bug>.admonition-title,.admonition.danger>.admonition-title,.admonition.error>.admonition-title{background-color:rgba(255,23,68,.1);border-bottom-color:rgba(255,23,68,.2)}.admonition.danger>.admonition-title:before{color:#ff1744;content:"\E3E7"}.admonition.error>.admonition-title:before{color:#ff1744;content:"\E14C"}.admonition.bug>.admonition-title:before{color:#ff1744;content:"\E868"}.admonition.example,.admonition.snippet{border-left-color:rgba(0,184,212,.8)}.admonition.example>.admonition-title,.admonition.snippet>.admonition-title{background-color:rgba(0,184,212,.1);border-bottom-color:rgba(0,184,212,.2)}.admonition.example>.admonition-title:before,.admonition.snippet>.admonition-title:before{color:#00b8d4;content:"\E242"}.admonition.cite,.admonition.quote{border-left-color:rgba(158,158,158,.8)}.admonition.cite>.admonition-title,.admonition.quote>.admonition-title{background-color:rgba(158,158,158,.1);border-bottom-color:rgba(158,158,158,.2)}.admonition.cite>.admonition-title:before,.admonition.quote>.admonition-title:before{color:#9e9e9e;content:"\E244"}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
@font-face {
  font-family: 'Catamaran';
  font-style: normal;
  font-weight: 400;
  src: url(https://fonts.gstatic.com/s/catamaran/v19/o-0bIpQoyXQa2RxT7-5B6Ryxs2E_6n1iPHjd5a7dvg.ttf) format('truetype');
}
.markdown-preview.markdown-preview .caso_estudio {
  background-color: #f5f5f5;
  border: 2px solid #969696;
  padding: 15px;
  margin-top: 15px;
  margin-bottom: 15px;
  border-radius: 5px;
  box-shadow: 0 0 7px 0 rgba(78, 120, 158, 0.1);
}
.markdown-preview.markdown-preview .ejercicio {
  background-color: #f5faf5;
  border: 2px solid #969b96;
  padding-left: 15px;
  padding-right: 15px;
  margin-top: 15px;
  margin-bottom: 15px;
  border-radius: 5px;
  box-shadow: 0 0 7px 0 rgba(78, 120, 158, 0.1);
}
.markdown-preview.markdown-preview .contenedor {
  display: flex;
  justify-content: center;
  margin: 30px auto 30px auto;
}
.markdown-preview.markdown-preview .fondo {
  background: url(https://programacioniesbalmis.github.io/Imagenes/BannersMoodle/banner.png);
  background-size: cover;
  width: 75%;
  height: 160px;
  border-radius: 10px;
  position: relative;
}
.markdown-preview.markdown-preview .cita {
  font-family: Arial;
  font-style: italic;
  font-weight: 600;
  text-align: justify;
  line-height: 1.5rem;
  opacity: 0.6;
  color: white;
  padding: 5rem;
  position: relative;
  top: 50%;
  left: 50%;
  font-size: 1.3rem;
  transform: translate(-50%, -50%);
}
.markdown-preview.markdown-preview .abre_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-left: 30px;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, -15%);
}
.markdown-preview.markdown-preview .cierra_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-right: 30px;
  right: 0%;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, 55%);
}
.markdown-preview.markdown-preview .autor {
  font-family: Arial;
  color: white;
  margin: 0px;
  padding-left: 30px;
  position: absolute;
  top: 83%;
  font-size: 1rem;
}
.markdown-preview.markdown-preview .flotante {
  display: flex;
  margin-top: 15px;
  margin-bottom: 15px;
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .flotante {
    justify-content: center;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .flotante {
    justify-content: space-between;
  }
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .flotante {
    flex-direction: column;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .flotante {
    flex-direction: row;
  }
}
.markdown-preview.markdown-preview .flotante_izq {
  margin-right: 15px;
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .flotante_izq {
    width: 100%;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .flotante_izq {
    width: auto;
  }
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .flotante_der {
    width: 100%;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .flotante_der {
    width: auto;
  }
}
.markdown-preview.markdown-preview .galeria_imagenes {
  display: flex;
  justify-content: space-evenly;
  align-items: center;
  margin-top: 15px;
  margin-bottom: 15px;
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .galeria_imagenes {
    flex-direction: column;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .galeria_imagenes {
    flex-direction: row;
  }
}

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="a침adiendo-scaffold-la-agenda">A침adiendo Scaffold la Agenda </h1>
<p><a href="./0_Agenda_scaffold.pdf">Descargar estos apuntes</a></p>
<h2 id="mortar_board-caso-de-estudio">游꿉 Caso de Estudio </h2>
<p>Vamos a partir de nuestra Agenda de Contactos con Intents en la que ten칤amos dos pantallas, una para mostrar los contactos y otra para a침adirlos y vamos a a침adir a ambas alg칰n tipo de Scaffold.</p>
<h3 id="paso-1-a침adir-scaffold-al-formulario-de-a침adir-o-editar-un-contacto">Paso 1: A침adir Scaffold al formulario de a침adir o editar un contacto. </h3>
<div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px">
<div style="width: 50%">
<p>Empezaremos con el formulario de contactos. Para ello, vamos a pasarlo a침adir un Sacffold como el de la imagen donde tenemos:</p>
<ol>
<li>Un <strong><code>TopAppBar</code></strong> con un t칤tulo y un bot칩n de navegaci칩n para volver atr치s.</li>
<li>El <strong><code>FAB</code></strong> de guardar los datos del contacto, pasar치 a estar gestionado por el Scaffold.</li>
<li>Adem치s el <strong><code>SnackBarHost</code></strong> del Scaffold, nos permitir치 mostrar mensajes de error a trav칠s de un <strong><code>SnackBar</code></strong> personalizado tal y como se indica en la imagen.</li>
</ol>
</div>
<div style="width: auto">
<img height="300px" src="../../assets/imagenes/ejercicios4_1/ejercicio0/form_contacto.png">
</div>
</div>
<p>Vemos pues el proceso de c칩mo realizarlo:</p>
<ol>
<li>
<p>Vamos a borrar la funci칩n composable <strong><code>BoxScope.Pie</code></strong> que emit칤a el FAB  o el SnackBar, pues ahora lo har치 el Scaffold. <strong>Los par치metros que recibiese <code>CuerpoFormulario</code> para usar en dicho composable ya no ser치n necesarios</strong>.</p>
</li>
<li>
<p>Definiremos un composable que emitir치 nuestro TopAppBar en nuestro caso usaremos <strong><code>CenterAlignedTopAppBar</code></strong> de Material 3 pues no vamos a tener acciones. Adem치s, recibir치 el callback para volver atr치s en la navegaci칩n.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@OptIn</span><span class="token punctuation">(</span>ExperimentalMaterial3Api<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">)</span>
<span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">FormContactoTopAppBar</span><span class="token punctuation">(</span>
    scrollBehavior<span class="token operator">:</span> TopAppBarScrollBehavior <span class="token operator">=</span> TopAppBarDefaults<span class="token punctuation">.</span><span class="token function">pinnedScrollBehavior</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    onNavigateTrasFormContacto<span class="token operator">:</span> <span class="token punctuation">(</span>actualizaContactos<span class="token operator">:</span> Boolean<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">CenterAlignedTopAppBar</span><span class="token punctuation">(</span>
        scrollBehavior <span class="token operator">=</span> scrollBehavior<span class="token punctuation">,</span>
        title <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token function">Text</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token function">stringResource</span><span class="token punctuation">(</span>id <span class="token operator">=</span> R<span class="token punctuation">.</span>string<span class="token punctuation">.</span>app_name<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        navigationIcon <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token function">IconButton</span><span class="token punctuation">(</span>onClick <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">onNavigateTrasFormContacto</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">Icon</span><span class="token punctuation">(</span>
                    painter <span class="token operator">=</span> Filled<span class="token punctuation">.</span><span class="token function">getArrowBackIosIcon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    contentDescription <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Volver a lista de contactos"</span></span><span class="token punctuation">,</span>
                    modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span>ButtonDefaults<span class="token punctuation">.</span>IconSize<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p>Definiremos un composable que emitir치 nuestro <strong><code>FAB</code></strong> del Scaffold para guardar los datos del contacto. Recibir치 el callback para guardar los datos del contacto.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">FabGuardar</span><span class="token punctuation">(</span>onGuardarContacto<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">ExtendedFloatingActionButton</span><span class="token punctuation">(</span>
        text <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">Text</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Guardar"</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        icon <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token function">Icon</span><span class="token punctuation">(</span>
                painter <span class="token operator">=</span> Filled<span class="token punctuation">.</span><span class="token function">getSaveIcon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                contentDescription <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Localized description"</span></span><span class="token punctuation">,</span>
                modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span>FloatingActionButtonDefaults<span class="token punctuation">.</span>LargeIconSize<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        onClick <span class="token operator">=</span> onGuardarContacto
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div style="page-break-after:always;"></div>
</li>
<li>
<p>Para la gesti칩n del <strong><code>SnackBar</code></strong>, tenemos la clase <strong><code>InformacionEstadoUiState</code></strong> definida en la librer칤a de componentes del m칩dulo en <strong><code>com.github.pmdmiesbalmis.components.manejo_errores.InformacionEstadoUiState</code></strong> <strong><a href="https://github.com/pmdmiesbalmis/components/blob/main/components/src/main/java/com/github/pmdmiesbalmis/components/manejo_errores/InformacionEstadoUiState.kt">InformacionEstadoUiState.kt</a></strong>. Esta nos permita gestionar mensajes de estado tales como informaci칩n o error en la UI. En ella, <strong>tendremos tres estados para mostrar el SnackBar</strong>:</p>
<ul>
<li>Uno para ocultarlo</li>
<li>Uno para mostrar informaci칩n.</li>
<li>Uno para mostrar un error.</li>
</ul>
<p>Esta clase gestionar치 el estado de visualizaci칩n del componente definido <strong><code>com.github.pmdmiesbalmis.components.ui.composables</code></strong> <strong><a href="https://github.com/pmdmiesbalmis/components/blob/main/components/src/main/java/com/github/pmdmiesbalmis/components/manejo_errores/InformacionEstadoUiState.kt%5D(https://github.com/pmdmiesbalmis/components/blob/main/components/src/main/java/com/github/pmdmiesbalmis/components/ui/composables/SnackbarCommon.kt)">SnackbarCommon.kt</a></strong>. Esta se <em>emitir치</em> dentro del <strong><code>SnackBarHost</code></strong> del Scaffold.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-fun">fun</span> <span class="token function">SnackbarCommon</span><span class="token punctuation">(</span>informacionEstado<span class="token operator">:</span> InformacionEstadoUiState<span class="token punctuation">)</span>
</code></pre><p>B치sicamente este composable nos permitir치 mostrar un SnackBar con un mensaje de informaci칩n con una barra de progreso circular o un SnackBar con un mensaje de error y un bot칩n para cerrarlo.</p>
 <div style="display: flex; justify-content: space-evenly; align-items: center; margin-top: 15px; margin-bottom: 15px">
 <img height="50" src="../../assets/imagenes/ejercicios4_1/ejercicio0/error.png">
 <img height="50" src="../../assets/imagenes/ejercicios4_1/ejercicio0/progreso.png">
 </div>
 <div style="page-break-after:always;"></div>
</li>
<li>
<p>Ya estamos preparados para a침adir el Scaffold a <strong><code>FormContactoScreen</code></strong> que quedar치 de la siguiente manera...</p>
<p>Primero redefinimos el prototipo pasando <strong>un nuevo par치metro <code>InformacionEstadoUiState</code></strong> para nuestro Scaffold.</p>
<pre data-role="codeBlock" data-info="kotlin { highlight=6 }" class="language-kotlin kotlin" data-line="6"><code><span class="token function">OptIn</span><span class="token punctuation">(</span>ExperimentalMaterial3Api<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">)</span>
<span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">FormContactoScreen</span><span class="token punctuation">(</span>
    contactoState<span class="token operator">:</span> ContactoUiState<span class="token punctuation">,</span>
    validacionContactoState<span class="token operator">:</span> ValidacionContactoUiState<span class="token punctuation">,</span>
    informacionEstado<span class="token operator">:</span> InformacionEstadoUiState<span class="token punctuation">,</span>
    onContactoEvent<span class="token operator">:</span> <span class="token punctuation">(</span>ContactoEvent<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit<span class="token punctuation">,</span>
    onNavigateTrasFormContacto<span class="token operator">:</span> <span class="token punctuation">(</span>actualizaContactos<span class="token operator">:</span> Boolean<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> scrollBehavior <span class="token operator">=</span> TopAppBarDefaults<span class="token punctuation">.</span><span class="token function">enterAlwaysScrollBehavior</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> snackbarHostState <span class="token operator">=</span> remember <span class="token punctuation">{</span> <span class="token function">SnackbarHostState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code><div class="line-highlight-wrapper">




<div aria-hidden="true" class="line-highlight" data-range="6" data-start="6">
</div></div></pre><p>Llamamos al <strong><code>LaunchedEffect</code></strong> para gestionar el estado del <strong><code>SnackBar</code></strong> en el <strong><code>SnackBarHost</code></strong> del <strong><code>Scaffold</code></strong> a trav칠s de la funci칩n <strong><code>CorrutinaGestionSnackBar</code></strong> definida en <strong><code>SnackbarCommon.kt</code></strong>.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token function">CorrutinaGestionSnackBar</span><span class="token punctuation">(</span>
    snackbarHostState <span class="token operator">=</span> snackbarHostState<span class="token punctuation">,</span>
    informacionEstado <span class="token operator">=</span> informacionEstado
<span class="token punctuation">)</span>
<span class="token operator">..</span><span class="token punctuation">.</span>
</code></pre> <div style="page-break-after:always;"></div>
<p>Ya podemos definir el Scaffold con su <strong><code>TopAppBar</code></strong>, <strong><code>FAB</code></strong> y <strong><code>SnackBarHost</code></strong>...</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token function">Scaffold</span><span class="token punctuation">(</span>
    modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">nestedScroll</span><span class="token punctuation">(</span>scrollBehavior<span class="token punctuation">.</span>nestedScrollConnection<span class="token punctuation">)</span><span class="token punctuation">,</span>
    topBar <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token function">FormContactoTopAppBar</span><span class="token punctuation">(</span>
            scrollBehavior <span class="token operator">=</span> scrollBehavior<span class="token punctuation">,</span>
            onNavigateTrasFormContacto <span class="token operator">=</span> onNavigateTrasFormContacto
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    floatingActionButton <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token function">FabGuardar</span><span class="token punctuation">(</span>
            onGuardarContacto <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token function">onContactoEvent</span><span class="token punctuation">(</span>
                    ContactoEvent<span class="token punctuation">.</span><span class="token function">OnSaveContacto</span><span class="token punctuation">(</span>
                        onNavigateTrasFormContacto
                    <span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    snackbarHost <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token function">SnackbarHost</span><span class="token punctuation">(</span>hostState <span class="token operator">=</span> snackbarHostState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Emitiremos un SanackBar u otro dependiendo </span>
            <span class="token comment">// el valor de informacionEstado</span>
            <span class="token function">SnackbarCommon</span><span class="token punctuation">(</span>informacionEstado <span class="token operator">=</span> informacionEstado<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">BoxWithConstraints</span><span class="token punctuation">(</span>
        modifier <span class="token operator">=</span> Modifier
            <span class="token punctuation">.</span><span class="token function">fillMaxSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Contenido del formulario anterior</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div style="page-break-after:always;"></div>
</li>
<li>
<p>Por 칰ltimo, nos queda gestionar el estado de tipo <strong><code>InformacionEstadoUiState</code></strong> en <strong><code>ContactoViewModel.kt</code></strong>, sustituy칠ndolo el actual <strong><code>verSnackBarState</code></strong>. Es por ello que borraremos <strong><code>verSnackBarState</code></strong> y definiremos...</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-var">var</span> informacionEstadoState<span class="token operator">:</span> InformacionEstadoUiState <span class="token keyword keyword-by">by</span> <span class="token function">mutableStateOf</span><span class="token punctuation">(</span>
    InformacionEstadoUiState<span class="token punctuation">.</span><span class="token function">Oculta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-set">set</span>
</code></pre><p>Ahora en la gesti칩n de <strong><code>ContactoEvent</code></strong> al producirse un error en la validaci칩n.</p>
<pre data-role="codeBlock" data-info="kotlin { highlight=[3,12-15] }" class="language-kotlin kotlin" data-line="3,12-15"><code><span class="token operator">..</span><span class="token punctuation">.</span>
<span class="token keyword keyword-is">is</span> ContactoEvent<span class="token punctuation">.</span>OnDismissError <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    validacionContactoState <span class="token operator">=</span> <span class="token function">ValidacionContactoUiState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-is">is</span> ContactoEvent<span class="token punctuation">.</span>OnSaveContacto <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    validacionContactoState <span class="token operator">=</span> validadorContacto<span class="token punctuation">.</span><span class="token function">valida</span><span class="token punctuation">(</span>contactoState<span class="token punctuation">)</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>validacionContactoState<span class="token punctuation">.</span>hayError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token operator">..</span><span class="token punctuation">.</span>
        <span class="token comment">// Guardamos o editamos el contacto</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
        informacionEstadoState <span class="token operator">=</span> InformacionEstadoUiState<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>
            mensaje <span class="token operator">=</span> validacionContactoState<span class="token punctuation">.</span>mensajeError<span class="token operator">!!</span><span class="token punctuation">,</span>
            onDismiss <span class="token operator">=</span> <span class="token punctuation">{</span> informacionEstadoState <span class="token operator">=</span> InformacionEstadoUiState<span class="token punctuation">.</span><span class="token function">Oculta</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">..</span><span class="token punctuation">.</span>
</code><div class="line-highlight-wrapper">

<div aria-hidden="true" class="line-highlight" data-range="3" data-start="3">
</div></div><div class="line-highlight-wrapper">










<div aria-hidden="true" class="line-highlight" data-range="12-15" data-start="12" data-end="15">



</div></div></pre><p>Ya solo quedar칤a pasar este estado desde el VM al <strong><code>FormContactoScreen</code></strong> en la <strong><code>MainActivity</code></strong>. Puedes definir este composable para probarlo.</p>
<pre data-role="codeBlock" data-info="kotlin { highlight=[2,6] }" class="language-kotlin kotlin" data-line="2,6"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">VerFormContacto</span><span class="token punctuation">(</span>vm <span class="token operator">:</span> ContactoViewModel <span class="token operator">=</span> <span class="token function">hiltViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">FormContactoScreen</span><span class="token punctuation">(</span>
        contactoState <span class="token operator">=</span> vm<span class="token punctuation">.</span>contactoState<span class="token punctuation">,</span>
        validacionContactoState <span class="token operator">=</span> vm<span class="token punctuation">.</span>validacionContactoState<span class="token punctuation">,</span>
        informacionEstado <span class="token operator">=</span> vm<span class="token punctuation">.</span>informacionEstadoState<span class="token punctuation">,</span>
        onContactoEvent <span class="token operator">=</span> vm<span class="token operator">::</span>onContactoEvent<span class="token punctuation">,</span>
        onNavigateTrasFormContacto <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code><div class="line-highlight-wrapper">
<div aria-hidden="true" class="line-highlight" data-range="2" data-start="2">
</div></div><div class="line-highlight-wrapper">




<div aria-hidden="true" class="line-highlight" data-range="6" data-start="6">
</div></div></pre></li>
</ol>
<div style="page-break-after:always;"></div>
<h3 id="paso-2-a침adir-scaffold-la-pantalla-de-listar-contactos">Paso 2: A침adir Scaffold la pantalla de listar contactos </h3>
<p>Vamos a pasar la pantalla de listar contactos a un <strong><code>BottomSheetScaffold</code></strong> como el de la imagen...</p>
<div style="display: flex; justify-content: center; align-items: center; margin-top: 15px; margin-bottom: 15px">
    <img height="400" src="../../assets/imagenes/ejercicios4_1/ejercicio0/lista_contactos.png">
</div>
<p>En el vamos a colocar:</p>
<ol>
<li>Un <strong><code>TopAppBar</code></strong> con un t칤tulo y un bot칩n de acci칩n para actualizar la lista de contactos.</li>
<li>Un SnackBarHost para mostrar mensajes de estado donde utilizaremos el <strong><code>SnackbarCommon</code></strong> que definimos en el paso anterior.</li>
<li>Una hoja inferior desplegable modal (<strong><code>BottomSheet</code></strong>) que contendr치 el componente con <strong><code>FilterChips</code></strong> que definimos en temas anteriores y que se encuentra en el <strong><code>.ui.features.components.SeleccionCategorias.kt</code></strong>. Este composable nos permitir치 filtrar los contactos por categor칤as.</li>
<li>Adem치s, definiremos un <strong><code>sheetDragHandle</code></strong> espec칤fico para nuestra hoja inferior, que ser치 un componente <strong><code>Switch</code></strong> que nos permitir치 activar o desactivar los filtros.</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Puesto que al usar un <strong><code>BottomSheetScaffold</code></strong>, no tendremos slot para el FAB, este seguir치 mostr치ndose en el composable con el contenido principal como suced칤a hasta ahora.</p>
</div>
<p>Tambi칠n, modificaremos <strong><code>ListaContatosViewModel</code></strong> para que gestione los nuevos estados de la pantalla, as칤 como el filtrado de los contactos y la acci칩n recarga de los mismos.</p>
<div style="page-break-after:always;"></div>
<p>Vemos pues el proceso de c칩mo realizarlo:</p>
<ol>
<li>
<p>Primero definiremos el <strong><code>sheetDragHandle</code></strong> personalizado para nuestro <strong><code>BottomSheet</code></strong>. Como hemos comentado, <strong>recibir치 un estado que me indicar치 si el filtrado est치 activo o no</strong> y un callback para cambiar dicho estado.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">SwitchActivacionFiltrado</span><span class="token punctuation">(</span>
    modifier<span class="token operator">:</span> Modifier <span class="token operator">=</span> Modifier<span class="token punctuation">,</span>
    filtradoActivoState<span class="token operator">:</span> Boolean<span class="token punctuation">,</span>
    onActivarFiltradoClicked<span class="token operator">:</span> <span class="token punctuation">(</span>Boolean<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Switch</span><span class="token punctuation">(</span>
        modifier <span class="token operator">=</span> modifier<span class="token punctuation">,</span>
        checked <span class="token operator">=</span> filtradoActivoState<span class="token punctuation">,</span>
        onCheckedChange <span class="token operator">=</span> onActivarFiltradoClicked<span class="token punctuation">,</span>
        thumbContent <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token function">Icon</span><span class="token punctuation">(</span>
                painter <span class="token operator">=</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>filtradoActivoState<span class="token punctuation">)</span> Filled<span class="token punctuation">.</span><span class="token function">getFilterListIcon</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
                <span class="token keyword keyword-else">else</span> Filled<span class="token punctuation">.</span><span class="token function">getFilterListOffIcon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                contentDescription <span class="token operator">=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">,</span>
                modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span>SwitchDefaults<span class="token punctuation">.</span>IconSize<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p>Ahora definiremos la <strong><code>CenterAlignedTopAppBar</code></strong> para el <strong><code>BottomSheetScaffold</code></strong>.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@OptIn</span><span class="token punctuation">(</span>ExperimentalMaterial3Api<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">)</span>
<span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">ListaContactosTopAppBar</span><span class="token punctuation">(</span>
    scrollBehavior<span class="token operator">:</span> TopAppBarScrollBehavior <span class="token operator">=</span> TopAppBarDefaults<span class="token punctuation">.</span><span class="token function">pinnedScrollBehavior</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    onActualizaContactos<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit<span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">CenterAlignedTopAppBar</span><span class="token punctuation">(</span>
        scrollBehavior <span class="token operator">=</span> scrollBehavior<span class="token punctuation">,</span>
        title <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token function">Text</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token function">stringResource</span><span class="token punctuation">(</span>id <span class="token operator">=</span> R<span class="token punctuation">.</span>string<span class="token punctuation">.</span>app_name<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        actions <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token function">IconButton</span><span class="token punctuation">(</span>onClick <span class="token operator">=</span> onActualizaContactos<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">Icon</span><span class="token punctuation">(</span>
                    painter <span class="token operator">=</span> Filled<span class="token punctuation">.</span><span class="token function">getRefreshIcon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    contentDescription <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Actualiza contactos"</span></span><span class="token punctuation">,</span>
                    modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span>ButtonDefaults<span class="token punctuation">.</span>IconSize<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div style="page-break-after:always;"></div>
</li>
<li>
<p>Vamos ahora de definir la diferentes partes de nuestro BottomSheetScaffold. Teniendo en cuenta que toda la l칩gica va estar en nuestro ViewModel. En primer lugar definiremos el prototipo, los estados que manejar치 localmente y los <strong><code>LandchedEffect</code></strong> para gestionar que nuestro <strong><code>BottomSheet</code></strong> siempre est칠 visible y el mostrar o ocultar el <strong><code>SnackBar</code></strong> en funci칩n del estado de <strong><code>InformacionEstadoUiState</code></strong>.</p>
<pre data-role="codeBlock" data-info="kotlin { highlight=[7,8,12] }" class="language-kotlin kotlin" data-line="7,8,12"><code><span class="token annotation builtin">@OptIn</span><span class="token punctuation">(</span>ExperimentalMaterial3Api<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">)</span>
<span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">ListaContactosScreen</span><span class="token punctuation">(</span>
    modifier<span class="token operator">:</span> Modifier <span class="token operator">=</span> Modifier<span class="token punctuation">,</span>
    contactosState<span class="token operator">:</span> List<span class="token operator">&lt;</span>ContactoUiState<span class="token operator">&gt;</span><span class="token punctuation">,</span>
    contactoSeleccionadoState<span class="token operator">:</span> ContactoUiState<span class="token operator">?</span><span class="token punctuation">,</span>
    filtradoActivoState<span class="token operator">:</span> Boolean<span class="token punctuation">,</span>
    filtroCategoriaState<span class="token operator">:</span> CatergoriaUiState<span class="token punctuation">,</span>
    informacionEstadoState<span class="token operator">:</span> InformacionEstadoUiState<span class="token punctuation">,</span>
    onActualizaContactos<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit<span class="token punctuation">,</span>
    onActivarFiltradoClicked<span class="token operator">:</span> <span class="token punctuation">(</span>Boolean<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit<span class="token punctuation">,</span>
    onFiltroModificado<span class="token operator">:</span> <span class="token punctuation">(</span>CatergoriaUiState<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit<span class="token punctuation">,</span>
    onContactoClicked<span class="token operator">:</span> <span class="token punctuation">(</span>ContactoUiState<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit<span class="token punctuation">,</span>
    onAddClicked<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit<span class="token punctuation">,</span>
    onEditClicked<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit<span class="token punctuation">,</span>
    onDeleteClicked<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> scrollBehavior <span class="token operator">=</span> TopAppBarDefaults<span class="token punctuation">.</span><span class="token function">pinnedScrollBehavior</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> scaffoldState <span class="token operator">=</span> <span class="token function">rememberBottomSheetScaffoldState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> snackbarHostState <span class="token operator">=</span> remember <span class="token punctuation">{</span> <span class="token function">SnackbarHostState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token keyword keyword-val">val</span> scope <span class="token operator">=</span> <span class="token function">rememberCoroutineScope</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// Corrutina que muestra el bottom sheet si no est치 visible</span>
    <span class="token function">LaunchedEffect</span><span class="token punctuation">(</span>
        key1 <span class="token operator">=</span> <span class="token operator">!</span>scaffoldState<span class="token punctuation">.</span>bottomSheetState<span class="token punctuation">.</span>isVisible<span class="token punctuation">,</span>
        block <span class="token operator">=</span> <span class="token punctuation">{</span> scaffoldState<span class="token punctuation">.</span>bottomSheetState<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>

    <span class="token comment">// Gesti칩n del estado del SnackBar como en la pantalla anterior</span>
    <span class="token function">CorrutinaGestionSnackBar</span><span class="token punctuation">(</span>
        snackbarHostState <span class="token operator">=</span> snackbarHostState<span class="token punctuation">,</span>
        informacionEstado <span class="token operator">=</span> informacionEstadoState
    <span class="token punctuation">)</span>        
    <span class="token operator">..</span><span class="token punctuation">.</span>
</code><div class="line-highlight-wrapper">





<div aria-hidden="true" class="line-highlight" data-range="7" data-start="7">
</div></div><div class="line-highlight-wrapper">






<div aria-hidden="true" class="line-highlight" data-range="8" data-start="8">
</div></div><div class="line-highlight-wrapper">










<div aria-hidden="true" class="line-highlight" data-range="12" data-start="12">
</div></div></pre> <div style="page-break-after:always;"></div>
<p>Veamos las ranuras del <strong><code>BottomSheetScaffold</code></strong>:</p>
<pre data-role="codeBlock" data-info="kotlin { highlight=[11-20] }" class="language-kotlin kotlin" data-line="11-20"><code>    <span class="token function">BottomSheetScaffold</span><span class="token punctuation">(</span>
        sheetContent <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token function">SeleccionCategoriasConFilterChip</span><span class="token punctuation">(</span>
                categoriaState <span class="token operator">=</span> filtroCategoriaState<span class="token punctuation">,</span>
                onCategoriaChanged <span class="token operator">=</span> onFiltroModificado
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        sheetDragHandle <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token function">SwitchActivacionFiltrado</span><span class="token punctuation">(</span>
                filtradoActivoState <span class="token operator">=</span> filtradoActivoState<span class="token punctuation">,</span>
                <span class="token comment">// Cuando se desactive el filtrado, </span>
                <span class="token comment">// cerraremos nuestro BottomSheet</span>
                onActivarFiltradoClicked <span class="token operator">=</span> <span class="token punctuation">{</span> filtradoOn <span class="token operator">-&gt;</span>
                    <span class="token function">onActivarFiltradoClicked</span><span class="token punctuation">(</span>filtradoOn<span class="token punctuation">)</span>
                    scope<span class="token punctuation">.</span><span class="token function">launch</span> <span class="token punctuation">{</span>
                        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>filtradoOn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            scaffoldState<span class="token punctuation">.</span>bottomSheetState<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        sheetPeekHeight <span class="token operator">=</span> <span class="token number">45</span><span class="token punctuation">.</span>dp<span class="token punctuation">,</span>
        sheetShape <span class="token operator">=</span> BottomSheetDefaults<span class="token punctuation">.</span>ExpandedShape<span class="token punctuation">,</span>
        scaffoldState <span class="token operator">=</span> scaffoldState<span class="token punctuation">,</span>
        modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">nestedScroll</span><span class="token punctuation">(</span>scrollBehavior<span class="token punctuation">.</span>nestedScrollConnection<span class="token punctuation">)</span><span class="token punctuation">,</span>
        topBar <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token function">ListaContactosTopAppBar</span><span class="token punctuation">(</span>
                scrollBehavior <span class="token operator">=</span> scrollBehavior<span class="token punctuation">,</span>
                onActualizaContactos <span class="token operator">=</span> onActualizaContactos
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        snackbarHost <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token function">SnackbarHost</span><span class="token punctuation">(</span>hostState <span class="token operator">=</span> snackbarHostState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">SnackbarCommon</span><span class="token punctuation">(</span>informacionEstado <span class="token operator">=</span> informacionEstadoState<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Contenido principal de la pantalla con la lista y el FAB</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="line-highlight-wrapper">









<div aria-hidden="true" class="line-highlight" data-range="11-20" data-start="11" data-end="20">









</div></div></pre></li>
</ol>
<div style="page-break-after:always;"></div>
<p>Ahora realizaremos los cambios en el ViewModel en <strong><code>ListaContactosViewModel.kt</code></strong> para que gestione los nuevos estados de la pantalla, as칤 como el filtrado de los contactos y la acci칩n recarga de los mismos.</p>
<p>A침adiremos pues las siguientes propiedades...</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-var">var</span> filtradoActivoState<span class="token operator">:</span> Boolean <span class="token keyword keyword-by">by</span> <span class="token function">mutableStateOf</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-set">set</span>

<span class="token keyword keyword-var">var</span> filtroCategoriaState<span class="token operator">:</span> CatergoriaUiState 
<span class="token keyword keyword-by">by</span> <span class="token function">mutableStateOf</span><span class="token punctuation">(</span><span class="token function">CatergoriaUiState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-set">set</span>

<span class="token keyword keyword-var">var</span> informacionEstadoState<span class="token operator">:</span> InformacionEstadoUiState 
<span class="token keyword keyword-by">by</span> <span class="token function">mutableStateOf</span><span class="token punctuation">(</span>InformacionEstadoUiState<span class="token punctuation">.</span><span class="token function">Oculta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-set">set</span>
</code></pre><p>A침adiremos una nueva <strong>funci칩n de extensi칩n para filtrar los contactos</strong> que cumplan con el predicado definido en el estado <strong><code>filtroCategoriaState</code></strong>.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> ContactoUiState<span class="token punctuation">.</span><span class="token function">predicadoFiltro</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>
    <span class="token keyword keyword-var">var</span> cumpleFiltro <span class="token operator">=</span> <span class="token operator">!</span>filtradoActivoState

    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cumpleFiltro<span class="token punctuation">)</span> <span class="token comment">// Est치 en alguna de las categoirias seleccionadas</span>
        cumpleFiltro <span class="token operator">=</span> categorias<span class="token punctuation">.</span>familia <span class="token operator">&amp;&amp;</span> filtroCategoriaState<span class="token punctuation">.</span>familia <span class="token operator">||</span>
                categorias<span class="token punctuation">.</span>amigos <span class="token operator">&amp;&amp;</span> filtroCategoriaState<span class="token punctuation">.</span>amigos <span class="token operator">||</span>
                categorias<span class="token punctuation">.</span>trabajo <span class="token operator">&amp;&amp;</span> filtroCategoriaState<span class="token punctuation">.</span>trabajo <span class="token operator">||</span>
                categorias<span class="token punctuation">.</span>emergencias <span class="token operator">&amp;&amp;</span> filtroCategoriaState<span class="token punctuation">.</span>emergencias

    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cumpleFiltro<span class="token punctuation">)</span> <span class="token comment">// El contacto no est치 en ninguna de las categorias seleccionadas</span>
        cumpleFiltro <span class="token operator">=</span> <span class="token operator">!</span>categorias<span class="token punctuation">.</span>familia <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>filtroCategoriaState<span class="token punctuation">.</span>familia <span class="token operator">&amp;&amp;</span>
                <span class="token operator">!</span>categorias<span class="token punctuation">.</span>amigos <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>filtroCategoriaState<span class="token punctuation">.</span>amigos <span class="token operator">&amp;&amp;</span>
                <span class="token operator">!</span>categorias<span class="token punctuation">.</span>trabajo <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>filtroCategoriaState<span class="token punctuation">.</span>trabajo <span class="token operator">&amp;&amp;</span>
                <span class="token operator">!</span>categorias<span class="token punctuation">.</span>emergencias <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>filtroCategoriaState<span class="token punctuation">.</span>emergencias

    <span class="token keyword keyword-return">return</span> cumpleFiltro
<span class="token punctuation">}</span>
</code></pre><div style="page-break-after:always;"></div>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-fun">fun</span> <span class="token function">onActivarFiltradoClicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    filtradoActivoState <span class="token operator">=</span> <span class="token operator">!</span>filtradoActivoState
    <span class="token function">cargaContactos</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-fun">fun</span> <span class="token function">onFiltroModificado</span><span class="token punctuation">(</span>categorias<span class="token operator">:</span> CatergoriaUiState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    filtroCategoriaState <span class="token operator">=</span> categorias<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">cargaContactos</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">deseleccionaContacto</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    contatoSleccionadoState <span class="token operator">=</span> <span class="token keyword keyword-null">null</span>
<span class="token punctuation">}</span>

<span class="token comment">// Funci칩n de suspensi칩n que accede a los datos del repositorio y </span>
<span class="token comment">// si es necesario alg칰n filtro lo aplica.</span>
<span class="token keyword keyword-private">private</span> <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getContactos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>ContactoUiState<span class="token operator">&gt;</span> <span class="token operator">=</span> contactoRepository<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span><span class="token function">toContactoUiState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token function">filter</span> <span class="token punctuation">{</span> c <span class="token operator">-&gt;</span> c<span class="token punctuation">.</span><span class="token function">predicadoFiltro</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// Funci칩n que se encarga de cargar los contactos y gestionar los estados</span>
<span class="token comment">// notificados en el SnackBarHost. Si se produce alg칰n error, se mostrar치</span>
<span class="token comment">// un SnackBar con un mensaje de error.</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">cargaContactos</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">deseleccionaContacto</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    informacionEstadoState <span class="token operator">=</span> InformacionEstadoUiState<span class="token punctuation">.</span><span class="token function">Informacion</span><span class="token punctuation">(</span>
        mensaje <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Cargando contactos..."</span></span><span class="token punctuation">,</span>
        muestraProgreso <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">)</span>
    viewModelScope<span class="token punctuation">.</span><span class="token function">launch</span> <span class="token punctuation">{</span>
        runCatching <span class="token punctuation">{</span>
            contactosState <span class="token operator">=</span> <span class="token function">getContactos</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">onSuccess</span> <span class="token punctuation">{</span>
            informacionEstadoState <span class="token operator">=</span> InformacionEstadoUiState<span class="token punctuation">.</span><span class="token function">Oculta</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">onFailure</span> <span class="token punctuation">{</span>
            Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"ListaContactosViewModel"</span></span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"Cargando Contactos: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">it<span class="token punctuation">.</span>localizedMessage</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            informacionEstadoState <span class="token operator">=</span> InformacionEstadoUiState<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>
                mensaje <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Error al cargar los contactos"</span></span><span class="token punctuation">,</span>
                onDismiss <span class="token operator">=</span> <span class="token punctuation">{</span> informacionEstadoState <span class="token operator">=</span> InformacionEstadoUiState<span class="token punctuation">.</span><span class="token function">Oculta</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Nada m치s crearse el viewModel cargamos los contactos</span>
<span class="token keyword keyword-init">init</span> <span class="token punctuation">{</span> <span class="token function">cargaContactos</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
</code></pre><div style="page-break-after:always;"></div>
<p>Por 칰ltimo, nos queda la gesti칩n del borrado de un contacto gestionando los mensajes de estado y error en el <strong><code>SnackBarHost</code></strong> de forma similar a como lo hemos hecho al cargar los contactos.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-fun">fun</span> <span class="token function">onItemListaContatoEvent</span><span class="token punctuation">(</span>e<span class="token operator">:</span> ItemListaContactosEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-when">when</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-is">is</span> ItemListaContactosEvent<span class="token punctuation">.</span>OnClickContacto <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            contatoSleccionadoState <span class="token operator">=</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>contatoSleccionadoState<span class="token operator">?</span><span class="token punctuation">.</span>id <span class="token operator">!=</span> e<span class="token punctuation">.</span>contacto<span class="token punctuation">.</span>id<span class="token punctuation">)</span> e<span class="token punctuation">.</span>contacto <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-null">null</span>
        <span class="token punctuation">}</span>

        <span class="token keyword keyword-is">is</span> ItemListaContactosEvent<span class="token punctuation">.</span>OnDeleteContacto <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            informacionEstadoState <span class="token operator">=</span> InformacionEstadoUiState<span class="token punctuation">.</span><span class="token function">Informacion</span><span class="token punctuation">(</span>
                mensaje <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Borrando a </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">contatoSleccionadoState<span class="token operator">!!</span><span class="token punctuation">.</span>nombre</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">,</span>
                muestraProgreso <span class="token operator">=</span> <span class="token boolean">true</span>
            <span class="token punctuation">)</span>
            viewModelScope<span class="token punctuation">.</span><span class="token function">launch</span> <span class="token punctuation">{</span>
                runCatching <span class="token punctuation">{</span>
                    contactoRepository<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>contatoSleccionadoState<span class="token operator">!!</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span>
                    contactosState <span class="token operator">=</span> <span class="token function">getContactos</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">onSuccess</span> <span class="token punctuation">{</span>
                    informacionEstadoState <span class="token operator">=</span> InformacionEstadoUiState<span class="token punctuation">.</span><span class="token function">Oculta</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">onFailure</span> <span class="token punctuation">{</span>
                    Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>
                        <span class="token string-literal singleline"><span class="token string">"ListaContactosViewModel"</span></span><span class="token punctuation">,</span> 
                        <span class="token string-literal singleline"><span class="token string">"Borrando Contacto: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">it<span class="token punctuation">.</span>localizedMessage</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span>
                    <span class="token punctuation">)</span>
                    informacionEstadoState <span class="token operator">=</span> InformacionEstadoUiState<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>
                        mensaje <span class="token operator">=</span> 
                        <span class="token string-literal singleline"><span class="token string">"Error al borrar el contacto </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">contatoSleccionadoState<span class="token operator">!!</span><span class="token punctuation">.</span>nombre</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span>
                        onDismiss <span class="token operator">=</span> <span class="token punctuation">{</span> 
                            informacionEstadoState <span class="token operator">=</span> InformacionEstadoUiState<span class="token punctuation">.</span><span class="token function">Oculta</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div style="page-break-after:always;"></div>
<p>Ya solo quedar칤a pasar estos estados desde el VM al <strong><code>ListaContactosScreen</code></strong> en la <strong><code>MainActivity</code></strong>. Puedes definir este composable para probarlo.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">VerListaContactos</span><span class="token punctuation">(</span>vm <span class="token operator">:</span> ListaContactosViewModel <span class="token operator">=</span> <span class="token function">hiltViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">ListaContactosScreen</span><span class="token punctuation">(</span>
        contactosState <span class="token operator">=</span> vm<span class="token punctuation">.</span>contactosState<span class="token punctuation">,</span>
        contactoSeleccionadoState <span class="token operator">=</span> vm<span class="token punctuation">.</span>contatoSleccionadoState<span class="token punctuation">,</span>
        filtradoActivoState <span class="token operator">=</span> vm<span class="token punctuation">.</span>filtradoActivoState<span class="token punctuation">,</span>
        filtroCategoriaState <span class="token operator">=</span> vm<span class="token punctuation">.</span>filtroCategoriaState<span class="token punctuation">,</span>
        informacionEstadoState <span class="token operator">=</span> vm<span class="token punctuation">.</span>informacionEstadoState<span class="token punctuation">,</span>
        onActualizaContactos <span class="token operator">=</span>  <span class="token punctuation">{</span> vm<span class="token punctuation">.</span><span class="token function">cargaContactos</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        onActivarFiltradoClicked <span class="token operator">=</span> <span class="token punctuation">{</span> vm<span class="token punctuation">.</span><span class="token function">onActivarFiltradoClicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        onFiltroModificado <span class="token operator">=</span> <span class="token punctuation">{</span> categorias <span class="token operator">-&gt;</span> vm<span class="token punctuation">.</span><span class="token function">onFiltroModificado</span><span class="token punctuation">(</span>categorias<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        onContactoClicked <span class="token operator">=</span> <span class="token punctuation">{</span> c <span class="token operator">-&gt;</span>
            vm<span class="token punctuation">.</span><span class="token function">onItemListaContatoEvent</span><span class="token punctuation">(</span>ItemListaContactosEvent<span class="token punctuation">.</span><span class="token function">OnClickContacto</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        onAddClicked <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        onEditClicked <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        onDeleteClicked <span class="token operator">=</span> <span class="token punctuation">{</span>
            vm<span class="token punctuation">.</span><span class="token function">onItemListaContatoEvent</span><span class="token punctuation">(</span>ItemListaContactosEvent<span class="token punctuation">.</span>OnDeleteContacto<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="admonition info">
<p class="admonition-title">Soluci칩n</p>
<p>Si te surge alguna duda o tienes dificultades para completar este caso de estudio. Puedes descargar la soluci칩n de este caso de estudio del siguiente enlace: <strong><a href="../../assets/codigo/ejercicio4_1/ejercicio0/0_AgendaScaffold_recurso.zip">propuesta de soluci칩n</a></strong></p>
</div>

      </div>
      
      
    
    
    
    
    
    
  
    </body></html>