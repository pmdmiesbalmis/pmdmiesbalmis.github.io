<!DOCTYPE html><html><head>
      <title>PMDM 2º DAM  Tema 4.2 - Navegación</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.25/dist/katex.min.css">
      
      
      
      
      
      <style>
      @import url(https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css);
code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}@font-face{font-family:"Material Icons";font-style:normal;font-weight:400;src:local("Material Icons"),local("MaterialIcons-Regular"),url("data:application/x-font-woff;charset=utf-8;base64,d09GRgABAAAAAAfIAAsAAAAADDAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAADMAAABCsP6z7U9TLzIAAAE8AAAARAAAAFZW7kosY21hcAAAAYAAAADTAAACjtP6ytBnbHlmAAACVAAAAxgAAAQ4zRtvlGhlYWQAAAVsAAAALwAAADYRwZsnaGhlYQAABZwAAAAcAAAAJAeKAzxobXR4AAAFuAAAABIAAAA8OGQAAGxvY2EAAAXMAAAAIAAAACAG5AfwbWF4cAAABewAAAAfAAAAIAEfAERuYW1lAAAGDAAAAVcAAAKFkAhoC3Bvc3QAAAdkAAAAYgAAAK2vz7wkeJxjYGRgYOBikGPQYWB0cfMJYeBgYGGAAJAMY05meiJQDMoDyrGAaQ4gZoOIAgCKIwNPAHicY2BkPsQ4gYGVgYOpk+kMAwNDP4RmfM1gxMjBwMDEwMrMgBUEpLmmMDgwVLy4xKzzX4chhrmK4QpQmBEkBwAZygyweJzFkr0NwjAQhZ+TEP6CRUfHBEwRUWaQTICyQbpMwRCskA5RUIONxG0RnnNpKAIV4qzPku/8c353ACYAYrIjCWCuMAh2ptf0/hiL3p/gyPUWa3osqlt0L1zu9r71z8dGrJRykFoauXQd932Lj5vhG+MjxGeYI8MKETObMpslf5EyP8tg+vHun5r539PvlvXzaVhRFVQDTPEWKVQR90KhnnC5Ek67vUKN4VuFasM/ldARj43CCkCsEjpJSoVVgRyU0GVSK6wUpFFCx8lFgX0BiXpRPQB4nE2TTWjcRhTH3xttpDhxN7uxPlp3u/FK7moRPixafRijNosxSw/LUsIwNcaEHPZggo/FmEKMCKWU4kNOOftQSlhE8alnH0Ix9BqWnHooPRrTQ0+mnu2bXTu2pPdGM9LM/6c3fwECTM4gBBMYQNqxzLrZAjqYSlqu2TAHZQA0/DQJH6FtzqGDnvbt4Ggwvzw/nL8EfH8kW0fsuRqhgWXZnY7M1picaUL7Du5BHeDzMIl83dAt016wH1qmvtSMo5R6YRJHTR//FXsff/nj/tc/5K9P5d+nP22+fFK5u7v3K39SW3y+OtDKO3L85vD09PD9z5X17a2N1g4tqk01RlqX7gyoEmnsWQtVr4rtZMmukEaFBZxzefkCn11cyKMLZgshRwgTYNoLNXCBz2ja7HvZG7hDpPSNfoo5vs0knK/9hb+rNpu+8kHPgk/Ao4kK3tWtTpSEtvkA9c+wE6UaUdwieNkaHg55tBEtRiEPw1s0+FtrtTcc9two2lhMknV7PZF/cs6+uUFTmpTGbEx7sQCPSLOttHS3GRltqp7SNzVSKzl6aWnZT/CX5k6/v9N3Hh8fHBwffJVjhrC6OgH5dkIt/tPsq+d/PD5Qz7G7efzq1THFjdZVPe/N6ulQ3JnDWSE5junsFsVIiFwL/htf1S5gJ3BfOcUxfHKLnzqpFpyfZ9cX+/5WB6a+Y0pHpzkNrYNVDwMsikK+y7WuLCRg/oFHkA8VT3rDg5ZnU6ktzzINymV0m74Xd5pfIGXyFeVEQSShkzqG7TBBa2OxVRKitLXv7h3uuftXnXq7lz2tZ/WnWa9dx9dCjDhHzmuVQATlmljr9dZErUydSo2Hbi/b1vXtrOeGCk2/8s3ZlO8+ueJT8BVlw5pGw2oYccdSiHHqx0RlabHqdNR9jAETl6PreJcPBnnfpTLnOQ8C3OV8AmQGzouV1iZdeb5SSIoVc8W8/kcDtksUH5FrU6/aqBqNWcMEzxG4DAQ14qRQhi9mWU0rzepKezbjfgCwQKxVYq5ajRgpRqy45CqwkJydcEkbTkvRz8P5/2ZpDTN4nGNgZGBgAOKb6v+/xvPbfGXgZmEAgeuB2kkI+v8bFgbmKiCXg4EJJAoAPyAKhQB4nGNgZGBg1vmvwxDDwgACQJKRARXwAwAzZQHQeJxjYQCCFAYGFgbSMQAcWACdAAAAAAAAAAwALgBgAIQAmADSAQgBIgE8AVABoAHeAfwCHHicY2BkYGDgZ7BgYGMAASYg5gJCBob/YD4DAA/hAWQAeJxlkbtuwkAURMc88gApQomUJoq0TdIQzEOpUDokKCNR0BuzBiO/tF6QSJcPyHflE9Klyyekz2CuG8cr7547M3d9JQO4xjccnJ57vid2cMHqxDWc40G4Tv1JuEF+Fm6ijRfhM+oz4Ra6eBVu4wZvvMFpXLIa40PYQQefwjVc4Uu4Tv1HuEH+FW7i1mkKn6Hj3Am3sHC6wm08Ou8tpSZGe1av1PKggjSxPd8zJtSGTuinyVGa6/Uu8kxZludCmzxMEzV0B6U004k25W35fj2yNlCBSWM1paujKFWZSbfat+7G2mzc7weiu34aczzFNYGBhgfLfcV6iQP3ACkSaj349AxXSN9IT0j16JepOb01doiKbNWt1ovippz6sVYYwsXgX2rGVFIkq7Pl2PNrI6qW6eOshj0xaSq9mpNEZIWs8LZUfOouNkVXxp/d5woqebeYIf4D2J1ywQB4nG3LOw6AIBAE0B384B+PAkgEa+QwNnYmHt+EpXSal5lkSBBnoP8oCFSo0aCFRIceA0ZMmLFAYSW88rmvtMUjG3RiQ9HvpfusM6zWNmtc5H/iPewha50tOt5PS/QBx2IeSwAA") format("woff")}.admonition{box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12),0 3px 1px -2px rgba(0,0,0,.2);position:relative;margin:1.5625em 0;padding:0 1.2rem;border-left:.4rem solid rgba(68,138,255,.8);border-radius:.2rem;background-color:rgba(255,255,255,.05);overflow:auto}.admonition>p{margin-top:.8rem}.admonition>.admonition-title{margin:0 -1.2rem;padding:.8rem 1.2rem .8rem 3.6rem;border-bottom:1px solid rgba(68,138,255,.2);background-color:rgba(68,138,255,.1);font-weight:700}.admonition>.admonition-title:before{position:absolute;left:1.2rem;font-size:1.5rem;color:rgba(68,138,255,.8);content:"\E3C9"}.admonition>.admonition-title:before{font-family:Material Icons;font-style:normal;font-variant:normal;font-weight:400;line-height:2rem;text-transform:none;white-space:nowrap;speak:none;word-wrap:normal;direction:ltr}.admonition.abstract,.admonition.summary,.admonition.tldr{border-left-color:rgba(0,176,255,.8)}.admonition.abstract>.admonition-title,.admonition.summary>.admonition-title,.admonition.tldr>.admonition-title{background-color:rgba(0,176,255,.1);border-bottom-color:rgba(0,176,255,.2)}.admonition.abstract>.admonition-title:before,.admonition.summary>.admonition-title:before,.admonition.tldr>.admonition-title:before{color:#00b0ff;content:"\E8D2"}.admonition.hint,.admonition.tip{border-left-color:rgba(0,191,165,.8)}.admonition.hint>.admonition-title,.admonition.tip>.admonition-title{background-color:rgba(0,191,165,.1);border-bottom-color:rgba(0,191,165,.2)}.admonition.hint>.admonition-title:before,.admonition.tip>.admonition-title:before{color:#00bfa5;content:"\E80E"}.admonition.info,.admonition.todo{border-left-color:rgba(0,184,212,.8)}.admonition.info>.admonition-title,.admonition.todo>.admonition-title{background-color:rgba(0,184,212,.1);border-bottom-color:rgba(0,184,212,.2)}.admonition.info>.admonition-title:before,.admonition.todo>.admonition-title:before{color:#00b8d4;content:"\E88E"}.admonition.check,.admonition.done,.admonition.success{border-left-color:rgba(0,200,83,.8)}.admonition.check>.admonition-title,.admonition.done>.admonition-title,.admonition.success>.admonition-title{background-color:rgba(0,200,83,.1);border-bottom-color:rgba(0,200,83,.2)}.admonition.check>.admonition-title:before,.admonition.done>.admonition-title:before,.admonition.success>.admonition-title:before{color:#00c853;content:"\E876"}.admonition.faq,.admonition.help,.admonition.question{border-left-color:rgba(100,221,23,.8)}.admonition.faq>.admonition-title,.admonition.help>.admonition-title,.admonition.question>.admonition-title{background-color:rgba(100,221,23,.1);border-bottom-color:rgba(100,221,23,.2)}.admonition.faq>.admonition-title:before,.admonition.help>.admonition-title:before,.admonition.question>.admonition-title:before{color:#64dd17;content:"\E887"}.admonition.attention,.admonition.caution,.admonition.warning{border-left-color:rgba(255,145,0,.8)}.admonition.attention>.admonition-title,.admonition.caution>.admonition-title,.admonition.warning>.admonition-title{background-color:rgba(255,145,0,.1);border-bottom-color:rgba(255,145,0,.2)}.admonition.attention>.admonition-title:before{color:#ff9100;content:"\E417"}.admonition.caution>.admonition-title:before,.admonition.warning>.admonition-title:before{color:#ff9100;content:"\E002"}.admonition.fail,.admonition.failure,.admonition.missing{border-left-color:rgba(255,82,82,.8)}.admonition.fail>.admonition-title,.admonition.failure>.admonition-title,.admonition.missing>.admonition-title{background-color:rgba(255,82,82,.1);border-bottom-color:rgba(255,82,82,.2)}.admonition.fail>.admonition-title:before,.admonition.failure>.admonition-title:before,.admonition.missing>.admonition-title:before{color:#ff5252;content:"\E14C"}.admonition.bug,.admonition.danger,.admonition.error{border-left-color:rgba(255,23,68,.8)}.admonition.bug>.admonition-title,.admonition.danger>.admonition-title,.admonition.error>.admonition-title{background-color:rgba(255,23,68,.1);border-bottom-color:rgba(255,23,68,.2)}.admonition.danger>.admonition-title:before{color:#ff1744;content:"\E3E7"}.admonition.error>.admonition-title:before{color:#ff1744;content:"\E14C"}.admonition.bug>.admonition-title:before{color:#ff1744;content:"\E868"}.admonition.example,.admonition.snippet{border-left-color:rgba(0,184,212,.8)}.admonition.example>.admonition-title,.admonition.snippet>.admonition-title{background-color:rgba(0,184,212,.1);border-bottom-color:rgba(0,184,212,.2)}.admonition.example>.admonition-title:before,.admonition.snippet>.admonition-title:before{color:#00b8d4;content:"\E242"}.admonition.cite,.admonition.quote{border-left-color:rgba(158,158,158,.8)}.admonition.cite>.admonition-title,.admonition.quote>.admonition-title{background-color:rgba(158,158,158,.1);border-bottom-color:rgba(158,158,158,.2)}.admonition.cite>.admonition-title:before,.admonition.quote>.admonition-title:before{color:#9e9e9e;content:"\E244"}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

@font-face {
  font-family: 'Catamaran';
  font-style: normal;
  font-weight: 400;
  src: url(https://fonts.gstatic.com/s/catamaran/v28/o-0bIpQoyXQa2RxT7-5B6Ryxs2E_6n1iPHjd5a7dvg.ttf) format('truetype');
}
.markdown-preview.markdown-preview .caso_estudio {
  background-color: #f5f5f5;
  border: 2px solid #969696;
  padding: 15px;
  margin-top: 15px;
  margin-bottom: 15px;
  border-radius: 5px;
  box-shadow: 0 0 7px 0 rgba(78, 120, 158, 0.1);
}
@page a4landscape {
  size: A4 landscape;
  margin: 1cm;
}
@page a4portrait {
  size: A4 portrait;
  margin: 1cm 1cm 2.5cm 1cm;
}
.markdown-preview.markdown-preview .landscape {
  page: a4landscape;
}
.markdown-preview.markdown-preview .portrait {
  page: a4portrait;
}
.markdown-preview.markdown-preview .ejercicio {
  background-color: #f5faf5;
  border: 2px solid #969b96;
  padding-left: 15px;
  padding-right: 15px;
  margin-top: 15px;
  margin-bottom: 15px;
  border-radius: 5px;
  box-shadow: 0 0 7px 0 rgba(78, 120, 158, 0.1);
}
.markdown-preview.markdown-preview .contenedor {
  display: flex;
  justify-content: center;
  margin: 30px auto 30px auto;
}
.markdown-preview.markdown-preview .fondo {
  background: url(https://programacioniesbalmis.github.io/Imagenes/BannersMoodle/banner.png);
  background-size: cover;
  width: 75%;
  height: 160px;
  border-radius: 10px;
  position: relative;
}
.markdown-preview.markdown-preview .cita {
  font-family: Arial;
  font-style: italic;
  font-weight: 600;
  text-align: justify;
  line-height: 1.5rem;
  opacity: 0.6;
  color: white;
  padding: 5rem;
  position: relative;
  top: 50%;
  left: 50%;
  font-size: 1.3rem;
  transform: translate(-50%, -50%);
}
.markdown-preview.markdown-preview .abre_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-left: 30px;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, -15%);
}
.markdown-preview.markdown-preview .cierra_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-right: 30px;
  right: 0%;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, 55%);
}
.markdown-preview.markdown-preview .autor {
  font-family: Arial;
  color: white;
  margin: 0px;
  padding-left: 30px;
  position: absolute;
  top: 83%;
  font-size: 1rem;
}
.markdown-preview.markdown-preview .flotante {
  display: flex;
  margin-top: 15px;
  margin-bottom: 15px;
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .flotante {
    justify-content: center;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .flotante {
    justify-content: space-between;
  }
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .flotante {
    flex-direction: column;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .flotante {
    flex-direction: row;
  }
}
.markdown-preview.markdown-preview .flotante_izq {
  margin-right: 15px;
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .flotante_izq {
    width: 100%;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .flotante_izq {
    width: auto;
  }
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .flotante_der {
    width: 100%;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .flotante_der {
    width: auto;
  }
}
.markdown-preview.markdown-preview .galeria_imagenes {
  display: flex;
  justify-content: space-evenly;
  align-items: center;
  margin-top: 15px;
  margin-bottom: 15px;
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .galeria_imagenes {
    flex-direction: column;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .galeria_imagenes {
    flex-direction: row;
  }
}

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="tema-42---navegación">Tema 4.2 - Navegación </h1>
<p>Descargar estos apuntes <a href="./Tema_4_2_navegacion.pdf">pdf</a> o <a href="./Tema_4_2_navegacion.html">html</a></p>
<h2 id="índice">Índice </h2>

<div class="md-toc">
<div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:18px">
          <a href="#introducción" class="md-toc-link">
            <p>Introducción</p>

          </a></div><details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#conceptos-básicos" class="md-toc-link"><p>Conceptos Básicos</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#dependencias-necesarias" class="md-toc-link">
            <p>Dependencias necesarias</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#navcontroller" class="md-toc-link">
            <p>NavController</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#navhost" class="md-toc-link">
            <p>NavHost</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#ejemplo-básico-de-navegación" class="md-toc-link"><p>Ejemplo básico de navegación</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#implementación-mínima" class="md-toc-link">
            <p>Implementación mínima</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#refactorizando-con-buenas-prácticas" class="md-toc-link">
            <p>Refactorizando con buenas prácticas</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#pasando-datos-entre-pantallas" class="md-toc-link"><p>Pasando datos entre pantallas</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#estrategias-para-pasar-datos-entre-pantallas" class="md-toc-link">
            <p>Estrategias para pasar datos entre pantallas</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#paso-de-argumentos-de-navegación" class="md-toc-link">
            <p>Paso de argumentos de navegación</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#integrando-hilt--viewmodel--animaciones" class="md-toc-link"><p>Integrando Hilt + ViewModel + Animaciones</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#cambiando-las-transiciones-entre-pantallas" class="md-toc-link">
            <p>Cambiando las transiciones entre pantallas</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#integrando-los-viewmodels-en-la-navegación" class="md-toc-link">
            <p>Integrando los ViewModels en la navegación</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:18px">
          <a href="#gestionar-grafos-de-navegación-complejos" class="md-toc-link">
            <p>Gestionar grafos de navegación complejos</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:18px">
          <a href="#integrado-navegación-y-navigationbar" class="md-toc-link">
            <p>Integrado navegación y NavigationBar</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:18px">
          <a href="#anexo-i---integrado-navegación-y-navigationdrawer" class="md-toc-link">
            <p>Anexo I - Integrado navegación y NavigationDrawer</p>

          </a></div>
</div>
<div style="page-break-after:always;"></div>
<h2 id="introducción">Introducción </h2>
<ul>
<li>
<p><strong>Navegación con Jetpack Compose</strong></p>
<ul>
<li>
<p>Documentación oficial general tanto con XML como Compose UI: <strong><a href="https://developer.android.com/guide/navigation/principles">Principles of navigation</a></strong></p>
</li>
<li>
<p>Documentación oficial compose: <strong><a href="https://developer.android.com/jetpack/compose/navigation">Navigation with Compose</a></strong></p>
</li>
<li>
<p>Codelab Básico Oficial de Google: <strong><a href="https://developer.android.com/codelabs/basic-android-kotlin-compose-navigation#0">Navigation with Compose</a></strong></p>
</li>
<li>
<p>Codelab Avanzado Oficial de Google: <strong><a href="https://developer.android.com/codelabs/jetpack-compose-navigation#0">Navigation with Compose</a></strong></p>
</li>
<li>
<p>Seguridad de tipos en la navegación (Vídeo Inglés) <strong><a href="https://www.youtube.com/watch?v=8m1W4PyYMYQ">Android Developers</a></strong></p>
</li>
<li>
<p><mark><strong>New</strong></mark> Navegación con seguridad de tipos (Vídeo Castellano): <strong><a href="https://www.youtube.com/watch?v=1OxiEaEWEe4">AristiDevs</a></strong></p>
</li>
<li>
<p>Navegación en Jetpack Compose (Lista de Reproducción): <strong><a href="https://www.youtube.com/watch?v=glyqjzkc4fk&amp;list=PLSrm9z4zp4mFYcmFGcJmdsps_lpsaWvKM">Stevdza-San</a></strong></p>
</li>
<li>
<p>Compartir datos entre pantallas (Vídeo Inglés): <strong><a href="https://www.youtube.com/watch?v=h61Wqy3qcKg&amp;t=596s">Philipp Lackner</a></strong></p>
</li>
<li>
<p>Navegación con seguridad de tipos (Vídeo Inglés): <strong><a href="https://www.youtube.com/watch?v=qBxaZ071N0c">Philipp Lackner</a></strong></p>
</li>
</ul>
</li>
</ul>
<p>La necesidad de navegar entre pantallas es una de las características más importantes de cualquier aplicación. Android Jetpack Compose proporciona una biblioteca de navegación que le permite navegar entre pantallas, pasar datos, administrar el historial de navegación y mucho más.</p>
<p>Esta biblioteca, <strong>inicialmente</strong> se implementó para las aplicaciones de Android basadas en vistas XML (Activities y Fragments), incluso dispone de una herramienta visual para diseñar la navegación de la aplicación.</p>
<p>Ahora, la biblioteca de navegación también se puede usar con aplicaciones de <strong>Android Jetpack Compose</strong>. La biblioteca de navegación de Compose proporciona una API declarativa para definir la navegación, y una API de navegación para navegar entre pantallas. Pero sin embargo no dispone de una herramienta visual para diseñar la navegación de la aplicación.</p>
<p>Como la mayoría de clases y el sistema de navegación es común a las aplicaciones basadas en vistas XML y a las basadas en Compose, <strong><a href="https://developer.android.com/guide/navigation/principles">la documentación oficial</a></strong> de la biblioteca de navegación <strong>es común para ambas</strong>. Por lo que en la documentación oficial, en la mayoría de ejemplos, se muestra la implementación con vistas XML y no con Compose. Esto puede llevarnos a confusión y a pensar que la biblioteca de navegación no es compatible con Compose, pero no es así, simplemente hay que saber interpretar los ejemplos y adaptarlos a Compose. De todas formas, tienes una entrada específica para Compose en ente <strong><a href="https://developer.android.com/jetpack/compose/navigation">enlace</a></strong></p>
<p>Desde sus inicios, la biblioteca de navegación para Compose ha tenido criticas por parte de la comunidad de desarrolladores, debido a su complejidad, falta de documentación y constantes cambios en su API. Es por eso que han surgido <em>multitud</em> de <strong>librerías de terceros</strong>, que en principio, facilitan la implementación evitando excesivo código "<em>bolierplate</em>" o incluso algunas son multiplataforma (Android, iOS, Desktop y Web)</p>
<p>Algunas de estas librerías son: <strong><a href="https://composedestinations.rafaelcosta.xyz/v2/">Compose Destinations</a></strong>, <strong><a href="https://bumble-tech.github.io/appyx/">Appyx</a></strong>, <strong><a href="https://voyager.adriel.cafe/">Voyager</a></strong>, <strong><a href="https://olshevski.github.io/compose-navigation-reimagined/">Reimagined</a></strong>, <strong><a href="https://xxfast.github.io/Decompose-Router/overview.html">Decompose</a></strong>.</p>
<p>Al final muchas de estas librerías son una capa de abstracción sobre la biblioteca de navegación oficial, por lo que es recomendable conocer la biblioteca oficial. Este <strong><a href="https://www.youtube.com/watch?v=JAGLOaWztBc">vídeo en inglés</a></strong>, Philipp Lackner nos hace una reflexión sobre este tema y el porqué conocer la biblioteca oficial de Google y en todo caso hacernos nosotros mismos nuestra propia abstracción de navegación.</p>
<p>Incluso utilizando la biblioteca oficial, hay muchas formas de implementar la navegación y que podréis ver en los diferentes tutoriales y vídeos que hay en la red, teniendo en cuenta que en cada uno se siguen diferentes patrones de diseño.</p>
<div class="admonition tip">
<p class="admonition-title">Importante</p>
<p>Nosotros en este tema vamos a seguir las recomendaciones de uso y mejores prácticas de implementación que en la actualidad recomienda Google y que pueden encontrar en el siguiente <strong><a href="https://developer.android.com/guide/navigation/design/type-safety">enlace</a></strong> que <strong>recomendamos que visites y leas</strong> tras ver el tema.</p>
</div>
<div style="page-break-after:always;"></div>
<h2 id="conceptos-básicos">Conceptos Básicos </h2>
<h3 id="dependencias-necesarias">Dependencias necesarias </h3>
<p>Recuerda que la versión puede cambiar en el futuro, por lo que es recomendable que consultes la última versión en el <strong><a href="https://developer.android.com/jetpack/androidx/releases/navigation">enlace</a></strong>. También debes tener en cuanta que un cambio en el primer número de la versión, puede implicar cambios importantes en la API que vamos a describir.</p>
<p>Para poder utilizar la biblioteca de navegación en Compose, debemos añadir las siguientes dependencias ...</p>
<p>En el <strong><code>libs.versions.toml</code></strong> ...</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Aunque en el ejemplo hemos puesto las entradas en varias líneas indentadas para más claridad y que quepa todo en la versión en pdf. El intérprete de Gradle para el toml no admite esta sintaxis, por lo que debes ponerlo <strong>en una sola línea</strong>.</p>
</div>
<pre data-role="codeBlock" data-info="toml" class="language-toml toml"><code><span class="token punctuation">[</span><span class="token table class-name">versions</span><span class="token punctuation">]</span>
<span class="token key property">composeNavigation</span> <span class="token punctuation">=</span> <span class="token string">"2.8.5"</span>
<span class="token key property">kotlinxSerializationJson</span> <span class="token punctuation">=</span> <span class="token string">"1.7.3"</span>
</code></pre><pre data-role="codeBlock" data-info="toml" class="language-toml toml"><code><span class="token punctuation">[</span><span class="token table class-name">libraries</span><span class="token punctuation">]</span>
<span class="token key property">compose-navigation</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> 
    <span class="token key property">group</span> <span class="token punctuation">=</span> <span class="token string">"androidx.navigation"</span><span class="token punctuation">,</span> 
    <span class="token key property">name</span> <span class="token punctuation">=</span> <span class="token string">"navigation-compose"</span><span class="token punctuation">,</span> 
    <span class="token key property">version.ref</span> <span class="token punctuation">=</span> <span class="token string">"composeNavigation"</span> 
<span class="token punctuation">}</span>
<span class="token key property">kotlinx-serializarion-json</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> 
    <span class="token key property">group</span> <span class="token punctuation">=</span> <span class="token string">"org.jetbrains.kotlinx"</span><span class="token punctuation">,</span> 
    <span class="token key property">name</span> <span class="token punctuation">=</span> <span class="token string">"kotlinx-serialization-json"</span><span class="token punctuation">,</span> 
    <span class="token key property">version.ref</span> <span class="token punctuation">=</span> <span class="token string">"kotlinxSerializationJson"</span> 
<span class="token punctuation">}</span>
<span class="token key property">androidx-hilt-navigation-compose</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> 
    <span class="token key property">group</span> <span class="token punctuation">=</span> <span class="token string">"androidx.hilt"</span><span class="token punctuation">,</span> 
    <span class="token key property">name</span> <span class="token punctuation">=</span> <span class="token string">"hilt-navigation-compose"</span><span class="token punctuation">,</span> 
    <span class="token key property">version.ref</span> <span class="token punctuation">=</span> <span class="token string">"hiltNavigationCompose"</span> 
<span class="token punctuation">}</span>
</code></pre><pre data-role="codeBlock" data-info="toml" class="language-toml toml"><code><span class="token punctuation">[</span><span class="token table class-name">plugins</span><span class="token punctuation">]</span>
<span class="token key property">kotlinx-serialization</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> 
    <span class="token key property">id</span> <span class="token punctuation">=</span> <span class="token string">"org.jetbrains.kotlin.plugin.serialization"</span><span class="token punctuation">,</span> 
    <span class="token key property">version.ref</span> <span class="token punctuation">=</span> <span class="token string">"kotlin"</span> 
<span class="token punctuation">}</span>
</code></pre><p>En el DSL definido en <strong><code>build.gradle.kts</code></strong> del <strong>proyecto</strong> ...</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code>plugins <span class="token punctuation">{</span>
    <span class="token function">alias</span><span class="token punctuation">(</span>libs<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span>kotlinx<span class="token punctuation">.</span>serialization<span class="token punctuation">)</span> apply <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre><p>En el DSL definido en <strong><code>build.gradle.kts</code></strong> del <strong>módulo app</strong> ...</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code>plugins <span class="token punctuation">{</span>
    <span class="token function">alias</span><span class="token punctuation">(</span>libs<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span>kotlinx<span class="token punctuation">.</span>serialization<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

dependencies <span class="token punctuation">{</span>
    <span class="token function">implementation</span><span class="token punctuation">(</span>libs<span class="token punctuation">.</span>compose<span class="token punctuation">.</span>navigation<span class="token punctuation">)</span>
    <span class="token function">implementation</span><span class="token punctuation">(</span>libs<span class="token punctuation">.</span>kotlinx<span class="token punctuation">.</span>serializarion<span class="token punctuation">.</span>json<span class="token punctuation">)</span>

    <span class="token comment">// y su estamos usano Hilt y no está ya añadida</span>
    <span class="token function">implementation</span><span class="token punctuation">(</span>libs<span class="token punctuation">.</span>androidx<span class="token punctuation">.</span>hilt<span class="token punctuation">.</span>navigation<span class="token punctuation">.</span>compose<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="navcontroller">NavController </h3>
<p>El <strong><code>NavController</code></strong> es el <strong>encargado de gestionar la navegación entre destinos</strong>. El controlador <strong>ofrece métodos para navegar</strong> entre destinos, manejar enlaces profundos, <strong>administrar la pila de retroceso</strong> y más.</p>
<p>Para crear un <strong><code>NavController</code></strong> en Jetpack Compose haremos:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-val">val</span> navController <span class="token operator">=</span> <span class="token function">rememberNavController</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><p>Puesto que <strong><code>rememberNavController</code></strong> es una función <strong><code>@Composable</code></strong> NO puede ser creado en un <strong><code>ViewModel</code></strong>. Así pues, si quieres que la mayoría de tus componentes puedan acceder a la navegación, <strong>debes crear el  objeto <strong><code>NavController</code></strong> en el componente más alto de la jerarquía de composición</strong> esto es junto al <strong><code>NavHost</code></strong> del que hablaremos a continuación.</p>
<div style="page-break-after:always;"></div>
<h3 id="navhost">NavHost </h3>
<p>Para poder navegar entre pantallas, debemos tener <strong>un contenedor donde se muestren las pantallas</strong>. En las <strong>aplicaciones basadas en compose</strong> este contenedor <strong>es un <em>'composable'</em></strong> llamado <strong><code>NavHost</code></strong>. Al ser un contenedor, puede ocupar todo la pantalla o solo una parte de ella como se muestra en las imágenes más a a la derecha.</p>
<p><strong><code>NavHost</code></strong> recibirá un <strong><code>NavController</code></strong> e irá definiendo los destinos de navegación a través de un <strong><code>NavGraph</code></strong>, este componente lo recibirá como parámetro o será creado y gestionado por el propio <strong><code>NavHost</code></strong> de forma interna, solo si no se le ha pasa. El <strong><code>NavGraph</code></strong> es básicamente por tanto, una colección de destinos recuperables.</p>
<div class="galeria_imagenes">
    <img width="150px" src="assets/imagenes/tema_4_2/navhost_1.png">
    <img width="150px" src="assets/imagenes/tema_4_2/navhost_2.png">
</div>
<div style="page-break-after:always;"></div>
<h2 id="ejemplo-básico-de-navegación">Ejemplo básico de navegación </h2>
<h3 id="implementación-mínima">Implementación mínima </h3>
<p>Vamos a aplicar los conceptos anteriores a un ejemplo básico de navegación entre dos pantallas <strong>A</strong> y <strong>B</strong>.</p>
<p>Tal y como se muestra en la imagen de ejemplo. La pantalla <strong>A</strong> será la pantalla principal y tendrá un <strong><code>Scaffold</code></strong> con un <strong><code>TopAppBar</code></strong> y un botón que nos permitirá navegar a la pantalla <strong>B</strong>. La pantalla <strong>B</strong> tendrá un <strong><code>Scaffold</code></strong> con un <strong><code>TopAppBar</code></strong> y en ella tendrá un <strong><code>IconButton</code></strong> de vuelta a la pantalla anterior que solo puede ser pantalla <strong>A</strong>.</p>
<p>Descarga proyecto de <strong>ejemplo 1</strong>: <strong><a href="assets/codigo/tema_4_2/EjemploNavegacionBasico1_recurso.zip">EjemploNavegacionBasico1.zip</a></strong></p>
<div class="galeria_imagenes">
    <img height="300px" src="assets/imagenes/tema_4_2/EjemploBasicoAtoB1.png">
</div>
<p>Los pasos serían los siguientes:</p>
<ol>
<li>
<p>Primero definiremos las pantallas en el paquete <strong><code>ui.features</code></strong><br>
Definimos <strong><code>PantallaAScreen.kt</code></strong> que emite en la composición la <strong>pantalla A</strong> y recibe un callback que será llamado cuando se pulse el botón de navegación a la <strong>pantalla B</strong>.:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">PantallaAScreen</span><span class="token punctuation">(</span>onNavigatePantallaB<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit<span class="token punctuation">)</span>
</code></pre><p>Definimos <strong><code>PantallaBScreen.kt</code></strong> que emite en la composición la <strong>pantalla B</strong> y recibe un callback que será llamado cuando se pulse el botón de navegación a la pantalla anterior que solo puede ser la <strong>pantalla A</strong>.:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">PantallaBScreen</span><span class="token punctuation">(</span>onNavegarAtras<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit<span class="token punctuation">)</span>
</code></pre><div class="admonition tip">
<p class="admonition-title">Importante</p>
<p>Como ves, en ambos casos pasamos callbacks que serán llamados cuando se pulse el botón de navegación y así evitamos dependencias con el <strong><code>NavController</code></strong> y <strong>tendremos centralizadas todas las acciones de navegación en el <code>NavHost</code></strong>.</p>
</div>
</li>
<li>
<p>Decidimos en que punto vamos a tener nuestro <strong><code>NavHost</code></strong> y como ya hemos comentado tendremos varias opciones. Para este ejemplo, lo normal es que esté lo más alto en la jerarquía de composición, por lo que lo pondremos en el <strong><code>setContent</code></strong> de la <strong><code>MainActivity</code></strong> y es en este punto donde crearemos al <strong><code>NavController</code></strong>.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token comment">// MainActivity.kt</span>
<span class="token keyword keyword-class">class</span> MainActivity <span class="token operator">:</span> <span class="token function">ComponentActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        setContent <span class="token punctuation">{</span>
            EjemploNavegacionTheme <span class="token punctuation">{</span>
                <span class="token function">Surface</span><span class="token punctuation">(</span>modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">fillMaxSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-val">val</span> navController <span class="token operator">=</span> <span class="token function">rememberNavController</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token function">NavHostEjemploBasicoInicial</span><span class="token punctuation">(</span>navController <span class="token operator">=</span> navController<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p>Para ello hemos definido la función composable <strong><code>NavHostEjemploBasicoInicial</code></strong> que recibe una instancia de <strong><code>NavHostController</code></strong>.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">NavHostEjemploBasicoInicial</span><span class="token punctuation">(</span>navController<span class="token operator">:</span> NavHostController<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">NavHost</span><span class="token punctuation">(</span>
        navController <span class="token operator">=</span> navController<span class="token punctuation">,</span> 
        startDestination <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"pantalla_A"</span></span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">composable</span><span class="token punctuation">(</span>route <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"pantalla_A"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> backStackEntry <span class="token operator">-&gt;</span>
            PantallaAScreen <span class="token punctuation">{</span>
                navController<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"pantalla_B"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token function">composable</span><span class="token punctuation">(</span>route <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"pantalla_B"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> backStackEntry <span class="token operator">-&gt;</span>
            PantallaBScreen <span class="token punctuation">{</span>
                navController<span class="token punctuation">.</span><span class="token function">popBackStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div style="page-break-after:always;"></div>
<p>Vamos a comentar más detalladamente el código del punto anterior:</p>
<pre data-role="codeBlock" data-info="kotlin {highlight=[7-9]}" class="language-kotlin kotlin" data-line="7-9"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">NavHostEjemploBasicoInicial</span><span class="token punctuation">(</span>navController<span class="token operator">:</span> NavHostController<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">NavHost</span><span class="token punctuation">(</span>
        navController <span class="token operator">=</span> navController<span class="token punctuation">,</span>  <span class="token comment">// Pasamos el NavController</span>
        startDestination <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"pantalla_A"</span></span> <span class="token comment">// Indicamos el destino inicial</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// En este contexto estamos definiendo un objeto NavGraphBuilder</span>
        <span class="token comment">// encargado de crear el grafo de navegación.</span>
        <span class="token comment">// Por lo que solo podemos usar métodos de esta clase. </span>

        <span class="token operator">..</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="line-highlight-wrapper">





<div aria-hidden="true" class="line-highlight" data-range="7-9" data-start="7" data-end="9">


</div></div></pre><pre data-role="codeBlock" data-info="kotlin {highlight=[5-9, 12-13, 16-18]}" class="language-kotlin kotlin" data-line="5-9,12-13,16-18"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">NavHostEjemploBasicoInicial</span><span class="token punctuation">(</span>navController<span class="token operator">:</span> NavHostController<span class="token punctuation">)</span> <span class="token punctuation">{</span>        
    <span class="token function">NavHost</span><span class="token punctuation">(</span>navController <span class="token operator">=</span> navController<span class="token punctuation">,</span> startDestination <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"pantalla_A"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token operator">..</span><span class="token punctuation">.</span>
        <span class="token comment">// composable es uno de los métodos de NavGraphBuilder y crea un o </span>
        <span class="token comment">// destin de navegación en el grafo.</span>
        <span class="token comment">// Como parámetro obligatorio recibe la ruta del destino que será  </span>
        <span class="token comment">// una cadena de texto similar a una URL de consumo de un API REST.</span>
        <span class="token comment">// Más adelante comentaremos otros parámetros opcionales.</span>
        <span class="token function">composable</span><span class="token punctuation">(</span>route <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"pantalla_A"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> backStackEntry <span class="token operator">-&gt;</span>

            <span class="token comment">// Aquí irá el composable con la pantalla o Screen que se </span>
            <span class="token comment">// emite en el NavHost en esta ruta del grafo.</span>
            PantallaAScreen <span class="token punctuation">{</span>

                <span class="token comment">// Callback que será llamado cuando se pulse el botón de navegación</span>
                <span class="token comment">// de ir a pantalla B. Si la ruta especificada no existe en el grafo</span>
                <span class="token comment">// obtendremos una excepción en tiempo de ejecución.</span>
                navController<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"pantalla_B"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token operator">..</span><span class="token punctuation">.</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="line-highlight-wrapper">



<div aria-hidden="true" class="line-highlight" data-range="5-9" data-start="5" data-end="9">




</div></div><div class="line-highlight-wrapper">










<div aria-hidden="true" class="line-highlight" data-range="12-13" data-start="12" data-end="13">

</div></div><div class="line-highlight-wrapper">














<div aria-hidden="true" class="line-highlight" data-range="16-18" data-start="16" data-end="18">


</div></div></pre><p>Por último, al definir el callback de navegación en la pantalla <strong>B</strong> hemos usado el método <strong><code>navigateUp</code></strong> que nos permite volver a la pantalla anterior, que en este caso es la pantalla <strong>A</strong>.</p>
</li>
</ol>
<div style="page-break-after:always;"></div>
<h3 id="refactorizando-con-buenas-prácticas">Refactorizando con buenas prácticas </h3>
<p>En este punto ya tenemos un ejemplo básico de navegación, pero <strong>en una aplicación real donde los destinos de navegación pueden ser muchos</strong>, podremos pasar parámetros entre pantallas, definir transiciones, usaremos ViewModel para acceder a la lógica de negocio, etc. El <strong>uso de cadenas para las rutas</strong> puede volver el código muy complejo. Esto <strong>hará que sea fácil cometer errores que no se detecten en tiempo de compilación</strong> y consecuentemente también será difícil de mantener o ampliar, testear y depurar.</p>
<p>Para solucionar esto, como comentamos en la introducción del tema, vamos a usar tipos seguros que es la recomendación actual Google y que pueden encontrar en el siguiente <strong><a href="https://developer.android.com/guide/navigation/design/type-safety">enlace</a></strong>. Por lo que vamos a refactorizar el código siguiendo los siguientes pasos:</p>
<ol>
<li>
<p>Crearemos un paquete <strong><code>ui.navigation</code></strong> donde definiremos los destinos y el grafo de navegación.</p>
</li>
<li>
<p>Por cada destino de navegación crearemos un fichero <strong><code>&lt;PantallaDestino&gt;Route.kt</code></strong> donde definiremos la gestion de la <strong>ruta o rutas</strong> que nos lleven a esa pantalla de destino.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token comment">// Definimos la ruta y como no recibe parámetros será un data object. </span>
<span class="token comment">// Debe ser serializable para ser pasado como parámetro en la navegación.</span>
<span class="token annotation builtin">@Serializable</span>
<span class="token keyword keyword-object">object</span> PantallaARoute

<span class="token comment">// Definimos un método de extensión de NavGraphBuilder para poder</span>
<span class="token comment">// usarlo en el contexto de nuestro NavHost</span>
<span class="token comment">// Fíjate que le hemos añadido el sufijo Destination indicando que es</span>
<span class="token comment">// un "nodo de destino" en el grafo de navegación.</span>
<span class="token keyword keyword-fun">fun</span> NavGraphBuilder<span class="token punctuation">.</span><span class="token function">pantallaADestination</span><span class="token punctuation">(</span>
    onNavigatePantallaB<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Aquí es donde realmente definimos el destino de navegación para la</span>
    <span class="token comment">// ruta que hemos definido en el objeto PantallaARoute</span>
    <span class="token comment">// y donde realmente se emite la pantalla A dentro del NavHost.</span>
    composable<span class="token operator">&lt;</span>PantallaARoute<span class="token operator">&gt;</span> <span class="token punctuation">{</span> backStackEntry <span class="token operator">-&gt;</span>
        <span class="token function">PantallaAScreen</span><span class="token punctuation">(</span>onNavigatePantallaB<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Definir <strong><code>NavGraphBuilder.pantallaADestination</code></strong> me ayuda a simplificar la definición del grafo de navegación, <strong>manteniendo así la emisión del <code>NavHost</code> limpia y fácil de leer</strong>. Además, podrá recibir el ViewModel de la pantalla destino y descomponer en la emisión del componente de la pantalla destino, lo que me ayudará a mantener la lógica de negocio fuera de la vista y así poder hacer previews test de mis pantallas.</p>
<p>Ahora definiremos <strong><code>PantallaBRoute.kt</code></strong> donde haremos lo mismo que antes pero <strong>definiendo una nueva ruta</strong> ...</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Serializable</span>
<span class="token keyword keyword-object">object</span> PantallaBRoute

<span class="token keyword keyword-fun">fun</span> NavGraphBuilder<span class="token punctuation">.</span><span class="token function">pantallaBDestination</span><span class="token punctuation">(</span>
    onNavegarAtras<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    composable<span class="token operator">&lt;</span>PantallaBRoute<span class="token operator">&gt;</span> <span class="token punctuation">{</span> backStackEntry <span class="token operator">-&gt;</span>
        <span class="token function">PantallaBScreen</span><span class="token punctuation">(</span>
            onNavegarAtras <span class="token operator">=</span> onNavegarAtras
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p>Por último definiremos <strong><code>NavHostEjemploBasico.kt</code></strong> donde definiremos el <em>composable</em> con el <strong><code>NavHost</code></strong> usando los métodos de extensión que hemos definido en los ficheros anteriores y que usaremos en el método <strong><code>setContent</code></strong> de la <strong><code>MainActivity</code></strong>.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">NavHostEjemploBasico</span><span class="token punctuation">(</span>navController<span class="token operator">:</span> NavHostController<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">NavHost</span><span class="token punctuation">(</span>
        navController <span class="token operator">=</span> navController<span class="token punctuation">,</span>
        startDestination <span class="token operator">=</span> PantallaARoute
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        pantallaADestination <span class="token punctuation">{</span> navController<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span>PantallaBRoute<span class="token punctuation">)</span> <span class="token punctuation">}</span>
        pantallaBDestination <span class="token punctuation">{</span> navController<span class="token punctuation">.</span><span class="token function">popBackStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Como vemos el código queda mucho más limpio y modularizado. Además, no usamos literales de cadena y tendremos una metodología de definición.</p>
</li>
</ol>
<h2 id="pasando-datos-entre-pantallas">Pasando datos entre pantallas </h2>
<ul>
<li>
<p><strong>Pasando datos entre pantallas</strong></p>
<ul>
<li>Documentación oficial compose: <strong><a href="https://developer.android.com/jetpack/compose/navigation?optional-args#nav-with-args">Navigate with arguments</a></strong></li>
<li>Navegación con seguridad de tipos (Vídeo Castellano): <strong><a href="https://www.youtube.com/watch?v=4xFpapw4PF0">DevExperto</a></strong></li>
</ul>
</li>
</ul>
<p>En el ejemplo anterior hemos visto como navegar entre pantallas, pero en una aplicación real, es muy probable que necesitemos pasar datos entre pantallas.</p>
<h3 id="estrategias-para-pasar-datos-entre-pantallas">Estrategias para pasar datos entre pantallas </h3>
<div class="admonition tip">
<p class="admonition-title">Importante</p>
<p>En el siguiente <strong><a href="https://www.youtube.com/watch?v=h61Wqy3qcKg">vídeo tutorial</a></strong> de <strong>Philipp Lackner</strong> se explica las diferentes estrategias de cómo pasar datos entre pantallas y las ventajas e inconvenientes de cada una de ellas. Es interesante que le eches un vistazo antes y después de ver este tema.</p>
</div>
<p>Der entre las estrategias posibles vamos a destacar las siguientes:</p>
<ol>
<li>
<p>👍👍 <strong>Pasar argumentos de navegación</strong>: <strong>La más adecuadas</strong> si queremos evitar acoplamiento entre pantallas y de esta manera usar una misma pantalla en diferentes contextos. La librería de navegación de Jetpack Compose para Android nos permite pasar argumentos de navegación entre pantallas.</p>
<p>Estos argumentos <strong>se pasan en la ruta de navegación</strong> soporta el paso de <strong>argumentos de tipo primitivo</strong> y objetos parcelables o serializables.</p>
<p>Lo más común es pasar un argumento de tipo primitivo que sea la <strong>clave primaria</strong> de un objeto que queremos recuperar en el ViewModel de la pantalla destino (<strong>es la recomendación de Google</strong>). Por ejemplo, si queremos recuperar un objeto de tipo <strong><code>Usuario</code></strong> en la pantalla destino, pasaremos como argumento de navegación el <strong><code>id</code></strong> del usuario y en la pantalla destino recuperaremos el objeto de nuestros repositorios a partir de ese <strong><code>id</code></strong>.</p>
</li>
<li>
<p>👍 <strong>Compartir un ViewModel</strong>: Básicamente consiste en tener el dato en un ViewModel que sea compartido por ambas pantallas. Para ello debemos asegurarnos que el <strong><code>ViewModelOwner</code></strong> sobreviva a ambas pantallas como por ejemplo el <strong><code>ViewModelOwner</code></strong> de la <strong><code>MainActivity</code></strong>. <strong>Aunque también hay otras estrategias como usar un <code>ViewModel</code> donde el <code>ViewModelOwner</code> sea un <code>NavGraph</code></strong>.</p>
</li>
<li>
<p>👎 <strong>Compartir una dependencia con estado</strong>: Básicamente consiste en usar Hilt para definir una clase que se pueda <strong>inyectar</strong> en los ViewModels que necesiten compartir datos y esté marcada como <strong><code>@Singleton</code></strong>. De esta manera tendremos una única instancia de la clase y por tanto los datos que almacene serán compartidos por todos los ViewModels que la inyecten. Las propiedades de dicha clase deben ser <strong><code>MutableState</code></strong> para que los cambios sean observables por los ViewModels que la inyecten.</p>
</li>
</ol>
<h3 id="paso-de-argumentos-de-navegación">Paso de argumentos de navegación </h3>
<div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px">
<div style="width: 50%">
<p>Veamos el proceso de paso de argumentos de navegación entre pantallas completando el ejemplo anterior donde navegábamos entre las pantallas <strong>A</strong> y <strong>B</strong>.</p>
<p>Vamos ha realizar una <strong>paso simple de datos</strong> entre pantallas. Como puedes ver en la imagen de ejemplo, en la pantalla <strong>A</strong> tendremos un <strong><code>TextField</code></strong> donde el usuario introducirá su nombre y en la pantalla <strong>B</strong> mostraremos un <strong><code>Text</code></strong> con el nombre introducido.</p>
<p>Descarga proyecto de <strong>ejemplo 2</strong>: <strong><a href="assets/codigo/tema_4_2/EjemploNavegacionBasico2_recurso.zip">EjemploNavegacionBasico2.zip</a></strong></p>
</div>
<div style="width: auto">
    <img height="300px" src="assets/imagenes/tema_4_2/EjemploBasicoAtoB2.png">
</div>
</div>
<p>Vamos los pasos lógicos que debemos seguir:</p>
<ol>
<li>
<p>Modificamos <strong><code>PantallaBScreen.kt</code></strong> para gestionar el argumento de navegación:</p>
<p>PantallaBScreen recibe ahora un parámetro de tipo <strong><code>String?</code></strong> que si es distinto de <strong><code>null</code></strong> mostrará el nombre en un <strong><code>Text</code></strong> justo debajo del rótulo <strong>B</strong></p>
<pre data-role="codeBlock" data-info="kotlin {highlight=3 }" class="language-kotlin kotlin" data-line="3"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">PantallaBScreen</span><span class="token punctuation">(</span>
    nombre<span class="token operator">:</span> String<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">,</span>
    onNavegarAtras<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit<span class="token punctuation">)</span>

</code><div class="line-highlight-wrapper">

<div aria-hidden="true" class="line-highlight" data-range="3" data-start="3">
</div></div></pre> <div style="page-break-after:always;"></div>
</li>
<li>
<p>Modificamos <strong><code>PantallaAScreen.kt</code></strong> para enviar el argumento de navegación:</p>
<p>Fíjate que <strong><code>onNavigatePantallaB</code></strong> ahora recibe un parámetro de tipo <strong><code>String</code></strong> que será el estado con el nombre introducido por el usuario.</p>
<pre data-role="codeBlock" data-info="kotlin {highlight=[4, 7, 8, 16, 18, 22]}" class="language-kotlin kotlin" data-line="4,7,8,16,18,22"><code><span class="token annotation builtin">@OptIn</span><span class="token punctuation">(</span>ExperimentalMaterial3Api<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">)</span>
<span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">PantallaAScreen</span><span class="token punctuation">(</span>
    onNavigatePantallaB<span class="token operator">:</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> comportamientoAnteScroll <span class="token operator">=</span> TopAppBarDefaults<span class="token punctuation">.</span><span class="token function">pinnedScrollBehavior</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-var">var</span> nombreState <span class="token keyword keyword-by">by</span> remember <span class="token punctuation">{</span> <span class="token function">mutableStateOf</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"anónimo"</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token keyword keyword-val">val</span> onNombreChange<span class="token operator">:</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit <span class="token operator">=</span> <span class="token punctuation">{</span> nombreState <span class="token operator">=</span> it <span class="token punctuation">}</span>
    <span class="token function">Scaffold</span><span class="token punctuation">(</span>
        content <span class="token operator">=</span> <span class="token punctuation">{</span> innerPadding <span class="token operator">-&gt;</span><span class="token function">ContenidoPantalla</span><span class="token punctuation">(</span><span class="token operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">ContenidoPantalla</span><span class="token punctuation">(</span>
    nombreState<span class="token operator">:</span> String<span class="token punctuation">,</span>
    onNombreChange<span class="token operator">:</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit<span class="token punctuation">,</span>
    onNavigatePantallaB<span class="token operator">:</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit<span class="token punctuation">,</span>
    modifier<span class="token operator">:</span> Modifier <span class="token operator">=</span> Modifier<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">..</span><span class="token punctuation">.</span>
    <span class="token function">Button</span><span class="token punctuation">(</span>onClick <span class="token operator">=</span> <span class="token punctuation">{</span> 
        <span class="token function">onNavigatePantallaB</span><span class="token punctuation">(</span>nombreState<span class="token punctuation">)</span> 
    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Text</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Ir a pantalla B"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code><div class="line-highlight-wrapper">


<div aria-hidden="true" class="line-highlight" data-range="4" data-start="4">
</div></div><div class="line-highlight-wrapper">





<div aria-hidden="true" class="line-highlight" data-range="7" data-start="7">
</div></div><div class="line-highlight-wrapper">






<div aria-hidden="true" class="line-highlight" data-range="8" data-start="8">
</div></div><div class="line-highlight-wrapper">














<div aria-hidden="true" class="line-highlight" data-range="16" data-start="16">
</div></div><div class="line-highlight-wrapper">
















<div aria-hidden="true" class="line-highlight" data-range="18" data-start="18">
</div></div><div class="line-highlight-wrapper">




















<div aria-hidden="true" class="line-highlight" data-range="22" data-start="22">
</div></div></pre></li>
<li>
<p>Modificamos <strong><code>PantallaBRoute.kt</code></strong> para redefinir la ruta de navegación con el parámetro de entrada y en lugar de un <strong><code>object</code></strong> definimos una <strong><code>data class</code></strong> con una propiedad de tipo <strong><code>String</code></strong> que será el dato que pasaremos entre pantallas.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Estas <strong>propiedades deben ser tipos simples del propio lenguaje</strong> que ya que por defecto son serializables y parcelables. En caso de ser tipos compuestos definidos por nosotros el paso de parametros no funcionaría y el proceso se complicaría ya que tendríamo que indicarle a la navegación como se serializan dichos tipos.</p>
</div>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token comment">// Definimos la ruta con un parámetro de tipo String</span>
<span class="token annotation builtin">@Serializable</span>
<span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">PantallaBRoute</span><span class="token punctuation">(</span><span class="token keyword keyword-val">val</span> nombre<span class="token operator">:</span> String<span class="token punctuation">)</span>

<span class="token keyword keyword-fun">fun</span> NavGraphBuilder<span class="token punctuation">.</span><span class="token function">pantallaBDestination</span><span class="token punctuation">(</span>
    onNavegarAtras<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    composable<span class="token operator">&lt;</span>PantallaBRoute<span class="token operator">&gt;</span> <span class="token punctuation">{</span> backStackEntry <span class="token operator">-&gt;</span>
        <span class="token comment">// Con el método toRoute podemos recuperar el objeto PantallaBRoute</span>
        <span class="token comment">// con el parámetro de entrada.</span>
        <span class="token keyword keyword-val">val</span> datos <span class="token operator">:</span> PantallaBRoute <span class="token operator">=</span> remember <span class="token punctuation">{</span> backStackEntry<span class="token punctuation">.</span>toRoute<span class="token operator">&lt;</span>PantallaBRoute<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
        <span class="token function">PantallaBScreen</span><span class="token punctuation">(</span>
            nombre <span class="token operator">=</span> datos<span class="token punctuation">.</span>nombre<span class="token punctuation">,</span>
            onNavegarAtras <span class="token operator">=</span> onNavegarAtras
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p>Modificamos <strong><code>NavHostEjemploBasico.kt</code></strong> fíjate que ahora en el callback de navegación de la pantalla <strong>A</strong> creamos un objeto de tipo <strong><code>PantallaBRoute</code></strong> con el nombre introducido por el usuario que será el argumento de navegación.</p>
<pre data-role="codeBlock" data-info="kotlin {highlight=6}" class="language-kotlin kotlin" data-line="6"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">NavHostEjemploBasico</span><span class="token punctuation">(</span>navController<span class="token operator">:</span> NavHostController<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">NavHost</span><span class="token punctuation">(</span><span class="token operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">pantallaADestination</span><span class="token punctuation">(</span>
            onNavigatePantallaB <span class="token operator">=</span> <span class="token punctuation">{</span> nombre <span class="token operator">-&gt;</span>
                navController<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span><span class="token function">PantallaBRoute</span><span class="token punctuation">(</span>nombre<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
        <span class="token operator">..</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="line-highlight-wrapper">




<div aria-hidden="true" class="line-highlight" data-range="6" data-start="6">
</div></div></pre></li>
</ol>
<h2 id="integrando-hilt--viewmodel--animaciones">Integrando Hilt + ViewModel + Animaciones </h2>
<p>Si nos fijamos en el ejemplo anterior, al volver de la pantalla <strong>B</strong> a la pantalla <strong>A</strong> el texto introducido en el <strong><code>TextField</code></strong> se pierde. Esto es debido a que la pantalla <strong>A</strong> se vuelve a crear y por tanto el estado del <strong><code>TextField</code></strong> se reinicia.</p>
<p>Para evitar esto vamos a introducir un <strong><code>ViewModel</code></strong> para cada una de las pantallas. <strong>La forma más simple de hacerlo</strong> es usando <strong><code>Hilt</code></strong>. Además,  como comentamos también podría ayudarnos a compartir datos entre pantallas. Recuerda que debemos tener la dependencia de <strong><code>hilt-navigation-compose</code></strong> en el fichero <strong><code>build.gradle.kts</code></strong> del módulo app:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token function">implementation</span><span class="token punctuation">(</span>libs<span class="token punctuation">.</span>androidx<span class="token punctuation">.</span>hilt<span class="token punctuation">.</span>navigation<span class="token punctuation">.</span>compose<span class="token punctuation">)</span>
</code></pre><p>Otro aspecto que vamos a mejorar, es la transición entre pantallas durante la navegación. Para ello, Google ha incorporado en la biblioteca de navegación de Jetpack Compose, un nuevo sistema de animaciones que nos permite definir animaciones de entrada y salida de las pantallas. Recuerda que debes tener añadida la siguiente librería de animaciones en el fichero <strong><code>build.gradle.kts</code></strong> del módulo app:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token function">implementation</span><span class="token punctuation">(</span>libs<span class="token punctuation">.</span>compose<span class="token punctuation">.</span>navigation<span class="token punctuation">)</span>
</code></pre><p>Descarga proyecto de <strong>ejemplo 3</strong>: <strong><a href="assets/codigo/tema_4_2/EjemploNavegacionBasico3_recurso.zip">EjemploNavegacionBasico3.zip</a></strong></p>
<h3 id="cambiando-las-transiciones-entre-pantallas">Cambiando las transiciones entre pantallas </h3>
<p>Vamos a continuar con nuestro ejemplo anterior, pero vamos a cambiar las transiciones entre pantallas. Para ello, lo más sencillo será aplicar la mismas transiciones a todas nuestras navegaciones y para ello nos hemos inventado la transición, en la imagen de ejemplo puedes ver como la pantalla <strong>B</strong> tiene una transición de entrada de derecha a izquierda con un fade-in y la pantalla <strong>A</strong> una transición de salida de arriba a abajo con un fade-out.</p>
<p>Cuando hagamos un volver atrás con un popBackStack las direcciones de las transiciones se invertirán.</p>
<div class="galeria_imagenes">
    <img height="200px" src="assets/imagenes/tema_4_2/TransicionAtoB.png">
</div>
<div style="page-break-after:always;"></div>
<p>Podemos crear una <strong>biblioteca de funciones de extensión de <code>AnimatedContentTransitionScope&lt;NavBackStackEntry&gt;</code></strong> para definir las transiciones de navegación. Para ello siguiendo la documentación de Accompanist hemos definido las siguientes. Podríamos, por ejemplo,  llevarlas a algún tipo de fichero  del paquete <strong><code>utilities</code></strong> de nuestro proyecto.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-fun">fun</span> AnimatedContentTransitionScope<span class="token operator">&lt;</span>NavBackStackEntry<span class="token operator">&gt;</span>
        <span class="token punctuation">.</span><span class="token function">entradaDesdeDerecha</span><span class="token punctuation">(</span>duracion<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token operator">=</span>
    <span class="token function">fadeIn</span><span class="token punctuation">(</span>animationSpec <span class="token operator">=</span> <span class="token function">tween</span><span class="token punctuation">(</span>duracion<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>
    <span class="token function">slideIntoContainer</span><span class="token punctuation">(</span>
        AnimatedContentTransitionScope<span class="token punctuation">.</span>SlideDirection<span class="token punctuation">.</span>Left<span class="token punctuation">,</span>
        <span class="token function">tween</span><span class="token punctuation">(</span>duracion<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token keyword keyword-fun">fun</span> AnimatedContentTransitionScope<span class="token operator">&lt;</span>NavBackStackEntry<span class="token operator">&gt;</span>
        <span class="token punctuation">.</span><span class="token function">salidaAlaDerecha</span><span class="token punctuation">(</span>duracion<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token operator">=</span>
    <span class="token function">fadeOut</span><span class="token punctuation">(</span>animationSpec <span class="token operator">=</span> <span class="token function">tween</span><span class="token punctuation">(</span>duracion<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>
            <span class="token function">slideOutOfContainer</span><span class="token punctuation">(</span>
                AnimatedContentTransitionScope<span class="token punctuation">.</span>SlideDirection<span class="token punctuation">.</span>Right<span class="token punctuation">,</span>
                <span class="token function">tween</span><span class="token punctuation">(</span>duracion<span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
<span class="token keyword keyword-fun">fun</span> AnimatedContentTransitionScope<span class="token operator">&lt;</span>NavBackStackEntry<span class="token operator">&gt;</span>
        <span class="token punctuation">.</span><span class="token function">salidaHaciaAbajo</span><span class="token punctuation">(</span>duracion<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token operator">=</span>
    <span class="token function">fadeOut</span><span class="token punctuation">(</span>animationSpec <span class="token operator">=</span> <span class="token function">tween</span><span class="token punctuation">(</span>duracion<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>
            <span class="token function">slideOutOfContainer</span><span class="token punctuation">(</span>
                AnimatedContentTransitionScope<span class="token punctuation">.</span>SlideDirection<span class="token punctuation">.</span>Down<span class="token punctuation">,</span>
                <span class="token function">tween</span><span class="token punctuation">(</span>duracion<span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
<span class="token keyword keyword-fun">fun</span> AnimatedContentTransitionScope<span class="token operator">&lt;</span>NavBackStackEntry<span class="token operator">&gt;</span>
        <span class="token punctuation">.</span><span class="token function">entradaHaciaArriba</span><span class="token punctuation">(</span>duracion<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token operator">=</span>
    <span class="token function">fadeIn</span><span class="token punctuation">(</span>animationSpec <span class="token operator">=</span> <span class="token function">tween</span><span class="token punctuation">(</span>duracion<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>
            <span class="token function">slideIntoContainer</span><span class="token punctuation">(</span>
                AnimatedContentTransitionScope<span class="token punctuation">.</span>SlideDirection<span class="token punctuation">.</span>Up<span class="token punctuation">,</span>
                <span class="token function">tween</span><span class="token punctuation">(</span>duracion<span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
</code></pre><div style="page-break-after:always;"></div>
<p>Posteriormente, para conseguir el efecto descrito, simplemente tendremos que usarlas en los parámetros de las transiciones de navegación en el <strong><code>NavHost</code></strong>. Por ejemplo:</p>
<pre data-role="codeBlock" data-info="kotlin {highlight=[5-8]}" class="language-kotlin kotlin" data-line="5-8"><code><span class="token keyword keyword-val">val</span> duracionAnimacion <span class="token operator">=</span> <span class="token number">1100</span>
<span class="token function">NavHost</span><span class="token punctuation">(</span>
    navController <span class="token operator">=</span> navController<span class="token punctuation">,</span>
    startDestination <span class="token operator">=</span> PantallaARoute<span class="token punctuation">,</span>
    enterTransition <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">entradaDesdeDerecha</span><span class="token punctuation">(</span>duracionAnimacion<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    exitTransition <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">salidaHaciaAbajo</span><span class="token punctuation">(</span>duracionAnimacion<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    popEnterTransition <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">entradaHaciaArriba</span><span class="token punctuation">(</span>duracionAnimacion<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    popExitTransition <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">salidaAlaDerecha</span><span class="token punctuation">(</span>duracionAnimacion<span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code><div class="line-highlight-wrapper">



<div aria-hidden="true" class="line-highlight" data-range="5-8" data-start="5" data-end="8">



</div></div></pre><h3 id="integrando-los-viewmodels-en-la-navegación">Integrando los ViewModels en la navegación </h3>
<p>Como sabemos, normalmente nuestras pantallas van a tener toda los '<em>UIStates</em>', lógica y acceso a datos en un <strong><code>ViewModel</code></strong>. Veamos los pasos para hacerlo en nuestro ejemplo:</p>
<ol>
<li>
<p>Integraremos <strong><code>Hilt</code></strong> en nuestro proyecto como vimos en temas anteriores. No hace falta definir, de momento, el paquete <strong><code>di</code></strong> pues no vamos a preparar ningún módulo.</p>
</li>
<li>
<p>Definiremos el VM de la pantalla <strong>A</strong> en <strong><code>PantallaAViewModel.kt</code></strong>. En el ascendemos los estados utilizados en la misma. En nuestro caso el nombre introducido y el callback llamado desde el <strong><code>TextField</code></strong>.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@HiltViewModel</span>
<span class="token keyword keyword-class">class</span> PantallaAViewModel <span class="token annotation builtin">@Inject</span> <span class="token keyword keyword-constructor">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">ViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-var">var</span> nombreState <span class="token keyword keyword-by">by</span> <span class="token function">mutableStateOf</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"anónimo"</span></span><span class="token punctuation">)</span>
        <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-set">set</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">onNombreChange</span><span class="token punctuation">(</span>nombre<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        nombreState <span class="token operator">=</span> nombre
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p>Definiremos el VM de la pantalla <strong>B</strong> en <strong><code>PantallaBViewModel.kt</code></strong>. En el ascendemos los estados utilizados en la misma. En nuestro caso el estado con el nombre que vamos a visualizar en el <strong><code>Text</code></strong> de la pantalla <strong>B</strong>.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@HiltViewModel</span>
<span class="token keyword keyword-class">class</span> PantallaBViewModel <span class="token annotation builtin">@Inject</span> <span class="token keyword keyword-constructor">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">ViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-var">var</span> nombreState<span class="token operator">:</span> String <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"anónimo"</span></span>
<span class="token punctuation">}</span>
</code></pre><p>✋ Fíjate que <strong>NO hemos hecho el <code>private set</code></strong> a la propiedad. De esta manera podremos modificar el estado antes de navegar y no pasar parámetro o pasar el parámetro, y al recibirlo '<em>setearlo</em>' en el VM de <strong>B</strong>. Nosotros vamos a optar por la segunda opción.</p>
</li>
<li>
<p>En <strong><code>NavHostEjemploBasico.kt</code></strong> crearemos las instancias de los VM mediante <strong><code>hiltViewModel&lt;TipoDelViewMode&gt;</code></strong>. Des esta manera los VM tendrán como <strong><code>ViewModelOwner</code></strong> la <strong><code>MainActivity</code></strong> y por tanto no se destruirán al navegar entre pantallas y al regresar a una patalla anterior se mantendrán los estados.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">NavHostEjemploBasico</span><span class="token punctuation">(</span>
    navController<span class="token operator">:</span> NavHostController
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> vmPantallaA <span class="token operator">=</span> hiltViewModel<span class="token operator">&lt;</span>PantallaAViewModel<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> vmPantallaB <span class="token operator">=</span> hiltViewModel<span class="token operator">&lt;</span>PantallaBViewModel<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">NavHost</span><span class="token punctuation">(</span>
        navController <span class="token operator">=</span> navController<span class="token punctuation">,</span>
        <span class="token operator">..</span><span class="token punctuation">.</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token operator">..</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p>En <strong><code>PantallaARoute.kt</code></strong> vamos a definir la ruta y el builder del nodo del grafo de navegación para la pantalla <strong>A</strong>. Al recibir el VM desde el navHost cualquier cambio de estado del nombre que se produzca en el VM se reflejará en la vista,</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Serializable</span>
<span class="token keyword keyword-object">object</span> PantallaARoute

<span class="token keyword keyword-fun">fun</span> NavGraphBuilder<span class="token punctuation">.</span><span class="token function">pantallaADestination</span><span class="token punctuation">(</span>
    vm<span class="token operator">:</span> PantallaAViewModel<span class="token punctuation">,</span>
    onNavigatePantallaB<span class="token operator">:</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    composable<span class="token operator">&lt;</span>PantallaARoute<span class="token operator">&gt;</span> <span class="token punctuation">{</span> backStackEntry <span class="token operator">-&gt;</span>
        <span class="token function">PantallaAScreen</span><span class="token punctuation">(</span>
            nombreState <span class="token operator">=</span> vm<span class="token punctuation">.</span>nombreState<span class="token punctuation">,</span>
            onNombreChange <span class="token operator">=</span> vm<span class="token operator">::</span>onNombreChange<span class="token punctuation">,</span>
            onNavigatePantallaB <span class="token operator">=</span> onNavigatePantallaB
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Si hubíeramos creado el VM en el momento de emitir la pantalla como en el siguiente ejemplo...</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-fun">fun</span> NavGraphBuilder<span class="token punctuation">.</span><span class="token function">pantallaADestination</span><span class="token punctuation">(</span>
    onNavigatePantallaB<span class="token operator">:</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    composable<span class="token operator">&lt;</span>PantallaARoute<span class="token operator">&gt;</span> <span class="token punctuation">{</span> backStackEntry <span class="token operator">-&gt;</span>
        <span class="token keyword keyword-val">val</span> vm <span class="token operator">=</span> hiltViewModel<span class="token operator">&lt;</span>PantallaAViewModel<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">PantallaAScreen</span><span class="token punctuation">(</span>
            nombreState <span class="token operator">=</span> vm<span class="token punctuation">.</span>nombreState<span class="token punctuation">,</span>
            onNombreChange <span class="token operator">=</span> vm<span class="token operator">::</span>onNombreChange<span class="token punctuation">,</span>
            onNavigatePantallaB <span class="token operator">=</span> onNavigatePantallaB
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>entonces el <strong><code>ViewModelOwner</code></strong> sería el <strong><code>NavGraph</code></strong> creado por el <strong><code>NavGraphBuilder</code></strong> en el momento de la navegación y <strong>el VM se destruiría al volver atrás en la navegación</strong>. Esto puede ser útil en algunos casos, pero no en este porque perderíamos el estado del nombre introducido por el usuario.</p>
<p>Solo si usamos <strong><a href="https://developer.android.com/guide/navigation/design/nested-graphs">grafos de navegación anidados</a></strong> y el VM está asociado a un grafo anidado. El VM se destruirá al salir del grafo anidado en la navegación. Nosotros en este curso no vamos a tratar este tema por simplificar, pero puedes ver en el enlace anterior como se hace.</p>
</li>
<li>
<p>En <strong><code>PantallaBRoute.kt</code></strong> vamos '<em>setear</em>' en el VM de <strong>B</strong> el nombre recibido como parámetro en la navegación.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>En este caso podríamos pasar directemante como parámetro el nombre a <strong><code>PantallaBRoute</code></strong> pues no se trata de un estado que vaya a modificar. Pero hemos querido mostrar el caso más común de que el parámetro recibido tenga un efecto en algún estado del <strong><code>ViewModel</code></strong> asociado a la pantalla a emitir.</p>
</div>
<pre data-role="codeBlock" data-info="kotlin {highlight=9}" class="language-kotlin kotlin" data-line="9"><code><span class="token annotation builtin">@Serializable</span>
<span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">PantallaBRoute</span><span class="token punctuation">(</span><span class="token keyword keyword-val">val</span> nombre<span class="token operator">:</span> String<span class="token punctuation">)</span>

<span class="token keyword keyword-fun">fun</span> NavGraphBuilder<span class="token punctuation">.</span><span class="token function">pantallaBDestination</span><span class="token punctuation">(</span>
    vm<span class="token operator">:</span> PantallaBViewModel<span class="token punctuation">,</span>
    onNavegarAtras<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit<span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    composable<span class="token operator">&lt;</span>PantallaBRoute<span class="token operator">&gt;</span><span class="token punctuation">{</span> backStackEntry <span class="token operator">-&gt;</span>
        vm<span class="token punctuation">.</span>nombreState <span class="token operator">=</span> remember <span class="token punctuation">{</span> backStackEntry<span class="token punctuation">.</span>toRoute<span class="token operator">&lt;</span>PantallaBRoute<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>nombre <span class="token punctuation">}</span>
        <span class="token function">PantallaBScreen</span><span class="token punctuation">(</span>
            nombre <span class="token operator">=</span> vm<span class="token punctuation">.</span>nombreState<span class="token punctuation">,</span>
            onNavegarAtras <span class="token operator">=</span> onNavegarAtras
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="line-highlight-wrapper">







<div aria-hidden="true" class="line-highlight" data-range="9" data-start="9">
</div></div></pre><p>En este ejemplo simple, '<em>Setear</em>' el nombre el el <strong><code>ViuewModel</code></strong> de la <strong>pantalla B</strong> no desencadena más cambios de estado ni búsquedas en un repositorio, etc. Pero esto no es lo normal. Lo más habitual es que pasemos algún tipo de id o clave primaria de un objeto y que en el <strong><code>ViewModel</code></strong> de la pantalla destino recuperemos el objeto de nuestros repositorios a partir de ese <strong><code>id</code></strong> produciendo el consecuente cambio de estado.</p>
<div class="admonition tip">
<p class="admonition-title">Importante</p>
<p>En este último caso es importante comprobar que el id ha cambiado realmente para evitar hacer búsquedas y recomposiciones innecesarias si se proujese alguna recomposición del <strong><code>NavHost</code></strong>.<br>
Por ejemnplo, definiendo el setter de la propiedad <strong><code>id</code></strong> del <strong><code>ViewModel</code></strong> de la pantalla destino de la siguiente manera:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@HiltViewModel</span> <span class="token keyword keyword-class">class</span> PantallaBViewModel <span class="token annotation builtin">@Inject</span> <span class="token keyword keyword-constructor">constructor</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> repositorio<span class="token operator">:</span> Repositorio
<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">ViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-var">var</span> datosState<span class="token operator">:</span> Datos <span class="token keyword keyword-by">by</span> <span class="token function">mutableStateOf</span><span class="token punctuation">(</span><span class="token function">Datos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-set">set</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">setDatos</span><span class="token punctuation">(</span>id <span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>id <span class="token operator">!=</span> datosState<span class="token punctuation">.</span>id<span class="token punctuation">)</span> datosState <span class="token operator">=</span> repositorio<span class="token punctuation">.</span><span class="token function">getDatos</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
</li>
</ol>
<div style="page-break-after:always;"></div>
<div class="caso_estudio">
<p>🎓 <strong>Caso de estudio:</strong></p>
<p>Puedes descargar el código aquí: <strong><a href="assets/codigo/tema_4_2/EjemploNavegacionCompartiendoVM_recurso.zip">EjemploNavegacionCompartiendoVM.zip</a></strong> si no sabes seguir alguno de los ejemplos.</p>
<p>Aunque como hemos comentado, no es la opción recomendada por Google. En el siguiente caso de estudio vamos a aplicar lo que hemos visto hasta ahora para en lugar de pasar datos en la navegación, <strong>compartir datos complejos entre <code>ViewModels</code></strong>. Además, vamos a ver como crear un <strong>destino de navegación que sea un diálogo</strong>.</p>
<ol>
<li>
<p>Creamos una feature <strong><code>datos</code></strong> con el siguiente contenido:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">DatosUiState</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-val">val</span> nombre<span class="token operator">:</span> String <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Jhon"</span></span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> apellido<span class="token operator">:</span> String <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Doe"</span></span>
<span class="token punctuation">)</span>
</code></pre></li>
<li>
<p>En el paquete <strong><code>.features.datos.ver</code></strong> definimos el <strong><code>ViewModel</code></strong> de la pantalla <strong><code>VerDatosScreen.kt</code></strong> y lo denominaremos <strong><code>VerDatosViewModel.kt.</code></strong>. Simplemente me gestionará un estado de tipo <strong><code>DatosUiState</code></strong>.</p>
</li>
<li>
<p>En el paquete <strong><code>.features.datos.editar</code></strong> definimos <strong><code>EditarDatosDialog.kt</code></strong> y <strong><code>EditarDatosEvent.kt</code></strong> que agrupe los eventos de modificar nombre y apellido. Así mismo definirmos <strong><code>EditarDatosViewModel.kt</code></strong> que además de los eventos contenga como antes un estado de tipo <strong><code>DatosUiState</code></strong>.</p>
 <div class="galeria_imagenes">
 <img height="350px" src="assets/imagenes/tema_4_2/NavegarADialogo1.png">
 <img height="350px" src="assets/imagenes/tema_4_2/NavegarADialogo2.png">
 </div>
</li>
<li>
<p>En el paquete <strong><code>.ui.nabigation</code></strong> definimos <strong><code>VerDatosRoute.kt</code></strong> donde <strong>la destinación que recibirá su correspondiente <code>VerDatosViewModel</code></strong> y el callback de nagación desde donde centralizamos la misma.</p>
</li>
<li>
<p>En el paquete <strong><code>.ui.nabigation</code></strong> definimos <strong><code>EditarDatosRoute.kt</code></strong> con el siguiente código.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Serializable</span>
<span class="token keyword keyword-object">object</span> EditarDatosRoute

<span class="token keyword keyword-fun">fun</span> NavGraphBuilder<span class="token punctuation">.</span><span class="token function">editarDatosDestination</span><span class="token punctuation">(</span>
    vm<span class="token operator">:</span> EditarDatosViewModel<span class="token punctuation">,</span>
    onAceptar<span class="token operator">:</span> <span class="token punctuation">(</span>DatosUiState<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit<span class="token punctuation">,</span>
    onCancelar<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    dialog<span class="token operator">&lt;</span>EditarDatosRoute<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">EditarDatosDialog</span><span class="token punctuation">(</span>
            datosState <span class="token operator">=</span> vm<span class="token punctuation">.</span>datosState<span class="token punctuation">,</span>
            onPantallaPrincipalEvent <span class="token operator">=</span> vm<span class="token operator">::</span>onEditarDatosEvent<span class="token punctuation">,</span>
            onAceptar <span class="token operator">=</span> onAceptar<span class="token punctuation">,</span>
            onCancelar <span class="token operator">=</span> onCancelar
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Fíjate que en lugar de <strong><code>composable&lt;EditarDatosRoute&gt;</code></strong> usamos <strong><code>dialog&lt;EditarDatosRoute&gt;</code></strong> para definir un destino de navegación se comporte como un diálogo modal. <strong><code>EditarDatosDialog.kt</code></strong> emite el componente de material3 <strong><code>AlertDialog</code></strong> que ya hemos visto en temas anteriores.</p>
 <div style="page-break-after:always;"></div>
</li>
<li>
<p>La opción de compartir datos entre los ViewModel la centralizaremos al definir el <strong><code>NavHost</code></strong> y <strong>en los callback de navegación al diálogo y volver de la misma</strong>.</p>
<pre data-role="codeBlock" data-info="kotlin {highlight=[5,6, 13-16, 20-23]}" class="language-kotlin kotlin" data-line="5,6,13-16,20-23"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">NavHostCompartiendoVm</span><span class="token punctuation">(</span>
    navController<span class="token operator">:</span> NavHostController
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> vVm <span class="token operator">=</span> hiltViewModel<span class="token operator">&lt;</span>VerDatosViewModel<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> eVm <span class="token operator">=</span> hiltViewModel<span class="token operator">&lt;</span>EditarDatosViewModel<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">NavHost</span><span class="token punctuation">(</span>
        navController <span class="token operator">=</span> navController<span class="token punctuation">,</span>
        startDestination <span class="token operator">=</span> VerDatosRoute
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">verDatosDestination</span><span class="token punctuation">(</span>
            vm <span class="token operator">=</span> vVm<span class="token punctuation">,</span>
            onEditar <span class="token operator">=</span> <span class="token punctuation">{</span>
                eVm<span class="token punctuation">.</span><span class="token function">setDatos</span><span class="token punctuation">(</span>vVm<span class="token punctuation">.</span>datosState<span class="token punctuation">)</span>
                navController<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span>EditarDatosRoute<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
        <span class="token function">editarDatosDestination</span><span class="token punctuation">(</span>
            vm <span class="token operator">=</span> eVm<span class="token punctuation">,</span>
            onAceptar <span class="token operator">=</span> <span class="token punctuation">{</span> datos <span class="token operator">-&gt;</span>
                navController<span class="token punctuation">.</span><span class="token function">popBackStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                vVm<span class="token punctuation">.</span><span class="token function">setDatos</span><span class="token punctuation">(</span>datos<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            onCancelar <span class="token operator">=</span> <span class="token punctuation">{</span> navController<span class="token punctuation">.</span><span class="token function">popBackStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="line-highlight-wrapper">



<div aria-hidden="true" class="line-highlight" data-range="5" data-start="5">
</div></div><div class="line-highlight-wrapper">




<div aria-hidden="true" class="line-highlight" data-range="6" data-start="6">
</div></div><div class="line-highlight-wrapper">











<div aria-hidden="true" class="line-highlight" data-range="13-16" data-start="13" data-end="16">



</div></div><div class="line-highlight-wrapper">


















<div aria-hidden="true" class="line-highlight" data-range="20-23" data-start="20" data-end="23">



</div></div></pre></li>
</ol>
</div> <!-- fin caso de estudio -->
<div style="page-break-after:always;"></div>
<h2 id="gestionar-grafos-de-navegación-complejos">Gestionar grafos de navegación complejos </h2>
<p>Descarga proyecto: <strong><a href="assets/codigo/tema_4_2/EjemploNavegacionJerarquiaCompleja_recurso.zip">EjemploNavegacionJerarquiaCompleja.zip</a></strong></p>
<p>En dicho proyecto hemos definido el siguiente grafo de navegación. Donde hay pantallas que me pueden llevar a <strong>dos posibles destinos</strong> como <strong><code>n1</code></strong>, <strong><code>n21</code></strong> y <strong><code>n22</code></strong>. Otras que me llevan a <strong>un único destino</strong> como <strong><code>n32</code></strong> y pantalla finales que <strong>no tienen destinos</strong> como <strong><code>n31</code></strong>, <strong><code>n33</code></strong> y <strong><code>n4</code></strong>.</p>
<p></p><p align="center" style="zoom:0.7" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 12.2.0 (20241103.1931)
 -->
<!-- Title: G Pages: 1 -->
<svg width="785pt" height="455pt" viewBox="0.00 0.00 784.97 455.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 451)">
<title>G</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-451 780.97,-451 780.97,4 -4,4"></polygon>
<!-- NavGraph -->
<g id="node1" class="node">
<title>NavGraph</title>
<path fill="#ffffff" stroke="#ffffff" d="M439.33,-447C439.33,-447 352.67,-447 352.67,-447 347.33,-447 342,-441.67 342,-436.33 342,-436.33 342,-425.67 342,-425.67 342,-420.33 347.33,-415 352.67,-415 352.67,-415 439.33,-415 439.33,-415 444.67,-415 450,-420.33 450,-425.67 450,-425.67 450,-436.33 450,-436.33 450,-441.67 444.67,-447 439.33,-447"></path>
<text text-anchor="middle" x="396" y="-425" font-family="Arial" font-size="20.00">NavGraph</text>
</g>
<!-- n1 -->
<g id="node2" class="node">
<title>n1</title>
<path fill="#cee9fa" stroke="#cee9fa" d="M438,-396C438,-396 354,-396 354,-396 348,-396 342,-390 342,-384 342,-384 342,-336 342,-336 342,-330 348,-324 354,-324 354,-324 438,-324 438,-324 444,-324 450,-330 450,-336 450,-336 450,-384 450,-384 450,-390 444,-396 438,-396"></path>
<text text-anchor="middle" x="396" y="-354" font-family="Arial" font-size="20.00">n1</text>
</g>
<!-- NavGraph&#45;&gt;n1 -->
<g id="edge1" class="edge">
<title>NavGraph-&gt;n1</title>
<path fill="none" stroke="#104e8b" stroke-width="2" d="M396,-414.69C396,-412.97 396,-411.17 396,-409.3"></path>
<polygon fill="#104e8b" stroke="#104e8b" stroke-width="2" points="399.5,-409.35 396,-399.35 392.5,-409.35 399.5,-409.35"></polygon>
</g>
<!-- n21 -->
<g id="node3" class="node">
<title>n21</title>
<path fill="#88d2f2" stroke="#88d2f2" d="M330,-288C330,-288 246,-288 246,-288 240,-288 234,-282 234,-276 234,-276 234,-228 234,-228 234,-222 240,-216 246,-216 246,-216 330,-216 330,-216 336,-216 342,-222 342,-228 342,-228 342,-276 342,-276 342,-282 336,-288 330,-288"></path>
<text text-anchor="middle" x="288" y="-246" font-family="Arial" font-size="20.00">n21</text>
</g>
<!-- n1&#45;&gt;n21 -->
<g id="edge2" class="edge">
<title>n1-&gt;n21</title>
<path fill="none" stroke="#104e8b" stroke-width="2" d="M341.68,-347.84C323.39,-341.32 304.71,-331.07 293.12,-315 290.12,-310.83 288.05,-306.07 286.68,-301.08"></path>
<polygon fill="#104e8b" stroke="#104e8b" stroke-width="2" points="290.16,-300.69 285.06,-291.4 283.26,-301.84 290.16,-300.69"></polygon>
<text text-anchor="middle" x="346.06" y="-301.5" font-family="Arial" font-size="15.00" fill="#104e8b">popBackStack()</text>
</g>
<!-- n22 -->
<g id="node4" class="node">
<title>n22</title>
<path fill="#88d2f2" stroke="#88d2f2" d="M560,-288C560,-288 476,-288 476,-288 470,-288 464,-282 464,-276 464,-276 464,-228 464,-228 464,-222 470,-216 476,-216 476,-216 560,-216 560,-216 566,-216 572,-222 572,-228 572,-228 572,-276 572,-276 572,-282 566,-288 560,-288"></path>
<text text-anchor="middle" x="518" y="-246" font-family="Arial" font-size="20.00">n22</text>
</g>
<!-- n1&#45;&gt;n22 -->
<g id="edge3" class="edge">
<title>n1-&gt;n22</title>
<path fill="none" stroke="#104e8b" stroke-width="2" d="M436.62,-323.7C446.6,-315.03 457.41,-305.65 467.78,-296.63"></path>
<polygon fill="#104e8b" stroke="#104e8b" stroke-width="2" points="470.01,-299.33 475.27,-290.13 465.42,-294.04 470.01,-299.33"></polygon>
<text text-anchor="middle" x="517.24" y="-301.5" font-family="Arial" font-size="15.00" fill="#104e8b">popBackStack()</text>
</g>
<!-- n31 -->
<g id="node5" class="node">
<title>n31</title>
<path fill="#41a9d0" stroke="#41a9d0" d="M96,-180C96,-180 12,-180 12,-180 6,-180 0,-174 0,-168 0,-168 0,-120 0,-120 0,-114 6,-108 12,-108 12,-108 96,-108 96,-108 102,-108 108,-114 108,-120 108,-120 108,-168 108,-168 108,-174 102,-180 96,-180"></path>
<text text-anchor="middle" x="54" y="-138" font-family="Arial" font-size="20.00">n31</text>
</g>
<!-- n21&#45;&gt;n31 -->
<g id="edge4" class="edge">
<title>n21-&gt;n31</title>
<path fill="none" stroke="#104e8b" stroke-width="2" d="M233.53,-241.28C202.53,-234.4 163.61,-223.42 131.62,-207 121.58,-201.85 111.61,-195.29 102.33,-188.37"></path>
<polygon fill="#104e8b" stroke="#104e8b" stroke-width="2" points="104.59,-185.7 94.55,-182.32 100.3,-191.22 104.59,-185.7"></polygon>
<text text-anchor="middle" x="175.81" y="-193.5" font-family="Arial" font-size="15.00" fill="#104e8b">popUpTo(n1)</text>
</g>
<!-- n4 -->
<g id="node8" class="node">
<title>n4</title>
<path fill="#118fb2" stroke="#118fb2" d="M400,-72C400,-72 316,-72 316,-72 310,-72 304,-66 304,-60 304,-60 304,-12 304,-12 304,-6 310,0 316,0 316,0 400,0 400,0 406,0 412,-6 412,-12 412,-12 412,-60 412,-60 412,-66 406,-72 400,-72"></path>
<text text-anchor="middle" x="358" y="-30" font-family="Arial" font-size="20.00">n4</text>
</g>
<!-- n21&#45;&gt;n4 -->
<g id="edge5" class="edge">
<title>n21-&gt;n4</title>
<path fill="none" stroke="#104e8b" stroke-width="2" d="M298.6,-215.61C307.4,-186.59 320.41,-144.5 332.62,-108 335.18,-100.34 337.98,-92.25 340.76,-84.38"></path>
<polygon fill="#104e8b" stroke="#104e8b" stroke-width="2" points="343.99,-85.74 344.05,-75.14 337.4,-83.39 343.99,-85.74"></polygon>
<text text-anchor="middle" x="376.81" y="-139.5" font-family="Arial" font-size="15.00" fill="#104e8b">popUpTo(n1)</text>
</g>
<!-- n32 -->
<g id="node6" class="node">
<title>n32</title>
<path fill="#41a9d0" stroke="#41a9d0" d="M562,-180C562,-180 478,-180 478,-180 472,-180 466,-174 466,-168 466,-168 466,-120 466,-120 466,-114 472,-108 478,-108 478,-108 562,-108 562,-108 568,-108 574,-114 574,-120 574,-120 574,-168 574,-168 574,-174 568,-180 562,-180"></path>
<text text-anchor="middle" x="520" y="-138" font-family="Arial" font-size="20.00">n32</text>
</g>
<!-- n22&#45;&gt;n32 -->
<g id="edge6" class="edge">
<title>n22-&gt;n32</title>
<path fill="none" stroke="#104e8b" stroke-width="2" d="M502.49,-215.78C500.9,-209.45 499.95,-202.8 501.14,-192.88"></path>
<polygon fill="#104e8b" stroke="#104e8b" stroke-width="2" points="504.57,-193.58 502.93,-183.12 497.68,-192.32 504.57,-193.58"></polygon>
<text text-anchor="middle" x="554.06" y="-193.5" font-family="Arial" font-size="15.00" fill="#104e8b">popBackStack()</text>
</g>
<!-- n33 -->
<g id="node7" class="node">
<title>n33</title>
<path fill="#41a9d0" stroke="#41a9d0" d="M761,-180C761,-180 677,-180 677,-180 671,-180 665,-174 665,-168 665,-168 665,-120 665,-120 665,-114 671,-108 677,-108 677,-108 761,-108 761,-108 767,-108 773,-114 773,-120 773,-120 773,-168 773,-168 773,-174 767,-180 761,-180"></path>
<text text-anchor="middle" x="719" y="-138" font-family="Arial" font-size="20.00">n33</text>
</g>
<!-- n22&#45;&gt;n33 -->
<g id="edge7" class="edge">
<title>n22-&gt;n33</title>
<path fill="none" stroke="#104e8b" stroke-width="2" d="M572.27,-231.05C589.45,-224.11 608.31,-215.83 625,-207 636.15,-201.1 647.64,-194.24 658.61,-187.28"></path>
<polygon fill="#104e8b" stroke="#104e8b" stroke-width="2" points="660.33,-190.33 666.82,-181.96 656.52,-184.46 660.33,-190.33"></polygon>
<text text-anchor="middle" x="715.69" y="-193.5" font-family="Arial" font-size="15.00" fill="#104e8b">popBackStack(n1)</text>
</g>
<!-- n32&#45;&gt;n4 -->
<g id="edge8" class="edge">
<title>n32-&gt;n4</title>
<path fill="none" stroke="#104e8b" stroke-width="2" d="M466.06,-107.7C452.19,-98.63 437.14,-88.78 422.79,-79.39"></path>
<polygon fill="#104e8b" stroke="#104e8b" stroke-width="2" points="424.8,-76.53 414.52,-73.98 420.97,-82.38 424.8,-76.53"></polygon>
<text text-anchor="middle" x="501.64" y="-85.5" font-family="Arial" font-size="15.00" fill="#104e8b">popBackStack()</text>
</g>
</g>
</svg>
</p><p></p>
<p>Pero fijémonos en la gestión que se hace de los retornos indicada en cada arista del grafo:</p>
<ul>
<li>Si indicamos <strong><code>popBackStack()</code></strong> indicaremos que cuando se vuelva de la pantalla de destino se irá justoa a la anterior de donde se llamó.</li>
<li>Si indicamos <strong><code>popBackStack(n1)</code></strong> como de <strong><code>n22</code></strong> a  <strong><code>n33</code></strong> indicaremos que cuando se vuelva de la pantalla de destino se irá a la pantalla indicada en el parámetro de la función en este caso al nodo inicial.</li>
<li>Si indicamos <strong><code>popUpTo(n1)</code></strong> como de <strong><code>n21</code></strong> a  <strong><code>n24</code></strong> indicaremos que cualquier <strong><code>popBackStack</code></strong> en el destino siempre me llevará a <strong><code>n1</code></strong>. En este último caso si llegamos a <strong><code>n4</code></strong> desde <strong><code>n21</code></strong> volveremos a <strong><code>n1</code></strong> al hacer un <strong><code>popBackStack</code></strong> pero si llegamos desde <strong><code>n32</code></strong> volveremos justo a la pantalla de origen <strong><code>n32</code></strong>.</li>
</ul>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">NavHostEjemploJerarquiaCompleja</span><span class="token punctuation">(</span>navController<span class="token operator">:</span> NavHostController<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">NavHost</span><span class="token punctuation">(</span>navController <span class="token operator">=</span> navController<span class="token punctuation">,</span>
        startDestination <span class="token operator">=</span> Nivel1Route<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">nivel1Destination</span><span class="token punctuation">(</span>
            onNavigateNivel21 <span class="token operator">=</span> <span class="token punctuation">{</span> navController<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span>Nivel21Route<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            onNavigateNivel22 <span class="token operator">=</span> <span class="token punctuation">{</span> navController<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span>Nivel22Route<span class="token punctuation">)</span> <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
        <span class="token function">nivel21Destination</span><span class="token punctuation">(</span>
            onNavigateNivel31 <span class="token operator">=</span> <span class="token punctuation">{</span>
                navController<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span>Nivel31Route<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">popUpTo</span><span class="token punctuation">(</span>Nivel1Route<span class="token punctuation">)</span> <span class="token punctuation">{</span> inclusive <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            onNavigateNivel4 <span class="token operator">=</span> <span class="token punctuation">{</span>
                navController<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span><span class="token function">Nivel4Route</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"N1 &gt; N2.1"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">popUpTo</span><span class="token punctuation">(</span>Nivel1Route<span class="token punctuation">)</span> <span class="token punctuation">{</span> inclusive <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            onNavegarAtras <span class="token operator">=</span> <span class="token punctuation">{</span> navController<span class="token punctuation">.</span><span class="token function">popBackStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
        <span class="token function">nivel22Destination</span><span class="token punctuation">(</span>
            onNavigateNivel32 <span class="token operator">=</span> <span class="token punctuation">{</span> navController<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span>Nivel32Route<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            onNavigateNivel33 <span class="token operator">=</span> <span class="token punctuation">{</span> navController<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span>Nivel33Route<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            onNavegarAtras <span class="token operator">=</span> <span class="token punctuation">{</span> navController<span class="token punctuation">.</span><span class="token function">popBackStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
        <span class="token function">nivel31Destination</span><span class="token punctuation">(</span>
            onNavegarAtras <span class="token operator">=</span> <span class="token punctuation">{</span> navController<span class="token punctuation">.</span><span class="token function">popBackStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
        <span class="token function">nivel32Destination</span><span class="token punctuation">(</span>
            onNavigateNivel4 <span class="token operator">=</span> <span class="token punctuation">{</span> navController<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span><span class="token function">Nivel4Route</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"N1 &gt; N2.2 &gt; N3.2"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            onNavegarAtras <span class="token operator">=</span> <span class="token punctuation">{</span> navController<span class="token punctuation">.</span><span class="token function">popBackStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
        <span class="token function">nivel33Destination</span><span class="token punctuation">(</span>
            onNavegarAtras <span class="token operator">=</span> <span class="token punctuation">{</span> navController<span class="token punctuation">.</span><span class="token function">popBackStack</span><span class="token punctuation">(</span>Nivel1Route<span class="token punctuation">,</span> inclusive <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
        <span class="token function">nivel4Destination</span><span class="token punctuation">(</span>
            onNavegarAtras <span class="token operator">=</span> <span class="token punctuation">{</span> navController<span class="token punctuation">.</span><span class="token function">popBackStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Recuerda <strong>profuncizar</strong> en el uso  de <strong><code>popBackStack(...)</code></strong> es muy altamente <strong>recomendable</strong> la lectura <strong><a href="https://developer.android.com/guide/navigation/backstack?hl=es-419#pop-back">documentación oficial de Android</a></strong> ya que por su '<em>complejidad</em>' vamos a dejar fuera del Tema.</p>
<p>Así mimos en <strong><a href="https://developer.android.com/guide/navigation/backstack?hl=es-419#compose-examples">este enlace</a></strong> tienes un ejemplo de como como definir un builder de opciones de navegación con más detalle.</p>
<div style="page-break-after:always;"></div>
<h2 id="integrado-navegación-y-navigationbar">Integrado navegación y NavigationBar </h2>
<div class="flotante" ,="" style="align-items: center;">
<div class="flotante_izq">
<p>En el tema anterior ya vimos como definir diferentes componentes gráficos en la jerarquía superior de la pantalla, definidos en Material3 para navegar de una pantalla a otra. Algunos de estos serían: <strong><code>NavigationBar</code></strong>, <strong><code>NavigationDrawer</code></strong>, <strong><code>PrimaryTabs</code></strong>, etc. En este apartado vamos a ver el caso del <strong><code>NavigationBar</code></strong>. Para ello, vamos a realizar una aplicación con el esquema mostrado a la derecha.</p>
<p>Si nos fijamos en el mismo, el Scaffold no cambia y será el contenido del mismo el que contenga nuestro <strong><code>NavHost</code></strong> que intercambiará diferentes '<em>pantallas</em>' que en este caso hemos denominado <strong>Pantalla1</strong>, <strong>Pantalla2</strong> y <strong>Pantalla3</strong>.</p>
</div>
<div class="flotante_der">
    <img width="500px" src="assets/imagenes/tema_4_2/navhost_2.png">
</div>
</div>
<p>Descarga proyecto de <strong>Ejemplo NavigationBar</strong>: <strong><a href="assets/codigo/tema_4_2/EjemploNavConNavigationBar_recurso.zip">EjemploNavConNavigationBar.zip</a></strong></p>
<p>Puedes ver un esquema de funcionamiento en la siguiente imagen...</p>
<div class="galeria_imagenes">
    <img height="525" src="assets/imagenes/tema_4_2/EjemploNavigationBar.png">
</div>
<div style="page-break-after:always;"></div>
<p>Para simplificar la implementación de la propuesta, no vamos a usar Hilt, ni ViewModel y voy a pasar como parámetro de navegación un entero con el número de la pantalla de donde vengo. Por tanto, siguiendo los pasos descritos a lo largo del tema ...</p>
<ol>
<li>
<p>Definiremos los composables con las pantallas <strong>Pantalla1</strong>, <strong>Pantalla2</strong> y <strong>Pantalla3</strong> en el paquete <strong><code>ui.features</code></strong>. En nuestro caso, será un único componente pantalla denominado <strong><code>PantallaScreen.kt</code></strong> y que tendrá el siguiente interfaz.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-fun">fun</span> <span class="token function">PantallaScreen</span><span class="token punctuation">(</span>
    pantalla<span class="token operator">:</span> Int<span class="token punctuation">,</span>
    pantallaDeDondeVengo<span class="token operator">:</span> Int<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">,</span>
    onNavigatePantallaAnterior<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit
<span class="token punctuation">)</span>
</code></pre><p>Si el parámetro <strong><code>pantallaDeDondeVengo</code></strong> está a <strong><code>null</code></strong> significa que estoy en la primera pantalla. En caso contrario, se mostrará un texto con la pantalla de donde vengo y un botón de navegación para volver a ella que tendrá el mismo efecto que pulsar el icono de la <strong><code>TopAppBar</code></strong> <strong><code>&lt;</code></strong> tal y como se veía en la imagen anterior.</p>
</li>
<li>
<p>En el paquete <strong><code>ui.navigation</code></strong> definiremos nuestro componente <strong><code>NavHost</code></strong>. Pero antes, definiremos un fuente con la especificación de cada uno de los destinos y cómo navegar a ellos. Por ejemplo, vamos a ver la definición de <strong><code>Pantalla1Route.kt</code></strong> ya que <strong><code>Pantalla2Route.kt</code></strong> y <strong><code>Pantalla3Route.kt</code></strong> serán análogos.</p>
<p>Permitimos que <strong><code>pantallaAnterior</code></strong> pueda ser <strong><code>null</code></strong> porque al ser Pantalla1Route el primer destino de navegación, no vendrá de ninguna pantalla anterior, pero podemos volver regresar a ella desde la 2 y la 3 y en ese caso sí que tendremos un valor.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Serializable</span>
<span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">Pantalla1Route</span><span class="token punctuation">(</span><span class="token keyword keyword-val">val</span> pantallaAnterior<span class="token operator">:</span> Int<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>

<span class="token keyword keyword-fun">fun</span> NavGraphBuilder<span class="token punctuation">.</span><span class="token function">pantalla1Destination</span><span class="token punctuation">(</span>
    onNavigatePantallaAnterior<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    composable<span class="token operator">&lt;</span>Pantalla1Route<span class="token operator">&gt;</span><span class="token punctuation">{</span> backStackEntry <span class="token operator">-&gt;</span>
        <span class="token function">PantallaScreen</span><span class="token punctuation">(</span>
            pantalla <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
            pantallaDeDondeVengo <span class="token operator">=</span> backStackEntry<span class="token punctuation">.</span>toRoute<span class="token operator">&lt;</span>Pantalla1Route<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>pantallaAnterior<span class="token punctuation">,</span>
            onNavigatePantallaAnterior <span class="token operator">=</span> onNavigatePantallaAnterior
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div style="page-break-after:always;"></div>
</li>
<li>
<p>Implementados los destinos o rutas, ya podemos definir nuestro <strong><code>NavHost</code></strong> en <strong><code>EjemploNavHost.kt</code></strong>. Este recibirá el <strong><code>NavHostController</code></strong> y lo usará en el el callback que pasamos para volver a la pantalla anterior.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">EjemploNavHost</span><span class="token punctuation">(</span>navController<span class="token operator">:</span> NavHostController<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">NavHost</span><span class="token punctuation">(</span>
        navController <span class="token operator">=</span> navController<span class="token punctuation">,</span>
        startDestination <span class="token operator">=</span> Pantalla1Route
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-val">val</span> onNavigatePantallaAnterior<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit <span class="token operator">=</span> <span class="token punctuation">{</span>
            navController<span class="token punctuation">.</span><span class="token function">popBackStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token function">pantalla1Destination</span><span class="token punctuation">(</span>onNavigatePantallaAnterior <span class="token operator">=</span> onNavigatePantallaAnterior<span class="token punctuation">)</span>
    <span class="token function">pantalla2Destination</span><span class="token punctuation">(</span>onNavigatePantallaAnterior <span class="token operator">=</span> onNavigatePantallaAnterior<span class="token punctuation">)</span>
    <span class="token function">pantalla3Destination</span><span class="token punctuation">(</span>onNavigatePantallaAnterior <span class="token operator">=</span> onNavigatePantallaAnterior<span class="token punctuation">)</span>        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p>Implementaremos <strong><code>Scaffold</code></strong> principal con una <strong><code>TopAppBar</code></strong> y la <strong><code>NavigationBar</code></strong> en el fuente <strong><code>EjemploNavDentroDeUnScaffold.kt</code></strong> tal y como vimos en el tema anterior. Este será emitido desde el <strong><code>setContent</code></strong> de la <strong><code>MainActivity</code></strong> aunque también podremos tener un <strong><code>@Preview</code></strong> y su contenido principal será el <strong><code>NavHost</code></strong>.</p>
<p>Nuestro <strong><code>NavigationBar</code></strong> solo recibe el estado con el índice de la pantalla actual y el callback para navegar a la pantalla seleccionada.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">NavigationBarEnEjemploNav</span><span class="token punctuation">(</span>
    iOpcionNevagacionSeleccionada<span class="token operator">:</span> Int <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    onNavigateToScreen<span class="token operator">:</span> <span class="token punctuation">(</span>Int<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> titlesAndIcons <span class="token operator">=</span> remember <span class="token punctuation">{</span> <span class="token operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
    NavigationBar <span class="token punctuation">{</span>
        titlesAndIcons<span class="token punctuation">.</span><span class="token function">forEachIndexed</span> <span class="token punctuation">{</span> index<span class="token punctuation">,</span> <span class="token punctuation">(</span>title<span class="token punctuation">,</span> icon<span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
            <span class="token function">NavigationBarItem</span><span class="token punctuation">(</span>
                icon <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">Icon</span><span class="token punctuation">(</span>icon<span class="token punctuation">,</span> contentDescription <span class="token operator">=</span> title<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                label <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">Text</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                selected <span class="token operator">=</span> iOpcionNevagacionSeleccionada <span class="token operator">==</span> index<span class="token punctuation">,</span>
                onClick <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">onNavigateToScreen</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token punctuation">}</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div style="page-break-after:always;"></div>
<p>El contenido principal lo metemos dentro de un Box para poder aplicar el padding recibido desde el Scaffold.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">ContenidoPrincipalEnEjemploNav</span><span class="token punctuation">(</span>
    navController<span class="token operator">:</span> NavHostController<span class="token punctuation">,</span>
    modifier<span class="token operator">:</span> Modifier <span class="token operator">=</span> Modifier
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Box</span><span class="token punctuation">(</span>modifier <span class="token operator">=</span> modifier<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">EjemploNavHost</span><span class="token punctuation">(</span>navController<span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Definimos una función de utilidad privada que a partir de la <strong>ruta actual</strong> como <strong><code>NavDestination</code></strong> obtenida de la <strong>pila de nevegación</strong> <strong><code>NavBackStackEntry</code></strong> nos devuelve el índice de la pantalla actual.</p>
<p>Fíjate que usamos el método <strong><code>hasRoute</code></strong> indicándole el tipo de la ruta que queremos comprobar.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">iOpcionNevagacionSeleccionadaAPartirDeDestino</span><span class="token punctuation">(</span>destino<span class="token operator">:</span> NavDestination<span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> Int <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-when">when</span> <span class="token punctuation">{</span>
        destino <span class="token operator">==</span> <span class="token keyword keyword-null">null</span> <span class="token operator">-&gt;</span> <span class="token number">0</span>
        destino<span class="token punctuation">.</span>hasRoute<span class="token operator">&lt;</span>Pantalla1Route<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token number">0</span>
        destino<span class="token punctuation">.</span>hasRoute<span class="token operator">&lt;</span>Pantalla2Route<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token number">1</span>
        destino<span class="token punctuation">.</span>hasRoute<span class="token operator">&lt;</span>Pantalla3Route<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token number">2</span>
        <span class="token keyword keyword-else">else</span> <span class="token operator">-&gt;</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Vamos por último a definir la función <strong><code>EjemploNavDentroDeUnScaffold</code></strong> que como hemos comentado será llamada desde la <strong><code>MainActivity</code></strong>. Veamos sus diferentes partes:</p>
<div class="admonition tip">
<p class="admonition-title">Importante</p>
<p>Cuando pulsemos el botón de volver atrás. <strong>¿Cómo se actualiza el estado de la <code>NavigationBar</code>?</strong>. Fíjate que obtenemos un <strong><code>State&lt;NavBackStackEntry?&gt;</code></strong> con <strong><code>navController.currentBackStackEntryAsState()</code></strong> que se actualizará cada vez que se produzca un cambio en el destino de navegación. De él, obtenemos un estado derivado (<strong><code>derivedStateOf</code></strong>) con el índice de nuestro <strong><code>NavigationBar</code></strong> utilizando la función de utilidad que hemos definido anteriormente y a la que le pasamos la ruta actual con <strong><code>entradaEnPilaDeNavegacionActuasState.destination?</code></strong>.</p>
</div>
<pre data-role="codeBlock" data-info="kotlin {highlight=[7-12]}" class="language-kotlin kotlin" data-line="7-12"><code><span class="token annotation builtin">@OptIn</span><span class="token punctuation">(</span>ExperimentalMaterial3Api<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">)</span>
<span class="token annotation builtin">@Composable</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">EjemploNavDentroDeUnScaffold</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> comportamientoAnteScroll <span class="token operator">=</span> TopAppBarDefaults<span class="token punctuation">.</span><span class="token function">exitUntilCollapsedScrollBehavior</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> navController <span class="token operator">=</span> <span class="token function">rememberNavController</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> entradaEnPilaDeNavegacionActuasState <span class="token keyword keyword-by">by</span> navController<span class="token punctuation">.</span><span class="token function">currentBackStackEntryAsState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> iOpcionNevagacionSeleccionada <span class="token keyword keyword-by">by</span> remember <span class="token punctuation">{</span>
        derivedStateOf <span class="token punctuation">{</span>
            <span class="token function">iOpcionNevagacionSeleccionadaAPartirDeDestino</span><span class="token punctuation">(</span>
                entradaEnPilaDeNavegacionActuasState<span class="token operator">?</span><span class="token punctuation">.</span>destination
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code><div class="line-highlight-wrapper">





<div aria-hidden="true" class="line-highlight" data-range="7-12" data-start="7" data-end="12">





</div></div></pre><p>Definimos ya el componente <strong><code>Scaffold</code></strong> y le pasamos al <strong><code>TopAppBar</code></strong>:</p>
<ol>
<li>El <strong><code>callback</code></strong> para navegar atrás.</li>
<li>El <strong><code>callback</code></strong> para deshacer toda la navegación.</li>
</ol>
<pre data-role="codeBlock" data-info="kotlin {highlight=[8, 11-13]}" class="language-kotlin kotlin" data-line="8,11-13"><code><span class="token function">Scaffold</span><span class="token punctuation">(</span>
    modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">nestedScroll</span><span class="token punctuation">(</span>
        comportamientoAnteScroll<span class="token punctuation">.</span>nestedScrollConnection<span class="token punctuation">)</span><span class="token punctuation">,</span>
    topBar <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token function">TopAppBarEnEjemploNav</span><span class="token punctuation">(</span>
            comportamientoAnteScroll <span class="token operator">=</span> comportamientoAnteScroll<span class="token punctuation">,</span>
            onNavegarAtras <span class="token operator">=</span> <span class="token punctuation">{</span>
                navController<span class="token punctuation">.</span><span class="token function">popBackStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            onDeshacerNavegacion <span class="token operator">=</span> <span class="token punctuation">{</span>
                navController<span class="token punctuation">.</span><span class="token function">popBackStack</span><span class="token punctuation">(</span>
                    navController<span class="token punctuation">.</span>graph<span class="token punctuation">.</span>startDestinationRoute<span class="token operator">!!</span><span class="token punctuation">,</span> <span class="token boolean">false</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code><div class="line-highlight-wrapper">






<div aria-hidden="true" class="line-highlight" data-range="8" data-start="8">
</div></div><div class="line-highlight-wrapper">









<div aria-hidden="true" class="line-highlight" data-range="11-13" data-start="11" data-end="13">


</div></div></pre><p>Nuestro <strong><code>NavigationBar</code></strong> recibirá del índice seleccionado a partir del estado que actulizaba la navegación. De tal manera que sólo con navegar este estado cambiará. Además, le pasamos los callbacks para navegar a la pantalla seleccionada utilizando la funciones de extenxión de NavHostController que hemos definido anteriormente en cada uno de los destinos.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code>bottomBar <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">NavigationBarEnEjemploNav</span><span class="token punctuation">(</span>
        iOpcionNevagacionSeleccionada <span class="token operator">=</span> iOpcionNevagacionSeleccionada<span class="token punctuation">,</span>
        onNavigateToScreen <span class="token operator">=</span> <span class="token punctuation">{</span> i <span class="token operator">-&gt;</span>
            <span class="token keyword keyword-when">when</span> <span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token number">0</span> <span class="token operator">-&gt;</span> navController<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span>
                    <span class="token function">Pantalla1Route</span><span class="token punctuation">(</span>pantallaAnterior <span class="token operator">=</span> iOpcionNevagacionSeleccionada <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
                <span class="token number">1</span> <span class="token operator">-&gt;</span> navController<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span>
                    <span class="token function">Pantalla2Route</span><span class="token punctuation">(</span>pantallaAnterior <span class="token operator">=</span> iOpcionNevagacionSeleccionada <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
                <span class="token number">2</span> <span class="token operator">-&gt;</span> navController<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span>
                    <span class="token function">Pantalla3Route</span><span class="token punctuation">(</span>pantallaAnterior <span class="token operator">=</span> iOpcionNevagacionSeleccionada <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><p>Por último, emitiremos el componente que definía el <strong><code>NavHost</code></strong> en el contenido principal del <strong><code>Scaffold</code></strong>.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code>        content <span class="token operator">=</span> <span class="token punctuation">{</span> innerPadding <span class="token operator">-&gt;</span>
            <span class="token function">ContenidoPrincipalEnEjemploNav</span><span class="token punctuation">(</span>
                navController <span class="token operator">=</span> navController<span class="token punctuation">,</span>
                modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span>innerPadding<span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></li>
</ol>
<div style="page-break-after:always;"></div>
<h2 id="anexo-i---integrado-navegación-y-navigationdrawer">Anexo I - Integrado navegación y NavigationDrawer </h2>
<p>Descarga proyecto de <strong>Ejemplo NavigationDrawer</strong>: <strong><a href="assets/codigo/tema_4_2/EjemploNavConNavigationDrawer_recurso.zip">EjemploNavConNavigationDrawer.zip</a></strong></p>
<p>En el proyecto anterior puedes encontrar un ejemplo análogo al enterior, pero usando un <strong><code>NavigationDrawer</code></strong>. Tendremos 5 destinos de navegación y siempre volveremos a la pantalla1. La pantalla1 además, nos permitirá desplegar el <strong><code>DrawerSheet</code></strong> a través de una acción en su <strong><code>TopAppBar</code></strong>.</p>
<div class="row">
<div class="col-sm-3 my-auto">
<p><img src="assets/imagenes/tema_4_2/NavDrawer/NavDrawer1.png" alt="alt text"></p>
</div>
<div class="col-sm-3 my-auto">
<p><img src="assets/imagenes/tema_4_2/NavDrawer/NavDrawer2.png" alt="alt text"></p>
</div>
<div class="col-sm-3 my-auto">
<p><img src="assets/imagenes/tema_4_2/NavDrawer/NavDrawer3.png" alt="alt text"></p>
</div>
<div class="col-sm-3 my-auto">
<p><img src="assets/imagenes/tema_4_2/NavDrawer/NavDrawer4.png" alt="alt text"></p>
</div>
</div>
<p>1️⃣ En la Pantalla 1 damos por ejemplo acceso al menú y desde ella podemor ir a cualquier otra.<br>
2️⃣ Por ejemplo, si seleccionamos al desplegar la Pantalla 3 se cerrará el menú e iremos a ella.<br>
3️⃣ Desde cualquier Pantalla el volver irá a la Pantalla 1.</p>

      </div>
      
      
    
    
    
    
    
    
  
    </body></html>