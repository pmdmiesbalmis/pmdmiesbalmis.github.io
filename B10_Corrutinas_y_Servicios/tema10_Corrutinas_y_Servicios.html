<!DOCTYPE html><html><head>
      <title>PMDM 2&#xBA; DAM  Tema 10. Corrutinas y Servicios</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css">
      
      
      
      
      
      
      
      
      
      <style>
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}

/* highlight */
pre[data-line] {
  position: relative;
  padding: 1em 0 1em 3em;
}
pre[data-line] .line-highlight-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  background-color: transparent;
  display: block;
  width: 100%;
}

pre[data-line] .line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: hsla(24, 20%, 50%,.08);
  background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}

pre[data-line] .line-highlight:before, 
pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-start);
  position: absolute;
  top: .4em;
  left: .6em;
  min-width: 1em;
  padding: 0 .5em;
  background-color: hsla(24, 20%, 50%,.4);
  color: hsl(24, 20%, 95%);
  font: bold 65%/1.5 sans-serif;
  text-align: center;
  vertical-align: .3em;
  border-radius: 999px;
  text-shadow: none;
  box-shadow: 0 1px white;
}

pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-end);
  top: auto;
  bottom: .4em;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
.markdown-preview.markdown-preview {
  background-color: #FFFF;
}

      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview  ">
      <style>/* 
Añade 

@import "../EstilosPersonalizadosMarkdownEnhanced.less"

justo después del front matter 
*/
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
@font-face {
  font-family: 'Catamaran';
  font-style: normal;
  font-weight: 400;
  src: url(https://fonts.gstatic.com/s/catamaran/v8/o-0bIpQoyXQa2RxT7-5B6Ryxs2E_6n1iPHjd5a7dvg.ttf) format('truetype');
}
.contenedor {
  display: flex;
  justify-content: center;
  margin: 30px auto 30px auto;
}
.fondo {
  background: url(https://programacioniesbalmis.github.io/Imagenes/BannersMoodle/banner.png);
  background-size: cover;
  width: 75%;
  height: 160px;
  border-radius: 10px;
  position: relative;
}
.cita {
  font-family: Arial;
  font-style: italic;
  font-weight: 600;
  text-align: justify;
  line-height: 1.5rem;
  opacity: 0.6;
  color: white;
  padding: 5rem;
  position: relative;
  top: 50%;
  left: 50%;
  font-size: 1.3rem;
  transform: translate(-50%, -50%);
}
.abre_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-left: 30px;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, -15%);
}
.cierra_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-right: 30px;
  right: 0%;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, 55%);
}
.autor {
  font-family: Arial;
  color: white;
  margin: 0px;
  padding-left: 30px;
  position: absolute;
  top: 83%;
  font-size: 1rem;
}
</style>
<h1 class="mume-header undefined" id="apuntes">Apuntes</h1>

<p><a href="./tema10_Corrutinas_y_Servicios.pdf">Descargar estos apuntes</a></p>
<h1 class="mume-header undefined" id="tema-10-corrutinas-y-servicios">Tema 10. Corrutinas y Servicios</h1>

<h2 class="mume-header undefined" id="%C3%ADndice">&#xCD;ndice</h2>

<ol>
<li><a href="#corrutinas-kotlin">Corrutinas Kotlin</a>
<ol>
<li><a href="#alcance-de-las-corrutinas">Alcance de las corrutinas</a></li>
<li><a href="#coroutinecontext">CoroutineContext</a></li>
<li><a href="#funciones-de-suspensi%C3%B3n">Funciones de Suspensi&#xF3;n</a></li>
<li><a href="#builders-de-corrutinas">Builders de corrutinas</a></li>
<li><a href="#viewmodel-y-corrutinas">ViewModel y Corrutinas</a></li>
</ol>
</li>
<li><a href="#servicios">Servicios</a></li>
</ol>
<div style="page-break-after:always;"></div>
<h3 class="mume-header" id="corrutinas-kotlin">Corrutinas Kotlin</h3>

<p>Una <a href="https://kotlinlang.org/docs/coroutines-guide.html">corrutina de Koytlin</a> es un conjunto de sentencias que realizan una tarea espec&#xED;fica, con la capacidad de suspender o resumir su ejecuci&#xF3;n sin bloquear un hilo. Esto permite que tengas diferentes corrutinas cooperando entre ellas y no significa que exista un hilo por cada corrutina, al contrario, puedes ejecutar varias en un solo.</p>
<p>Las corrutinas son parte del paquete kotlinx.coroutines, por lo que necesitas especificar la <a href="https://mvnrepository.com/artifact/org.jetbrains.kotlinx/kotlinx-coroutines-android">dependencia correspondiente</a> en en <strong><code>build.gradle</code></strong>. A d&#xED;a de hoy:</p>
<pre data-role="codeBlock" data-info="json" class="language-json">implementation <span class="token string">&quot;org.jetbrains.kotlinx:kotlinx-coroutines-android:1.5.1&quot;</span>
</pre><p>Las <a href="https://babel.es/es/Media/Blog/Julio-2021/Coroutines-en-el-desarrollo-de-Android">corrutinas en el desarrollo de Android</a>, aunque son un elemento que va a permitirnos crear c&#xF3;digos m&#xE1;s sencillos, al principio pueden parecer complejas debido a su nivel de abstracci&#xF3;n.</p>
<h4 class="mume-header" id="alcance-de-las-corrutinas">Alcance de las corrutinas</h4>

<p>Cuando creamos coroutines asumimos de manera impl&#xED;cita dos aspectos muy importantes: El &#xE1;mbito (CoroutineScope y GlobalScope) y el contexto (CoroutineContext).</p>
<p>El uso de <strong><code>GlobalScope</code></strong> permite crea corrutinas de nivel superior, esto quiere decir que tienen la capacidad de vivir hasta que termine la aplicaci&#xF3;n y es trabajo del desarrollador el control para su cancelaci&#xF3;n, por lo que no se aconseja usar este &#xE1;mbito.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"> <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">ejemploGlobalScope</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           GlobalScope<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>
             <span class="token function">launch</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token function">requireActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;GlobalScope&quot;</span><span class="token punctuation">,</span>
            Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><blockquote>
<p>&#x1F4CC; con <strong><code>launch</code></strong> lanzamos la corrutina en el contexto de la Main para poder mostrar el Toast y dentro de esta lanzamos otra para procesos largos (los tres segundos de retardo).</p>
</blockquote>
<p>Para reducir este alcance, Kotlin nos permite crear los espacios donde queremos que se d&#xE9; la concurrencia. Esto lo haremos mediante <strong><code>CoroutineScope</code></strong>.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin">    <span class="token keyword">var</span> coroutineScope<span class="token operator">=</span> <span class="token function">CoroutineScope</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">ejemploCoroutineScopeConMain</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
       coroutineScope<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">launch</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>isActive<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
            Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token function">requireActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;[CoroutineScope-Main] I&apos;m alive on&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;<span class="token interpolation"><span class="token delimiter variable">${</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token delimiter variable">}</span></span>!&quot;</span><span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//Al salir del fragment se cancela la corutina</span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onDetach</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDetach</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        coroutineScope<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</pre><blockquote>
<p>&#x1F4CC;esta corrutina permanece activa hasta  que sea cancelada de alguna forma. Est&#xE1; lanzada con <strong><code>launch</code></strong> y en el alcance de la Main, por lo que podremos usar el Toast para mostrar la informaci&#xF3;n. El alcance personalizado lo hemos conseguido con el constructor de <strong><code>CoroutineScope()</code></strong></p>
</blockquote>
<p>Cada vez que usamos un constructor de coroutines en realidad estamos haciendo una llamada a una funci&#xF3;n que recibe como primer par&#xE1;metro un objeto de tipo <strong><code>CoroutineContext</code></strong>.</p>
<h4 class="mume-header" id="coroutinecontext">CoroutineContext</h4>

<p>Las coroutines siempre se ejecutan en alg&#xFA;n contexto que est&#xE1; representado por un valor del tipo CoroutineContext.</p>
<div align="center">
    <img height src="./imagenes/corrutinas2.png">
</div>
<p>El contexto de Coroutine es un conjunto de varios elementos. Los elementos principales son el<br>
Job de la Coroutine, su dispatcher y tambi&#xE9;n su Exception handler.</p>
<ul>
<li>
<p><strong>Job</strong> De acuerdo con la documentaci&#xF3;n oficial &quot;Un Job es una cosa cancelable con un ciclo de vida que culmina con su finalizaci&#xF3;n. Los trabajos de coroutine se crean con <strong><code>launch coroutine builder</code></strong>. Ejecuta un bloque de c&#xF3;digo especificado y se completa a la finalizaci&#xF3;n de este bloque&quot;.</p>
<p>La ejecuci&#xF3;n de un trabajo no produce un valor de resultado. Deber&#xED;amos utilizar una interfaz <strong><code>Deferred</code></strong> para un trabajo que produzca un resultado. Un trabajo con resultado (Deferred), se crea con el <strong><code>async coroutine builder</code></strong> y el resultado se puede recuperar con el m&#xE9;todo <strong><code>await()</code></strong>, que lanza una excepci&#xF3;n si el Deferred ha fallado.</p>
<p>Los jobs tienen un par de funciones interesantes que pueden ser muy &#xFA;tiles. Pero es importante entender que un Job puede tener a su vez otro Job padre. Ese job padre tiene cierto control sobre los hijos, y ah&#xED; es donde entran en juego estas funciones:</p>
<ul>
<li>job.join -&gt; Con est&#xE1; funci&#xF3;n, se puede bloquear la corrutina asociada con el job hasta que todos los jobs hijos hayan finalizado. Todas las funciones de suspension que se llaman dentro de una corrutina est&#xE1;n vinculadas a job, as&#xED; que el job puede detectar cu&#xE1;ndo finalizan todos los jobs hijos y despu&#xE9;s continuar la ejecuci&#xF3;n. job.join() es una funci&#xF3;n de suspensi&#xF3;n en s&#xED; misma, por lo que debe llamarse dentro de otra corrutina.</li>
<li>job.cancel -&gt; Esta funci&#xF3;n cancelar&#xE1; todos sus jobs hijos asociados. job.cancel() esta es una funci&#xF3;n normal, por lo que no requiere una corrutina para ser llamada.</li>
</ul>
<blockquote>
<p>&#x270B; Con GlobalScope el padre no va a esperar la finalizaci&#xF3;n de sus hijos y una vez que el padre es cancelado, los otros trabajos van a seguir corriendo aparte. Es decir, en este caso es responsabilidad del desarrollador llevar el control del tiempo de vida de las coroutines porque no hay sincronizaci&#xF3;n con los trabajos hijos.</p>
</blockquote>
</li>
<li>
<p><strong>Dispacher</strong> En Kotlin, todas las Coroutines deben ejecutarse en un dispatcher incluso cuando se ejecutan en el hilo principal. los Dispatchers son un tipo de contextos de corrutina que especifican el hilo o hilos que pueden ser utilizados por la corrutina para ejecutar su c&#xF3;digo. Hay dispatchers que solo usan un hilo (como Main) y otros que definen un grupo de hilos que se optimizar&#xE1;n para ejecutar todas las corrutinas que reciben. Para especificar d&#xF3;nde deben ejecutarse las coroutines, Kotlin proporciona tres Dispatchers que puedes utilizar:</p>
<ul>
<li><strong><code>Dispatchers.Main</code></strong>. Hilo principal en Android, interact&#xFA;a con la UI y realiza trabajos ligeros como: llamar a funciones de suspensi&#xF3;n, llamar a funciones de la interfaz de usuario y actualizar LiveData</li>
<li><strong><code>Dispatchers.IO</code></strong>. En general, todas las tareas que bloquear&#xE1;n el hilo mientras esperan la respuesta. Optimizado para la E/S de disco y red fuera del hilo principal: solicitudes de bases de datos, lectura/escritura de archivos,sensores, conexi&#xF3;n en red, ...</li>
<li><strong><code>Dispatchers.Default</code></strong>. Optimizado para el trabajo intensivo de la CPU fuera del hilo principal: ordenar una lista, an&#xE1;lisis de JSON, utilidades</li>
</ul>
</li>
</ul>
 <div align="center">
    <img height="200" src="./imagenes/corrutinas1.png">
</div>
<ul>
<li><strong>Exception Handler</strong>. Este elemento es opcional del CoroutineContext, y nos permite manejar excepciones no capturadas. Y de esta forma mejorar la expericencia de usuario</li>
</ul>
<h4 class="mume-header" id="funciones-de-suspensi%C3%B3n">Funciones de Suspensi&#xF3;n</h4>

<p>Las corrutinas se basan en las <strong>funciones de suspension</strong>  que son funciones normales a las que se les agrega el modificador <strong><code>suspend</code></strong>, las funciones de suspensi&#xF3;n tienen la capacidad de bloquear la ejecuci&#xF3;n de la corrutina mientras est&#xE1;n haciendo su trabajo. Una vez que termina, el resultado de la operaci&#xF3;n se devuelve y se puede utilizar en la siguiente l&#xED;nea.<br>
De esta manera se agregan dos nuevas operaciones (adem&#xE1;s de invocar / llamar y regresar ):</p>
<ul>
<li>suspender - pausa la ejecuci&#xF3;n de la corrutina actual, guardando todas las variables locales. El hilo actual puede continuar con su trabajo, mientras que el c&#xF3;digo de suspensi&#xF3;n se ejecuta en otro hilo.</li>
<li>reanudar : contin&#xFA;a una corrutina suspendida desde el lugar donde se paus&#xF3; cuando el resultado est&#xE1; listo.</li>
</ul>
<p>Las funciones de suspensi&#xF3;n solo pueden llamarse o ejecutarse dentro de una corrutina o dentro de otra funci&#xF3;n de suspensi&#xF3;n.<br>
Algunas de las funciones usadas con frecuencias para lanzar corrutinas son funciones de suspensi&#xF3;n en si mismas, tales como <strong><code>delay, join, await, withContext, supervisorScope, etc.</code></strong>.</p>
<h5 class="mume-header" id="withcontext">withContext</h5>

<p>Esta es una funci&#xF3;n de suspensi&#xF3;n que permite cambiar f&#xE1;cilmente el contexto que se utilizar&#xE1; para ejecutar una parte del c&#xF3;digo dentro de una corrutina. <strong><code>WithContext</code></strong> es una funci&#xF3;n de suspensi&#xF3;n en s&#xED; misma.</p>
<h4 class="mume-header" id="builders-de-corrutinas">Builders de corrutinas</h4>

<p>Los constructores de coroutinas sirven para iniciar las corrutinas. Tenemos diferentes builders dependiendo de lo que queramos hacer, e incluso t&#xE9;cnicamente se pueden crear personalizados. Pero para la mayor&#xED;a de los casos son suficientes con los que proporciona la librer&#xED;a:</p>
<ul>
<li>
<p><strong><code>runBlocking</code></strong>, este builder bloquea el hilo actual hasta que se terminen todas las tareas dentro de esa corrutina. No suele ser una funcionalidad muy usada de las corrutinas, ya que precisamente lo que se pretende con estas es la sincronizaci&#xF3;n de m&#xE1;s de una tarea.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin">    <span class="token keyword">fun</span> <span class="token function">ejemploRunBlocking</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
            <span class="token function">runBlocking</span> <span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">//Lanzamos tres corrutinas con launch</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">..</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">launch</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Default<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">//delay es una funcion de suspensi&#xF3;n por lo que al</span>
                        <span class="token comment">//lanzar las tres corrutinas el tiempo no duran 5segundos</span>
                        <span class="token comment">//ya que se hacen las tres intercaladas</span>
                        <span class="token comment">//a diferencia de sleep</span>
                        Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">&quot;CORRUTINA&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;<span class="token interpolation"><span class="token delimiter variable">${</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token delimiter variable">}</span></span>&quot;</span><span class="token punctuation">)</span>
                        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token function">requireActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;Ya han terminado las tareas lanzadas&quot;</span><span class="token operator">+</span>
        <span class="token string">&quot;con el constructor runBlocking.&quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;\nSe desbloquea el hilo principal y se muestra este texto&quot;</span><span class="token punctuation">,</span>
        Toast<span class="token punctuation">.</span>LENGTH_LONG<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</pre><blockquote>
<p>&#x1F4CC;en este ejemplo lanzamos una corrutina que a su vez lanza otras tres corrutinas, la primera con <strong><code>runBlocking</code></strong> bloquear&#xE1; el hilo principal, por lo que el <strong><code>Toast</code></strong> no ocurrir&#xE1; hasta que no terminen todas las subrutinas hijas de <strong><code>runBlocking</code></strong>. <strong><code>launch</code></strong> se lanza, en este ejemplo, en un contexto que no es el Main, por lo que nunca podremos introducir ninguna interacci&#xF3;n con las vistas (por eso la salida la realizamos mediante log). Cada una de las tres corrutinas lanzadas por launch permanecer&#xE1; 5 segundos de espera, pero al realizarse al mismo tiempo, el retardo es de poco m&#xE1;s de 5 segundo. Si  el bucle no lanzara las tres subrutinas con launch y solo dejaramos el <strong><code>delay</code></strong> el retardo ser&#xED;a de unos 15 segundos aproximadamente.</p>
</blockquote>
</li>
<li>
<p><strong><code>launch</code></strong>, este es el builder m&#xE1;s usado. A diferencia de runBlocking, no bloquear&#xE1; el subproceso actual (si se usan los dispatchers adecuados).Launch devuelve un Job, que permitir&#xE1; realizar las funciones explicadas anteriormente.<br>
Cuando <strong>launch</strong> se usa sin par&#xE1;metros, hereda el contexto (y por lo tanto el dispatcher) del CoroutineScope desde el que se inicia. Puede iniciarse dentro de otra corrutina omitiendose o no el Dispachers, pero si no est&#xE1; dentro de una corrutina necesitar&#xE1; obligatoriamente especificar el alcance. Launch nos devuelve un Job, que permitir&#xE1; realizar las funciones explicadas anteriormente.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token operator">..</span><span class="token punctuation">.</span>
<span class="token comment">//launch especificando el alcance mediante CoroutineScope</span>
<span class="token function">CoroutineScope</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">//Al estar dentro de una corrutina padre, se puede omitir </span>
<span class="token comment">//el alcance e incluso el Dispatchers si no queremos cambiar </span>
<span class="token comment">//el contexto del padre, en este caso si lo cambiamos</span>
<span class="token function">launch</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token operator">..</span><span class="token punctuation">.</span>    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">..</span><span class="token punctuation">.</span>
</pre></li>
<li>
<p><strong><code>async</code></strong>, este otro builder permite ejecutar varias tareas en segundo plano en paralelo. No es una funci&#xF3;n de suspensi&#xF3;n en s&#xED; misma, por lo que cuando ejecutamos async, el proceso en segundo plano se inicia, pero la siguiente l&#xED;nea se ejecuta de inmediato. <strong><code>async</code></strong> siempre debe llamarse dentro de otra corrutina, y devuelve un job especializado que se llama <strong><code>Deferred</code></strong>.<br>
<strong><code>Deferred</code></strong> tiene una nueva funci&#xF3;n de suspensi&#xF3;n  llamada <strong><code>await()</code></strong> que es la que bloquea. Llamaremos a await() solo cuando necesitemos el resultado. Si el resultado a&#xFA;n no esta listo, la corrutina se suspende en ese punto. Si ya tenemos el resultado, simplemente lo devolver&#xE1; y continuar&#xE1;.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">ejemploAsyncAway</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> cadena<span class="token operator">:</span>String<span class="token operator">?</span><span class="token operator">=</span><span class="token keyword">null</span>
    <span class="token function">CoroutineScope</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">launch</span> <span class="token punctuation">{</span>
        <span class="token keyword">val</span> job<span class="token operator">=</span>async <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">..</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                tiempo<span class="token punctuation">.</span>text <span class="token operator">=</span>i<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token string">&quot;Ha terminado la corrutina async&quot;</span>
        <span class="token punctuation">}</span>
        cadena<span class="token operator">=</span>job<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token function">requireActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>cadena<span class="token punctuation">,</span>Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><blockquote>
<p>&#x1F4CC; lanzamos el <strong><code>async</code></strong> dentro de una corrutina launch con contesto Main, para poder pintar cada segundo el texto que nos interese (en este caso un contador de 1 a 5). Cambiamos el Dispacher a IO para realizar el retardo y devolvemos una cadena como respuesta del <strong><code>async</code></strong>. Cuando termine el trabajo la corrutina, recuperaremos la cadena con <strong><code>await</code></strong> y se lanzar&#xE1; el Toast que la utiliza.</p>
</blockquote>
</li>
</ul>
<h4 class="mume-header" id="viewmodel-y-corrutinas">ViewModel y Corrutinas</h4>

<p>ViewModel es extendido con una propiedad <strong><code>viewModelScope</code></strong> que se encarga de cancelar las corrutinas cuando ya no son necesarias.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token comment">//propiedad viewModelScope extendida de CoroutineScope y</span>
<span class="token comment">//que a su vez extiende el ViewModel</span>
<span class="token keyword">val</span> ViewModel<span class="token punctuation">.</span>viewModelScope<span class="token operator">:</span> CoroutineScope
   <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token keyword">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><p>Gracias al comportamiento de <strong><code>CoroutineScope</code></strong> a trav&#xE9;s de la propiedad <strong><code>viewModelScope</code></strong> se realiza un seguimiento de todas las corrutinas que se crean en este ambito. Por lo tanto, si se cancela un alcance, se cancelan todas las corrutinas creadas en &#xE9;l.</p>
<p>Por ejemplo, en el siguiente c&#xF3;digo creamos un ViewModel que nos gestionar&#xE1; un <strong><code>MutableLiveData</code></strong> de tipo ArrayList de Strings y que tiene un m&#xE9;todo que simula una descarga de datos que se guardar&#xE1;n en el objeto:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword">class</span> ItemViewModel <span class="token operator">:</span> <span class="token function">ViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> valores <span class="token operator">=</span>
        <span class="token function">arrayOf</span><span class="token punctuation">(</span><span class="token string">&quot;item1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;item2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;item3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;item4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;item5&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;item6&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;item7&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;item8&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">var</span> liveData <span class="token operator">=</span>
        MutableLiveData<span class="token operator">&lt;</span>ArrayList<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//:MutableLiveData&lt;String&gt; by lazy { MutableLiveData&lt;String&gt;() }</span>
    <span class="token keyword">val</span> datos<span class="token operator">:</span> LiveData<span class="token operator">&lt;</span>ArrayList<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> liveData

    <span class="token keyword">fun</span> <span class="token function">descargarDatos</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">val</span> random <span class="token operator">=</span> <span class="token function">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">var</span> aux <span class="token operator">=</span> ArrayList<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">//Simulaci&#xF3;n de una descarga lenta de datos</span>
        <span class="token keyword">val</span> numeroElementos <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
        viewModelScope<span class="token punctuation">.</span><span class="token function">launch</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">0</span><span class="token operator">..</span>numeroElementos<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                aux<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>valores<span class="token punctuation">[</span>random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>valores<span class="token punctuation">.</span>size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            liveData<span class="token punctuation">.</span>value <span class="token operator">=</span> aux
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><blockquote>
<p>&#x1F4CC;en el m&#xE9;todo <strong>descargarDatos</strong> se usa la propiedad <strong><code>viewModelScope</code></strong> para lanzar la corrutina que producir&#xE1; el retardo y la lista generada con elementos aleatorios.</p>
</blockquote>
<p>El uso del ViewModel desde las distintas partes de la aplicaci&#xF3;n, es igual al que hemos visto en temas anteriores.</p>
<h3 class="mume-header" id="servicios">Servicios</h3>

<p>A la hora de realizar lo que llamamos <strong>long-time running tasks</strong>, es decir tareas que tienen que estar durante un gran tiempo en segundo plano y no tienen porqu&#xE9; estar ligadas a la actividad que las ha lanzado, una de las opciones para llevarlas a cabo, son los <strong>Servicios</strong>. Los servicios son componentes que se ejecutan en background (o segundo plano) y que no interact&#xFA;an con el usuario. La plataforma Android ofrece una gran cantidad de servicios predefinidos, disponibles regularmente a trav&#xE9;s de la clase Manager. De esta manera, en nuestras actividades podremos acceder a estos servicios a trav&#xE9;s del m&#xE9;todo getSystemService().<br>
Pero nosotros como programadores podemos definir nuestros propios servicios. Por defecto los servicios corren en el mismo proceso que el hilo (thread) de la aplicaci&#xF3;n. Por lo tanto es necesario ejecutar procesamiento as&#xED;ncrono en el servicio para realizar tareas de uso intensivo de recursos en background. Un m&#xE9;todo com&#xFA;nmente usado es crear y ejecutar un nuevo thread en el servicio para realizar la tarea requerida y finalizar dicho hilo cuando se termin&#xF3; de ejecutar la tarea.<br>
Tenemos varias opciones para que nuestra activity se comunique con un servicio.<br>
&#xF0FC; Usar intent: es un escenario simple donde no se requiere comunicaci&#xF3;n directa ni notificaciones de procesos. El servicio recibe los datos v&#xED;a intent y realiza la tarea que sea necesaria sin devolver ning&#xFA;n tipo de dato. Un escenario donde podemos utilizar esto es cuando necesitamos actualizar un content provider. El servicio recibe los datos v&#xED;a intent, actualiza el content provider y este notifica a nuestra app que el contenido est&#xE1; actualizado, sin que se requiera alguna acci&#xF3;n extra por nuestro servicio.<br>
&#xF0FC; Usar receivers: otro m&#xE9;todo es emitir eventos y registrar receptores (receivers, clase BroadcastReceiver) para establecer la comunicaci&#xF3;n. Por ejemplo, una activity registra din&#xE1;micamente un receiver para un evento, y el servicio es el encargado de emitir ese evento. Este escenario se usa cuando es necesario que el escenario notifique que termin&#xF3; de hacer alguna tarea.<br>
Si el servicio creado va a realizar tareas que tengan un coste computacional elevado, se pueden provocar problemas en la aplicaci&#xF3;n (Application Not Responding o ANR), para evitar situaciones como estas, el servicio puede ejecutarse en un hilo secundario, para hacer esto la clase de la que hereda nuestro servicio debe ser IntentService, en caso contrario heredar&#xE1; de Service.<br>
Por otro lado, si necesitamos utilizar servicios propios, estos deben ir declarados en el archivo AndroidManifest.xml. Para desarrollar con servicios hay que tener muy claros estos puntos.</p>
<p>Android <strong><code>WorkManager</code></strong> es una biblioteca de procesamiento en segundo plano que se utiliza para ejecutar tareas en segundo plano que deber&#xED;an ejecutarse de forma garantizada, pero no necesariamente de forma inmediata. Con WorkManager podemos poner en cola nuestro procesamiento en segundo plano incluso cuando la aplicaci&#xF3;n no se est&#xE1; ejecutando y el dispositivo se reinicia por alguna raz&#xF3;n. WorkManager tambi&#xE9;n nos permite definir las restricciones necesarias para ejecutar la tarea, por ejemplo, la disponibilidad de la red antes de iniciar la tarea en segundo plano.</p>
<p>Android WorkManager es parte de  Android Jetpack  (un conjunto de bibliotecas para guiar a los desarrolladores a escribir aplicaciones de calidad) y es uno de los  componentes de la arquitectura de Android  (colecci&#xF3;n de componentes que ayudan a los desarrolladores a dise&#xF1;ar aplicaciones robustas, probables y f&#xE1;ciles de mantener).<br>
Android WorkManager puede ser una biblioteca de procesamiento en segundo plano perfecta para usar cuando su tarea:</p>
<ol>
<li>
<p>No necesita ejecutarse en un momento espec&#xED;fico</p>
</li>
<li>
<p>Puede aplazarse para su ejecuci&#xF3;n</p>
</li>
<li>
<p>Se garantiza que se ejecutar&#xE1; incluso despu&#xE9;s de que se elimine la aplicaci&#xF3;n o se reinicie el dispositivo.</p>
</li>
<li>
<p>Tiene que cumplir con limitaciones como el suministro de bater&#xED;a o la disponibilidad de la red antes de la ejecuci&#xF3;n.</p>
</li>
</ol>
<p>El ejemplo m&#xE1;s simple de esto puede ser cuando su aplicaci&#xF3;n necesita cargar una gran cantidad de datos de usuario en el servidor.</p>

      </div>
      
      
    
    
    
    
    
    
    
    
  
    </body></html>