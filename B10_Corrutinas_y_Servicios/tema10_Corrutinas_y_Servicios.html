<!DOCTYPE html><html><head>
      <title>PMDM 2&#xBA; DAM  Tema 10. Corrutinas y Servicios</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css">
      
      
      
      
      
      
      
      
      
      <style>
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}

/* highlight */
pre[data-line] {
  position: relative;
  padding: 1em 0 1em 3em;
}
pre[data-line] .line-highlight-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  background-color: transparent;
  display: block;
  width: 100%;
}

pre[data-line] .line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: hsla(24, 20%, 50%,.08);
  background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}

pre[data-line] .line-highlight:before, 
pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-start);
  position: absolute;
  top: .4em;
  left: .6em;
  min-width: 1em;
  padding: 0 .5em;
  background-color: hsla(24, 20%, 50%,.4);
  color: hsl(24, 20%, 95%);
  font: bold 65%/1.5 sans-serif;
  text-align: center;
  vertical-align: .3em;
  border-radius: 999px;
  text-shadow: none;
  box-shadow: 0 1px white;
}

pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-end);
  top: auto;
  bottom: .4em;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
.markdown-preview.markdown-preview {
  background-color: #FFFF;
}

      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview  ">
      <style>/* 
Añade 

@import "../EstilosPersonalizadosMarkdownEnhanced.less"

justo después del front matter 
*/
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
@font-face {
  font-family: 'Catamaran';
  font-style: normal;
  font-weight: 400;
  src: url(https://fonts.gstatic.com/s/catamaran/v8/o-0bIpQoyXQa2RxT7-5B6Ryxs2E_6n1iPHjd5a7dvg.ttf) format('truetype');
}
.contenedor {
  display: flex;
  justify-content: center;
  margin: 30px auto 30px auto;
}
.fondo {
  background: url(https://programacioniesbalmis.github.io/Imagenes/BannersMoodle/banner.png);
  background-size: cover;
  width: 75%;
  height: 160px;
  border-radius: 10px;
  position: relative;
}
.cita {
  font-family: Arial;
  font-style: italic;
  font-weight: 600;
  text-align: justify;
  line-height: 1.5rem;
  opacity: 0.6;
  color: white;
  padding: 5rem;
  position: relative;
  top: 50%;
  left: 50%;
  font-size: 1.3rem;
  transform: translate(-50%, -50%);
}
.abre_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-left: 30px;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, -15%);
}
.cierra_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-right: 30px;
  right: 0%;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, 55%);
}
.autor {
  font-family: Arial;
  color: white;
  margin: 0px;
  padding-left: 30px;
  position: absolute;
  top: 83%;
  font-size: 1rem;
}
</style>
<h1 class="mume-header undefined" id="apuntes">Apuntes</h1>

<p><a href="./tema10_Corrutinas_y_Servicios.pdf">Descargar estos apuntes</a></p>
<h1 class="mume-header undefined" id="tema-10-corrutinas-y-servicios">Tema 10. Corrutinas y Servicios</h1>

<h2 class="mume-header undefined" id="%C3%ADndice">&#xCD;ndice</h2>

<ol>
<li><a href="#corrutinas-kotlin">Corrutinas Kotlin</a>
<ol>
<li><a href="#alcance-de-las-corrutinas">Alcance de las corrutinas</a></li>
<li><a href="#coroutinecontext">CoroutineContext</a></li>
<li><a href="#funciones-de-suspensi%C3%B3n">Funciones de Suspensi&#xF3;n</a></li>
<li><a href="#builders-de-corrutinas">Builders de corrutinas</a></li>
</ol>
</li>
</ol>
<div style="page-break-after:always;"></div>
<h3 class="mume-header" id="corrutinas-kotlin">Corrutinas Kotlin</h3>

<p>Una <a href="https://kotlinlang.org/docs/coroutines-guide.html">corrutina de Koytlin</a> es un conjunto de sentencias que realizan una tarea espec&#xED;fica, con la capacidad suspender o resumir su ejecuci&#xF3;n sin bloquear un hilo. Esto permite que tengas diferentes corrutinas cooperando entre ellas y no significa que exista un hilo por cada corrutina, al contrario, puedes ejecutar varias en un solo.</p>
<p>Las corrutinas hacen parte del paquete kotlinx.coroutines, por lo que necesitas especificar la <a href="https://mvnrepository.com/artifact/org.jetbrains.kotlinx/kotlinx-coroutines-android">dependencia correspondiente</a> en en <strong><code>build.gradle</code></strong>. A d&#xED;a de hoy:</p>
<pre data-role="codeBlock" data-info="json" class="language-json">implementation <span class="token string">&quot;org.jetbrains.kotlinx:kotlinx-coroutines-android:1.5.1&quot;</span>
</pre><p>Las <a href="https://babel.es/es/Media/Blog/Julio-2021/Coroutines-en-el-desarrollo-de-Android">corrutinas en el desarrollo de Android</a>, aunque son un elemento que va a permitirnos crear c&#xF3;digos m&#xE1;s sencillos, al principio pueden parecer complejas debido a su nivel de abstracci&#xF3;n.</p>
<h4 class="mume-header" id="alcance-de-las-corrutinas">Alcance de las corrutinas</h4>

<p>Cuando creamos coroutines asumimos de manera impl&#xED;cita dos aspectos muy importantes: El &#xE1;mbito (CoroutineScope y GlobalScope) y el contexto (CoroutineContext).</p>
<p>El uso de <strong><code>GlobalScope</code></strong> permite crea corrutinas de nivel superior, esto quiere decir que tienen la capacidad de vivir hasta que termine la aplicaci&#xF3;n y es trabajo del desarrollador en control para su cancelaci&#xF3;n, por lo que no se aconseja usar este &#xE1;mbito.</p>
<p>Para reducir este alcance, Kotlin nos permite crear los espacios donde queremos que se d&#xE9; la concurrencia. Esto lo haremos mediante <strong><code>CoroutineScope</code></strong>. Cada vez que usamos un constructor de coroutines en realidad estamos haciendo una llamada a una funci&#xF3;n que recibe como primer par&#xE1;metro un objeto de tipo <strong><code>CoroutineContext</code></strong>.</p>
<h4 class="mume-header" id="coroutinecontext">CoroutineContext</h4>

<p>Las coroutines siempre se ejecutan en alg&#xFA;n contexto que est&#xE1; representado por un valor del tipo CoroutineContext.</p>
<div align="center">
    <img height src="./imagenes/corrutinas2.png">
</div>
<p>El contexto de Coroutine es un conjunto de varios elementos. Los elementos principales son el<br>
Job de la Coroutine, su dispatcher y tambi&#xE9;n su Exception handler.</p>
<ul>
<li>
<p><strong>Job</strong> De acuerdo con la documentaci&#xF3;n oficial &quot;Un Job es una cosa cancelable con un ciclo de vida que culmina con su finalizaci&#xF3;n. Los trabajos de coroutine se crean con launch coroutine builder. Ejecuta un bloque de c&#xF3;digo especificado y se completa a la finalizaci&#xF3;n de este bloque&quot;.</p>
<p>La ejecuci&#xF3;n de un trabajo no produce un valor de resultado. Deber&#xED;amos utilizar una interfaz Deferred para un trabajo que produzca un resultado. Un trabajo con resultado (Deferred), se crea con el constructor async Coroutine y el resultado se puede recuperar con el m&#xE9;todo await(), que lanza una excepci&#xF3;n si el Deferred ha fallado.</p>
<p>Los jobs tienen un par de funciones interesantes que pueden ser muy &#xFA;tiles. Pero es importante entender que un Job puede tener a su vez otro Job padre. Ese job padre tiene cierto control sobre los hijos, y ah&#xED; es donde entran en juego estas funciones:</p>
<ul>
<li>job.join -&gt; Con est&#xE1; funci&#xF3;n, se puede bloquear la corrutina asociada con el job hasta que todos los jobs hijos hayan finalizado. Todas las funciones de suspension que se llaman dentro de una corrutina est&#xE1;n vinculadas a job, as&#xED; que el job puede detectar cu&#xE1;ndo finalizan todos los jobs hijos y despu&#xE9;s continuar la ejecuci&#xF3;n. job.join() es una funci&#xF3;n de suspensi&#xF3;n en s&#xED; misma, por lo que debe llamarse dentro de otra corrutina.</li>
<li>job.cancel -&gt; Esta funci&#xF3;n cancelar&#xE1; todos sus jobs hijos asociados. job.cancel() esta es una funci&#xF3;n normal, por lo que no requiere una corrutina para ser llamada.</li>
</ul>
</li>
<li>
<p><strong>Dispacher</strong> En Kotlin, todas las Coroutines deben ejecutarse en un dispatcher incluso cuando se ejecutan en el hilo principal. los Dispatchers son un tipo de contextos de corrutina que especifican el hilo o hilos que pueden ser utilizados por la corrutina para ejecutar su c&#xF3;digo. Hay dispatchers que solo usan un hilo (como Main) y otros que definen un grupo de hilos que se optimizar&#xE1;n para ejecutar todas las corrutinas que reciben. Para especificar d&#xF3;nde deben ejecutarse las coroutines, Kotlin proporciona tres Dispatchers que puedes utilizar:</p>
<ul>
<li><strong><code>Dispatchers.Main</code></strong>. Hilo principal en Android, interact&#xFA;a con la UI y realiza trabajos ligeros como: llamar a funciones de suspensi&#xF3;n, llamar a funciones de la interfaz de usuario y actualizar LiveData</li>
<li><strong><code>Dispatchers.IO</code></strong>. En general, todas las tareas que bloquear&#xE1;n el hilo mientras esperan la respuesta. Optimizado para la E/S de disco y red fuera del hilo principal: solicitudes de bases de datos, lectura/escritura de archivos,sensores, conexi&#xF3;n en red, ...</li>
<li><strong><code>Dispatchers.Default</code></strong>. Optimizado para el trabajo intensivo de la CPU fuera del hilo principal: ordenar una lista, an&#xE1;lisis de JSON, utilidades</li>
</ul>
</li>
</ul>
 <div align="center">
    <img height="200" src="./imagenes/corrutinas1.png">
</div>
<ul>
<li><strong>Exception Handler</strong>. Este elemento es opcional del CoroutineContext, y nos permite manejar excepciones no capturadas. Y de esta forma mejorar la expericencia de usuario</li>
</ul>
<h4 class="mume-header" id="funciones-de-suspensi%C3%B3n">Funciones de Suspensi&#xF3;n</h4>

<p>Las corrutinas se basan en las <strong>funciones de suspension</strong>  que son funciones normales a las que se les agrega el modificador <strong><code>suspend</code></strong>, las funciones de suspensi&#xF3;n tienen la capacidad de bloquear la ejecuci&#xF3;n de la corrutina mientras est&#xE1;n haciendo su trabajo. Una vez que termina, el resultado de la operaci&#xF3;n se devuelve y se puede utilizar en la siguiente l&#xED;nea.<br>
De esta manera se agregan dos nuevas operaciones (adem&#xE1;s de invocar / llamar y regresar ):</p>
<ul>
<li>suspender - pausa la ejecuci&#xF3;n de la corrutina actual, guardando todas las variables locales. El hilo actual puede continuar con su trabajo, mientras que el c&#xF3;digo de suspensi&#xF3;n se ejecuta en otro hilo.</li>
<li>reanudar : contin&#xFA;a una corrutina suspendida desde el lugar donde se paus&#xF3; cuando el resultado est&#xE1; listo.</li>
</ul>
<p>val user = suspended { userService.doLogin(username, password) }<br>
val currentFriends = suspended { userService.requestCurrentFriends(user) }<br>
Las funciones de suspensi&#xF3;n pueden ejecutarse en el hilo actual o en uno diferente. Depende de c&#xF3;mo se configuren. Las funciones de suspensi&#xF3;n solo pueden ejecutarse dentro de una corrutina o dentro de otra funci&#xF3;n de suspensi&#xF3;n.<br>
Solo se pueden llamar a las funciones de suspensi&#xF3;n desde otras funciones de suspensi&#xF3;n, o utilizando un constructor de corrutinas para iniciar una nueva corrutina. Estas funciones pueden ejecutar una operaci&#xF3;n de larga duraci&#xF3;n y esperar a que se complete sin bloquearse. Hay que tener en cuenta que las funciones de suspensi&#xF3;n se sincronizan autom&#xE1;ticamente con otras variables y funciones del hilo principal.</p>
<p>Vamos a poner en funcionamiento todos estos conocimientos retomando el ejercicio resuelto del bloque 6 <strong>ProgresIndicators</strong>, mejorando la funcionalidad.</p>
<p>withContext<br>
Esta es una funci&#xF3;n que permite cambiar f&#xE1;cilmente el contexto que se utilizar&#xE1; para ejecutar una parte del c&#xF3;digo dentro de una corrutina<br>
withContext es una funci&#xF3;n de suspensi&#xF3;n en s&#xED; misma, por lo que no necesitamos usarla dentro de otra funci&#xF3;n de suspensi&#xF3;n. En su lugar, podemos hacer:</p>
<h4 class="mume-header" id="builders-de-corrutinas">Builders de corrutinas</h4>

<p>Los coroutine builders sirven para iniciar las corrutinas. Tenemos diferentes builders dependiendo de lo que queramos hacer, e incluso t&#xE9;cnicamente se pueden crear personalizados. Pero para la mayor&#xED;a de los casos son suficientes con los que proporciona la librer&#xED;a:</p>
<ul>
<li>
<p><strong><code>runBlocking</code></strong>, este builder bloquea el hilo actual hasta que se terminen todas las tareas dentro de esa corrutina. No suele ser una funcionalidad muy usada de las corrutinas, ya que precisamente lo que se pretende con estas es la sincronizaci&#xF3;n de m&#xE1;s de una tarea.</p>
</li>
<li>
<p><strong><code>launch</code></strong>, este es el builder m&#xE1;s usado. A diferencia de runBlocking, no bloquear&#xE1; el subproceso actual (si se usan los dispatchers adecuados). Este builder siempre necesita un **<code>scope</code>. launch devuelve un Job.</p>
</li>
<li>
<p><strong><code>async</code></strong>, este otro builder permite ejecutar varias tareas en segundo plano en paralelo. No es una funci&#xF3;n de suspensi&#xF3;n en s&#xED; misma, por lo que cuando ejecutamos async, el proceso en segundo plano se inicia, pero la siguiente l&#xED;nea se ejecuta de inmediato. async siempre debe llamarse dentro de otra corrutina, y devuelve un job especializado que se llama Deferred.</p>
</li>
</ul>
<p>Este objeto tiene una nueva funci&#xF3;n  llamada await() que es la que bloquea. Llamaremos a await() solo cuando necesitemos el resultado. Si el resultado a&#xFA;n no esta listo, la corrutina se suspende en ese punto. Si ya tenemos el resultado, simplemente lo devolver&#xE1; y continuar&#xE1;. De esta manera, puedes ejecutar tantas tareas en segundo plano como necesites.<br>
coroutineScope { .. } : Crea un nuevo &#xE1;mbito personalizado y no se completa hasta que todos los Coroutines hijos se completan;<br>
Si el padre se cancela, todos los hijos se cancelan.<br>
El padre siempre esperar&#xE1; a que se completen sus hijos.</p>
<p>No recomiendo el uso de GlobalScope porque el padre no va a esperar la finalizaci&#xF3;n de sus hijos y una vez que el padre es cancelado, los otros trabajos van a seguir corriendo aparte. Es decir, ahora es responsabilidad del desarrollador llevar el control del tiempo de vida de las coroutines porque no hay sincronizaci&#xF3;n con los trabajos hijos.</p>

      </div>
      
      
    
    
    
    
    
    
    
    
  
    </body></html>