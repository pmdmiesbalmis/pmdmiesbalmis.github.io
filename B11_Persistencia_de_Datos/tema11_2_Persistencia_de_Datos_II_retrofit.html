<!DOCTYPE html><html><head>
      <title>PMDM 2&#xBA; DAM  Tema 11. Persistencia de Datos II Retrofit</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.3/dist/katex.min.css">
      
      
      
      
      
      
      
      
      
      <style>
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}

/* highlight */
pre[data-line] {
  position: relative;
  padding: 1em 0 1em 3em;
}
pre[data-line] .line-highlight-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  background-color: transparent;
  display: block;
  width: 100%;
}

pre[data-line] .line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: hsla(24, 20%, 50%,.08);
  background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}

pre[data-line] .line-highlight:before, 
pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-start);
  position: absolute;
  top: .4em;
  left: .6em;
  min-width: 1em;
  padding: 0 .5em;
  background-color: hsla(24, 20%, 50%,.4);
  color: hsl(24, 20%, 95%);
  font: bold 65%/1.5 sans-serif;
  text-align: center;
  vertical-align: .3em;
  border-radius: 999px;
  text-shadow: none;
  box-shadow: 0 1px white;
}

pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-end);
  top: auto;
  bottom: .4em;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
.markdown-preview.markdown-preview .slides > section {
  height: 100%;
  font-size: 90%;
  overflow-y: auto !important;
}
.markdown-preview.markdown-preview .slide code {
  color: yellow;
}

      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview  ">
      <style>/* 
Añade 

@import "../EstilosPersonalizadosMarkdownEnhanced.less"

justo después del front matter 
*/
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
@font-face {
  font-family: 'Catamaran';
  font-style: normal;
  font-weight: 400;
  src: url(https://fonts.gstatic.com/s/catamaran/v17/o-0bIpQoyXQa2RxT7-5B6Ryxs2E_6n1iPHjd5a7dvg.ttf) format('truetype');
}
.contenedor {
  display: flex;
  justify-content: center;
  margin: 30px auto 30px auto;
}
.fondo {
  background: url(https://programacioniesbalmis.github.io/Imagenes/BannersMoodle/banner.png);
  background-size: cover;
  width: 75%;
  height: 160px;
  border-radius: 10px;
  position: relative;
}
.cita {
  font-family: Arial;
  font-style: italic;
  font-weight: 600;
  text-align: justify;
  line-height: 1.5rem;
  opacity: 0.6;
  color: white;
  padding: 5rem;
  position: relative;
  top: 50%;
  left: 50%;
  font-size: 1.3rem;
  transform: translate(-50%, -50%);
}
.abre_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-left: 30px;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, -15%);
}
.cierra_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-right: 30px;
  right: 0%;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, 55%);
}
.autor {
  font-family: Arial;
  color: white;
  margin: 0px;
  padding-left: 30px;
  position: absolute;
  top: 83%;
  font-size: 1rem;
}
</style>
<h1 class="mume-header undefined" id="apuntes">Apuntes</h1>

<p>Descargar estos apuntes en <a href="./tema11_2_Persistencia_de_Datos_II_retrofit.pdf">pdf</a> y <a href="./tema11_2_Persistencia_de_Datos_II_retrofit.html">html</a></p>
<h1 class="mume-header undefined" id="tema-112-persistencia-de-datos-ii-retrofit">Tema 11.2. Persistencia de Datos II Retrofit</h1>

<h2 class="mume-header undefined" id="%C3%ADndice">&#xCD;ndice</h2>

<ol>
<li><a href="#acceso-a-bases-de-datos-remotas">Acceso a bases de datos remotas</a>
<ol>
<li><a href="#introducci%C3%B3n">Introducci&#xF3;n</a></li>
<li><a href="#acceso-a-bases-de-datos-con-apirest-y-retrofit">Acceso a bases de datos con Apirest y Retrofit</a>
<ol>
<li><a href="#definici%C3%B3n-del-servicio-rest">Definici&#xF3;n del Servicio Rest</a></li>
<li><a href="#consumo-de-un-servicio-rest-desde-android">Consumo de un Servicio Rest desde Android</a></li>
</ol>
</li>
</ol>
</li>
</ol>
<div style="page-break-after:always;"></div>
<h2 class="mume-header" id="acceso-a-bases-de-datos-remotas">Acceso a bases de datos remotas</h2>

<h3 class="mume-header" id="introducci%C3%B3n">Introducci&#xF3;n</h3>

<p>Para obtener y guardar informaci&#xF3;n de una base de datos remota, es necesario conectarse a un servidor donde se encontrar&#xE1; la BBDD. El esquema de funcionamiento lo podemos ver en la siguiente imagen:</p>
<div align="center">
    <img height="280" src="./imagenes/imagen1.png">
</div>
<p>En el servidor funcionan en realidad tres componentes b&#xE1;sicos:</p>
<ul>
<li>Una base de datos, que almacena toda la informaci&#xF3;n de los usuarios. Para la BBDD se puede utilizar MySQL, que es de licencia gratuita.</li>
</ul>
<div align="center">
    <img height="180" src="./imagenes/imagen2.png">
</div>
<ul>
<li>
<p>Un servlet , que atiende la petici&#xF3;n recibida, la procesa y env&#xED;a la respuesta correspondiente. Un servlet no es m&#xE1;s que un componente Java, generalmente peque&#xF1;o e independiente de la<br>
plataforma.</p>
</li>
<li>
<p>Un servidor web , donde reside y se ejecuta el servlet , y que permanece a la espera de conexiones HTTP entrantes.</p>
</li>
</ul>
<p>Los formatos m&#xE1;s utilizados para compartir informaci&#xF3;n mediante estos servicios web son XML (y otros derivados) y JSON .</p>
<h5 class="mume-header" id="qu%C3%A9-es-json">&#xBF;Qu&#xE9; es JSON?</h5>

<p>JSON ( Javascript Objec t Notation ) es un formato ligero de intercambio de datos entre clientes y servidores, basado en la sintaxis de Javascript para representar estructuras en forma organizada. Es un formato en texto plano independiente de todo lenguaje de programaci&#xF3;n, es m&#xE1;s, soporta el intercambio de datos en gran variedad de lenguajes de programaci&#xF3;n como PHP Python C++ C# Java y Ruby.</p>
<p>XML tambi&#xE9;n puede usarse para el intercambio, pero debido a que su definici&#xF3;n genera un DOM , el parseo se vuelve extenso y pesado. Adem&#xE1;s de ello XML debe usar Xpath para especificar rutas de elementos y atributos, por lo que demora la reconstrucci&#xF3;n de la petici&#xF3;n. En cambio JSON no requiere restricciones adicionales, simplemente se obtiene el texto plano y el engine de Javascript en los navegadores hace el trabajo de parsing sin ninguna complicaci&#xF3;n.</p>
<h5 class="mume-header" id="tipos-de-datos-en-json">Tipos de datos en JSON</h5>

<p>Similar a la estructuraci&#xF3;n de datos primitivos y complejos en los lenguajes de programaci&#xF3;n, JSON establece varios tipos de datos: cadenas, n&#xFA;meros, booleanos, arrays, objetos y valores null. El prop&#xF3;sito es crear objetos que contengan varios atributos compuestos como pares clave valor. Donde la clave es un nombre que identifique el uso del valor que lo acompa&#xF1;a. Veamos un ejemplo:</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token punctuation">{</span>
   <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">101</span><span class="token punctuation">,</span>
   <span class="token property">&quot;Nombre&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Carlos&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;EstaActivo&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
   <span class="token property">&quot;Notas&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">2.3</span><span class="token punctuation">,</span> <span class="token number">4.3</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</pre><p>La anterior estructura es un objeto JSON compuesto por los datos de un estudiante. Los objetos JSON contienen sus atributos entre llaves <strong><code>{}</code></strong>, al igual que un bloque de c&#xF3;digo en Javascript, donde cada atributo debe ir separado por coma <strong><code>,</code></strong> para diferenciar cada par.</p>
<p>La sintaxis de los pares debe contener dos puntos <strong><code>:</code></strong> para dividir la clave del valor. El nombre del par debe tratarse como cadena y a&#xF1;adirle comillas dobles.<br>
Si notas, este ejemplo trae un ejemplo de cada tipo de dato:</p>
<ul>
<li>
<p>El <em>Id</em> es de tipo entero, ya que contiene un n&#xFA;mero que representa el c&#xF3;digo del estudiante.</p>
</li>
<li>
<p>El <em>Nombre</em> es un string. Usa comillas dobles para identificarlas.</p>
</li>
<li>
<p><em>EstaActivo</em> es un tipo booleano que representa si el estudiante se encuentra en la instituci&#xF3;n educativa o no. Usa las palabras reservadas true y false para declarar el valor.</p>
</li>
<li>
<p><em>Notas</em> es un arreglo de n&#xFA;meros reales. El conjunto de sus elementos debes incluirlos dentro de corchetes <strong><code>[ ]</code></strong> y separarlos por coma.</p>
</li>
</ul>
<p>La idea es crear un mecanismo que permita recibir la informaci&#xF3;n que contiene la base de datos externa en formato JSON hacia la aplicaci&#xF3;n. Con ello se parsear&#xE1; cada elemento y ser&#xE1; interpretado en forma de objeto Java para integrar correctamente el aspecto en la interfaz de usuario.</p>
<p>La clase <strong>JsonObject</strong> de la librer&#xED;a <strong>org.json.JSONObject</strong>, puede interpretar datos con formato JSON y parsearlos a objetos Java o a la inversa.<br>
Veamos una ilustraci&#xF3;n que muestra el proceso de parseo que ser&#xE1; estudiado:</p>
<div align="center">
    <img height="250" src="./imagenes/imagen3.png">
</div>
<ul>
<li>
<p>Como puedes observar el origen de los datos es un servidor externo o hosting que hayas contratado como proveedor para tus servicios web. La aplicaci&#xF3;n web que realiza la gesti&#xF3;n de encriptaci&#xF3;n de los datos a formato <code>JSON</code> puede ser <code>PHP</code>, <code>JavaScript</code>, <code>ASP.NET</code>, etc..</p>
</li>
<li>
<p>Tu aplicaci&#xF3;n Android a trav&#xE9;s de un cliente realiza una petici&#xF3;n a la direcci&#xF3;n URL del recurso con el fin de obtener los datos. Ese flujo entrante debe interpretarse con ayuda de un parser personalizado que implementaran las clases que se utilizan para trabajar con <code>JSON</code>.</p>
</li>
<li>
<p>El resultado final es un conjunto de datos adaptable al <code>API</code> de Android. Dependiendo de tus necesidades, puedes convertirlos en una lista de objetos estructurados que alimenten un adaptador que pueble un ListView o simplemente actualizar la base de datos local de tu aplicaci&#xF3;n en <code>SQLite</code>.</p>
</li>
</ul>
<h3 class="mume-header" id="acceso-a-bases-de-datos-con-apirest-y-retrofit">Acceso a bases de datos con Apirest y Retrofit</h3>

<p>Retrofit es un cliente <em>REST</em> para Android y Java, desarrollado por Square, muy simple y f&#xE1;cil de aprender. Permite hacer peticiones <strong><code>GET</code></strong>, <strong><code>POST</code></strong>, <strong><code>PUT</code></strong>, <strong><code>PATCH</code></strong>, <strong><code>DELETE</code></strong> y <strong><code>HEAD</code></strong>; gestionar diferentes tipos de par&#xE1;metros y parsear autom&#xE1;ticamente la respuesta a un POJO (Plain Old Java Object). Vamos a utilizar esta librer&#xED;a por su facilidad de manejo.</p>
<h4 class="mume-header" id="definici%C3%B3n-del-servicio-rest">Definici&#xF3;n del Servicio Rest</h4>

<p>Como es de suponer, para poder acceder a un servicio Rest desde una de nuestras aplicaciones, este debe de haber sido creado con anterioridad y alojado en un Hosting adecuado.</p>
<p>La parte de creaci&#xF3;n ya sea con PHP, Java, o cualquiera de los otros lenguajes que lo permiten no corresponde a nuestra asignatura, por lo que la pasaremos por alto y usaremos un ApiRest general que se ha proporcionado en el m&#xF3;dulo de Acceso a Datos y que con unas peque&#xF1;as modificaciones es valido para la mayor&#xED;a de casos. La carpeta con el ApiRest est&#xE1; compuesta de los siguientes archivos:</p>
<div align="center">
    <img height="200" src="./imagenes/imagen4.png">
</div>
<p>La configuraci&#xF3;n de nuestro API consta de dos archivos:</p>
<ol>
<li>
<p><strong><code>.htaccess</code></strong> En este archivo se configuran las reglas de acceso, sobre una ruta que le indiquemos en RewriteBase (aqu&#xED; es donde tendremos que a&#xF1;adir la carpeta en la que habremos alojado nuestra API, comenzando y acabando con <em><code>/</code></em>).</p>
<pre data-role="codeBlock" data-info="cmd" class="language-cmd"><code>RewriteEngine On
RewriteBase &quot;/uaurios/&quot;
RewriteRule ^([a-zA-Z0-9_-]*)$ index.php?action=$1&amp;%{QUERY_STRING}
RewriteRule ^([a-zA-Z0-9_-]*)/([a-zA-Z0-9_-]*)$ index.php?action=$1&amp;value=$2&amp;%{QUERY_STRING} [L,QSA]
RewriteRule ^([a-zA-Z0-9_-]*)/([a-zA-Z0-9_-]*)/([a-zA-Z0-9_-]*) index.php?action=$1&amp;field=$2&amp;value=$3&amp;%{QUERY_STRING} [L,QSA]
</code></pre></li>
<li>
<p><strong><code>apirest_variables.php</code></strong>, en este archivo se definen los  datos de conexi&#xF3;n a la base de datos. se indican las tablas que tiene esta y el nombre del identificador de cada una de ellas.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token delimiter important">&lt;?php</span>
    <span class="token comment">// CONFIGURACI&#xD3;N BASE DE DATOS MYSQL</span>
    <span class="token variable">$servername</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;127.0.0.1&quot;</span><span class="token punctuation">;</span>
    <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;root&quot;</span><span class="token punctuation">;</span>
    <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
    
    <span class="token comment">// BASE DE DATOS</span>
    <span class="token variable">$dbname</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;uruariosmensajes&quot;</span><span class="token punctuation">;</span>
    
    <span class="token comment">// TABLAS Y SU CLAVE</span>
    <span class="token variable">$tablas</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$tablas</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;mensajes&quot;</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string double-quoted-string">&quot;_id&quot;</span><span class="token punctuation">;</span>
    <span class="token variable">$tablas</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;usuarios&quot;</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string double-quoted-string">&quot;_id&quot;</span><span class="token punctuation">;</span>
</pre></li>
</ol>
<p>El resto de archivos del ApiREst no tendr&#xE1;n que modificarse, ya que est&#xE1; construida de forma gen&#xE9;rica con las necesidades m&#xE1;s comunes para estos casos. Tendremos que crear la BD y alojar el ApiRest de forma local o en la nube, usando los conocimientos que se tienen del m&#xF3;dulo de Acceso a Datos.</p>
<div style="display: flex; justify-content: space-between; margin-top: 15px">
<div style="width: 70%">
<p><em>Vamos a suponer un ejemplo muy sencillo de una base de datos Usuarios en el que tendremos solamente una tabla Usuarios con dos campos de tipo String (nick y nombre). La BD la habremos construido en el servidor con antelaci&#xF3;n (en este caso con tabla usarios de tres campos, nick y nombre de tipo cadena y _id de tipo num&#xE9;rico autoincrementable como clave). Tambi&#xE9;n crearemos una aplicaci&#xF3;n con dos campos de texto que nos permita insertar los datos del usuario y un bot&#xF3;n flotante de a&#xF1;adir, como se ve en la imagen siguiente:</em></p>
</div>
<div style="width: auto">
    <img height="200px" src="./imagenes/imagen7.png">
</div>
</div>
<h4 class="mume-header" id="consumo-de-un-servicio-rest-desde-android">Consumo de un Servicio Rest desde Android</h4>

<p>Existen diferentes librer&#xED;as que nos permitir&#xED;an consumir los servicios desde la App de Android, pero dada su facilidad vamos a utilizar las librer&#xED;as: <strong>Retrofit2</strong> y <strong>Gson</strong>.</p>
<p>Retrofit la utilizaremos para hacer peticiones y procesar las respuestas del APIRest, mientras que con Gson transformaremos los datos de JSON a los propios que utilice la aplicaci&#xF3;n.</p>
<p>Para ello a&#xF1;adiremos las siguientes l&#xED;neas en el build.gradle de la app, y no olvides incluir permisos de internet:</p>
<pre data-role="codeBlock" data-info="groovy" class="language-groovy">implementation <span class="token string">&quot;com.squareup.retrofit2:converter-gson:2.9.0&quot;</span>
implementation <span class="token string">&apos;com.squareup.retrofit2:retrofit:2.9.0&apos;</span>
</pre><p>Podemos decir que los pasos a seguir ser&#xE1;n los siguientes:</p>
<ol>
<li>
<p>Creaci&#xF3;n de un builder de Retrofit. Para poder utilizar Retrofit necesitas crear un builder que te servir&#xE1; para comunicarte con la API elegida. En la imagen se ha utilizado un m&#xE9;todo para encapsular el c&#xF3;digo, aunque no es necesario.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">crearRetrofit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> ProveedorSersvicio <span class="token punctuation">{</span>
    <span class="token comment">//val url = &quot;http://10.0.2.2/usuarios/&quot; //para el AVD de android</span>
    <span class="token keyword keyword-val">val</span> url<span class="token operator">=</span><span class="token string">&quot;http://xusa.iesdoctorbalmis.info/usuarios/&quot;</span> <span class="token comment">//para servidor del instituto</span>
    <span class="token keyword keyword-val">val</span> retrofit <span class="token operator">=</span> Retrofit<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">baseUrl</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addConverterFactory</span><span class="token punctuation">(</span>GsonConverterFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-return">return</span> retrofit<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>ProveedorSersvicio<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</pre><p>Si te fijas en la segunda l&#xED;nea ver&#xE1;s que hay que escribir la url base de la API a la que har&#xE1;s las peticiones. La obtienes de la documentaci&#xF3;n proporcionada por el creador de la API.</p>
<p>En la siguiente l&#xED;nea hay que indicar la forma de convertir los objetos de la API a los de tu aplicaci&#xF3;n y viceversa, aqu&#xED; es donde espec&#xED;ficas que vas a utilizar Gson.</p>
<p>Este builder lo necesitar&#xE1;s para hacer las llamadas a la API, as&#xED; que procura que sea accesible.</p>
</li>
<li>
<p>Creaci&#xF3;n de las clases Pojo que le servir&#xE1; al Gson para parsear los resultados. Pero primero necesitas conocer la estructura del Json que va a devolverte la API, ya que no hay un patr&#xF3;n establecido. Para conocer la estructura previamente, se puede utilizar PostMan y realizar las diferentes peticiones (GET, POST, PUT, etc) desde este.</p>
<p>Existen aplicaciones o webs que facilitan la creaci&#xF3;n de la clase Pojo a partir de un JSon, como por ejemplo: [<a href="http://www.jsonschema2pojo.org/">http://www.jsonschema2pojo.org/</a>]</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-class">class</span> RespuestaJSon <span class="token punctuation">{</span>
    <span class="token keyword keyword-var">var</span> respuesta <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword keyword-var">var</span> metodo<span class="token operator">:</span> String<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword keyword-null">null</span>
    <span class="token keyword keyword-var">var</span> tabla<span class="token operator">:</span> String<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword keyword-null">null</span>
    <span class="token keyword keyword-var">var</span> mensaje<span class="token operator">:</span> String<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword keyword-null">null</span>
    <span class="token keyword keyword-var">var</span> sqlQuery<span class="token operator">:</span> String<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword keyword-null">null</span>
    <span class="token keyword keyword-var">var</span> sqlError<span class="token operator">:</span> String<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword keyword-null">null</span>
<span class="token punctuation">}</span>
</pre><p>Despu&#xE9;s tienes que crear la estructura de clases para almacenar la informaci&#xF3;n que te resulte &#xFA;til. Clase Usuario en este ejemplo.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-class">class</span> <span class="token function">Usuarios</span><span class="token punctuation">(</span><span class="token keyword keyword-var">var</span> nick<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token keyword keyword-var">var</span> nombre<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token keyword keyword-var">var</span> _id<span class="token operator">:</span> Int <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
</pre></li>
<li>
<p>Otro elemento imprescindible, es la gesti&#xF3;n de los servicios que se quieran utilizar. Para cada uno de ellos se tendr&#xE1; que hacer una petici&#xF3;n a la API. Necesitaremos crear una interfaz con todos los servicios que quieras utilizar. Aqu&#xED; tienes unos ejemplos:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-interface">interface</span> ProveedorSersvicio <span class="token punctuation">{</span>
    <span class="token annotation builtin">@GET</span><span class="token punctuation">(</span><span class="token string">&quot;usuarios&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation builtin">@Headers</span><span class="token punctuation">(</span><span class="token string">&quot;Accept: application/json&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Content-Type: application/json&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">usuarios</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Response<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Usuarios<span class="token operator">&gt;</span><span class="token operator">&gt;</span>

    <span class="token annotation builtin">@GET</span><span class="token punctuation">(</span><span class="token string">&quot;mensajes&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation builtin">@Headers</span><span class="token punctuation">(</span><span class="token string">&quot;Accept: application/json&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Content-Type: application/json&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">mensajes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>Response<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Mensaje<span class="token operator">&gt;</span><span class="token operator">&gt;</span>

    <span class="token annotation builtin">@GET</span><span class="token punctuation">(</span><span class="token string">&quot;mensajes/{nick}&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation builtin">@Headers</span><span class="token punctuation">(</span><span class="token string">&quot;Accept: application/json&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Content-Type: application/json&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getUsuario</span><span class="token punctuation">(</span><span class="token annotation builtin">@Path</span><span class="token punctuation">(</span><span class="token string">&quot;nick&quot;</span><span class="token punctuation">)</span> nick<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> Response<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Usuarios<span class="token operator">&gt;</span><span class="token operator">&gt;</span>

    <span class="token annotation builtin">@POST</span><span class="token punctuation">(</span><span class="token string">&quot;usuarios&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation builtin">@Headers</span><span class="token punctuation">(</span><span class="token string">&quot;Accept: application/json&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Content-Type: application/json&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">insertarUsuario</span><span class="token punctuation">(</span><span class="token annotation builtin">@Body</span> usuarios<span class="token operator">:</span> Usuarios<span class="token punctuation">)</span><span class="token operator">:</span> Response<span class="token operator">&lt;</span>RespuestaJSon<span class="token operator">&gt;</span>

    <span class="token annotation builtin">@POST</span><span class="token punctuation">(</span><span class="token string">&quot;mensajes&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation builtin">@Headers</span><span class="token punctuation">(</span><span class="token string">&quot;Accept: application/json&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Content-Type: application/json&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">insertarMensaje</span><span class="token punctuation">(</span><span class="token annotation builtin">@Body</span> mensaje<span class="token operator">:</span> Mensaje<span class="token punctuation">)</span><span class="token operator">:</span> Response<span class="token operator">&lt;</span>RespuestaJSon<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</pre><p>En el c&#xF3;digo de arriba hay dos servicios dos son de tipo <strong><code>GET</code></strong> sin palabra clave y que servir&#xE1;n para obtener todos los usuarios y todos los mensajes. Luego se tiene otro servicio <strong><code>GET</code></strong> con palabra clave (Nick) que servir&#xE1; para seleccionar los mensajes de un determinado Nick. Y luego dos <strong><code>POST</code></strong> a los que se les pasa en el Body los datos a a&#xF1;adir.</p>
<p>Usando <strong><code>Corrutinas</code></strong> se realizar&#xE1; la llamada a la API, por lo que los m&#xE9;todos de la interfaz deben ser de tipo <strong>suspend</strong>. En cada m&#xE9;todo se indica el tipo de dato que espera obtener, en estos ejemplos la respuesta puede ser o una lista del tipo de objeto de la petici&#xF3;n o un tipo RespuestaJSon, que tendr&#xE1; todos los posibles miembros que nos podr&#xED;a dar alguna de las llamadas invocadas.<br>
Las palabras seguidas del s&#xED;mbolo <strong><code>@</code></strong> dan funcionalidad a los servicios, haci&#xE9;ndolos din&#xE1;micos y reutilizables, para m&#xE1;s informaci&#xF3;n [<a href="http://square.github.io/retrofit/">http://square.github.io/retrofit/</a>]</p>
<blockquote>
<p>&#x1F4A1; Las que gestiona <strong>Retrofit</strong> para invocar la url de la petici&#xF3;n son <strong><code>@GET, @POST, @PUT y @DELETE</code></strong>. El par&#xE1;metro corresponder&#xE1; con la url de la petici&#xF3;n.<br>
En el builder de Retrofit se incluye la url base del api terminada con <strong><code>/</code></strong>, que unida con el par&#xE1;metro del servicio crear&#xE1;n la url completa de la petici&#xF3;n:<br>
<strong><code>@GET -&gt; http://10.0.2.2/usuarios/usuario</code></strong></p>
<ul>
<li>
<p><strong><code>@Header y @Headers</code></strong>. Se usan para especificar los valores que van en la secci&#xF3;n <em>header</em> de la petici&#xF3;n, como por ejemplo en que formato van a ser enviados y recibidos los datos.</p>
</li>
<li>
<p><strong><code>@Path</code></strong>. Sirve para incluir un identificador en la url de la petici&#xF3;n, para obtener informaci&#xF3;n sobre algo espec&#xED;fico. El atributo en el m&#xE9;todo de llamada que sea precedido por <em>@Path</em>, sustituir&#xE1; al identificador entre llaves de la ruta que tenga el mismo nombre.</p>
</li>
<li>
<p><strong><code>@Fields</code></strong>. Nos permite pasar variables b&#xE1;sicas en las peticiones <em>Post y Put</em>.</p>
</li>
<li>
<p><strong><code>@Body</code></strong>. Es equivalente a Fields pero para variables objeto.</p>
</li>
<li>
<p><strong><code>@Query</code></strong>. Se usa cuando la petici&#xF3;n va a necesitar par&#xE1;metros (los valores que van despu&#xE9;s del <strong><code>?</code></strong> en una url).</p>
</li>
</ul>
</blockquote>
</li>
<li>
<p>Pedir datos a la Api ser&#xED;a el &#xFA;ltimo paso a realizar. Retrofit nos da la opci&#xF3;n de realizarlo de manera s&#xED;ncrona o as&#xED;ncrona. Vamos a aprovechar nuestros conocimientos de corrutinas para lanzar la petici&#xF3;n en segundo plano de forma sencilla.</p>
<pre data-role="codeBlock" data-info="kotlin{class=&quot;line-numbers&quot;}" class="language-kotlin line-numbers"><span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">anyadirUsuario</span><span class="token punctuation">(</span>usuarios<span class="token operator">:</span> Usuarios<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-val">val</span> context<span class="token operator">=</span><span class="token keyword keyword-this">this</span>
        <span class="token keyword keyword-var">var</span> salida<span class="token operator">:</span>String<span class="token operator">?</span>
        <span class="token keyword keyword-val">val</span> proveedorServicios<span class="token operator">:</span> ProveedorSersvicio <span class="token operator">=</span> <span class="token function">crearRetrofit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token function">CoroutineScope</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">launch</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-val">val</span> response <span class="token operator">=</span> proveedorServicios<span class="token punctuation">.</span><span class="token function">insertarUsuario</span><span class="token punctuation">(</span>usuarios<span class="token punctuation">)</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>isSuccessful<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-val">val</span> usuariosResponse <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>usuariosResponse <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> salida <span class="token operator">=</span> usuariosResponse<span class="token punctuation">.</span>mensaje
                <span class="token keyword keyword-else">else</span> salida<span class="token operator">=</span>response<span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span>
            <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                Log<span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token string">&quot;Error&quot;</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span><span class="token function">errorBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                salida<span class="token operator">=</span>response<span class="token punctuation">.</span><span class="token function">errorBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
                Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> salida<span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_LONG<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>espera <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> espera<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token function">limpiaControl</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><blockquote>
<p>&#x1F4CC; <strong>Nota:</strong> <strong>L&#xED;nea 4</strong> llamamos al m&#xE9;todo crearRetrofit, que es el que nos devuelve un proveedor de servicios del tipo de interface que hemos creado y nos enlazar&#xE1; con la url del servidor y con el GSon. <strong>L&#xED;neas 5 - 13</strong> se lanza la corrutina con la petici&#xF3;n deseada, cuando se obtenga respuesta se filtra para ver si ha sido correcta y recuperar los datos necesarios, <strong><code>response.body()</code></strong>, en caso contrario se lanza mensaje de error.</p>
</blockquote>
</li>
</ol>
<p><span style="color: DarkRed; font-weight: bold;">&#x2712;&#xFE0F;EjercicioPropuestoBDExternas</span></p>
<p><span style="color: DarkRed; font-weight: bold;">&#x2712;&#xFE0F;EjercicioPropuestoAgenda</span></p>

      </div>
      
      
    
    
    
    
    
    
    
    
  
    </body></html>