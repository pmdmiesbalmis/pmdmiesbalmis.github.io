<!DOCTYPE html><html><head>
      <title>PMDM 2&#xBA; DAM  Tema 11. Persist&#xE8;ncia de Dades III Firebase</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.3/dist/katex.min.css">
      
      
      
      
      
      
      
      
      
      <style>
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}

/* highlight */
pre[data-line] {
  position: relative;
  padding: 1em 0 1em 3em;
}
pre[data-line] .line-highlight-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  background-color: transparent;
  display: block;
  width: 100%;
}

pre[data-line] .line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: hsla(24, 20%, 50%,.08);
  background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}

pre[data-line] .line-highlight:before, 
pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-start);
  position: absolute;
  top: .4em;
  left: .6em;
  min-width: 1em;
  padding: 0 .5em;
  background-color: hsla(24, 20%, 50%,.4);
  color: hsl(24, 20%, 95%);
  font: bold 65%/1.5 sans-serif;
  text-align: center;
  vertical-align: .3em;
  border-radius: 999px;
  text-shadow: none;
  box-shadow: 0 1px white;
}

pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-end);
  top: auto;
  bottom: .4em;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
.markdown-preview.markdown-preview .slides > section {
  height: 100%;
  font-size: 90%;
  overflow-y: auto !important;
}
.markdown-preview.markdown-preview .slide code {
  color: yellow;
}

      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview  ">
      <style>/* 
Añade 

@import "../EstilosPersonalizadosMarkdownEnhanced.less"

justo después del front matter 
*/
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
@font-face {
  font-family: 'Catamaran';
  font-style: normal;
  font-weight: 400;
  src: url(https://fonts.gstatic.com/s/catamaran/v17/o-0bIpQoyXQa2RxT7-5B6Ryxs2E_6n1iPHjd5a7dvg.ttf) format('truetype');
}
.contenedor {
  display: flex;
  justify-content: center;
  margin: 30px auto 30px auto;
}
.fondo {
  background: url(https://programacioniesbalmis.github.io/Imagenes/BannersMoodle/banner.png);
  background-size: cover;
  width: 75%;
  height: 160px;
  border-radius: 10px;
  position: relative;
}
.cita {
  font-family: Arial;
  font-style: italic;
  font-weight: 600;
  text-align: justify;
  line-height: 1.5rem;
  opacity: 0.6;
  color: white;
  padding: 5rem;
  position: relative;
  top: 50%;
  left: 50%;
  font-size: 1.3rem;
  transform: translate(-50%, -50%);
}
.abre_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-left: 30px;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, -15%);
}
.cierra_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-right: 30px;
  right: 0%;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, 55%);
}
.autor {
  font-family: Arial;
  color: white;
  margin: 0px;
  padding-left: 30px;
  position: absolute;
  top: 83%;
  font-size: 1rem;
}
</style>
<h1 class="mume-header undefined" id="apunts">Apunts</h1>

<p>Descarregar aquests apunts en <a href="./tema11_3_Persistencia_de_Datos_III_firebase_val.pdf">pdf</a> y <a href="./tema11_3_Persistencia_de_Datos_III_firebase_val.html">html</a></p>
<h1 class="mume-header undefined" id="tema-113-persist%C3%A8ncia-de-dades-iii-firebase">Tema 11.3. Persist&#xE8;ncia de Dades III Firebase</h1>

<h2 class="mume-header undefined" id="%C3%ADndex">&#xCD;ndex</h2>

<ol>
<li><a href="#acceso-a-base-de-datos-con-firebase">Acceso a Base de Datos con FIREBASE</a>
<ol>
<li><a href="#creant-un-app-de-firebase">Creant un app de Firebase</a></li>
<li><a href="#firestore-database">Firestore DataBase</a>
<ol>
<li><a href="#firebaseui-y-recyclerview">FirebaseUI y RecyclerView</a></li>
<li><a href="#filtrat-i-ordenaci%C3%B3">Filtrat i ordenaci&#xF3;</a></li>
</ol>
</li>
<li><a href="#firebase-auth-autenticaci%C3%B3">Firebase Auth. Autenticaci&#xF3;</a></li>
</ol>
</li>
</ol>
<div style="page-break-after:always;"></div>
<h2 class="mume-header" id="acceso-a-base-de-datos-con-firebase">Acceso a Base de Datos con FIREBASE</h2>

<p><a href="https://firebase.google.com/">Firebase</a> &#xE9;s una plataforma de *backend per a construir aplicacions m&#xF2;bils i web, s&apos;encarrega del maneig de la infraestructura permetent que el desenvolupador s&apos;enfoque en altres aspectes de l&apos;aplicaci&#xF3;. Entre les seues caracter&#xED;stiques s&apos;inclou base de dades de temps real, autenticaci&#xF3; d&apos;usuaris i emmagatzematge (*hosting) est&#xE0;tic. La idea d&apos;usar Firebase &#xE9;s no haver d&apos;escriure codi del costat del servidor i aprofitar al m&#xE0;xim les caracter&#xED;stiques que ens proveeix la plataforma. Per a utilitzar Firebase amb Android disposem d&apos;un SDK, el qual cosa ens permetr&#xE0; integrar-ho f&#xE0;cilment a la nostra aplicaci&#xF3;. Per a aquest exemple construirem un llistat de coses per fer usant la base de dades de temps real de Firebase com backend i autenticaci&#xF3; amb email/password.</p>
<h3 class="mume-header" id="creant-un-app-de-firebase">Creant un app de Firebase</h3>

<p>El primer pas &#xE9;s associar el nostre compte de Firebase a una dels nostres comptes de correu electr&#xF2;nic:</p>
<div align="center">
    <img height="250" src="./imagenes/imagen16.png">
</div>
<p>Una vegada est&#xE0; llesta veurem la pantalla on &#xE9;s possible visualitzar els nostres projectes o crear nous.</p>
<div align="center">
    <img height="250" src="./imagenes/imagen17.png">
</div>
<span style="align: center;">
<table align="center">
<tbody><tr>
<td style="border: 0;">
Per a crear un nou projecte solament haurem d&apos;introduir un nom i l&apos;organitzaci&#xF3; o carpeta principal del projecte. Google ens demanar&#xE0; si volem habilitar Google Analytics en el projecte, el deixarem habilitat.
</td>
<td style="border: 0;">
<div align="center">
    <img width="1000" src="./imagenes/imagen18.png">
</div>
</td>
</tr>
</tbody></table>
</span>
<div align="left">
    <img height="50" src="./imagenes/imagen19.png">
</div>
<p>I ho associarem al compte per defecte. Una vegada realitzats aquests passos, es crear&#xE0; el projecte de firebase.</p>
<p>Posteriorment ens apareixer&#xE0; la pantalla que ens permetr&#xE0; afegir l&apos;aplicaci&#xF3; al nostre projecte Cada projecte estar&#xE0; associat a una o m&#xE9;s aplicacions, per la qual cosa abans de crear el projecte necessitarem crear l&apos;aplicaci&#xF3; o decidir l&apos;espai de noms d&apos;aquesta.</p>
<p><em>Crearem una aplicaci&#xF3; senzilla amb el seg&#xFC;ent aspecte, que ens permeta entendre el funcionament d&apos;acc&#xE9;s a Firebase per a enviar i rebre dades sense autenticaci&#xF3;.</em></p>
<div align="center">
    <img height="200" src="./imagenes/imagen32.png">
</div>
<p>Quan l&apos;usuari meta la informaci&#xF3; en els TextView i prema el bot&#xF3; afegir, la informaci&#xF3; es guarda en Firebase i quan es modifique aquesta des de Firebase, es mostrar&#xE0; un missatge amb el text modificat en el Txt de l&apos;aplicaci&#xF3;.</p>
<div align="center">
    <img height="150" src="./imagenes/imagen20.png">
</div>
<p>Una vegada tinguem l&apos;espai de nom, podrem seguir amb els passos que ens demana Firebase per a crear l&apos;aplicaci&#xF3;. En el nostre cas no ser&#xE0; necessari introduir la signatura de certificaci&#xF3;.</p>
<div align="center">
    <img height="350" src="./imagenes/imagen21.png">
</div>
<p>Just en el moment que acaba de crear-se l&apos;aplicaci&#xF3;, es descarregara un arxiu JSON que haurem de copiar en el nostre projecte Android. Nom&#xE9;s haurem de seguir les instruccions que proporciona molt clarament la p&#xE0;gina Web de Firebase (copiar l&apos;arxiu i afegir les l&#xED;nies que indiquen que usarem serveis de google en els build.gradle de l&apos;app i del projecte).</p>
<ol>
<li>
<p>En el projecte</p>
<pre data-role="codeBlock" data-info="groovy" class="language-groovy">  dependencies <span class="token punctuation">{</span>
     classpath <span class="token string">&quot;com.android.tools.build:gradle:7.0.3&quot;</span>
     classpath <span class="token string">&quot;com.google.gms:google-services:4.3.10&quot;</span> <span class="token comment">//a&#xF1;adir esta l&#xED;nea</span>
     <span class="token punctuation">...</span>
  <span class="token punctuation">}</span>
</pre></li>
<li>
<p>En la APP</p>
<pre data-role="codeBlock" data-info="groovy" class="language-groovy">plugins <span class="token punctuation">{</span>
   id <span class="token string">&apos;com.android.application&apos;</span>
   id <span class="token string">&apos;kotlin-android&apos;</span>
   id <span class="token string">&apos;com.google.gms.google-services&apos;</span>  <span class="token comment">// Google Services plugin</span>
<span class="token punctuation">}</span>

dependencies <span class="token punctuation">{</span>
    <span class="token punctuation">...</span>
    implementation <span class="token string">&apos;androidx.appcompat:appcompat:1.3.1&apos;</span>
    <span class="token comment">//a&#xF1;adir las siguientes dos l&#xED;neas</span>
    implementation <span class="token function">platform</span><span class="token punctuation">(</span><span class="token string">&apos;com.google.firebase:firebase-bom:28.4.1&apos;</span><span class="token punctuation">)</span>
    implementation <span class="token string">&apos;com.google.firebase:firebase-analytics&apos;</span>
    <span class="token punctuation">...</span>
<span class="token punctuation">}</span>
</pre><p>La depend&#xE8;ncia de firebase bom permetr&#xE0; evitar afegir la versi&#xF3; a la resta de depend&#xE8;ncies de Firebase que incloguem en el nostre projecte, facilitant molt el treball.</p>
<p>Molt important no oblidar afegir en el SDK, el servei de Google Play</p>
</li>
</ol>
<div align="center">
    <img height src="./imagenes/imagen22.png">
</div>
<p>En la manera consola podrem accedir a tots els nostres projectes, i podem comprovar l&apos;aplicaci&#xF3; o aplicacions afegides sobre un projecte (podem afegir m&#xE9;s d&apos;una).</p>
<span style="align: center;">
<table align="center">
<tbody><tr style="border:hidden;">
<td align="center" rowspan="2">
<div align="left">
    <img width="400" src="./imagenes/imagen24.png">
</div>
</td>
<td style="border:hidden;">
<div align="center">
    <img height="150" src="./imagenes/imagen23.png">
</div>
</td>
</tr>
<tr>
<td style="border:hidden;">
Accedint a la configuraci&#xF3; de l&apos;aplicaci&#xF3; o del projecte, podrem veure informaci&#xF3; sobre les claus, ANEU d&apos;aplicaci&#xF3; i altra. Tamb&#xE9; podrem descarregar de nou el .json de configuraci&#xF3; dels serveis.
</td>
</tr>

</tbody></table>
</span>
<p>Totes les aplicacions per defecte es troben en manera desenvolupe i sota el pla gratis que suporta fins a 100 connexions concurrents, 1GB d&apos;emmagatzematge i 10GB de transfer&#xE8;ncia en el backend. Despr&#xE9;s de creada l&apos;app ens dirigim a veure els seus detalls, podem entrar en diverses pestanyes que ens permetran treballar amb l&apos;APP, per&#xF2; a nosaltres ens interessa la BD. Firebase ofereix dues solucions de bases de dades en el n&#xFA;vol i accessibles per als clients que admeten sincronitzaci&#xF3; en temps real:</p>
<ul>
<li>
<p><strong><code>Firestore DataBase</code></strong> a vegades tamb&#xE9; nomenada Cloud Firestores, &#xE9;s la base de dades m&#xE9;s recent de Firebase. Aprofita el millor de Realtime Database amb un model de dades nou, permet consultes m&#xE9;s riques i r&#xE0;pides, i l&apos;escalament s&apos;ajusta a un nivell m&#xE9;s alt que Realtime Database.</p>
</li>
<li>
<p><strong><code>Realtime Database</code></strong> &#xE9;s la base de dades original de Firebase. &#xC9;s una soluci&#xF3; eficient i de baixa lat&#xE8;ncia destinada a les apps per a dispositius m&#xF2;bils que necessiten estats sincronitzats entre els clients en temps real. &#xC9;s similar a l&apos;anterior en el seu &#xFA;s, per la qual cosa no l&apos;explicarem.</p>
</li>
</ul>
<div align="center">
    <img height="250" src="./imagenes/imagen25.png">
</div>
<h3 class="mume-header" id="firestore-database">Firestore DataBase</h3>

<p>Base de dades NoSQL flexible, escalable i en el n&#xFA;vol a fi d&apos;emmagatzemar i sincronitzar dades per a la programaci&#xF3; en el costat del client i del servidor. Igual que <a href="https://firebase.google.com/docs/database">Firebase Realtime Database</a> mant&#xE9; les dades sincronitzades entre apps client a trav&#xE9;s d&apos;agents d&apos;escolta en temps real. El model de dades de <a href="https://firebase.google.com/docs/firestore">Firebase Firestore DataBase</a> admet estructures de dades flexibles i jer&#xE0;rquiques.</p>
<p>Emmagatzema les dades en documents organitzats en col&#xB7;leccions, els documents poden contindre objectes niats complexos, a m&#xE9;s de subcolecciones. Est&#xE0; optimitzada per a emmagatzemar grans col&#xB7;leccions de documents xicotets. El model de dades est&#xE0; format per documents, cada document cont&#xE9; un conjunt de parells clau-valor. Tots els documents s&apos;han d&apos;emmagatzemar en col&#xB7;leccions, els documents poden contindre subcolecciones i objectes niats, i tots dos poden incloure camps primitius com strings o tipus d&apos;objectes complexos com a llistes. Les col&#xB7;leccions i els documents es creen de manera impl&#xED;cita en <strong><code>Firestore DataBase</code></strong>. Nom&#xE9;s has d&apos;assignar dades a un document dins d&apos;una col&#xB7;lecci&#xF3;. Si la col&#xB7;lecci&#xF3; o el document no existeixen, <strong><code>Firestore DataBase</code></strong> els crea. Cada document est&#xE0; identificat per una clau &#xFA;nica, que pot generar-se autom&#xE0;ticament o que es pot afegir alhora que el document:</p>
<div align="center">
    <img width src="./imagenes/imagen26.png">
</div>
<p>S&#xF3;n molt similars a JSON, de fet, b&#xE0;sicament s&#xF3;n JSON. Existeixen algunes difer&#xE8;ncies, per exemple: els documents admeten <strong>tipus de dades addicionals</strong> i la seua grand&#xE0;ria es limita a 1 MB, per&#xF2; en general, pots tractar els documents com a registres JSON lleugers. Els documents viuen en col&#xB7;leccions, que simplement s&#xF3;n contenidors de documents. Per exemple, podries tindre una col&#xB7;lecci&#xF3; anomenada users amb els diferents usuaris de la teua app, en la qual hi haja un document que represente a cadascun:</p>
<div align="center">
    <img height="250" src="./imagenes/imagen27.png">
</div>
<p><em>Usant l&apos;exercici del qual hem creat el layout d&apos;inici, afegirem el codi necessari perqu&#xE8; ens permeta interactuar amb Firebase. L&apos;aplicaci&#xF3; guardar&#xE0; usuaris amb contrasenya en la base de dades amb <strong><code>Firebase Cloud Firestone</code></strong> i a m&#xE9;s permetr&#xE0; l&apos;autenticaci&#xF3; amb <strong><code>Firebase Auth</code></strong>.</em></p>
<p><em>En el projecte de Firebase que acabem de crear, afegirem una base de dades <strong>Firestore DataBase</strong>.</em></p>
<div align="center">
    <img height="200" src="./imagenes/imagen28.png">
</div>
<p><em>Haurem de seleccionar la ubicaci&#xF3; de la nostra Base de dades, podem seleccionar ZURIC(europe-west6)</em>. Un element important i que encara no hem esmentat, s&#xF3;n la Regles. La Firebase Cloud Firestore proporciona un llenguatge de regles flexibles basades en expressions i sintaxi similar a la de JavaScript <a href="https://firebase.google.com/docs/firestore/security/get-started?authuser=0">https://firebase.google.com/docs/firestore/security/get-started?authuser=0</a>, que permet definir f&#xE0;cilment la manera en qu&#xE8; les teues dades han d&apos;estructurar-se i indexar-se, i el moment en qu&#xE8; poden sotmetre&apos;s a lectura i escriptura. Aquestes regles les podrem configurar desde la pestanya RULES de la nostra BD,</p>
<div align="center">
    <img height="150" src="./imagenes/imagen29.png">
</div>
<p>Per defecte vindrien configurades per a manera producci&#xF3;, encara que per a iniciar-se podem seleccionar manera de prova (dura 30 dies).</p>
<div align="center">
    <img height="220" src="./imagenes/imagen30.png">
</div>
<div align="center">
    <img height="150" src="./imagenes/imagen31.png">
</div>
<p>Si ens hagu&#xE9;rem conf&#xF3;s o volgu&#xE9;rem canviar les regles, caldria canviar el seu valor i sobretot <strong>No oblidar Publicar</strong>.</p>
<p>Abans de comen&#xE7;ar amb el codi d&apos;acc&#xE9;s a la BD, haurem d&apos;afegir la depend&#xE8;ncia que ens permetr&#xE0; fer-ho:</p>
<pre data-role="codeBlock" data-info="groovy" class="language-groovy">implementation <span class="token string">&apos;com.google.firebase:firebase-firestore&apos;</span>
</pre><p>Per a referenciar a la nostra base de dades solament haurem de crear un objecte de tipus <strong><code>FirebaseFirestore</code></strong>. L&apos;arxiu que descarreguem en enlla&#xE7;ar l&apos;app amb el projecte, &#xE9;s el que s&apos;encarrega de tot el treball intern per a la connexi&#xF3;:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-val">val</span> firebaseFirestore <span class="token operator">=</span> FirebaseFirestore<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><p>Per a fer refer&#xE8;ncia a una col&#xB7;lecci&#xF3; existent o afegir-la en cas de no existir, utilitzarem el m&#xE8;tode <strong><code>collection</code></strong> amb el nom de la col&#xB7;lecci&#xF3; com a argument.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin">firebaseFirestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;Usuarios&quot;</span><span class="token punctuation">)</span>
</pre><p>Aquest m&#xE8;tode retorna una refer&#xE8;ncia a la col&#xB7;lecci&#xF3; seleccionada, i amb ell podrem afegir nous elements a ella (la col&#xB7;lecci&#xF3; es crear&#xE0; en afegir el primer document, en cas d&apos;haver sigut creada anteriorment far&#xE0; la refer&#xE8;ncia solament).</p>
<p>Per a afegir un objecte (document) a la col&#xB7;lecci&#xF3; ho podrem fer de dues maneres:</p>
<ol>
<li>
<p>Deixant que la plataforma genere una clau aleat&#xF3;ria, per a aix&#xF2; utilitzarem el m&#xE8;tode add.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin">    firebaseFirestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;Usuarios&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">Usuario</span><span class="token punctuation">(</span><span class="token string">&quot;Pepe&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;correo@gmail.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre> <div align="center">
     <img height="95" src="./imagenes/imagen33.png">
 </div>
</li>
<li>
<p>Afegint nosaltres la clau, aquesta ha de ser &#xFA;nica perqu&#xE8; l&apos;usuari s&apos;afija.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin">firebaseFirestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;Usuarios&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">document</span><span class="token punctuation">(</span>usuario<span class="token punctuation">.</span>correo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>usuario<span class="token punctuation">)</span>
</pre> <div align="center">
     <img height="95" src="./imagenes/imagen34.png">
 </div>
</li>
</ol>
<p>Per a inserir el valor del nou fill hem utilitzat un objecte de la classe Pojo Usuari, que ens haurem creat amb anterioritat, Firestore converteix autom&#xE0;ticament els atributs amb els seus valors per a poder guardar-los correctament. <strong>Cura haurem de tindre els atributs p&#xFA;blics o usar getter i setter.</strong></p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-class">class</span> Usuario <span class="token operator">:</span> Serializable <span class="token punctuation">{</span>
    <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> usuario<span class="token operator">:</span> String
    <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> correo<span class="token operator">:</span> String

    <span class="token keyword keyword-constructor">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword keyword-constructor">constructor</span><span class="token punctuation">(</span>usuario<span class="token operator">:</span> String<span class="token punctuation">,</span> correo<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>usuario <span class="token operator">=</span> usuario
        <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>correo <span class="token operator">=</span> correo
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>El codi complet per a crear l&apos;aplicaci&#xF3; que ens afegir&#xE0; un usuari cada vegada que premem el bot&#xF3; afegir, de manera que l&apos;aneu de l&apos;usuari siga el correu, ser&#xE0; el seg&#xFC;ent:</p>
<pre data-role="codeBlock" data-info="kotlin{class=&quot;line-numbers&quot;}" class="language-kotlin line-numbers"><span class="token keyword keyword-class">class</span> MainActivity <span class="token operator">:</span> <span class="token function">AppCompatActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> firebaseFirestore<span class="token operator">:</span> FirebaseFirestore
    <span class="token keyword keyword-var">var</span> listenerRegistration<span class="token operator">:</span> ListenerRegistration<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword keyword-null">null</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span>
        firebaseFirestore <span class="token operator">=</span> FirebaseFirestore<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-val">val</span> usuarioET <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>TextInputLayout<span class="token operator">&gt;</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>usuario<span class="token punctuation">)</span>
        <span class="token keyword keyword-val">val</span> correoET <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>TextInputLayout<span class="token operator">&gt;</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>correo<span class="token punctuation">)</span>
        <span class="token keyword keyword-val">val</span> a&#xF1;adir <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>Button<span class="token operator">&gt;</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>anyadir<span class="token punctuation">)</span>

        <span class="token keyword keyword-val">val</span> salida <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>TextView<span class="token operator">&gt;</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>salida<span class="token punctuation">)</span>
        a&#xF1;adir<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">{</span>
            <span class="token keyword keyword-val">val</span> usuario <span class="token operator">=</span> <span class="token function">Usuario</span><span class="token punctuation">(</span>usuarioET<span class="token punctuation">.</span>editText<span class="token operator">?</span><span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                  correoET<span class="token punctuation">.</span>editText<span class="token operator">?</span><span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            firebaseFirestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;Usuarios&quot;</span><span class="token punctuation">)</span>
                             <span class="token punctuation">.</span><span class="token function">document</span><span class="token punctuation">(</span>usuario<span class="token punctuation">.</span>correo<span class="token punctuation">)</span>
                             <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>usuario<span class="token punctuation">)</span>
                             <span class="token punctuation">.</span><span class="token function">addOnSuccessListener</span> <span class="token punctuation">{</span>
                              Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>
                              <span class="token keyword keyword-this">this</span><span class="token punctuation">,</span>
                              <span class="token string">&quot;Usuario A&#xF1;adido&quot;</span><span class="token punctuation">,</span>
                              Toast<span class="token punctuation">.</span>LENGTH_SHORT
                              <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
                             <span class="token punctuation">.</span><span class="token function">addOnFailureListener</span> <span class="token punctuation">{</span> e <span class="token operator">-&gt;</span>
                             Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>
                             <span class="token keyword keyword-this">this</span><span class="token punctuation">,</span>
                             <span class="token string">&quot;Error&quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
                             Toast<span class="token punctuation">.</span>LENGTH_SHORT
                             <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><blockquote>
<p>&#x1F4CC; <strong>Nota:</strong> Com es pot veuen en el codi del OnClick, afegim l&apos;usuari recollit dels EditText creant com a clau el correu, com s&apos;ha explicat anteriorment en el tema.A m&#xE9;s als m&#xE8;todes d&apos;afegir objecte (set o add) se li poden assignaran diferents escuchadores per a comprovar l&apos;estat del proc&#xE9;s. <strong>L&#xED;nia 19 i 25</strong>.</p>
</blockquote>
<p>Per a <a href="https://cloud.google.com/firestore/docs/query-data/queries?hl=es">buscar un document en Cloud Firestore</a>, existeixen diferents possibilitats basades en la clausula <strong>Where</strong>. <em>Per exemple, si quisieramos comprovar si l&apos;aneu de l&apos;usuari no est&#xE0; repetit i nom&#xE9;s en aqueix cas afegir-lo, podr&#xED;em modificar l&apos;anterior codi de la seg&#xFC;ent manera:</em></p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"> <span class="token keyword keyword-fun">fun</span> <span class="token function">compruebaSiExisteyAnayade</span><span class="token punctuation">(</span>usuario<span class="token operator">:</span> Usuario<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        firebaseFirestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;Usuarios&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">whereEqualTo</span><span class="token punctuation">(</span>FieldPath<span class="token punctuation">.</span><span class="token function">documentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> usuario<span class="token punctuation">.</span>correo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addOnCompleteListener</span><span class="token punctuation">(</span>OnCompleteListener<span class="token operator">&lt;</span>QuerySnapshot<span class="token operator">?</span><span class="token operator">&gt;</span>
             <span class="token punctuation">{</span> task <span class="token operator">-&gt;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>task<span class="token punctuation">.</span>isSuccessful<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>task<span class="token punctuation">.</span>result<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">anyadeUsuario</span><span class="token punctuation">(</span>usuario<span class="token punctuation">)</span> 
                    <span class="token keyword keyword-else">else</span> Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>
                        <span class="token keyword keyword-this">this</span><span class="token punctuation">,</span>
                        <span class="token string">&quot;El correo ya existe, introduce uno nuevo&quot;</span><span class="token punctuation">,</span>
                        Toast<span class="token punctuation">.</span>LENGTH_LONG
                    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                    Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">,</span> task<span class="token punctuation">.</span>exception<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                         Toast<span class="token punctuation">.</span>LENGTH_LONG<span class="token punctuation">)</span>
                         <span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">anyadeUsuario</span><span class="token punctuation">(</span>usuario<span class="token operator">:</span> Usuario<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        firebaseFirestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;Usuarios&quot;</span><span class="token punctuation">)</span>
                         <span class="token punctuation">.</span><span class="token function">document</span><span class="token punctuation">(</span>usuario<span class="token punctuation">.</span>correo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>usuario<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addOnSuccessListener</span> <span class="token punctuation">{</span>
                Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>
                    <span class="token keyword keyword-this">this</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;Usuario A&#xF1;adido&quot;</span><span class="token punctuation">,</span>
                    Toast<span class="token punctuation">.</span>LENGTH_SHORT
                <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">addOnFailureListener</span> <span class="token punctuation">{</span> e <span class="token operator">-&gt;</span>
                Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>
                    <span class="token keyword keyword-this">this</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;Error&quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
                    Toast<span class="token punctuation">.</span>LENGTH_SHORT
                <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><p>Si quisieramos donar funcionalitat al bot&#xF3; <strong>Eliminar</strong>, podem fer alguna cosa semblan&#xE7;a al seg&#xFC;ent. En aquest cas s&apos;est&#xE0; eliminant per nom d&apos;usuari, aix&#xED; que en el cas d&apos;existir m&#xE9;s d&apos;un document amb el mateix nom, s&apos;eliminaran tots.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-fun">fun</span> <span class="token function">Elimina</span><span class="token punctuation">(</span>usuario<span class="token operator">:</span> Usuario<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        firebaseFirestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;Usuarios&quot;</span><span class="token punctuation">)</span>
                         <span class="token punctuation">.</span><span class="token function">whereEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;usuario&quot;</span><span class="token punctuation">,</span> usuario<span class="token punctuation">.</span>usuario<span class="token punctuation">)</span>
                         <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addOnCompleteListener</span> <span class="token punctuation">{</span> task <span class="token operator">-&gt;</span> 
               <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>documento <span class="token keyword keyword-in">in</span> task<span class="token punctuation">.</span>result<span class="token operator">!!</span><span class="token punctuation">)</span> documento<span class="token punctuation">.</span>reference<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
                                   <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><p>Si el que volem &#xE9;s controlar els canvis que ocorren en la BD, siga a trav&#xE9;s d&apos;una aplicaci&#xF3; o directament des de la consola de Firebase, haurem de registrar un listener del tipus ListenerRegistration, que s&apos;inicialitzar&#xE0; sobre la consulta que desitgem amb <strong><code>addSnapshotListener</code></strong>. <em>En el seg&#xFC;ent exemple posem a escoltar tots els documents de la col&#xB7;lecci&#xF3; Usuaris, mostrant en el TextView (que est&#xE0; sota els botons) el resultat de qualsevol modificaci&#xF3; en qualsevol document de la col&#xB7;lecci&#xF3;.</em></p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-fun">fun</span> <span class="token function">listarUsuarios</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-val">val</span> query <span class="token operator">=</span> firebaseFirestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;Usuarios&quot;</span><span class="token punctuation">)</span>
        listenerRegistration <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">addSnapshotListener</span> <span class="token punctuation">{</span>value<span class="token punctuation">,</span> error<span class="token operator">-&gt;</span>
           <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>error <span class="token operator">==</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>dc <span class="token keyword keyword-in">in</span> value<span class="token operator">!!</span><span class="token punctuation">.</span>documentChanges<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-when">when</span> <span class="token punctuation">(</span>dc<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        DocumentChange<span class="token punctuation">.</span>Type<span class="token punctuation">.</span>ADDED <span class="token operator">-&gt;</span> salida<span class="token punctuation">.</span>text <span class="token operator">=</span>
                            <span class="token string">&quot;<span class="token interpolation"><span class="token delimiter variable">${</span>salida<span class="token punctuation">.</span>text<span class="token delimiter variable">}</span></span>\nSe ha a&#xF1;adido:&quot;</span><span class="token operator">+</span>
                             <span class="token string">&quot;<span class="token interpolation"><span class="token delimiter variable">${</span>dc<span class="token punctuation">.</span>document<span class="token punctuation">.</span>data<span class="token delimiter variable">}</span></span>\n&quot;</span><span class="token punctuation">.</span><span class="token function">trimIndent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        DocumentChange<span class="token punctuation">.</span>Type<span class="token punctuation">.</span>MODIFIED <span class="token operator">-&gt;</span> salida<span class="token punctuation">.</span>text <span class="token operator">=</span>
                            <span class="token string">&quot;<span class="token interpolation"><span class="token delimiter variable">${</span>salida<span class="token punctuation">.</span>text<span class="token delimiter variable">}</span></span>\n Se ha modificado:&quot;</span><span class="token operator">+</span>
                            <span class="token string">&quot;<span class="token interpolation"><span class="token delimiter variable">${</span>dc<span class="token punctuation">.</span>document<span class="token punctuation">.</span>data<span class="token delimiter variable">}</span></span>\n&quot;</span><span class="token punctuation">.</span><span class="token function">trimIndent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        DocumentChange<span class="token punctuation">.</span>Type<span class="token punctuation">.</span>REMOVED <span class="token operator">-&gt;</span> salida<span class="token punctuation">.</span>text <span class="token operator">=</span>
                            <span class="token string">&quot;<span class="token interpolation"><span class="token delimiter variable">${</span>salida<span class="token punctuation">.</span>text<span class="token delimiter variable">}</span></span>\nSe ha eliminado:&quot;</span><span class="token operator">+</span>
                            <span class="token string">&quot;<span class="token interpolation"><span class="token delimiter variable">${</span>dc<span class="token punctuation">.</span>document<span class="token punctuation">.</span>data<span class="token delimiter variable">}</span></span>\n&quot;</span><span class="token punctuation">.</span><span class="token function">trimIndent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-else">else</span>  Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">,</span> <span class="token string">&quot;No se puede listar&quot;</span><span class="token operator">+</span>error<span class="token punctuation">,</span> 
                                  Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><p>Es pot realitzar la consulta sobre qualsevol element de la col&#xB7;lecci&#xF3; despr&#xE9;s d&apos;haver sigut seleccionat, de la seg&#xFC;ent manera:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin">query<span class="token punctuation">.</span><span class="token function">whereEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;correo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;manuel@gamil.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addSnapshotListener</span><span class="token punctuation">{</span><span class="token operator">..</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</pre><blockquote>
<p>&#x26A0;&#xFE0F; <strong>Av&#xED;s:</strong> Un altre tema important a tindre en compte, &#xE9;s que la subscripci&#xF3; a una refer&#xE8;ncia d&apos;una base de dades de Firebase, &#xE9;s a dir, el fet d&apos;assignar un listener a una ubicaci&#xF3; de l&apos;arbre per a estar al corrent dels seus canvis <strong>no &#xE9;s una cosa gratu&#xEF;ta</strong> des del punt de vista de consum de recursos. Per tant, &#xE9;s recomanable eliminar aqueixa subscripci&#xF3; quan ja no la necessitem. Per a fer aix&#xF2; n&apos;hi ha prou amb cridar al m&#xE8;tode <strong><code>remove()</code></strong> del listener registrat, quan no desitgem continuar escoltant.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        listenerRegistration<span class="token operator">!!</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</pre></blockquote>
<h4 class="mume-header" id="firebaseui-y-recyclerview">FirebaseUI y RecyclerView</h4>

<p><a href="https://github.com/firebase/FirebaseUI-Android">FirebaseUI</a> ens permet associar f&#xE0;cilment a un control <strong><code>ListView</code></strong> o <strong><code>RecyclerView</code></strong>, una refer&#xE8;ncia a una llista d&apos;elements d&apos;una base de dades Firebase. D&apos;aquesta manera, el control s&apos;actualitzar&#xE0; autom&#xE0;ticament cada vegada que es produ&#xEF;sca qualsevol canvi en la llista, sense haver de gestionar manualment per part nostra els esdeveniments de la llista, ni haver d&apos;emmagatzemar en una estructura paral&#xB7;lela la informaci&#xF3;, ni haver de construir gran part dels adaptadors necessaris&#x2026; en resum, estalviant moltes l&#xED;nies de codi i evitant molts possibles errors. Per a utilitzar <strong><code>FirebaseUI</code></strong> el primer que haurem de fer ser&#xE0; afegir la refer&#xE8;ncia a la llibreria en el fitxer build.gradle del nostre m&#xF2;dul principal. Cal tindre en compte que cada versi&#xF3; de <strong><code>FirebaseUI</code></strong> &#xE9;s compatible &#xFA;nicament amb una versi&#xF3; concreta de *Firebase, per la qual cosa hem d&apos;assegurar que les versions utilitzades de totes dues llibreries s&#xF3;n coherents. En la p&#xE0;gina de <strong><code>FirebaseUI</code></strong> teniu disponible la taula de compatibilitats entre versions. En el moment d&apos;actualitzaci&#xF3; d&apos;aquestes anotacions:</p>
<pre data-role="codeBlock" data-info="groovy" class="language-groovy">implementation <span class="token string">&apos;com.firebaseui:firebase-ui-firestore:8.0.0&apos;</span>
</pre><p>Aquesta llibreria ens proveeix d&apos;una Adaptador derivat de <strong><code>RecyclerView.ViewAdapter</code></strong> que gestionar&#xE0; autom&#xE0;ticament la c&#xE0;rrega de les dades que li passem com a refer&#xE8;ncia en la vista assignada pel <strong><code>Holder</code></strong>, per a aix&#xF2; el primer que haurem de crear &#xE9;s el ViewHolder personalitzat que gestione les dades de les nostres aplicaci&#xF3; (reprenem l&apos;exemple i implementem el bot&#xF3; llistar, podem crear un fragment o activity per a mostrar).</p>
<pre data-role="codeBlock" data-info="kotlin{class=&quot;line-numbers&quot;}" class="language-kotlin line-numbers"><span class="token keyword keyword-class">class</span> <span class="token function">Adaptador</span><span class="token punctuation">(</span>options<span class="token operator">:</span> FirestoreRecyclerOptions<span class="token operator">&lt;</span>Usuario<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">:</span>
    FirestoreRecyclerAdapter<span class="token operator">&lt;</span>Usuario<span class="token punctuation">,</span> Adaptador<span class="token punctuation">.</span>Holder<span class="token operator">&gt;</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">,</span>
    View<span class="token punctuation">.</span><span class="token function">OnClickListener</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-var">var</span> listener<span class="token operator">:</span> View<span class="token punctuation">.</span>OnClickListener<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword keyword-null">null</span>
    <span class="token keyword keyword-override">override</span>  <span class="token keyword keyword-fun">fun</span> <span class="token function">onBindViewHolder</span><span class="token punctuation">(</span>holder<span class="token operator">:</span> Holder<span class="token punctuation">,</span> position<span class="token operator">:</span> Int<span class="token punctuation">,</span> 
                                   model<span class="token operator">:</span> Usuario<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        holder<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreateViewHolder</span><span class="token punctuation">(</span>parent<span class="token operator">:</span> ViewGroup<span class="token punctuation">,</span> viewType<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> 
                                    Holder <span class="token punctuation">{</span>
        <span class="token keyword keyword-val">val</span> view<span class="token operator">:</span> View <span class="token operator">=</span> LayoutInflater<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>context<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>linea_recycler<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
        view<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">Holder</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">onClickListener</span><span class="token punctuation">(</span>listener<span class="token operator">:</span> View<span class="token punctuation">.</span>OnClickListener<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>listener <span class="token operator">=</span> listener
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onClick</span><span class="token punctuation">(</span>v<span class="token operator">:</span> View<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        listener<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
   <span class="token keyword keyword-inner">inner</span> <span class="token keyword keyword-class">class</span> <span class="token function">Holder</span><span class="token punctuation">(</span>v<span class="token operator">:</span> View<span class="token punctuation">)</span> <span class="token operator">:</span> RecyclerView<span class="token punctuation">.</span><span class="token function">ViewHolder</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> usuario<span class="token operator">:</span> TextView
        <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> correo<span class="token operator">:</span> TextView
        <span class="token keyword keyword-fun">fun</span> <span class="token function">bind</span><span class="token punctuation">(</span>item<span class="token operator">:</span> Usuario<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            usuario<span class="token punctuation">.</span>text <span class="token operator">=</span> item<span class="token punctuation">.</span>usuario
            correo<span class="token punctuation">.</span>text <span class="token operator">=</span> item<span class="token punctuation">.</span>correo
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-init">init</span> <span class="token punctuation">{</span>
            usuario <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>usuario<span class="token punctuation">)</span>
            correo <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>correo<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><blockquote>
<p>&#x1F4CC; <strong>Nota:</strong> Definim un adaptador com ja hem fet anteriorment, amb el Holder per a controlar les vistes de les l&#xED;nies del recycler <strong>L&#xED;nia 22 a 28</strong>, on sobreescriur&#xED;em, obligat&#xF2;riament, els dos m&#xE8;todes i el constructor. He implementar&#xED;em els listener necessaris per al funcionament dels esdeveniments. La principal difer&#xE8;ncia &#xE9;s que l&apos;Adaptador hereta de la classe <strong><code>FirestoreRecyclerAdapter</code></strong>. FirebaseUI ens facilita el llistat dels elements extrets de la BD proporcionant aquesta libreria. A aquesta classe li hem d&apos;indicar que els elements usats s&#xF3;n: el ViewHolder personalitzat que acabem de crear i la classe java que utilitzem per a encapsular la informaci&#xF3; de cada element de la llista <strong><code>FirestoreRecyclerAdapter&lt;Usuari, Adaptador.Holder&gt;</code></strong>.<br>
En crear un objecte d&apos;aquesta classe, hem de passar-li un objecte de la mateixa llibreria, de tipus <strong><code>FirestoreRecyclerOptions</code></strong>.</p>
</blockquote>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"> <span class="token keyword keyword-val">val</span> firestoreRecyclerOptions <span class="token operator">=</span> FirestoreRecyclerOptions<span class="token punctuation">.</span>Builder<span class="token operator">&lt;</span>Usuario<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">setQuery</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> Usuario<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><p>Al qual hem de passar-li la seg&#xFC;ent informaci&#xF3;:</p>
<ul>
<li>L&apos;objecte classe del nostre Item (Usuari.class)</li>
<li>La refer&#xE8;ncia al node de la base de dades que cont&#xE9; la llista d&apos;elements que volem mostrar en el control.</li>
</ul>
<p>Ara nom&#xE9;s quedaria crear un objecte del tipus adaptador que ens hem creat, passant-li l&apos;element <strong><code>firebaseRecyclerOption</code></strong> i ja tindr&#xED;em quasi tot fet.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">cargarRecycler</span><span class="token punctuation">(</span>query<span class="token operator">:</span> Query<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-val">val</span> firestoreRecyclerOptions <span class="token operator">=</span> FirestoreRecyclerOptions<span class="token punctuation">.</span>
                                       Builder<span class="token operator">&lt;</span>Usuario<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">setQuery</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> Usuario<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        recyclerView <span class="token operator">=</span> vista<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>recycler<span class="token punctuation">)</span>
        adapter <span class="token operator">=</span> <span class="token function">Adaptador</span><span class="token punctuation">(</span>firestoreRecyclerOptions<span class="token punctuation">)</span>
        <span class="token comment">//Click para eliminar elementos</span>
        adapter<span class="token operator">!!</span><span class="token punctuation">.</span><span class="token function">onClickListener</span><span class="token punctuation">{</span>
                Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>
                    <span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;Elemento eliminado&quot;</span> <span class="token operator">+</span> recyclerView<span class="token operator">!!</span><span class="token punctuation">.</span>
                                           <span class="token function">getChildAdapterPosition</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    Toast<span class="token punctuation">.</span>LENGTH_SHORT
                <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                adapter<span class="token operator">!!</span><span class="token punctuation">.</span>snapshots<span class="token punctuation">.</span><span class="token function">getSnapshot</span><span class="token punctuation">(</span>recyclerView<span class="token operator">!!</span><span class="token punctuation">.</span>
                                            <span class="token function">getChildAdapterPosition</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                                            reference<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        recyclerView<span class="token operator">!!</span><span class="token punctuation">.</span>adapter <span class="token operator">=</span> adapter
        recyclerView<span class="token operator">!!</span><span class="token punctuation">.</span>layoutManager <span class="token operator">=</span> <span class="token function">LinearLayoutManager</span><span class="token punctuation">(</span><span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</pre><p>No haurem d&apos;oblidar iniciar el escoltador de l&apos;adaptador en comen&#xE7;ar l&apos;aplicaci&#xF3; i tancar-lo en acabar.</p>
<span style="align: center;">
<table align="center">
<tbody><tr style="border:hidden;">
<td>
<div align="center">
    <img height src="./imagenes/imagen36.png">
</div></td>
<td style="border:hidden;">
<div align="center">
    <img height src="./imagenes/imagen35.png">
</div>
</td>
</tr>
</tbody></table>
</span>
<h4 class="mume-header" id="filtrat-i-ordenaci%C3%B3">Filtrat i ordenaci&#xF3;</h4>

<p>El primer que hem de tindre en compte &#xE9;s que en les BD de Firebase no tindrem totes les facilitats d&apos;ordenaci&#xF3; i filtrat que solen trobar-se en bases de dades SQL tradicionals. Per a les consultes podem trobar la informaci&#xF3; que necessitem en el seg&#xFC;ent enllace <a href="https://firebase.google.com/docs/firestore/query-data/queries">https://firebase.google.com/docs/firestore/query-data/queries</a>.</p>
<p>Per a realitzar consultes s&apos;utilitza qualsevol dels m&#xE8;todes <strong><code>where</code></strong> que indiquen que tipus de consulta necessitem:</p>
<div align="center">
    <img height="110" src=".\imagenes/imagen37.png">
</div>
<p>Usant la col&#xB7;lecci&#xF3; de l&apos;exemple que ens trobem en l&apos;enlla&#xE7; de la p&#xE0;gina de documentaci&#xF3; de firestore, <em>amb l&apos;expressi&#xF3; seg&#xFC;ent recuperar&#xED;em tots els documents que tenen una poblaci&#xF3; menor a 100000 habitants.</em></p>
<div align="center">
    <img height="20" src=".\imagenes/imagen38.png">
</div>
<p>Es poden enlla&#xE7;ar cerques amb <strong><code>where</code></strong>, de la seg&#xFC;ent manera:</p>
<div align="center">
    <img height="20" src=".\imagenes/imagen39.png">
</div>
<p><em>En aquest cas es buscaran tots els documents d&apos;estat igual a CA i del resultat d&apos;aqueixa cerca s&apos;extrauran nom&#xE9;s aquells que tinguen una poblaci&#xF3; menor a 100000.</em><br>
Tamb&#xE9; est&#xE0; l&apos;opci&#xF3; de buscar dins d&apos;una col&#xB7;lecci&#xF3; directament. Si alguns dels nostres documents tenen un membre que &#xE9;s una col&#xB7;lecci&#xF3;, podrem realitzar la consulta sobre aquest element usant alguna de les sobrec&#xE0;rregues de <strong><code>whereArrayContains</code></strong></p>
<div align="center">
    <img height="30" src=".\imagenes/imagen40.png">
</div>
<p><em>En les dades &#x2018;regions&#x2019; es refereix a un array amb els noms de les regions a les quals pertany cada ciutat, per la qual cosa amb la consulta anterior s&apos;extrauran totes les ciutats que en aqueix array tinguen l&apos;entrada &#x2018;west_coast&#x2019;, si la tenen repetida nom&#xE9;s apareixeran una vegada en els resultats.</em></p>
<p>Si el que volem fer &#xE9;s ordenar les dades obtingudes, tenim tota la informaci&#xF3; en la url <a href="https://firebase.google.com/docs/firestore/query-data/orderlimitdata?hl=es">https://firebase.google.com/docs/firestore/query-data/orderlimitdata?hl=es</a> S&apos;utilitzar&#xE0; qualsevol de les sobrec&#xE0;rregues del m&#xE8;tode <strong><code>orderBy</code></strong></p>
<div align="center">
    <img height="100" src=".\imagenes/imagen41.png">
</div>
<p>Per exemple, es poden combinar m&#xE9;s d&apos;un <strong><code>orderBy</code></strong> per a realitzar la consulta que necessitem. En aquest cas s&apos;ordena pel nom de l&apos;estat i a partir d&apos;ac&#xED; per n&#xFA;mero de poblaci&#xF3; i en ordre descendent.</p>
<div align="center">
    <img height="30" src=".\imagenes/imagen42.png">
</div>
<p>Una cl&#xE0;usula <strong><code>orderBy</code></strong> tamb&#xE9; filtra a la recerca de l&apos;exist&#xE8;ncia del camp donat. El conjunt de resultats no inclour&#xE0; documents que no continguen el camp corresponent. Com &#xE9;s d&apos;esperar, tamb&#xE9; es poden ordenar les dades despr&#xE9;s de realitzar una consulta <strong><code>where</code></strong>, per&#xF2; amb la condici&#xF3; que ha de ser sobre el mateix camp pel qual s&apos;ha fet la cerca.</p>
<div align="center">
    <img height="33" src=".\imagenes/imagen43.png">
</div>
<p>Si amb orderBy es pot especificar l&apos;ordre de classificaci&#xF3; de les dades, amb limit pots limitar la quantitat de documents recuperats.</p>
<p><em>Retorna els noms de les tres primeres ciutats</em></p>
<div align="center">
    <img height="25" src=".\imagenes/imagen44.png">
</div>
<p><em>Retorna els noms de les tres &#xFA;ltimes ciutats</em></p>
<div align="center">
    <img height="25" src=".\imagenes/imagen45.png">
</div>
<p>Altres cursors de consultes que estan disponibles s&#xF3;n:</p>
<span style="align: center;">
<table align="center">
<tbody><tr>
<td style="border:hidden;">
<ul>
<li><strong><code>startAt</code></strong> -&gt; La consulta nom&#xE9;s retornar&#xE0; els elements el valor dels quals siga igual o superior a la dada passada com a par&#xE0;metre.<br>
<em>Ciutats amb nombre d&apos;habitants 100000 i ordenats per n&#xFA;mero de poblaci&#xF3;</em></li>
</ul>
</td>
<td style="border:hidden;">
<div align="center">
    <img height src=".\imagenes/imagen46.png">
</div>
</td>
</tr>
<tr>
<td style="border:hidden;" colspan="2">
<ul>
<li><strong><code>startAfter</code></strong> -&gt; Id&#xE8;ntic a l&apos;anterior per&#xF2; per a valors superiors, no inclou els documents amb valor igual.</li>
</ul>
</td>
</tr>
<tr>
<td style="border:hidden;">
<ul>
<li><strong><code>endAt</code></strong> -&gt; La consulta nom&#xE9;s retornar&#xE0; els elements el valor dels quals siga igual o inferior a la dada passada com a par&#xE0;metre.<br>
<em>Ciutats amb nombre d&apos;habitants &lt;= 100000 i ordenats per n&#xFA;mero de poblaci&#xF3;</em></li>
</ul>

</td>
<td style="border:hidden;">
<div align="center">
    <img width="400" src=".\imagenes/imagen47.png">
</div>
</td>
</tr>
<tr>
<td style="border:hidden;" colspan="2">
<ul>
<li><strong><code>endBefore</code></strong> -&gt; Id&#xE8;ntic a l&apos;anterior per&#xF2; per a valors inferiors, no inclou els documents amb valor igual.</li></ul></td>


</tr>
</tbody></table>
</span>
<p>Tamb&#xE9; podrem utilitzar diversos criteris de filtrat en la mateixa consulta, &#xE9;s a dir podrem combinar diversos dels m&#xE8;todes anteriors per a obtindre nom&#xE9;s el rang d&apos;elements necessari.</p>
<div align="center">
    <img width="300" src=".\imagenes/imagen48.png">
</div>
<h3 class="mume-header" id="firebase-auth-autenticaci%C3%B3">Firebase Auth. Autenticaci&#xF3;</h3>

<p><a href="https://firebase.google.com/docs/auth">Firebase Authentication</a> proporciona serveis de backend, SDK f&#xE0;cils d&apos;usar i biblioteques d&apos;IU ja elaborades per a autenticar als usuaris en l&apos;app. <em>Ens iniciarem en el seu &#xFA;s modificant el projecte anterior, per a aix&#xF2; crearem un altre Fragment que ser&#xE0; el primer que s&apos;inicie en l&apos;aplicaci&#xF3;. Ens permetr&#xE0; crear un compte o autenticar-nos amb una ja existent, si l&apos;autenticaci&#xF3; &#xE9;s correcta es carregar&#xE0; el fragment amb el qual s&apos;iniciava el nostre projecte anteriorment.</em></p>
<p>Si volem autenticar-nos com a usuaris, tenim diverses opcions:<strong><code>email/password, google, tel&#xE8;fon, Facebook, twitter, github, anonymous</code></strong>. <em>Nosaltres veurem l&apos;exemple d&apos;email/password i el de anonymous, en la resta d&apos;autenticacions podeu seguir la documentaci&#xF3; de FireBase.</em></p>
<p>El primer pas seria afegir la depend&#xE8;ncia d&apos;autenticaci&#xF3;, que com tenim incl&#xF2;s la de *firebase-*bom, no necessitar&#xE0; n&#xFA;mero de versi&#xF3;:</p>
<pre data-role="codeBlock" data-info="groovy" class="language-groovy">implementation <span class="token string">&apos;com.google.firebase:firebase-auth&apos;</span>
</pre><p><em>Tendremos que codificar un layout que permita introducir el usuario y la contrase&#xF1;a para poder logearnos.</em></p>
<div align="center">
    <img width="200" src=".\imagenes/imagen49.png">
</div>
<p>El seg&#xFC;ent ser&#xE0; activar els prove&#xEF;dors amb els quals volem iniciar sessi&#xF3;. Ens anem a l&apos;opci&#xF3; *Authentication i dins d&apos;aquest a la pestanya M&#xE8;todes d&apos;inici de sessi&#xF3;. Haurem de seleccionar tots dos casos i habilitar l&apos;estat.</p>
<div align="center">
    <img width="500" src=".\imagenes/imagen50.png">
</div>
<p>Una vegada afegit els prove&#xEF;dors, tindrem dues maneres de crear els usuaris: <strong>a trav&#xE9;s de la consola i des de l&apos;aplicaci&#xF3;</strong>. Des de la consola ens haurem d&apos;anar a la pestanya usuaris, ac&#xED; podrem crear els usuaris que necessitem. Els usuaris an&#xF2;nims apareixeran solament amb l&apos;aneu &#xFA;nic que assigna Firebase a cada usuari creat.</p>
<p>L&apos;altre cas ser&#xE0; en codificar l&apos;aplicaci&#xF3;. Per a tots els casos d&apos;autenticaci&#xF3; necessitem una inst&#xE0;ncia de <strong><code>FirebaseAuth.getInstance()</code></strong>, a partir d&apos;aquesta podrem afegir els escuchadores necessaris:</p>
<p>El seg&#xFC;ent pas ser&#xE0; decidir si volem permetre crear usuaris nous, o solament logearnos amb algun existent. En la nostra aplicaci&#xF3; farem les dues coses, i fins i tot ens logearemos com a an&#xF2;nims. El codi apareix a continuaci&#xF3;, i un enlla&#xE7; amb tota la informaci&#xF3; <a href="https://firebase.google.com/docs/auth/android/password-auth">https://firebase.google.com/docs/auth/android/password-auth</a></p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"> <span class="token comment">////// Crear usuario nueveo y iniciar sesi&#xF3;n</span>
        btCrear<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">{</span>
               FirebaseAuth<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createUserWithEmailAndPassword</span><span class="token punctuation">(</span>
                    user<span class="token punctuation">.</span>editText<span class="token operator">!!</span><span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pasword<span class="token punctuation">.</span>editText<span class="token operator">!!</span>
                        <span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">addOnCompleteListener</span><span class="token punctuation">(</span><span class="token function">requireActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        OnCompleteListener<span class="token operator">&lt;</span>AuthResult<span class="token operator">?</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> task <span class="token operator">-&gt;</span>
                            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>task<span class="token punctuation">.</span>isSuccessful<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;Usuario creado&quot;</span><span class="token punctuation">,</span>
                                            Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                <span class="token function">iniciarFragmen</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span>result<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span>
                                             <span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;@&quot;</span><span class="token punctuation">)</span><span class="token operator">!!</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>
                                <span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                <span class="token string">&quot;Problemas al crear usuario&quot;</span> <span class="token operator">+</span>task<span class="token punctuation">.</span>exception<span class="token punctuation">,</span>
                                Toast<span class="token punctuation">.</span>LENGTH_SHORT
                            <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> view

</pre><pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token comment">/////Iniciar sesi&#xF3;n con usuario y contrase&#xF1;a</span>
        btIniciar<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">{</span>
             FirebaseAuth<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">signInWithEmailAndPassword</span><span class="token punctuation">(</span>
                user<span class="token punctuation">.</span>editText<span class="token operator">!!</span><span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pasword<span class="token punctuation">.</span>editText<span class="token operator">!!</span>
                    <span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addOnCompleteListener</span><span class="token punctuation">(</span><span class="token function">requireActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    OnCompleteListener<span class="token operator">&lt;</span>AuthResult<span class="token operator">?</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> task <span class="token operator">-&gt;</span>
                        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>task<span class="token punctuation">.</span>isSuccessful<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>
                                <span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                <span class="token string">&quot;Authentication failed:&quot;</span> <span class="token operator">+</span> task<span class="token punctuation">.</span>exception<span class="token punctuation">,</span>
                                Toast<span class="token punctuation">.</span>LENGTH_SHORT
                            <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token function">iniciarFragmen</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span>result<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span>
                                             <span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;@&quot;</span><span class="token punctuation">)</span><span class="token operator">!!</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
</pre><pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"> <span class="token comment">//////// Iniciar sesi&#xF3;n con an&#xF3;nimo</span>
        btAnonimus<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">{</span>
                 FirebaseAuth<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">signInAnonymously</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addOnCompleteListener</span>
                <span class="token punctuation">(</span>
                    <span class="token function">requireActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    OnCompleteListener<span class="token operator">&lt;</span>AuthResult<span class="token operator">?</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> task <span class="token operator">-&gt;</span>
                        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>task<span class="token punctuation">.</span>isSuccessful<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>
                                <span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                <span class="token string">&quot;Authentication failed:&quot;</span> <span class="token operator">+</span> task<span class="token punctuation">.</span>exception<span class="token punctuation">,</span>
                                Toast<span class="token punctuation">.</span>LENGTH_SHORT
                            <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token function">iniciarFragmen</span><span class="token punctuation">(</span><span class="token string">&quot;anonimous&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
</pre><p>Com podem veure en el codi, el que es fa &#xE9;s usar qualsevol dels m&#xE8;todes que h&#xE0;gem triat (login, an&#xF2;nim o afegir usuari) sobre la inst&#xE0;ncia de <strong><code>FirebaseAuth</code></strong>. Amb aquests passos tindrem l&apos;autenticaci&#xF3; controlada, i podrem seguir amb la nostra aplicaci&#xF3;.</p>
<p><span style="color: DarkRed; font-weight: bold;">&#x2712;&#xFE0F;Resol l&apos;exercici dels exemples fins a aconseguir un correcte funcionament</span></p>

      </div>
      
      
    
    
    
    
    
    
    
    
  
    </body></html>