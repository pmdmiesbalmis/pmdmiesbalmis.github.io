<!DOCTYPE html><html><head>
      <title>PMDM 2&#xBA; DAM  Tema 11. Persist&#xE8;ncia de Dades I</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.3/dist/katex.min.css">
      
      
      
      
      
      
      
      
      
      <style>
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}

/* highlight */
pre[data-line] {
  position: relative;
  padding: 1em 0 1em 3em;
}
pre[data-line] .line-highlight-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  background-color: transparent;
  display: block;
  width: 100%;
}

pre[data-line] .line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: hsla(24, 20%, 50%,.08);
  background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}

pre[data-line] .line-highlight:before, 
pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-start);
  position: absolute;
  top: .4em;
  left: .6em;
  min-width: 1em;
  padding: 0 .5em;
  background-color: hsla(24, 20%, 50%,.4);
  color: hsl(24, 20%, 95%);
  font: bold 65%/1.5 sans-serif;
  text-align: center;
  vertical-align: .3em;
  border-radius: 999px;
  text-shadow: none;
  box-shadow: 0 1px white;
}

pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-end);
  top: auto;
  bottom: .4em;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
.markdown-preview.markdown-preview {
  background-color: #FFFF;
}

      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview  ">
      <style>/* 
Añade 

@import "../EstilosPersonalizadosMarkdownEnhanced.less"

justo después del front matter 
*/
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
@font-face {
  font-family: 'Catamaran';
  font-style: normal;
  font-weight: 400;
  src: url(https://fonts.gstatic.com/s/catamaran/v17/o-0bIpQoyXQa2RxT7-5B6Ryxs2E_6n1iPHjd5a7dvg.ttf) format('truetype');
}
.contenedor {
  display: flex;
  justify-content: center;
  margin: 30px auto 30px auto;
}
.fondo {
  background: url(https://programacioniesbalmis.github.io/Imagenes/BannersMoodle/banner.png);
  background-size: cover;
  width: 75%;
  height: 160px;
  border-radius: 10px;
  position: relative;
}
.cita {
  font-family: Arial;
  font-style: italic;
  font-weight: 600;
  text-align: justify;
  line-height: 1.5rem;
  opacity: 0.6;
  color: white;
  padding: 5rem;
  position: relative;
  top: 50%;
  left: 50%;
  font-size: 1.3rem;
  transform: translate(-50%, -50%);
}
.abre_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-left: 30px;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, -15%);
}
.cierra_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-right: 30px;
  right: 0%;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, 55%);
}
.autor {
  font-family: Arial;
  color: white;
  margin: 0px;
  padding-left: 30px;
  position: absolute;
  top: 83%;
  font-size: 1rem;
}
</style>
<h1 class="mume-header undefined" id="apunts">Apunts</h1>

<p><a href="./tema11_Persistencia_de_Datos_I_val.pdf">Descarregar estos apunts</a></p>
<h1 class="mume-header undefined" id="tema-11-persist%C3%A8ncia-de-dades-i">Tema 11. Persist&#xE8;ncia de Dades I</h1>

<h2 class="mume-header undefined" id="%C3%ADndex">&#xCD;ndex</h2>

<ol>
<li><a href="#acc%C3%A9s-a-bases-de-dades-locals-sqlite">Acc&#xE9;s a bases de dades locals. *SQLite</a>
<ol>
<li><a href="#introducci%C3%B3">Introducci&#xF3;</a></li>
<li><a href="#creaci%C3%B3-i-obertura-de-la-bd">Creaci&#xF3; i obertura de la BD</a></li>
<li><a href="#acc%C3%A9s-i-modificaci%C3%B3-de-les-dades-en-la-bd">Acc&#xE9;s i modificaci&#xF3; de les dades en la BD</a>
<ol>
<li><a href="#acc%C3%A9s-a-la-bd-mitjan%C3%A7ant-sent%C3%A8ncies-sql">Acc&#xE9;s a la BD mitjan&#xE7;ant sent&#xE8;ncies sql</a></li>
<li><a href="#acc%C3%A9s-a-la-bd-mitjan%C3%A7ant-sqlitedatabase">Acc&#xE9;s a la BD mitjan&#xE7;ant SQLiteDataBase</a></li>
<li><a href="#recuperaci%C3%B3-de-dades-amb-rawquery">Recuperaci&#xF3; de dades amb rawQuery</a></li>
<li><a href="#recuperaci%C3%B3-de-dades-amb-query">Recuperaci&#xF3; de dades amb query</a></li>
</ol>
</li>
<li><a href="#%C3%BAs-de-simplecursoradapter">&#xDA;s de SimpleCursorAdapter</a>
<ol>
<li><a href="#cursors-amb-recyclerview">Cursors amb RecyclerView</a></li>
</ol>
</li>
</ol>
</li>
<li><a href="#acc%C3%A9s-a-bases-de-dades-remotes">Acc&#xE9;s a bases de dades remotes</a>
<ol>
<li><a href="#introducci%C3%B3-1">Introducci&#xF3;</a></li>
<li><a href="#acc%C3%A9s-a-bases-de-dades-amb-apirest-i-retrofit">Acc&#xE9;s a bases de dades amb Apirest i Retrofit</a>
<ol>
<li><a href="#definici%C3%B3-del-servei-rest">Definici&#xF3; del Servei Rest</a></li>
<li><a href="#consum-dun-servei-rest-des-dandroid">Consum d&apos;un Servei Rest des d&apos;Android</a></li>
</ol>
</li>
</ol>
</li>
<li><a href="#acceso-a-base-de-datos-con-firebase">Acceso a Base de Datos con FIREBASE</a>
<ol>
<li><a href="#creant-un-app-de-firebase">Creant un app de Firebase</a></li>
<li><a href="#firestore-database">Firestore DataBase</a>
<ol>
<li><a href="#firebaseui-y-recyclerview">FirebaseUI y RecyclerView</a></li>
<li><a href="#filtrat-i-ordenaci%C3%B3">Filtrat i ordenaci&#xF3;</a></li>
</ol>
</li>
<li><a href="#firebase-auth-autenticaci%C3%B3">Firebase Auth. Autenticaci&#xF3;</a></li>
</ol>
</li>
</ol>
<div style="page-break-after:always;"></div>
<h2 class="mume-header" id="acc%C3%A9s-a-bases-de-dades-locals-sqlite">Acc&#xE9;s a bases de dades locals. *SQLite</h2>

<h3 class="mume-header" id="introducci%C3%B3">Introducci&#xF3;</h3>

<p>La plataforma Android proporciona dues eines principals per a l&apos;emmagatzematge i consulta de dades estructurades: la base de dades <strong>SQLite</strong> i <strong>Content Providers</strong> (ho treballarem en temes posteriors).<br>
Ens centrarem en <a href="https://developer.android.com/training/data-storage/sqlite?hl=es">SQLite</a>, encara que no entrarem ni en el disseny de BBDD relacionals ni en l&apos;&#xFA;s avan&#xE7;at de la BBDD. Per a con&#xE9;ixer tota la funcionalitat de SQLite es recomana usar la documentaci&#xF3; oficial.<br>
Per a l&apos;acc&#xE9;s a les bases de dades tindrem tres classes que hem de con&#xE9;ixer. La classe <strong><code>SQLiteOpenHelder</code></strong>, que encapsula totes les funcions de creaci&#xF3; de la base de dades i versions d&apos;aquesta. La classe <strong><code>SQLiteDatabase</code></strong>, que incorpora la gesti&#xF3; de taules i dades. I finalment la classe <strong><code>Cursor</code></strong>, que usarem per a moure&apos;ns pel *recordset que ens retorna una consulta <em>SELECT</em>.</p>
<h3 class="mume-header" id="creaci%C3%B3-i-obertura-de-la-bd">Creaci&#xF3; i obertura de la BD</h3>

<p>El m&#xE8;tode recomanat per a la creaci&#xF3; de la base de dades &#xE9;s estendre la classe <strong><code>SQLiteOpenHelder</code></strong> i sobreescriure els m&#xE8;todes <strong><code>onCreate</code></strong> i <strong><code>onUpgrade</code></strong>. El primer m&#xE8;tode s&apos;utilitza per a crear la base de dades per primera vegada i el segon per a actualitzacions d&apos;aquesta. Si la base de dades ja existeix i la seua versi&#xF3; actual coincideix amb la sol&#xB7;licitada, es realitzar&#xE0; la connexi&#xF3; a ella.</p>
<p>Per a executar la sent&#xE8;ncia SQL utilitzarem el m&#xE8;tode <strong><code>execSQL</code></strong> proporcionat per la API per a SQLite d&apos;Android.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-internal">internal</span> <span class="token keyword keyword-inner">inner</span> <span class="token keyword keyword-class">class</span> <span class="token function">BDClientes</span><span class="token punctuation">(</span>
        context<span class="token operator">:</span> Context<span class="token operator">?</span><span class="token punctuation">,</span>
        name<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>
        factory<span class="token operator">:</span> CursorFactory<span class="token operator">?</span><span class="token punctuation">,</span>
        version<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">SQLiteOpenHelper</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> name<span class="token punctuation">,</span> factory<span class="token punctuation">,</span> version<span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
     <span class="token keyword keyword-var">var</span> sentencia <span class="token operator">=</span>
            <span class="token string">&quot;create table if not exists clientes&quot;</span> <span class="token operator">+</span> 
            <span class="token string">&quot;(dni VARCHAR PRIMARY KEY NOT NULL, nombre TEXT, apellidos TEXT);&quot;</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>sqLiteDatabase<span class="token operator">:</span> SQLiteDatabase<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            sqLiteDatabase<span class="token punctuation">.</span><span class="token function">execSQL</span><span class="token punctuation">(</span>sentencia<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onUpgrade</span><span class="token punctuation">(</span>sqLiteDatabase<span class="token operator">:</span> SQLiteDatabase<span class="token punctuation">,</span> i<span class="token operator">:</span> Int<span class="token punctuation">,</span> i2<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><blockquote>
<p>&#x1F4CC; Si la base de dades existeix per&#xF2; la seua versi&#xF3; actual &#xE9;s anterior a la sol&#xB7;licitada, es dir&#xE0; autom&#xE0;ticament al m&#xE8;tode *onUgrde(). Si la base de dades no existeix es diu autom&#xE0;ticament a onCreate().</p>
</blockquote>
<h3 class="mume-header" id="acc%C3%A9s-i-modificaci%C3%B3-de-les-dades-en-la-bd">Acc&#xE9;s i modificaci&#xF3; de les dades en la BD</h3>

<p>Una vegada creada la classe, instanciarem un objecte del tipus creat i usarem un dels dos seg&#xFC;ents m&#xE8;todes per a tindre acc&#xE9;s a la gesti&#xF3; de dades: <strong><code>getWritableDatabase()</code></strong> per a acc&#xE9;s d&apos;escriptura i <strong><code>getReadableDatabase()</code></strong> per a acc&#xE9;s de nom&#xE9;s lectura. En tots dos casos es retornar&#xE0; un objecte de la classe <strong><code>SQLiteDatabase</code></strong> per a l&apos;acc&#xE9;s a les dades.<br>
Per a realitzar una codificaci&#xF3; neta i reutilitzable, el millor &#xE9;s crear una classe amb tots els m&#xE8;todes que necessitem per a treballar amb la Base de dades, a m&#xE9;s &#xE9;s &#xFA;til tindre la classe derivada de SQLiteOpenHelper interna a aquesta.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-class">class</span> <span class="token function">BDAdapter</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token operator">?</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
  <span class="token keyword keyword-private">private</span>  <span class="token keyword keyword-var">var</span> clientes<span class="token operator">:</span> BDClientes
    
  <span class="token keyword keyword-init">init</span> <span class="token punctuation">{</span>
        clientes <span class="token operator">=</span> <span class="token function">BDClientes</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">&quot;BDClientes&quot;</span><span class="token punctuation">,</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  
  <span class="token operator">..</span><span class="token punctuation">.</span> 

  <span class="token keyword keyword-internal">internal</span> <span class="token keyword keyword-inner">inner</span> <span class="token keyword keyword-class">class</span> <span class="token function">BDClientes</span><span class="token punctuation">(</span>
        context<span class="token operator">:</span> Context<span class="token operator">?</span><span class="token punctuation">,</span>
        name<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>
        factory<span class="token operator">:</span> CursorFactory<span class="token operator">?</span><span class="token punctuation">,</span>
        version<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">SQLiteOpenHelper</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> name<span class="token punctuation">,</span> factory<span class="token punctuation">,</span> version<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
        <span class="token keyword keyword-var">var</span> sentencia <span class="token operator">=</span>
            <span class="token string">&quot;create table if not exists clientes&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;(dni VARCHAR PRIMARY KEY NOT NULL, nombre TEXT, apellidos TEXT);&quot;</span>
        <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>sqLiteDatabase<span class="token operator">:</span> SQLiteDatabase<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            sqLiteDatabase<span class="token punctuation">.</span><span class="token function">execSQL</span><span class="token punctuation">(</span>sentencia<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onUpgrade</span><span class="token punctuation">(</span>sqLiteDatabase<span class="token operator">:</span> SQLiteDatabase<span class="token punctuation">,</span> i<span class="token operator">:</span> Int<span class="token punctuation">,</span> i2<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><blockquote>
<p>&#x1F4CC; Com podem veure en el codi, creguem un objecte del tipus de BDClientes amb el qual treballarem cridant al constructor BDClientes(), a aquest m&#xE8;tode li passem el context, el nom de la BBDD, un objecte cursor (amb valor null) i la versi&#xF3; de la BD que necessitem.</p>
</blockquote>
<p>Per a poder usar els m&#xE8;todes creats en la classe, tan sols instanciaremos un objecte d&apos;aquesta passant-li el context (de tipus activity). Amb aquesta inst&#xE0;ncia podrem cridar a qualsevol dels m&#xE8;todes que crearem en la classe d&apos;utilitat.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-var">var</span> bdAdapter <span class="token operator">=</span> <span class="token function">BDAdapter</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span>
bdAdapter<span class="token punctuation">.</span><span class="token function">insertarDatos</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><h4 class="mume-header" id="acc%C3%A9s-a-la-bd-mitjan%C3%A7ant-sent%C3%A8ncies-sql">Acc&#xE9;s a la BD mitjan&#xE7;ant sent&#xE8;ncies sql</h4>

<p>L&apos;acc&#xE9;s a la BBDD es fa en dues fases, primer s&apos;aconsegueix un objecte del tipus <strong><code>SQLiteDatabase</code></strong> i posteriorment usem les seues funcions per a gestionar les dades. Si hem obert correctament la base de dades llavors podrem comen&#xE7;ar amb les insercions, actualitzacions, esborrat, etc. No haurem d&apos;oblidar tancar l&apos;acc&#xE9;s a la BD, sempre que no s&apos;estiga usant un cursor.</p>
<p><em>Per exemple, inserirem 10 registres en la nostra taula clients. Per a aix&#xF2; podrem crear un m&#xE8;tode en el <strong>BDAdapter</strong> semblant al seg&#xFC;ent:</em></p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-fun">fun</span> <span class="token function">insertarDatos</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-var">var</span> dbClientes <span class="token operator">=</span>clientes<span class="token punctuation">.</span>writableDatabase
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>dbClientes <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token keyword keyword-in">in</span> <span class="token number">0</span><span class="token operator">..</span><span class="token number">9</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-val">val</span> sentencia <span class="token operator">=</span> <span class="token string">&quot;INSERT INTO Clientes (dni, nombre, apellidos) VALUES&quot;</span> <span class="token operator">+</span>
                        <span class="token string">&quot; (&apos;&quot;</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">&quot;&apos;,&apos;nombre&quot;</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">&quot;&apos;,&apos;apellido&quot;</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">&quot;&apos;);&quot;</span>
                dbClientes<span class="token punctuation">.</span><span class="token function">execSQL</span><span class="token punctuation">(</span>sentencia<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            dbClientes<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><blockquote>
<p>&#x270B; Val, i ara qu&#xE8;? On est&#xE0; la base de dades que acabem de crear? Com podem comprovar que tot ha anat b&#xE9; i que els registres s&apos;han inserit correctament?, en primer lloc vegem on s&apos;ha creat la nostra base de dades. Totes les bases de dades SQLite creades per aplicacions Android s&apos;emmagatzemen en la mem&#xF2;ria del tel&#xE8;fon en un fitxer amb el mateix nom de la base de dades situat en una ruta que segueix el seg&#xFC;ent patr&#xF3;: <strong>/data/data/paquete.java.de.la.aplicacion/databases/nom_base_dades</strong><br>
En el cas del nostre exemple, la base de dades s&apos;emmagatzemaria per tant en la ruta seg&#xFC;ent: <strong>/data/data/exemple.basedatos/databases/DBClientes</strong><br>
Per a comprovar que les dades s&apos;han gravat podem accedir de manera remota a l&apos;emulador a trav&#xE9;s de la seua consola de comandos (shell). Per&#xF2; &#xE9;s mes senzill obrir l&apos;arxiu creat amb un bloc de notes i donar una ullada al seu contingut.</p>
</blockquote>
<h4 class="mume-header" id="acc%C3%A9s-a-la-bd-mitjan%C3%A7ant-sqlitedatabase">Acc&#xE9;s a la BD mitjan&#xE7;ant SQLiteDataBase</h4>

<p>La API d&apos;Android ens ofereix dos m&#xE8;todes per a accedir a les dades. El primer d&apos;ells ja ho hem vist, es tracta d&apos;executar sent&#xE8;ncies SQL a trav&#xE9;s de <strong>execSql</strong>. Aquest m&#xE8;tode t&#xE9; com a par&#xE0;metre una cadena amb qualsevol instrucci&#xF3; SQL v&#xE0;lida. L&apos;altra forma &#xE9;s utilitzar els m&#xE8;todes espec&#xED;fics <strong>insert(), update() i delete()</strong> de la classe <strong>SQLiteDatabase</strong>.</p>
<p>Vegem a continuaci&#xF3; cadascun d&apos;aquests m&#xE8;todes.</p>
<ul>
<li>
<p><strong><code>insert()</code></strong>: rep tres par&#xE0;metres <em><code>insert(table, nullColumnHack, values)</code></em>, el primer &#xE9;s el nom de la taula, el segon s&apos;utilitza en cas que necessitem inserir valors nuls en la taula &quot;nullColumnHack&quot; en aquest cas el deixarem passar ja que no l&apos;usarem i per tant el posem a *null i el tercer s&#xF3;n els valors del registre a inserir. Els valors a inserir els passarem al seu torn com a elements d&apos;una col&#xB7;lecci&#xF3; de tipus <strong><code>ContentValues</code></strong>. Aquests elements s&apos;emmagatzemen com a parelles <strong>clau-valor</strong>, on la clau ser&#xE0; el nom de cada camp i el valor ser&#xE0; la dada que s&apos;inserir&#xE0;.</p>
</li>
<li>
<p><strong><code>update()</code></strong>: Pr&#xE0;cticament &#xE9;s igual que l&apos;anterior m&#xE8;tode per&#xF2; amb l&apos;excepci&#xF3; que ac&#xED; estem usant el m&#xE8;tode <em><code>update(table, values, whereClause, whereArgs)</code></em> per a actualitzar/modificar registres de la nostra taula. Aquest m&#xE8;tode ens demana el nom de la taula &quot;table&quot;, els valors a modificar/actualitzar &quot;values&quot; (ContentValues), una condici&#xF3; WHERE &quot;whereClause&quot; que ens serveix per a indicar-li que valor volem que actualitze i com a &#xFA;ltim par&#xE0;metre &quot;whereArgs&quot; podem passar-li els valors nous a inserir, en aquest cas no el necessitarem per tant el posem a null.</p>
</li>
<li>
<p><strong><code>delete()</code></strong>: el m&#xE8;tode <em><code>delete(table, whereClause, whereArgs)</code></em> ens demana el nom de la taula &quot;table&quot;, el registre a esborrar &quot;whereClause&quot; que prendrem com a refer&#xE8;ncia la seua aneu i com a &#xFA;ltim par&#xE0;metre &quot;whereArgs&quot; els valors a esborrar.</p>
</li>
</ul>
<div style="page-break-after:always;"></div>
<span style="align: center;">
<table align="center">
<tbody><tr style="border:hidden;">
<td align="center">
<div align="left">
    Inserint amb ContentValues
</div>
</td>
<td style="border:hidden;">
<div>
<img height="160" src="./imagenes/imagen8.png">
</div>
</td>
</tr>
<tr style="border:hidden;">
<td style="border:hidden;">
<div>
<img height="130" src="./imagenes/imagen9.png">
</div>
</td>
<td style="border:hidden;">
<div align="left">
    Modificant amb ContentValues
</div>
</td>
</tr>
<tr style="border:hidden;">
<td align="center">
<div align="left">
    Borrant amb ContentValues
</div>
</td>
<td style="border:hidden;">
<div>
<img height="70" src="./imagenes/imagen10.png">
</div>
</td>
</tr>
</tbody></table>
</span>
<p>Els valors que hem deixat anteriorment com null s&#xF3;n realment arguments que podem utilitzar en la sent&#xE8;ncia SQL. Vegem-ho amb un exemple:</p>
<div align="center">
    <img height="130" src="./imagenes/imagen11.png">
</div>
<p>On les <code>?</code> indiquen els empla&#xE7;aments dels arguments.</p>
<p><span style="color: DarkRed; font-weight: bold;">&#x2712;&#xFE0F; Crea un exercici EjercicioResueltoBD en el qual proves el codi vist anteriorment: Creaci&#xF3; de la BD, inserir elements amb SQL i modificar, eliminar i inserir mitjan&#xE7;ant ContentValue.</span></p>
<h4 class="mume-header" id="recuperaci%C3%B3-de-dades-amb-rawquery">Recuperaci&#xF3; de dades amb rawQuery</h4>

<p>Existeixen dues maneres de recuperar informaci&#xF3; (SELECT de la base de dades), encara que ambdues es recolzen en el concepte de <strong>cursor</strong>, que &#xE9;s en definitiva l&apos;objecte que recull els resultats de la consulta.Completarem l&apos;exercici anterior, perqu&#xE8; ens permeta anar inserint registres en la BD i visualitzant-los en un listView.</p>
<span style="align: center;">
<table align="center">
<tbody><tr>
<td style="border:hidden;">
<div align="left">
<p>La primera manera d&apos;obtindre dades &#xE9;s utilitzar el m&#xE8;tode rawQuery() de la classe SQLiteDatabase. Aquest m&#xE8;tode rep com a par&#xE0;metre la sent&#xE8;ncia SQL, on s&apos;indiquen els camps a recuperar i els criteris de selecci&#xF3;.</p>
</div>
</td>
<td style="border:hidden;">
<div align="center">
    <img width="600" src="./imagenes/imagen12.png">
</div>
</td>
</tr>
</tbody></table>
</span>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-fun">fun</span> <span class="token function">seleccionarDatosSelect</span><span class="token punctuation">(</span>sentencia<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>
        <span class="token keyword keyword-val">val</span> listaCliente<span class="token operator">:</span> ArrayList<span class="token operator">&lt;</span>Clientes<span class="token operator">&gt;</span><span class="token operator">?</span>
        <span class="token keyword keyword-val">val</span> dbClientes <span class="token operator">=</span> clientes<span class="token punctuation">.</span>readableDatabase
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>dbClientes <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-val">val</span> cursor<span class="token operator">:</span> Cursor <span class="token operator">=</span> dbClientes<span class="token punctuation">.</span><span class="token function">rawQuery</span><span class="token punctuation">(</span>sentencia<span class="token punctuation">,</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
            listaCliente <span class="token operator">=</span> <span class="token function">getClientes</span><span class="token punctuation">(</span>cursor<span class="token punctuation">)</span>
            dbClientes<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>listaCliente <span class="token operator">==</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token boolean">false</span> <span class="token keyword keyword-else">else</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</pre><p>Evidentment, ara haurem de rec&#xF3;rrer el cursor i visualitzar les dades retornades. Per a aix&#xF2; es disposa dels m&#xE8;todes <strong><code>moveToFirst()</code></strong>, <strong><code>moveToNext()</code></strong>, <strong><code>moveToLast()</code></strong>, <strong><code>moveToPrevius()</code></strong>, <strong><code>isFirst()</code></strong> i <strong><code>isLast()</code></strong>.<br>
Existeixen m&#xE8;todes espec&#xED;fics per a la recuperaci&#xF3; de dades getXXX(indexe), on XXX indica el tipus de dada (String, Blob, Float,&#x2026;) i el par&#xE0;metre &#xED;ndex permet recuperar la columna indicada en aquest, tenint en compte que comen&#xE7;a en 0.</p>
<p>El m&#xE8;tode getClientes (implementat per nosaltres) &#xE9;s el que ens permet llegir les dades existents en la BD i portar-los al arrayList:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-fun">fun</span> <span class="token function">getClientes</span><span class="token punctuation">(</span>cursor<span class="token operator">:</span> Cursor<span class="token punctuation">)</span><span class="token operator">:</span> ArrayList<span class="token operator">&lt;</span>Clientes<span class="token operator">&gt;</span><span class="token operator">?</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> clientes<span class="token operator">:</span> ArrayList<span class="token operator">&lt;</span>Clientes<span class="token operator">&gt;</span>
    <span class="token keyword keyword-var">var</span> cliente<span class="token operator">:</span> Clientes
    cursor<span class="token punctuation">.</span><span class="token function">moveToFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cursor<span class="token punctuation">.</span><span class="token function">isAfterLast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        clientes <span class="token operator">=</span> <span class="token function">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>cursor<span class="token punctuation">.</span><span class="token function">isAfterLast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cliente <span class="token operator">=</span>
              <span class="token function">Clientes</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cursor<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cursor<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            clientes<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>cliente<span class="token punctuation">)</span>
            cursor<span class="token punctuation">.</span><span class="token function">moveToNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> clientes
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-null">null</span>
<span class="token punctuation">}</span>
</pre><h4 class="mume-header" id="recuperaci%C3%B3-de-dades-amb-query">Recuperaci&#xF3; de dades amb query</h4>

<p>La segona manera de recuperar informaci&#xF3; de la BD &#xE9;s utilitzar el m&#xE8;tode <strong><code>query()</code></strong>. Rep com a par&#xE0;metres el nom de la taula, un string amb els camps a recuperar, un string on especificar les condicions del WHERE, un altre per als arguments si n&apos;hi haguera, un altre per al GROUP BY, un altre per a HAVING i finalment un altre per a ORDER BY.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-fun">fun</span> <span class="token function">seleccionarDatosCodigo</span><span class="token punctuation">(</span>
        columnas<span class="token operator">:</span> Array<span class="token operator">&lt;</span>String<span class="token operator">?</span><span class="token operator">&gt;</span><span class="token operator">?</span><span class="token punctuation">,</span>
        <span class="token keyword keyword-where">where</span><span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>
        valores<span class="token operator">:</span> Array<span class="token operator">&lt;</span>String<span class="token operator">?</span><span class="token operator">&gt;</span><span class="token operator">?</span><span class="token punctuation">,</span>
        orderBy<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> ArrayList<span class="token operator">&lt;</span>Clientes<span class="token operator">&gt;</span><span class="token operator">?</span> 
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-var">var</span> listaCliente<span class="token operator">:</span> ArrayList<span class="token operator">&lt;</span>Clientes<span class="token operator">&gt;</span><span class="token operator">?</span> <span class="token operator">=</span> <span class="token function">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-val">val</span> dbClientes <span class="token operator">=</span> clientes<span class="token punctuation">.</span>readableDatabase
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>dbClientes <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
            <span class="token keyword keyword-val">val</span> cursor<span class="token operator">:</span> Cursor <span class="token operator">=</span> 
             dbClientes<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;clientes&quot;</span><span class="token punctuation">,</span> columnas<span class="token punctuation">,</span> <span class="token keyword keyword-where">where</span><span class="token punctuation">,</span> valores<span class="token punctuation">,</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">,</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">,</span> orderBy<span class="token punctuation">)</span>
            listaCliente <span class="token operator">=</span> <span class="token function">getClientes</span><span class="token punctuation">(</span>cursor<span class="token punctuation">)</span>
            dbClientes<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-return">return</span> listaCliente
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-null">null</span>
    <span class="token punctuation">}</span>
</pre><p>On l&apos;anomenada al m&#xE8;tode podria ser la seg&#xFC;ent:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin">  <span class="token keyword keyword-val">val</span> listaCliente <span class="token operator">=</span> bdAdapter<span class="token punctuation">.</span><span class="token function">seleccionarDatosCodigo</span><span class="token punctuation">(</span>
                    <span class="token function">arrayOf</span><span class="token punctuation">(</span><span class="token string">&quot;dni&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;nombre&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;apellidos&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token keyword keyword-null">null</span><span class="token punctuation">,</span>
                    <span class="token keyword keyword-null">null</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;apellidos&quot;</span><span class="token punctuation">)</span>
</pre><div style="page-break-after:always;"></div>
<blockquote>
<p><span style="color: DarkRed; font-weight: bold;
">&#x2712;&#xFE0F;Crea un exercici ejemploBD en el qual proves el codi vist anteriorment: Recuperaci&#xF3; de les dades amb rawQuery i amb query. Per a aix&#xF2; crea l&apos;aplicaci&#xF3; com en la imatge, de manera que amb un bot&#xF3; es guarde la informaci&#xF3; en la BD i amb l&apos;altre s&apos;extraga i es mostre en una llista o en un recycler. Si utilitzareu una llista com es mostra en la imatge, debereis crear una classe adaptador com la de la seg&#xFC;ent imatge i associar-la a la llista amb el setAdapter:</span></p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"> binding<span class="token punctuation">.</span>listView<span class="token punctuation">.</span><span class="token function">setAdapter</span><span class="token punctuation">(</span>
                   <span class="token function">AdaptadorClientes</span><span class="token punctuation">(</span>
                       <span class="token keyword keyword-this">this</span><span class="token label symbol">@MainActivity</span><span class="token punctuation">,</span>
                       R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>list_layout<span class="token punctuation">,</span>
                       listaCliente<span class="token operator">!!</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><p>Clase Adaptador per a un ListView:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-class">class</span> <span class="token function">AdaptadorClientes</span><span class="token punctuation">(</span><span class="token keyword keyword-var">var</span> activitycontext<span class="token operator">:</span> Activity<span class="token punctuation">,</span> 
                           resource<span class="token operator">:</span> Int<span class="token punctuation">,</span> 
                           objects<span class="token operator">:</span> ArrayList<span class="token operator">&lt;</span>Clientes<span class="token operator">&gt;</span>
                           <span class="token punctuation">)</span> <span class="token operator">:</span>
   ArrayAdapter<span class="token operator">&lt;</span>Any<span class="token operator">&gt;</span><span class="token punctuation">(</span>activitycontext<span class="token punctuation">,</span> resource<span class="token punctuation">,</span> objects <span class="token keyword keyword-as">as</span> List<span class="token operator">&lt;</span>Any<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword keyword-var">var</span> objects<span class="token operator">:</span> ArrayList<span class="token operator">&lt;</span>Clientes<span class="token operator">&gt;</span>
   <span class="token keyword keyword-override">override</span>  <span class="token keyword keyword-fun">fun</span> <span class="token function">getView</span><span class="token punctuation">(</span>position<span class="token operator">:</span> Int<span class="token punctuation">,</span> 
                         convertView<span class="token operator">:</span> View<span class="token operator">?</span><span class="token punctuation">,</span> 
                         parent<span class="token operator">:</span> ViewGroup<span class="token punctuation">)</span><span class="token operator">:</span> View <span class="token punctuation">{</span>
       <span class="token keyword keyword-var">var</span> vista<span class="token operator">:</span> View<span class="token operator">?</span><span class="token operator">=</span> convertView
       <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>vista <span class="token operator">==</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword keyword-val">val</span> inflater <span class="token operator">=</span> activitycontext<span class="token punctuation">.</span>layoutInflater
           vista <span class="token operator">=</span> inflater<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>list_layout<span class="token punctuation">,</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
           <span class="token punctuation">(</span>vista<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>apellidolist<span class="token punctuation">)</span> <span class="token keyword keyword-as">as</span> TextView<span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>objects<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">.</span>apellidos<span class="token punctuation">)</span>
           <span class="token punctuation">(</span>vista<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>nombrelist<span class="token punctuation">)</span> <span class="token keyword keyword-as">as</span> TextView<span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>objects<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">.</span>nombre<span class="token punctuation">)</span>
           <span class="token punctuation">(</span>vista<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>dnilist<span class="token punctuation">)</span> <span class="token keyword keyword-as">as</span> TextView<span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>objects<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">.</span>dni<span class="token punctuation">)</span>
       <span class="token punctuation">}</span>
       <span class="token keyword keyword-return">return</span> vista
   <span class="token punctuation">}</span>

   <span class="token keyword keyword-init">init</span> <span class="token punctuation">{</span>
       <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>objects <span class="token operator">=</span> objects
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre></blockquote>
<p><span style="color: DarkRed; font-weight: bold;">&#x2712;&#xFE0F; Exercici Propost Rec&#xF3;rrer BD</span></p>
<h3 class="mume-header" id="%C3%BAs-de-simplecursoradapter">&#xDA;s de SimpleCursorAdapter</h3>

<p>S&apos;utilitza per a mapear les columnes d&apos;un cursor obert en una base de dades als diferents elements visuals continguts en el control de selecci&#xF3;. Aix&#xED; s&apos;evita el bolcat de tots els elements descarregats de la BD a una col&#xB7;lecci&#xF3;, amb l&apos;estalvi de mem&#xF2;ria que comporta.<br>
Ens trobem amb dos casos: quan usem <strong><code>Spinner</code></strong> o <strong><code>ListView</code></strong> senzills l&apos;adaptador que gestiona aquest bolcat ja est&#xE0; creat, si usem <strong><code>RecyclerView</code></strong> haurem de crear i gestionar l&apos;adaptador.<br>
Programarem un exemple per a practicar aquest concepte, ser&#xE0; una senzilla activitat amb un <strong><code>Spinner</code></strong> que mostrar&#xE0; els cicles inform&#xE0;tics amb la categoria a la qual pertanyen:</p>
<span style="align: center;">
<table align="center">
<tbody><tr>
<td>
<div align="center">
    <img height src="./imagenes/imagen13.png">
</div>
</td>
<td>
<div align="center">
    <img height src="./imagenes/imagen14.png">
</div>
</td>
</tr>
</tbody></table>
</span>
<p>Per a aix&#xF2; ens creem la base de dades i inserim elements com ja hem vist fins al moment:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-class">class</span> <span class="token function">DBAdapter</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-private">private</span>  <span class="token keyword keyword-var">var</span> ohCategoria<span class="token operator">:</span> OHCategoria
    <span class="token keyword keyword-init">init</span> <span class="token punctuation">{</span>
        ohCategoria <span class="token operator">=</span> <span class="token function">OHCategoria</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">&quot;BBDCategorias&quot;</span><span class="token punctuation">,</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">insertarDatosCodigo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword keyword-val">val</span> sqLiteDatabase <span class="token operator">=</span> ohCategoria<span class="token punctuation">.</span>writableDatabase
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>sqLiteDatabase <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-val">val</span> valores <span class="token operator">=</span> <span class="token function">ContentValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            valores<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;nombre&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ASIR&quot;</span><span class="token punctuation">)</span>
            valores<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;cate&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Superior&quot;</span><span class="token punctuation">)</span>
            valores<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;idcategoria&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
            sqLiteDatabase<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">&quot;categoria&quot;</span><span class="token punctuation">,</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">,</span> valores<span class="token punctuation">)</span>
            valores<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;nombre&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;DAM&quot;</span><span class="token punctuation">)</span>
            valores<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;cate&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Superior&quot;</span><span class="token punctuation">)</span>
            valores<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;idcategoria&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
            sqLiteDatabase<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">&quot;categoria&quot;</span><span class="token punctuation">,</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">,</span> valores<span class="token punctuation">)</span>
            valores<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;nombre&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;SMR&quot;</span><span class="token punctuation">)</span>
            valores<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;cate&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Medio&quot;</span><span class="token punctuation">)</span>
            valores<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;idcategoria&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
            sqLiteDatabase<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">&quot;categoria&quot;</span><span class="token punctuation">,</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">,</span> valores<span class="token punctuation">)</span>
            sqLiteDatabase<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">leerDatos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>Cursor<span class="token operator">?</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-val">val</span> sqLiteDatabase <span class="token operator">=</span> ohCategoria<span class="token punctuation">.</span>readableDatabase
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>sqLiteDatabase <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> sqLiteDatabase<span class="token punctuation">.</span><span class="token function">rawQuery</span><span class="token punctuation">(</span>
                <span class="token string">&quot;select  idcategoria as _id, nombre, cate from categoria&quot;</span><span class="token punctuation">,</span>
                <span class="token keyword keyword-null">null</span> <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-null">null</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-inner">inner</span> <span class="token keyword keyword-class">class</span> <span class="token function">OHCategoria</span><span class="token punctuation">(</span>
         context<span class="token operator">:</span> Context<span class="token operator">?</span><span class="token punctuation">,</span> name<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>
         factory<span class="token operator">:</span> SQLiteDatabase<span class="token punctuation">.</span>CursorFactory<span class="token operator">?</span><span class="token punctuation">,</span> 
         version<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">QLiteOpenHelper</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> name<span class="token punctuation">,</span> factory<span class="token punctuation">,</span> version<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-var">var</span> cadena <span class="token operator">=</span>
            &quot;create table <span class="token keyword keyword-if">if</span> not exists <span class="token function">categoria</span><span class="token punctuation">(</span>idcategoria
             INTEGER PRIMARY KEY NOT NULL<span class="token punctuation">,</span> nombre TEXT<span class="token punctuation">,</span> cate TEXT<span class="token punctuation">)</span><span class="token punctuation">;</span>&quot;
        <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>db<span class="token operator">:</span> SQLiteDatabase<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            db<span class="token punctuation">.</span><span class="token function">execSQL</span><span class="token punctuation">(</span>cadena<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onUpgrade</span><span class="token punctuation">(</span>db<span class="token operator">:</span> SQLiteDatabase<span class="token punctuation">,</span> 
                               oldVersion<span class="token operator">:</span> Int<span class="token punctuation">,</span> newVersion<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>Posteriorment passem a crear el cursorAdapter, per&#xF2; per a aix&#xF2; usarem un Spinner per a mostrar la informaci&#xF3;, ho incloem en el layout principal.</p>
<pre data-role="codeBlock" data-info="kotlin{highlight=[9,10]}" class="language-kotlin" data-line="9,10"> <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        <span class="token keyword keyword-val">val</span> from <span class="token operator">=</span> <span class="token function">arrayOf</span><span class="token punctuation">(</span><span class="token string">&quot;nombre&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;cate&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-val">val</span> <span class="token keyword keyword-to">to</span> <span class="token operator">=</span> <span class="token function">intArrayOf</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>ciclo<span class="token punctuation">,</span> R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>cate<span class="token punctuation">)</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_my<span class="token punctuation">)</span>
        <span class="token keyword keyword-val">val</span> dbAdapter<span class="token operator">=</span><span class="token function">DBAdapter</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span>
        dbAdapter<span class="token punctuation">.</span><span class="token function">insertarDatosCodigo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-val">val</span> desplegable <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>Spinner<span class="token operator">&gt;</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>spinner<span class="token punctuation">)</span>
        <span class="token keyword keyword-val">val</span> cursor<span class="token operator">=</span>dbAdapter<span class="token punctuation">.</span><span class="token function">leerDatos</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-val">val</span> mAdapter <span class="token operator">=</span> <span class="token function">SimpleCursorAdapter</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">,</span> R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>spinner_layout<span class="token punctuation">,</span> 
                                           cursor<span class="token punctuation">,</span> from<span class="token punctuation">,</span> <span class="token keyword keyword-to">to</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">)</span>
        desplegable<span class="token punctuation">.</span><span class="token function">setAdapter</span><span class="token punctuation">(</span>mAdapter<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
<div class="line-highlight-wrapper">







<div aria-hidden="true" class="line-highlight" data-range="9" data-start="9">
</div></div><div class="line-highlight-wrapper">








<div aria-hidden="true" class="line-highlight" data-range="10" data-start="10">
</div></div></pre><blockquote>
<p>&#x1F4CC; en la <strong>L&#xED;nia 9</strong> es retorna el cursor amb la selecci&#xF3; de les dades de la BD (compte!! no s&apos;haur&#xE0; de tancar el cursor). <strong>L&#xED;nia 19</strong> per al funcionament del <strong><code>SimpleCursorAdapter</code></strong>, &#xE9;s necessari indicar en la seua definici&#xF3; els seg&#xFC;ents elements: el context, el layout sobre el qual es definir&#xE0; la vista, el cursor que ser&#xE0; origen de les dades, llista amb el nom de les columnes que es vol enlla&#xE7;ar, una llista amb els aneu de les vistes on es mostraran els camps (l&apos;ordre &#xE9;s important) i un flag (0 per defecte)</p>
</blockquote>
<p><span style="color: DarkRed; font-weight: bold;">&#x2712;&#xFE0F; Prova l&apos;aplicaci&#xF3; de l&apos;exemple anterior</span></p>
<div style="page-break-after:always;"></div>
<h4 class="mume-header" id="cursors-amb-recyclerview">Cursors amb RecyclerView</h4>

<p>Com era d&apos;esperar, no es pot aplicar directament un adaptador de tipus <strong><code>SimpleCursorAdapter</code></strong> a un tipus <strong><code>RecyclerView</code></strong>. Si volem aprofitar els beneficis dels cursors en els recyclers, haurem de fabricar-los a mesura. Els passos s&#xF3;n els seg&#xFC;ents:</p>
<ol>
<li>
<p>Crear una classe <strong>Abstracta</strong> base que derive de <strong>RecyclerView.Adapter</strong> i en la qual implementarem els m&#xE8;todes sobreescrits derivats de RecyclerView.Adapter:</p>
<pre data-role="codeBlock" data-info="kotlin {highlight=[8,10,12,16]}" class="language-kotlin" data-line="8,10,12,16"> <span class="token keyword keyword-abstract">abstract</span> <span class="token keyword keyword-class">class</span> <span class="token function">CursorRecyclerAdapter</span><span class="token punctuation">(</span>cursor<span class="token operator">:</span> Cursor<span class="token punctuation">)</span> <span class="token operator">:</span>
 RecyclerView<span class="token punctuation">.</span>Adapter<span class="token operator">&lt;</span>RecyclerView<span class="token punctuation">.</span>ViewHolder<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword keyword-var">var</span> mCursor<span class="token operator">:</span> Cursor
 <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onBindViewHolder</span><span class="token punctuation">(</span>holder<span class="token operator">:</span> RecyclerView<span class="token punctuation">.</span>ViewHolder<span class="token punctuation">,</span> 
                               position<span class="token operator">:</span> Int<span class="token punctuation">)</span> 
 <span class="token punctuation">{</span>
     <span class="token function">checkNotNull</span><span class="token punctuation">(</span>mCursor<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token string">&quot;ERROR, cursos vacio&quot;</span> <span class="token punctuation">}</span>
     <span class="token function">check</span><span class="token punctuation">(</span>mCursor<span class="token punctuation">.</span><span class="token function">moveToPosition</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token string">&quot;ERROR, no se puede&quot;</span> <span class="token operator">+</span>
             <span class="token string">&quot; encontrar la posicion:  <span class="token interpolation variable">$position</span>&quot;</span> <span class="token punctuation">}</span>
     <span class="token function">onBindViewHolder</span><span class="token punctuation">(</span>holder<span class="token punctuation">,</span> mCursor<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
 <span class="token keyword keyword-abstract">abstract</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onBindViewHolder</span><span class="token punctuation">(</span>holder<span class="token operator">:</span> RecyclerView<span class="token punctuation">.</span>ViewHolder<span class="token punctuation">,</span> 
                               cursor<span class="token operator">:</span> Cursor<span class="token punctuation">)</span>
 <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getItemCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Int
 <span class="token punctuation">{</span>
     <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>mCursor <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>    mCursor<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-else">else</span> <span class="token number">0</span>
 <span class="token punctuation">}</span>
 <span class="token keyword keyword-init">init</span> <span class="token punctuation">{</span>
     mCursor <span class="token operator">=</span> cursor
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<div class="line-highlight-wrapper">






<div aria-hidden="true" class="line-highlight" data-range="8" data-start="8">
</div></div><div class="line-highlight-wrapper">








<div aria-hidden="true" class="line-highlight" data-range="10" data-start="10">
</div></div><div class="line-highlight-wrapper">










<div aria-hidden="true" class="line-highlight" data-range="12" data-start="12">
</div></div><div class="line-highlight-wrapper">














<div aria-hidden="true" class="line-highlight" data-range="16" data-start="16">
</div></div></pre><blockquote>
<p>&#x1F4CC; En heretar de <strong><code>RecyclerView.Adapter</code></strong> caldr&#xE0; implementar els m&#xE8;todes <strong><code>onBindViewHolder()</code></strong> al qual li arriba la posici&#xF3; de la l&#xED;nia del recycler que est&#xE0; activa en aqueix moment i <strong><code>getItemCount()</code></strong> que haur&#xE0; de retornar els elements que t&#xE9; el cursor <strong>L&#xED;nia 16</strong>, li arriba en el constructor. En el m&#xE8;tode onBindViewHolder es comprovar&#xE0; que el cursor no est&#xE0; vacio i que es pot accedir a la posici&#xF3; que arriba com a par&#xE0;metre <strong>L&#xED;nia 8</strong>, i en aqueix cas es dir&#xE0; al m&#xE8;tode <strong><code>onBindViewHolder(holder: RecyclerView.ViewHolder, cursor: Cursor)</code></strong> abstracte que hem de crear en aquesta classe <strong>L&#xED;nia 12</strong>, per&#xF2; aquesta vegada amb un <strong><code>Cursor</code></strong> com a par&#xE0;metre.</p>
</blockquote>
</li>
<li>
<p>Ara haurem de crear la nostra classe RecyclerView derivada de l&apos;anterior.</p>
<pre data-role="codeBlock" data-info="kotlin {highlight=[12]}" class="language-kotlin" data-line="12"><span class="token keyword keyword-class">class</span> <span class="token function">RecyclerAdapter</span><span class="token punctuation">(</span>c<span class="token operator">:</span> Cursor<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">CursorRecyclerAdapter</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreateViewHolder</span><span class="token punctuation">(</span>parent<span class="token operator">:</span> ViewGroup<span class="token punctuation">,</span> 
                                 viewType<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> RecyclerView<span class="token punctuation">.</span><span class="token function">ViewHolder</span> 
 <span class="token punctuation">{</span>
     <span class="token keyword keyword-val">val</span> v<span class="token operator">:</span> View <span class="token operator">=</span> LayoutInflater<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>context<span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>recycler_layout<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
     <span class="token keyword keyword-return">return</span> <span class="token function">SimpleViewHolder</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
 <span class="token keyword keyword-override">override</span>  <span class="token keyword keyword-fun">fun</span> <span class="token function">onBindViewHolder</span><span class="token punctuation">(</span>holder<span class="token operator">:</span> RecyclerView<span class="token punctuation">.</span>ViewHolder<span class="token punctuation">,</span>
                                cursor<span class="token operator">:</span> Cursor<span class="token punctuation">)</span> 
 <span class="token punctuation">{</span>
     <span class="token punctuation">(</span>holder <span class="token keyword keyword-as">as</span> SimpleViewHolder<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>cursor<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
 <span class="token keyword keyword-internal">internal</span> <span class="token keyword keyword-inner">inner</span> <span class="token keyword keyword-class">class</span> <span class="token function">SimpleViewHolder</span><span class="token punctuation">(</span>itemView<span class="token operator">:</span> View<span class="token punctuation">)</span> <span class="token operator">:</span>
                   RecyclerView<span class="token punctuation">.</span><span class="token function">ViewHolder</span><span class="token punctuation">(</span>itemView<span class="token punctuation">)</span> 
 <span class="token punctuation">{</span>
     <span class="token keyword keyword-var">var</span> nombre<span class="token operator">:</span> TextView
     <span class="token keyword keyword-var">var</span> cate<span class="token operator">:</span> TextView
     <span class="token keyword keyword-var">var</span> imagen<span class="token operator">:</span> ImageView
     <span class="token keyword keyword-fun">fun</span> <span class="token function">bind</span><span class="token punctuation">(</span>dato<span class="token operator">:</span> Cursor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         nombre<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>dato<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
         cate<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>dato<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token keyword keyword-val">val</span> theImage<span class="token operator">:</span> Bitmap <span class="token operator">=</span> MainActivity<span class="token punctuation">.</span>
                          <span class="token function">convertirStringBitmap</span><span class="token punctuation">(</span>dato<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
         imagen<span class="token punctuation">.</span><span class="token function">setImageBitmap</span><span class="token punctuation">(</span>theImage<span class="token punctuation">)</span>
     <span class="token punctuation">}</span>
     <span class="token keyword keyword-init">init</span> <span class="token punctuation">{</span>
         nombre <span class="token operator">=</span> itemView<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>ciclo<span class="token punctuation">)</span>
         cate <span class="token operator">=</span> itemView<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>cate<span class="token punctuation">)</span>
         imagen <span class="token operator">=</span> itemView<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>imagen<span class="token punctuation">)</span> <span class="token keyword keyword-as">as</span> ImageView
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<div class="line-highlight-wrapper">










<div aria-hidden="true" class="line-highlight" data-range="12" data-start="12">
</div></div></pre><blockquote>
<p>&#x1F4CC; A aquesta classe li arribar&#xE0; el cursor pel constructor que al seu torn ser&#xE0; passat a la classe pare. En heretar de la classe abstracta, haurem d&apos;implementar el seu m&#xE8;tode abstracte i ser&#xE0; ac&#xED; on aprofitarem que el cursos s&apos;ha posicionat en l&apos;element correcte de la BD, per a cridar al m&#xE8;tode <strong><code>bind(cursor)</code></strong> <strong>L&#xED;nia 12</strong> del <strong><code>Holder</code></strong>, amb aqueix estat del cursor. En el <strong><code>Holder</code></strong> tractarem els elements que traiem del cursos de manera correcta.</p>
</blockquote>
</li>
</ol>
<div style="page-break-after:always;"></div>
<span style="align: center;">
<table align="center">
<tbody><tr style="border:hidden;">
<td>
1. Com aquesta App &#xE9;s una mica diferent de l&apos;anterior, s&apos;han incl&#xF2;s imatges per a donar m&#xE9;s funcionalitat, hi ha dos m&#xE8;todes que ens permeten passar imatges de Mapa de bits a String i viceversa per a poder-les guardar en la BD a trav&#xE9;s del cursor (En la BD es guardaran com Blob). Estan localitzats en MyActivity i s&#xF3;n est&#xE0;tics per a poder accedir a ells sense necessitat d&apos;objecte.
</td>
<td style="border:hidden;">
<div align="center">
    <img width="1000" src="./imagenes/imagen15.png">
</div>
</td>
</tr>
</tbody></table>
</span>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-companion">companion</span> <span class="token keyword keyword-object">object</span> 
<span class="token punctuation">{</span>
  <span class="token keyword keyword-fun">fun</span> <span class="token function">convertirStringBitmap</span><span class="token punctuation">(</span>imagen<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> Bitmap <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> decodedString<span class="token operator">:</span> ByteArray <span class="token operator">=</span> Base64<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>imagen<span class="token punctuation">,</span> Base64<span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span>
    <span class="token keyword keyword-return">return</span> BitmapFactory<span class="token punctuation">.</span><span class="token function">decodeByteArray</span><span class="token punctuation">(</span>decodedString<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> decodedString<span class="token punctuation">.</span>size<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword keyword-fun">fun</span> <span class="token function">ConvertirImagenString</span><span class="token punctuation">(</span>bitmap<span class="token operator">:</span> Bitmap<span class="token punctuation">)</span><span class="token operator">:</span> String <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> stream <span class="token operator">=</span> <span class="token function">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    bitmap<span class="token punctuation">.</span><span class="token function">compress</span><span class="token punctuation">(</span>Bitmap<span class="token punctuation">.</span>CompressFormat<span class="token punctuation">.</span>PNG<span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> stream<span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> byte_arr<span class="token operator">:</span> ByteArray <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-return">return</span> Base64<span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span>byte_arr<span class="token punctuation">,</span> Base64<span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p><span style="color: DarkRed; font-weight: bold;">&#x2712;&#xFE0F;Proba la aplicaci&#xF3; del exemple anterior<br>
</span></p>
<p><span style="color: DarkRed; font-weight: bold;">&#x2712;&#xFE0F; Exercici proposat cursor amb recycler</span></p>
<div style="page-break-after:always;"></div>
<h2 class="mume-header" id="acc%C3%A9s-a-bases-de-dades-remotes">Acc&#xE9;s a bases de dades remotes</h2>

<h3 class="mume-header" id="introducci%C3%B3-1">Introducci&#xF3;</h3>

<p>Per a obtindre i guardar informaci&#xF3; d&apos;una base de dades remota, &#xE9;s necessari connectar-se a un servidor on es trobar&#xE0; la BBDD. L&apos;esquema de funcionament el podem veure en la seg&#xFC;ent imatge:</p>
<div align="center">
    <img height="280" src="./imagenes/imagen1.png">
</div>
<p>En el servidor funcionen en realitat tres components b&#xE0;sics:</p>
<ul>
<li>
<p>Una base de dades, que emmagatzema tota la informaci&#xF3; dels usuaris. Per a la BBDD es pot utilitzar MySQL, que &#xE9;s de llic&#xE8;ncia gratu&#xEF;ta.</p>
<div align="center">
  <img height="180" src="./imagenes/imagen2.png">
</div></li>
</ul>

<ul>
<li>Un servlet, que at&#xE9;n la petici&#xF3; rebuda, la processa i envia la resposta corresponent. Un servlet no &#xE9;s m&#xE9;s que un component Java, generalment xicotet i independent de la<br>
plataforma.</li>
<li>Un servidor web , on resideix i s&apos;executa el servlet , i que roman a l&apos;espera de connexions HTTP entrants.</li>
</ul>
<p>Els formats m&#xE9;s utilitzats per a compartir informaci&#xF3; mitjan&#xE7;ant aquests serveis web s&#xF3;n XML (i altres derivats) i JSON.</p>
<h5 class="mume-header" id="qu%C3%A8-%C3%A9s-json">Qu&#xE8; &#xE9;s JSON?</h5>

<p>JSON ( JavaScript Objec t Notation ) &#xE9;s un format lleuger d&apos;intercanvi de dades entre clients i servidors, basat en la sintaxi de JavaScript per a representar estructures en forma organitzada. &#xC9;s un format en text pla independent de tot llenguatge de programaci&#xF3;, &#xE9;s m&#xE9;s, suporta l&apos;intercanvi de dades en gran varietat de llenguatges de programaci&#xF3; com PHP Python C++ C# Java i Ruby.<br>
XML tamb&#xE9; pot usar-se per a l&apos;intercanvi, per&#xF2; pel fet que la seua definici&#xF3; genera un DOM , l&apos;analitze es torna extens i pesat. A m&#xE9;s d&apos;aix&#xF2; XML ha d&apos;usar Xpath per a especificar rutes d&apos;elements i atributs, per la qual cosa demora la reconstrucci&#xF3; de la petici&#xF3;. En canvi JSON no requereix restriccions addicionals, simplement s&apos;obt&#xE9; el text pla i el engine de JavaScript en els navegadors fa el treball de parsing sense cap complicaci&#xF3;.</p>
<h5 class="mume-header" id="tipus-de-dades-en-json">Tipus de dades en JSON</h5>

<p>Similar a l&apos;estructuraci&#xF3; de dades primitives i complexos en els llenguatges de programaci&#xF3;, JSON estableix diversos tipus de dades: cadenes, n&#xFA;meros, booleans, arrays, objectes i valors null. El prop&#xF2;sit &#xE9;s crear objectes que continguen diversos atributs compostos com a parells clau valor. On la clau &#xE9;s un nom que identifique l&apos;&#xFA;s del valor que l&apos;acompanya. Vegem un exemple:</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token punctuation">{</span>
   <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">101</span><span class="token punctuation">,</span>
   <span class="token property">&quot;Nombre&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Carlos&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;EstaActivo&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
   <span class="token property">&quot;Notas&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">2.3</span><span class="token punctuation">,</span> <span class="token number">4.3</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</pre><p>L&apos;anterior estructura &#xE9;s un objecte JSON compost per les dades d&apos;un estudiant. Els objectes JSON contenen els seus atributs entre claus <strong><code>{}</code></strong>, igual que un bloc de codi en JavaScript, on cada atribut ha d&apos;anar separat per coma <strong><code>,</code></strong> per a diferenciar cada parell.<br>
La sintaxi dels parells ha de contindre dos punts <strong><code>:</code></strong> per a dividir la clau del valor. El nom del parell ha de tractar-se com a cadena i afegir-li cometes dobles.<br>
Si notes, aquest exemple porta un exemple de cada tipus de dada:</p>
<ul>
<li>
<p>El <em>id</em> &#xE9;s de tipus sencer, ja que cont&#xE9; un n&#xFA;mero que representa el codi de l&apos;estudiant.</p>
</li>
<li>
<p>El <em>Nom</em> &#xE9;s un string. Usa cometes dobles per a identificar-les.</p>
</li>
<li>
<p><em>EstaActivo</em> &#xE9;s un tipus boole&#xE0; que representa si l&apos;estudiant es troba en la instituci&#xF3; educativa o no. Usa les paraules reservades true i false per a declarar el valor.</p>
</li>
<li>
<p><em>Notes</em> &#xE9;s un arranjament de nombres reals. El conjunt dels seus elements has d&apos;incloure&apos;ls dins de claud&#xE0;tors <strong><code>[ ]</code></strong> i separar-los per coma.</p>
</li>
</ul>
<p>La idea &#xE9;s crear un mecanisme que permeta rebre la informaci&#xF3; que cont&#xE9; la base de dades externa en format JSON cap a l&apos;aplicaci&#xF3;. Amb aix&#xF2; s&apos;analitzar&#xE0; cada element i ser&#xE0; interpretat en forma d&apos;objecte Java per a integrar correctament l&apos;aspecte en la interf&#xED;cie d&apos;usuari.<br>
La classe <strong>JsonObject</strong> de la llibreria <strong>org.json.JSONObject</strong>, pot interpretar dades amb format JSON i analitzar-los a objectes Java o al rev&#xE9;s.<br>
Vegem una il&#xB7;lustraci&#xF3; que mostra el proc&#xE9;s d&apos;analitze que ser&#xE0; estudiat:</p>
<div align="center">
    <img height="300" src="./imagenes/imagen3.png">
</div>
<ul>
<li>Com pots observar l&apos;origen de les dades &#xE9;s un servidor extern o hosting que hages contractat com a prove&#xEF;dor per als teus serveis web. L&apos;aplicaci&#xF3; web que realitza la gesti&#xF3; d&apos;encriptaci&#xF3; de les dades a format <code>JSON</code> pot ser <code>PHP</code>, <code>JavaScript</code>, <code>ASP.NET</code>, etc..</li>
<li>La teua aplicaci&#xF3; Android a trav&#xE9;s d&apos;un client realitza una petici&#xF3; a la direcci&#xF3; URL del recurs amb la finalitat d&apos;obtindre les dades. Aqueix flux entrant ha d&apos;interpretar-se amb ajuda d&apos;un parser personalitzat que implementaren les classes que s&apos;utilitzen per a treballar amb <code>JSON</code>.</li>
<li>El resultat final &#xE9;s un conjunt de dades adaptable al <code>API</code> d&apos;Android. Depenent de les teues necessitats, pots convertir-los en una llista d&apos;objectes estructurats que alimenten un adaptador que poble un ListView o simplement actualitzar la base de dades local de la teua aplicaci&#xF3; en <code>SQLite</code>.</li>
</ul>
<div style="page-break-after:always;"></div>
<h3 class="mume-header" id="acc%C3%A9s-a-bases-de-dades-amb-apirest-i-retrofit">Acc&#xE9;s a bases de dades amb Apirest i Retrofit</h3>

<p>Retrofit &#xE9;s un client <em>REST</em> per a Android i Java, desenvolupat per Square, molt simple i f&#xE0;cil d&apos;aprendre. Permet fer peticions <strong><code>GET</code></strong>, <strong><code>POST</code></strong>, <strong><code>PUT</code></strong>, <strong><code>PATCH</code></strong>, <strong><code>DELETE</code></strong> i <strong><code>HEAD</code></strong>; gestionar diferents tipus de par&#xE0;metres i analitzar autom&#xE0;ticament la resposta a un POJO (Plain Old Java Object). Utilitzarem aquesta llibreria per la seua facilitat de maneig.</p>
<h4 class="mume-header" id="definici%C3%B3-del-servei-rest">Definici&#xF3; del Servei Rest</h4>

<p>Com &#xE9;s de suposar, per a poder accedir a un servei Rest des d&apos;una de les nostres aplicacions, aquest ha d&apos;haver sigut creat amb anterioritat i allotjat en un Hosting adequat.<br>
La part de creaci&#xF3; ja siga amb PHP, Java, o qualsevol dels altres llenguatges que ho permeten no correspon a la nostra assignatura, per la qual cosa la passarem per alt i usarem un ApiRest general que s&apos;ha proporcionat en el m&#xF2;dul d&apos;Acc&#xE9;s a Dades i que amb unes xicotetes modificacions &#xE9;s valgut per a la majoria de casos. La carpeta amb el *ApiRest est&#xE0; composta dels seg&#xFC;ents arxius:</p>
<div align="center">
    <img height="200" src="./imagenes/imagen4.png">
</div>
<p>La configuraci&#xF3; del nostre *API consta de dos arxius:</p>
<ol>
<li><strong><code>.htaccess</code></strong> En aquest arxiu es configuren les regles d&apos;acc&#xE9;s, sobre una ruta que li indiquem en RewriteBase (ac&#xED; &#xE9;s on haurem d&apos;afegir la carpeta en la qual haurem allotjat nostra API, comen&#xE7;ant i acabant amb <em><code>/</code></em>).</li>
<li><strong><code>apirest_variables.php</code></strong>, en aquest arxiu es defineixen les dades de connexi&#xF3; a la base de dades. s&apos;indiquen les taules que t&#xE9; aquesta i el nom de l&apos;identificador de cadascuna d&apos;elles.</li>
</ol>
<div style="page-break-after:always;"></div>
<span style="align: center;">
<table align="center">
<tbody><tr>
<td align="center">
<font face="small fonts">
 .htaccess
</font>
<div align="center">
    <img height="
    " src="./imagenes/imagen5.png">
</div>
</td>
<td>
<div align="center">
<font face="small fonts">
 apirest_variables.php
</font>
    <img height="
    " src="./imagenes/imagen6.png">
</div>
</td>
</tr>
</tbody></table>
</span>
<p>La resta d&apos;arxius del ApiREst no hauran de modificar-se, ja que est&#xE0; constru&#xEF;da de manera gen&#xE8;rica amb les necessitats m&#xE9;s comunes per a aquests casos. Haurem de crear la BD i allotjar el ApiRest de manera local o en el n&#xFA;vol, usant els coneixements que es tenen del m&#xF2;dul d&apos;Acc&#xE9;s a Dades.</p>
<p><em>Suposarem un exemple molt senzill d&apos;una base de dades Usuaris en el qual tindrem solament una taula Usuaris amb dos camps de tipus String (nick i nom). La BD l&apos;haurem constru&#xEF;da en el servidor amb antelaci&#xF3; (en aquest cas amb taula usarios de tres camps, nick i nom de tipus cadena i _aneu de tipus num&#xE8;ric autoincrementable com a clau). Tamb&#xE9; crearem una aplicaci&#xF3; amb dos camps de text que ens permeta inserir les dades de l&apos;usuari i un bot&#xF3; flotant d&apos;afegir, com es veu en la imatge seg&#xFC;ent:</em></p>
<div align="center">
    <img height="250" src="./imagenes/imagen7.png">
</div>
<h4 class="mume-header" id="consum-dun-servei-rest-des-dandroid">Consum d&apos;un Servei Rest des d&apos;Android</h4>

<p>Existeixen diferents llibreries que ens permetrien consumir els serveis des de l&apos;App d&apos;Android, per&#xF2; donada la seua facilitat utilitzarem les llibreries: <strong>Retrofit2</strong> i <strong>Gson</strong>.<br>
Retrofit la utilitzarem per a fer peticions i processar les respostes del APIRest, mentre que amb Gson transformarem les dades de JSON als propis que utilitze l&apos;aplicaci&#xF3;.<br>
Per a aix&#xF2; afegirem les seg&#xFC;ents l&#xED;nies en el build.gradle de l&apos;app, i no oblides incloure permisos d&apos;internet:</p>
<pre data-role="codeBlock" data-info="json" class="language-json">            implementation <span class="token string">&quot;com.squareup.retrofit2:converter-gson:2.9.0&quot;</span>
            implementation &apos;com.squareup.retrofit2<span class="token operator">:</span>retrofit<span class="token operator">:</span><span class="token number">2.9</span>.<span class="token number">0</span>&apos;
</pre><p>Podem dir que els passos a seguir seran els seg&#xFC;ents:</p>
<ol>
<li>Creaci&#xF3; d&apos;un builder de Retrofit. Per a poder utilitzar Retrofit necessites crear un builder que et servir&#xE0; per a comunicar-te amb la API triada. En la imatge s&apos;ha utilitzat un m&#xE8;tode per a encapsular el codi, encara que no &#xE9;s necessari.</li>
</ol>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">crearRetrofit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> ProveedorSersvicio <span class="token punctuation">{</span>
    <span class="token comment">//val url = &quot;http://10.0.2.2/usuarios/&quot; //para el AVD de android</span>
    <span class="token keyword keyword-val">val</span> url<span class="token operator">=</span><span class="token string">&quot;http://xusa.iesdoctorbalmis.info/usuarios/&quot;</span> <span class="token comment">//para servidor del instituto</span>
    <span class="token keyword keyword-val">val</span> retrofit <span class="token operator">=</span> Retrofit<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">baseUrl</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addConverterFactory</span><span class="token punctuation">(</span>GsonConverterFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-return">return</span> retrofit<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>ProveedorSersvicio<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</pre><p>Si et fixes en la segona l&#xED;nia veur&#xE0;s que cal escriure la url base de la API a la qual far&#xE0;s les peticions. L&apos;obtens de la documentaci&#xF3; proporcionada pel creador de la API.<br>
En la seg&#xFC;ent l&#xED;nia cal indicar la manera de convertir els objectes de la API als de la teua aplicaci&#xF3; i viceversa, ac&#xED; &#xE9;s on espec&#xED;fiques que utilitzar&#xE0;s Gson.</p>
<p>Aquest builder ho necessitar&#xE0;s per a fer les anomenades a la API, aix&#xED; que procura que siga accessible.</p>
<ol start="2">
<li>
<p>Creaci&#xF3; de les classes Pojo que li servir&#xE0; al Gson per a analitzar els resultats. Per&#xF2; primer necessites con&#xE9;ixer l&apos;estructura del Json que et retornar&#xE0; la API, ja que no hi ha un patr&#xF3; establit. Per a con&#xE9;ixer l&apos;estructura pr&#xE8;viament, es pot utilitzar PostMan i realitzar les diferents peticions (GET, POST, PUT, etc) des d&apos;aquest.<br>
Existeixen aplicacions o webs que faciliten la creaci&#xF3; de la classe Pojo a partir d&apos;un JSon, com per exemple: [<a href="http://www.jsonschema2pojo.org/">http://www.jsonschema2pojo.org/</a>]</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-class">class</span> RespuestaJSon <span class="token punctuation">{</span>
    <span class="token keyword keyword-var">var</span> respuesta <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword keyword-var">var</span> metodo<span class="token operator">:</span> String<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword keyword-null">null</span>
    <span class="token keyword keyword-var">var</span> tabla<span class="token operator">:</span> String<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword keyword-null">null</span>
    <span class="token keyword keyword-var">var</span> mensaje<span class="token operator">:</span> String<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword keyword-null">null</span>
    <span class="token keyword keyword-var">var</span> sqlQuery<span class="token operator">:</span> String<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword keyword-null">null</span>
    <span class="token keyword keyword-var">var</span> sqlError<span class="token operator">:</span> String<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword keyword-null">null</span>
<span class="token punctuation">}</span>
</pre><p>Despr&#xE9;s has de crear l&apos;estructura de classes per a emmagatzemar la informaci&#xF3; que et resulte &#xFA;til. Classe Usuari en aquest exemple.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-class">class</span> <span class="token function">Usuarios</span><span class="token punctuation">(</span><span class="token keyword keyword-var">var</span> nick<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token keyword keyword-var">var</span> nombre<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token keyword keyword-var">var</span> _id<span class="token operator">:</span> Int <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
</pre></li>
<li>
<p>Un altre element imprescindible, &#xE9;s la gesti&#xF3; dels serveis que es vulguen utilitzar. Per a cadascun d&apos;ells s&apos;haur&#xE0; de fer una petici&#xF3; a la API. Necessitarem crear una interf&#xED;cie amb tots els serveis que vulgues utilitzar. Ac&#xED; tens uns exemples:</p>
</li>
</ol>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-interface">interface</span> ProveedorSersvicio <span class="token punctuation">{</span>
    <span class="token annotation builtin">@GET</span><span class="token punctuation">(</span><span class="token string">&quot;usuarios&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation builtin">@Headers</span><span class="token punctuation">(</span><span class="token string">&quot;Accept: application/json&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Content-Type: application/json&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">usuarios</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Response<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Usuarios<span class="token operator">&gt;</span><span class="token operator">&gt;</span>

    <span class="token annotation builtin">@GET</span><span class="token punctuation">(</span><span class="token string">&quot;mensajes&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation builtin">@Headers</span><span class="token punctuation">(</span><span class="token string">&quot;Accept: application/json&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Content-Type: application/json&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">mensajes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>Response<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Mensaje<span class="token operator">&gt;</span><span class="token operator">&gt;</span>

    <span class="token annotation builtin">@GET</span><span class="token punctuation">(</span><span class="token string">&quot;mensajes/{nick}&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation builtin">@Headers</span><span class="token punctuation">(</span><span class="token string">&quot;Accept: application/json&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Content-Type: application/json&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getUsuario</span><span class="token punctuation">(</span><span class="token annotation builtin">@Path</span><span class="token punctuation">(</span><span class="token string">&quot;nick&quot;</span><span class="token punctuation">)</span> nick<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> Response<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Usuarios<span class="token operator">&gt;</span><span class="token operator">&gt;</span>

    <span class="token annotation builtin">@POST</span><span class="token punctuation">(</span><span class="token string">&quot;usuarios&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation builtin">@Headers</span><span class="token punctuation">(</span><span class="token string">&quot;Accept: application/json&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Content-Type: application/json&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">insertarUsuario</span><span class="token punctuation">(</span><span class="token annotation builtin">@Body</span> usuarios<span class="token operator">:</span> Usuarios<span class="token punctuation">)</span><span class="token operator">:</span> Response<span class="token operator">&lt;</span>RespuestaJSon<span class="token operator">&gt;</span>

    <span class="token annotation builtin">@POST</span><span class="token punctuation">(</span><span class="token string">&quot;mensajes&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation builtin">@Headers</span><span class="token punctuation">(</span><span class="token string">&quot;Accept: application/json&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Content-Type: application/json&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">insertarMensaje</span><span class="token punctuation">(</span><span class="token annotation builtin">@Body</span> mensaje<span class="token operator">:</span> Mensaje<span class="token punctuation">)</span><span class="token operator">:</span> Response<span class="token operator">&lt;</span>RespuestaJSon<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</pre><p>En el codi de dalt hi ha dos serveis dos s&#xF3;n de tipus <strong><code>GET</code></strong> sense paraula clau i que serviran per a obtindre tots els usuaris i tots els missatges. Despr&#xE9;s es t&#xE9; un altre servei <strong><code>GET</code></strong> amb paraula clau (Nick) que servir&#xE0; per a seleccionar els missatges d&apos;un determinat Nick. I despr&#xE9;s dos <strong><code>POST</code></strong> als quals se&apos;ls passa en el Bodi les dades a afegir.<br>
Usant <strong><code>Corrutinas</code></strong> es realitzar&#xE0; l&apos;anomenada a la API, per la qual cosa els m&#xE8;todes de la interf&#xED;cie han de ser de tipus <strong>suspend</strong>. En cada m&#xE8;tode s&apos;indica el tipus de dada que espera obtindre, en aquests exemples la resposta pot ser o una llista del tipus d&apos;objecte de la petici&#xF3; o un tipus *RespuestaJSon, que tindr&#xE0; tots els possibles membres que ens podria donar alguna de les crides invocades.<br>
Les paraules seguides del s&#xED;mbol <strong><code>@</code></strong> donen funcionalitat als serveis, fent-los din&#xE0;mics i reutilitzables, per a m&#xE9;s informaci&#xF3; [<a href="http://square.github.io/retrofit/">http://square.github.io/retrofit/</a>]</p>
<blockquote>
<p>&#x1F4A1; Les que gestiona <strong>Retrofit</strong> per a invocar la url de la petici&#xF3; s&#xF3;n <strong><code>@GET, @POST, @PUT i @DELETE</code></strong>. El par&#xE0;metre correspondr&#xE0; amb la url de la petici&#xF3;.<br>
En el builder de Retrofit s&apos;inclou la url base del api acabada amb <strong><code>/</code></strong>, que unida amb el par&#xE0;metre del servei crearan la url completa de la petici&#xF3;:<br>
<strong><code>@GET -&gt; http://10.0.2.2/usuaris/usuari</code></strong></p>
<ul>
<li><strong><code>@Header i @Headers</code></strong>. S&apos;usen per a especificar els valors que van en la secci&#xF3; <em>header</em> de la petici&#xF3;, com per exemple en qu&#xE8; format seran enviats i rebuts les dades.</li>
<li><strong><code>@Path</code></strong>. Serveix per a incloure un identificador en la url de la petici&#xF3;, per a obtindre informaci&#xF3; sobre una cosa espec&#xED;fica. L&apos;atribut en el m&#xE8;tode de crida que siga precedit per <em>@Path</em>, substituir&#xE0; a l&apos;identificador entre claus de la ruta que tinga el mateix nom.</li>
<li><strong><code>@Fields</code></strong>. Ens permet passar variables b&#xE0;siques en les peticions <em>Post i Put</em>.</li>
<li><strong><code>@Bodi</code></strong>. &#xC9;s equivalent a Fields per&#xF2; per a variables objecte.</li>
<li><strong><code>@*Query</code></strong>. S&apos;usa quan la petici&#xF3; necessitar&#xE0; par&#xE0;metres (els valors que van despr&#xE9;s del <strong><code>?</code></strong> en una url).</li>
</ul>
</blockquote>
<ol start="4">
<li>Demanar dades a la Api seria l&apos;&#xFA;ltim passe a realitzar. Retrofit ens dona l&apos;opci&#xF3; de realitzar-ho de manera s&#xED;ncrona o as&#xED;ncrona. Aprofitarem els nostres coneixements de *corrutinas per a llan&#xE7;ar la petici&#xF3; en segon pla de manera senzilla.</li>
</ol>
<pre data-role="codeBlock" data-info="kotlin{highlight=[4,[5-19], 8]}" class="language-kotlin" data-line="4,5-19,8"> <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">anyadirUsuario</span><span class="token punctuation">(</span>usuarios<span class="token operator">:</span> Usuarios<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-val">val</span> context<span class="token operator">=</span><span class="token keyword keyword-this">this</span>
        <span class="token keyword keyword-var">var</span> salida<span class="token operator">:</span>String<span class="token operator">?</span>
        <span class="token keyword keyword-val">val</span> proveedorServicios<span class="token operator">:</span> ProveedorSersvicio <span class="token operator">=</span> <span class="token function">crearRetrofit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">CoroutineScope</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">launch</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-val">val</span> response <span class="token operator">=</span> proveedorServicios<span class="token punctuation">.</span><span class="token function">insertarUsuario</span><span class="token punctuation">(</span>usuarios<span class="token punctuation">)</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>isSuccessful<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-val">val</span> usuariosResponse <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>usuariosResponse <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> salida<span class="token operator">=</span>usuariosResponse<span class="token punctuation">.</span>mensaje
                <span class="token keyword keyword-else">else</span> salida<span class="token operator">=</span>response<span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span>
            <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                Log<span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token string">&quot;Error&quot;</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span><span class="token function">errorBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                salida<span class="token operator">=</span>response<span class="token punctuation">.</span><span class="token function">errorBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>  Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> salida<span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_LONG<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>espera <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> espera<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token function">limpiaControl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<div class="line-highlight-wrapper">


<div aria-hidden="true" class="line-highlight" data-range="4" data-start="4">
</div></div><div class="line-highlight-wrapper">



<div aria-hidden="true" class="line-highlight" data-range="5-19" data-start="5" data-end="19">














</div></div><div class="line-highlight-wrapper">






<div aria-hidden="true" class="line-highlight" data-range="8" data-start="8">
</div></div></pre><blockquote>
<p>&#x1F4CC; <strong>L&#xED;nia 4</strong> cridem al m&#xE8;tode crearRetrofit, que &#xE9;s el que ens retorna un prove&#xEF;dor de serveis del tipus de interface que hem creat i ens enlla&#xE7;ar&#xE0; amb la url del servidor i amb el GSon. L&#xED;nia 5 - 13 es llan&#xE7;a la corrutina amb la petici&#xF3; desitjada, quan s&apos;obtinga resposta es filtra per a veure si ha sigut correcta i recuperar les dades necess&#xE0;ries, <strong><code>response.bodi()</code></strong>, en cas contrari es llan&#xE7;a missatge d&apos;error.</p>
</blockquote>
<p><span style="color: DarkRed; font-weight: bold;">&#x2712;&#xFE0F;EjercicioPropuestoBDExternas</span></p>
<p><span style="color: DarkRed; font-weight: bold;">&#x2712;&#xFE0F;EjercicioPropuestoAgenda</span></p>
<div style="page-break-after:always;"></div>
<h2 class="mume-header" id="acceso-a-base-de-datos-con-firebase">Acceso a Base de Datos con FIREBASE</h2>

<p><a href="https://firebase.google.com/">Firebase</a> es una plataforma de backend para construir aplicaciones m&#xF3;viles y web, se encarga del manejo de la infraestructura permitiendo que el desarrollador se enfoque en otros aspectos de la aplicaci&#xF3;n. Entre sus caracter&#xED;sticas se incluye base de datos de tiempo real, autenticaci&#xF3;n de usuarios y almacenamiento (hosting) est&#xE1;tico. La idea de usar Firebase es no tener que escribir c&#xF3;digo del lado del servidor y aprovechar al m&#xE1;ximo las caracter&#xED;sticas que nos provee la plataforma. Para utilizar Firebase con Android disponemos de un SDK, lo que nos permitir&#xE1; integrarlo f&#xE1;cilmente a nuestra aplicaci&#xF3;n. Para este ejemplo vamos a construir un listado de cosas por hacer usando la base de datos de tiempo real de Firebase como backend y autenticaci&#xF3;n con email/password.</p>
<h3 class="mume-header" id="creant-un-app-de-firebase">Creant un app de Firebase</h3>

<p>El primer pas &#xE9;s associar el nostre compte de Firebase a una dels nostres comptes de correu electr&#xF2;nic:</p>
<div align="center">
    <img height="250" src="./imagenes/imagen16.png">
</div>
<p>Una vegada est&#xE0; llesta veurem la pantalla on &#xE9;s possible visualitzar els nostres projectes o crear nous.</p>
<div align="center">
    <img height="250" src="./imagenes/imagen17.png">
</div>
<span style="align: center;">
<table align="center">
<tbody><tr>
<td style="border: 0;">
Per a crear un nou projecte solament haurem d&apos;introduir un nom i l&apos;organitzaci&#xF3; o carpeta principal del projecte. Google ens demanar&#xE0; si volem habilitar Google Analytics en el projecte, el deixarem habilitat.
</td>
<td style="border: 0;">
<div align="center">
    <img width="1000" src="./imagenes/imagen18.png">
</div>
</td>
</tr>
</tbody></table>
</span>
<div align="left">
    <img height="50" src="./imagenes/imagen19.png">
</div>
<p>I ho associarem al compte per defecte. Una vegada realitzats aquests passos, es crear&#xE0; el projecte de firebase.</p>
<p>Posteriorment ens apareixer&#xE0; la pantalla que ens permetr&#xE0; afegir l&apos;aplicaci&#xF3; al nostre projecte Cada projecte estar&#xE0; associat a una o m&#xE9;s aplicacions, per la qual cosa abans de crear el projecte necessitarem crear l&apos;aplicaci&#xF3; o decidir l&apos;espai de noms d&apos;aquesta.</p>
<p><em>Crearem una aplicaci&#xF3; senzilla amb el seg&#xFC;ent aspecte, que ens permeta entendre el funcionament d&apos;acc&#xE9;s a Firebase per a enviar i rebre dades sense autenticaci&#xF3;.</em></p>
<div align="center">
    <img height="200" src="./imagenes/imagen32.png">
</div>
<p>Quan l&apos;usuari meta la informaci&#xF3; en els TextView i prema el bot&#xF3; afegir, la informaci&#xF3; es guarda en Firebase i quan es modifique aquesta des de Firebase, es mostrar&#xE0; un missatge amb el text modificat en el Txt de l&apos;aplicaci&#xF3;.</p>
<div align="center">
    <img height="150" src="./imagenes/imagen20.png">
</div>
<p>Una vegada tinguem l&apos;espai de nom, podrem seguir amb els passos que ens demana Firebase per a crear l&apos;aplicaci&#xF3;. En el nostre cas no ser&#xE0; necessari introduir la signatura de certificaci&#xF3;.</p>
<div align="center">
    <img height="350" src="./imagenes/imagen21.png">
</div>
<p>Just en el moment que acaba de crear-se l&apos;aplicaci&#xF3;, es descarregara un arxiu JSON que haurem de copiar en el nostre projecte Android. Nom&#xE9;s haurem de seguir les instruccions que proporciona molt clarament la p&#xE0;gina Web de Firebase (copiar l&apos;arxiu i afegir les l&#xED;nies que indiquen que usarem serveis de google en els build.gradle de l&apos;app i del projecte).</p>
<ol>
<li>
<p>En el projecte</p>
<pre data-role="codeBlock" data-info="json" class="language-json">  dependencies <span class="token punctuation">{</span>
     classpath <span class="token string">&quot;com.android.tools.build:gradle:7.0.3&quot;</span>
     classpath <span class="token string">&quot;com.google.gms:google-services:4.3.10&quot;</span> <span class="token comment">//a&#xF1;adir esta l&#xED;nea</span>
     ...
  <span class="token punctuation">}</span>
</pre></li>
<li>
<p>En la APP</p>
<pre data-role="codeBlock" data-info="json" class="language-json">plugins <span class="token punctuation">{</span>
   id &apos;com.android.application&apos;
   id &apos;kotlin-android&apos;
   id &apos;com.google.gms.google-services&apos;  <span class="token comment">// Google Services plugin</span>
<span class="token punctuation">}</span>

dependencies <span class="token punctuation">{</span>
    ...
    implementation &apos;androidx.appcompat<span class="token operator">:</span>appcompat<span class="token operator">:</span><span class="token number">1.3</span>.<span class="token number">1</span>&apos;
    <span class="token comment">//a&#xF1;adir las siguientes dos l&#xED;neas</span>
    implementation platform(&apos;com.google.firebase<span class="token operator">:</span>firebase-bom<span class="token operator">:</span><span class="token number">28.4</span>.<span class="token number">1</span>&apos;)
    implementation &apos;com.google.firebase<span class="token operator">:</span>firebase-analytics&apos;
    ...
<span class="token punctuation">}</span>
</pre></li>
</ol>
<p>La depend&#xE8;ncia de firebase bom permetr&#xE0; evitar afegir la versi&#xF3; a la resta de depend&#xE8;ncies de Firebase que incloguem en el nostre projecte, facilitant molt el treball.<br>
Molt important no oblidar afegir en el SDK, el servei de Google Play</p>
<div align="center">
    <img height src="./imagenes/imagen22.png">
</div>
<p>En la manera consola podrem accedir a tots els nostres projectes, i podem comprovar l&apos;aplicaci&#xF3; o aplicacions afegides sobre un projecte (podem afegir m&#xE9;s d&apos;una).</p>
<span style="align: center;">
<table align="center">
<tbody><tr style="border:hidden;">
<td align="center" rowspan="2">
<div align="left">
    <img width="400" src="./imagenes/imagen24.png">
</div>
</td>
<td style="border:hidden;">
<div align="center">
    <img height="150" src="./imagenes/imagen23.png">
</div>
</td>
</tr>
<tr>
<td style="border:hidden;">
Accedint a la configuraci&#xF3; de l&apos;aplicaci&#xF3; o del projecte, podrem veure informaci&#xF3; sobre les claus, ANEU d&apos;aplicaci&#xF3; i altra. Tamb&#xE9; podrem descarregar de nou el .json de configuraci&#xF3; dels serveis.
</td>
</tr>

</tbody></table>
</span>
<p>Totes les aplicacions per defecte es troben en manera desenvolupe i sota el pla gratis que suporta fins a 100 connexions concurrents, 1GB d&apos;emmagatzematge i 10GB de transfer&#xE8;ncia en el backend. Despr&#xE9;s de creada l&apos;app ens dirigim a veure els seus detalls, podem entrar en diverses pestanyes que ens permetran treballar amb l&apos;APP, per&#xF2; a nosaltres ens interessa la BD. Firebase ofereix dues solucions de bases de dades en el n&#xFA;vol i accessibles per als clients que admeten sincronitzaci&#xF3; en temps real:</p>
<ul>
<li><strong><code>Firestore DataBase</code></strong> a vegades tamb&#xE9; nomenada Cloud Firestores, &#xE9;s la base de dades m&#xE9;s recent de Firebase. Aprofita el millor de Realtime Database amb un model de dades nou, permet consultes m&#xE9;s riques i r&#xE0;pides, i l&apos;escalament s&apos;ajusta a un nivell m&#xE9;s alt que Realtime Database.</li>
<li><strong><code>Realtime Database</code></strong> &#xE9;s la base de dades original de Firebase. &#xC9;s una soluci&#xF3; eficient i de baixa lat&#xE8;ncia destinada a les apps per a dispositius m&#xF2;bils que necessiten estats sincronitzats entre els clients en temps real. &#xC9;s similar a l&apos;anterior en el seu &#xFA;s, per la qual cosa no l&apos;explicarem.</li>
</ul>
<div align="center">
    <img height="250" src="./imagenes/imagen25.png">
</div>
<h3 class="mume-header" id="firestore-database">Firestore DataBase</h3>

<p>Base de dades NoSQL flexible, escalable i en el n&#xFA;vol a fi d&apos;emmagatzemar i sincronitzar dades per a la programaci&#xF3; en el costat del client i del servidor. Igual que <a href="https://firebase.google.com/docs/database">Firebase Realtime Database</a> mant&#xE9; les dades sincronitzades entre apps client a trav&#xE9;s d&apos;agents d&apos;escolta en temps real. El model de dades de <a href="https://firebase.google.com/docs/firestore">Firebase Firestore DataBase</a> admet estructures de dades flexibles i jer&#xE0;rquiques. Emmagatzema les dades en documents organitzats en col&#xB7;leccions, els documents poden contindre objectes niats complexos, a m&#xE9;s de subcolecciones. Est&#xE0; optimitzada per a emmagatzemar grans col&#xB7;leccions de documents xicotets. El model de dades est&#xE0; format per documents, cada document cont&#xE9; un conjunt de parells clau-valor. Tots els documents s&apos;han d&apos;emmagatzemar en col&#xB7;leccions, els documents poden contindre subcolecciones i objectes niats, i tots dos poden incloure camps primitius com strings o tipus d&apos;objectes complexos com a llistes. Les col&#xB7;leccions i els documents es creen de manera impl&#xED;cita en <strong><code>Firestore DataBase</code></strong>. Nom&#xE9;s has d&apos;assignar dades a un document dins d&apos;una col&#xB7;lecci&#xF3;. Si la col&#xB7;lecci&#xF3; o el document no existeixen, <strong><code>Firestore DataBase</code></strong> els crea. Cada document est&#xE0; identificat per una clau &#xFA;nica, que pot generar-se autom&#xE0;ticament o que es pot afegir alhora que el document:</p>
<div align="center">
    <img width src="./imagenes/imagen26.png">
</div>
<p>S&#xF3;n molt similars a JSON, de fet, b&#xE0;sicament s&#xF3;n JSON. Existeixen algunes difer&#xE8;ncies, per exemple: els documents admeten <strong>tipus de dades addicionals</strong> i la seua grand&#xE0;ria es limita a 1 MB, per&#xF2; en general, pots tractar els documents com a registres JSON lleugers. Els documents viuen en col&#xB7;leccions, que simplement s&#xF3;n contenidors de documents. Per exemple, podries tindre una col&#xB7;lecci&#xF3; anomenada users amb els diferents usuaris de la teua app, en la qual hi haja un document que represente a cadascun:</p>
<div align="center">
    <img height="250" src="./imagenes/imagen27.png">
</div>
<p><em>Usant l&apos;exercici del qual hem creat el layout d&apos;inici, afegirem el codi necessari perqu&#xE8; ens permeta interactuar amb Firebase. L&apos;aplicaci&#xF3; guardar&#xE0; usuaris amb contrasenya en la base de dades amb <strong><code>Firebase Cloud Firestone</code></strong> i a m&#xE9;s permetr&#xE0; l&apos;autenticaci&#xF3; amb <strong><code>Firebase Auth</code></strong>.</em></p>
<p><em>En el projecte de Firebase que acabem de crear, afegirem una base de dades <strong>Firestore DataBase</strong>.</em></p>
<div align="center">
    <img height="200" src="./imagenes/imagen28.png">
</div>
<p><em>Haurem de seleccionar la ubicaci&#xF3; de la nostra Base de dades, podem seleccionar ZURIC(europe-west6)</em>. Un element important i que encara no hem esmentat, s&#xF3;n la Regles. La Firebase Cloud Firestore proporciona un llenguatge de regles flexibles basades en expressions i sintaxi similar a la de JavaScript <a href="https://firebase.google.com/docs/firestore/security/get-started?authuser=0">https://firebase.google.com/docs/firestore/security/get-started?authuser=0</a>, que permet definir f&#xE0;cilment la manera en qu&#xE8; les teues dades han d&apos;estructurar-se i indexar-se, i el moment en qu&#xE8; poden sotmetre&apos;s a lectura i escriptura. Aquestes regles les podrem configurar desde la pestanya RULES de la nostra BD,</p>
<div align="center">
    <img height="150" src="./imagenes/imagen29.png">
</div>
<p>Per defecte vindrien configurades per a manera producci&#xF3;, encara que per a iniciar-se podem seleccionar manera de prova (dura 30 dies).</p>
<div align="center">
    <img height="220" src="./imagenes/imagen30.png">
</div>
<div align="center">
    <img height="150" src="./imagenes/imagen31.png">
</div>
<p>Si ens hagu&#xE9;rem conf&#xF3;s o volgu&#xE9;rem canviar les regles, caldria canviar el seu valor i sobretot <strong>No oblidar Publicar</strong>.</p>
<p>Abans de comen&#xE7;ar amb el codi d&apos;acc&#xE9;s a la BD, haurem d&apos;afegir la depend&#xE8;ncia que ens permetr&#xE0; fer-ho:</p>
<pre data-role="codeBlock" data-info="json" class="language-json">   implementation &apos;com.google.firebase<span class="token operator">:</span>firebase-firestore&apos;
</pre><p>Per a referenciar a la nostra base de dades solament haurem de crear un objecte de tipus <strong><code>FirebaseFirestore</code></strong>. L&apos;arxiu que descarreguem en enlla&#xE7;ar l&apos;app amb el projecte, &#xE9;s el que s&apos;encarrega de tot el treball intern per a la connexi&#xF3;:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-val">val</span> firebaseFirestore <span class="token operator">=</span> FirebaseFirestore<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><p>Per a fer refer&#xE8;ncia a una col&#xB7;lecci&#xF3; existent o afegir-la en cas de no existir, utilitzarem el m&#xE8;tode <strong><code>collection</code></strong> amb el nom de la col&#xB7;lecci&#xF3; com a argument.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin">firebaseFirestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;Usuarios&quot;</span><span class="token punctuation">)</span>
</pre><p>Aquest m&#xE8;tode retorna una refer&#xE8;ncia a la col&#xB7;lecci&#xF3; seleccionada, i amb ell podrem afegir nous elements a ella (la col&#xB7;lecci&#xF3; es crear&#xE0; en afegir el primer document, en cas d&apos;haver sigut creada anteriorment far&#xE0; la refer&#xE8;ncia solament).</p>
<p>Per a afegir un objecte (document) a la col&#xB7;lecci&#xF3; ho podrem fer de dues maneres:</p>
<ol>
<li>
<p>Deixant que la plataforma genere una clau aleat&#xF3;ria, per a aix&#xF2; utilitzarem el m&#xE8;tode add.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin">    firebaseFirestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;Usuarios&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">Usuario</span><span class="token punctuation">(</span><span class="token string">&quot;Pepe&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;correo@gmail.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre> <div align="center">
     <img height="95" src="./imagenes/imagen33.png">
 </div>
</li>
<li>
<p>Afegint nosaltres la clau, aquesta ha de ser &#xFA;nica perqu&#xE8; l&apos;usuari s&apos;afija.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin">    firebaseFirestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;Usuarios&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">document</span><span class="token punctuation">(</span>usuario<span class="token punctuation">.</span>correo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>usuario<span class="token punctuation">)</span>
</pre> <div align="center">
     <img height="95" src="./imagenes/imagen34.png">
 </div>
</li>
</ol>
<p>Per a inserir el valor del nou fill hem utilitzat un objecte de la classe Pojo Usuari, que ens haurem creat amb anterioritat, Firestore converteix autom&#xE0;ticament els atributs amb els seus valors per a poder guardar-los correctament. <strong>Cura haurem de tindre els atributs p&#xFA;blics o usar getter i setter.</strong></p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-class">class</span> Usuario <span class="token operator">:</span> Serializable <span class="token punctuation">{</span>
    <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> usuario<span class="token operator">:</span> String
    <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> correo<span class="token operator">:</span> String

    <span class="token keyword keyword-constructor">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword keyword-constructor">constructor</span><span class="token punctuation">(</span>usuario<span class="token operator">:</span> String<span class="token punctuation">,</span> correo<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>usuario <span class="token operator">=</span> usuario
        <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>correo <span class="token operator">=</span> correo
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p><em>El codi complet per a crear l&apos;aplicaci&#xF3; que ens afegir&#xE0; un usuari cada vegada que premem el bot&#xF3; afegir, de manera que l&apos;aneu de l&apos;usuari siga el correu, ser&#xE0; el seg&#xFC;ent:</em></p>
<pre data-role="codeBlock" data-info="kotlin{highlight=[19,25]}" class="language-kotlin" data-line="19,25"><span class="token keyword keyword-class">class</span> MainActivity <span class="token operator">:</span> <span class="token function">AppCompatActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> firebaseFirestore<span class="token operator">:</span> FirebaseFirestore
    <span class="token keyword keyword-var">var</span> listenerRegistration<span class="token operator">:</span> ListenerRegistration<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword keyword-null">null</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span>
        firebaseFirestore <span class="token operator">=</span> FirebaseFirestore<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-val">val</span> usuarioET <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>TextInputLayout<span class="token operator">&gt;</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>usuario<span class="token punctuation">)</span>
        <span class="token keyword keyword-val">val</span> correoET <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>TextInputLayout<span class="token operator">&gt;</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>correo<span class="token punctuation">)</span>
        <span class="token keyword keyword-val">val</span> a&#xF1;adir <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>Button<span class="token operator">&gt;</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>anyadir<span class="token punctuation">)</span>

        <span class="token keyword keyword-val">val</span> salida <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>TextView<span class="token operator">&gt;</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>salida<span class="token punctuation">)</span>
        a&#xF1;adir<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">{</span>
            <span class="token keyword keyword-val">val</span> usuario <span class="token operator">=</span> <span class="token function">Usuario</span><span class="token punctuation">(</span>usuarioET<span class="token punctuation">.</span>editText<span class="token operator">?</span><span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                  correoET<span class="token punctuation">.</span>editText<span class="token operator">?</span><span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            firebaseFirestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;Usuarios&quot;</span><span class="token punctuation">)</span>
                             <span class="token punctuation">.</span><span class="token function">document</span><span class="token punctuation">(</span>usuario<span class="token punctuation">.</span>correo<span class="token punctuation">)</span>
                             <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>usuario<span class="token punctuation">)</span>
                             <span class="token punctuation">.</span><span class="token function">addOnSuccessListener</span> <span class="token punctuation">{</span>
                              Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>
                              <span class="token keyword keyword-this">this</span><span class="token punctuation">,</span>
                              <span class="token string">&quot;Usuario A&#xF1;adido&quot;</span><span class="token punctuation">,</span>
                              Toast<span class="token punctuation">.</span>LENGTH_SHORT
                              <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
                             <span class="token punctuation">.</span><span class="token function">addOnFailureListener</span> <span class="token punctuation">{</span> e <span class="token operator">-&gt;</span>
                             Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>
                             <span class="token keyword keyword-this">this</span><span class="token punctuation">,</span>
                             <span class="token string">&quot;Error&quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
                             Toast<span class="token punctuation">.</span>LENGTH_SHORT
                             <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<div class="line-highlight-wrapper">

















<div aria-hidden="true" class="line-highlight" data-range="19" data-start="19">
</div></div><div class="line-highlight-wrapper">























<div aria-hidden="true" class="line-highlight" data-range="25" data-start="25">
</div></div></pre><blockquote>
<p>&#x1F4CC; com es pot veuen en el codi del OnClick, afegim l&apos;usuari recollit dels EditText creant com a clau el correu, com s&apos;ha explicat anteriorment en el tema.A m&#xE9;s als m&#xE8;todes d&apos;afegir objecte (set o add) se li poden assignaran diferents escuchadores per a comprovar l&apos;estat del proc&#xE9;s. <strong>L&#xED;nia 19 i 25</strong>.</p>
</blockquote>
<p>Per a <a href="https://cloud.google.com/firestore/docs/query-data/queries?hl=es">buscar un document en Cloud Firestore</a>, existeixen diferents possibilitats basades en la clausula <strong>Where</strong>. <em>Per exemple, si quisieramos comprovar si l&apos;aneu de l&apos;usuari no est&#xE0; repetit i nom&#xE9;s en aqueix cas afegir-lo, podr&#xED;em modificar l&apos;anterior codi de la seg&#xFC;ent manera:</em></p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"> <span class="token keyword keyword-fun">fun</span> <span class="token function">compruebaSiExisteyAnayade</span><span class="token punctuation">(</span>usuario<span class="token operator">:</span> Usuario<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        firebaseFirestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;Usuarios&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">whereEqualTo</span><span class="token punctuation">(</span>FieldPath<span class="token punctuation">.</span><span class="token function">documentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> usuario<span class="token punctuation">.</span>correo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addOnCompleteListener</span><span class="token punctuation">(</span>OnCompleteListener<span class="token operator">&lt;</span>QuerySnapshot<span class="token operator">?</span><span class="token operator">&gt;</span>
             <span class="token punctuation">{</span> task <span class="token operator">-&gt;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>task<span class="token punctuation">.</span>isSuccessful<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>task<span class="token punctuation">.</span>result<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">anyadeUsuario</span><span class="token punctuation">(</span>usuario<span class="token punctuation">)</span> 
                    <span class="token keyword keyword-else">else</span> Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>
                        <span class="token keyword keyword-this">this</span><span class="token punctuation">,</span>
                        <span class="token string">&quot;El correo ya existe, introduce uno nuevo&quot;</span><span class="token punctuation">,</span>
                        Toast<span class="token punctuation">.</span>LENGTH_LONG
                    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                    Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">,</span> task<span class="token punctuation">.</span>exception<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                         Toast<span class="token punctuation">.</span>LENGTH_LONG<span class="token punctuation">)</span>
                         <span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">anyadeUsuario</span><span class="token punctuation">(</span>usuario<span class="token operator">:</span> Usuario<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        firebaseFirestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;Usuarios&quot;</span><span class="token punctuation">)</span>
                         <span class="token punctuation">.</span><span class="token function">document</span><span class="token punctuation">(</span>usuario<span class="token punctuation">.</span>correo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>usuario<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addOnSuccessListener</span> <span class="token punctuation">{</span>
                Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>
                    <span class="token keyword keyword-this">this</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;Usuario A&#xF1;adido&quot;</span><span class="token punctuation">,</span>
                    Toast<span class="token punctuation">.</span>LENGTH_SHORT
                <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">addOnFailureListener</span> <span class="token punctuation">{</span> e <span class="token operator">-&gt;</span>
                Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>
                    <span class="token keyword keyword-this">this</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;Error&quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
                    Toast<span class="token punctuation">.</span>LENGTH_SHORT
                <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><p><em>Si quisieramos donar funcionalitat al bot&#xF3; <strong>Eliminar</strong>, podem fer alguna cosa semblan&#xE7;a al seg&#xFC;ent. En aquest cas s&apos;est&#xE0; eliminant per nom d&apos;usuari, aix&#xED; que en el cas d&apos;existir m&#xE9;s d&apos;un document amb el mateix nom, s&apos;eliminaran tots.</em></p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-fun">fun</span> <span class="token function">Elimina</span><span class="token punctuation">(</span>usuario<span class="token operator">:</span> Usuario<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        firebaseFirestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;Usuarios&quot;</span><span class="token punctuation">)</span>
                         <span class="token punctuation">.</span><span class="token function">whereEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;usuario&quot;</span><span class="token punctuation">,</span> usuario<span class="token punctuation">.</span>usuario<span class="token punctuation">)</span>
                         <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addOnCompleteListener</span> <span class="token punctuation">{</span> task <span class="token operator">-&gt;</span> 
               <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>documento <span class="token keyword keyword-in">in</span> task<span class="token punctuation">.</span>result<span class="token operator">!!</span><span class="token punctuation">)</span> documento<span class="token punctuation">.</span>reference<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
                                   <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><p>Si el que volem &#xE9;s controlar els canvis que ocorren en la BD, siga a trav&#xE9;s d&apos;una aplicaci&#xF3; o directament des de la consola de Firebase, haurem de registrar un listener del tipus ListenerRegistration, que s&apos;inicialitzar&#xE0; sobre la consulta que desitgem amb <strong><code>addSnapshotListener</code></strong>. <em>En el seg&#xFC;ent exemple posem a escoltar tots els documents de la col&#xB7;lecci&#xF3; Usuaris, mostrant en el TextView (que est&#xE0; sota els botons) el resultat de qualsevol modificaci&#xF3; en qualsevol document de la col&#xB7;lecci&#xF3;.</em></p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-fun">fun</span> <span class="token function">listarUsuarios</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-val">val</span> query <span class="token operator">=</span> firebaseFirestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;Usuarios&quot;</span><span class="token punctuation">)</span>
        listenerRegistration <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">addSnapshotListener</span> <span class="token punctuation">{</span>value<span class="token punctuation">,</span> error<span class="token operator">-&gt;</span>
           <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>error <span class="token operator">==</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>dc <span class="token keyword keyword-in">in</span> value<span class="token operator">!!</span><span class="token punctuation">.</span>documentChanges<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-when">when</span> <span class="token punctuation">(</span>dc<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        DocumentChange<span class="token punctuation">.</span>Type<span class="token punctuation">.</span>ADDED <span class="token operator">-&gt;</span> salida<span class="token punctuation">.</span>text <span class="token operator">=</span>
                            <span class="token string">&quot;<span class="token interpolation"><span class="token delimiter variable">${</span>salida<span class="token punctuation">.</span>text<span class="token delimiter variable">}</span></span>\nSe ha a&#xF1;adido:&quot;</span><span class="token operator">+</span>
                             <span class="token string">&quot;<span class="token interpolation"><span class="token delimiter variable">${</span>dc<span class="token punctuation">.</span>document<span class="token punctuation">.</span>data<span class="token delimiter variable">}</span></span>\n&quot;</span><span class="token punctuation">.</span><span class="token function">trimIndent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        DocumentChange<span class="token punctuation">.</span>Type<span class="token punctuation">.</span>MODIFIED <span class="token operator">-&gt;</span> salida<span class="token punctuation">.</span>text <span class="token operator">=</span>
                            <span class="token string">&quot;<span class="token interpolation"><span class="token delimiter variable">${</span>salida<span class="token punctuation">.</span>text<span class="token delimiter variable">}</span></span>\n Se ha modificado:&quot;</span><span class="token operator">+</span>
                            <span class="token string">&quot;<span class="token interpolation"><span class="token delimiter variable">${</span>dc<span class="token punctuation">.</span>document<span class="token punctuation">.</span>data<span class="token delimiter variable">}</span></span>\n&quot;</span><span class="token punctuation">.</span><span class="token function">trimIndent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        DocumentChange<span class="token punctuation">.</span>Type<span class="token punctuation">.</span>REMOVED <span class="token operator">-&gt;</span> salida<span class="token punctuation">.</span>text <span class="token operator">=</span>
                            <span class="token string">&quot;<span class="token interpolation"><span class="token delimiter variable">${</span>salida<span class="token punctuation">.</span>text<span class="token delimiter variable">}</span></span>\nSe ha eliminado:&quot;</span><span class="token operator">+</span>
                            <span class="token string">&quot;<span class="token interpolation"><span class="token delimiter variable">${</span>dc<span class="token punctuation">.</span>document<span class="token punctuation">.</span>data<span class="token delimiter variable">}</span></span>\n&quot;</span><span class="token punctuation">.</span><span class="token function">trimIndent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-else">else</span>  Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">,</span> <span class="token string">&quot;No se puede listar&quot;</span><span class="token operator">+</span>error<span class="token punctuation">,</span> 
                                  Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><p>Es pot realitzar la consulta sobre qualsevol element de la col&#xB7;lecci&#xF3; despr&#xE9;s d&apos;haver sigut seleccionat, de la seg&#xFC;ent manera:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin">   query<span class="token punctuation">.</span><span class="token function">whereEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;correo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;manuel@gamil.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addSnapshotListener</span><span class="token punctuation">{</span><span class="token operator">..</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</pre><blockquote>
<p>&#x26A0;&#xFE0F; Un altre tema important a tindre en compte, &#xE9;s que la subscripci&#xF3; a una refer&#xE8;ncia d&apos;una base de dades de Firebase, &#xE9;s a dir, el fet d&apos;assignar un listener a una ubicaci&#xF3; de l&apos;arbre per a estar al corrent dels seus canvis <strong>no &#xE9;s una cosa gratu&#xEF;ta</strong> des del punt de vista de consum de recursos. Per tant, &#xE9;s recomanable eliminar aqueixa subscripci&#xF3; quan ja no la necessitem. Per a fer aix&#xF2; n&apos;hi ha prou amb cridar al m&#xE8;tode <strong><code>remove()</code></strong> del listener registrat, quan no desitgem continuar escoltant.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       listenerRegistration<span class="token operator">!!</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
</pre></blockquote>
<h4 class="mume-header" id="firebaseui-y-recyclerview">FirebaseUI y RecyclerView</h4>

<p><a href="https://github.com/firebase/FirebaseUI-Android">FirebaseUI</a> ens permet associar f&#xE0;cilment a un control <strong><code>ListView</code></strong> o <strong><code>RecyclerView</code></strong>, una refer&#xE8;ncia a una llista d&apos;elements d&apos;una base de dades Firebase. D&apos;aquesta manera, el control s&apos;actualitzar&#xE0; autom&#xE0;ticament cada vegada que es produ&#xEF;sca qualsevol canvi en la llista, sense haver de gestionar manualment per part nostra els esdeveniments de la llista, ni haver d&apos;emmagatzemar en una estructura paral&#xB7;lela la informaci&#xF3;, ni haver de construir gran part dels adaptadors necessaris&#x2026; en resum, estalviant moltes l&#xED;nies de codi i evitant molts possibles errors. Per a utilitzar <strong><code>FirebaseUI</code></strong> el primer que haurem de fer ser&#xE0; afegir la refer&#xE8;ncia a la llibreria en el fitxer build.gradle del nostre m&#xF2;dul principal. Cal tindre en compte que cada versi&#xF3; de <strong><code>FirebaseUI</code></strong> &#xE9;s compatible &#xFA;nicament amb una versi&#xF3; concreta de *Firebase, per la qual cosa hem d&apos;assegurar que les versions utilitzades de totes dues llibreries s&#xF3;n coherents. En la p&#xE0;gina de <strong><code>FirebaseUI</code></strong> teniu disponible la taula de compatibilitats entre versions. En el moment d&apos;actualitzaci&#xF3; d&apos;aquestes anotacions:</p>
<pre data-role="codeBlock" data-info="json" class="language-json">implementation &apos;com.firebaseui<span class="token operator">:</span>firebase-ui-firestore<span class="token operator">:</span><span class="token number">8.0</span>.<span class="token number">0</span>&apos;
</pre><p>Aquesta llibreria ens proveeix d&apos;una Adaptador derivat de <strong><code>RecyclerView.ViewAdapter</code></strong> que gestionar&#xE0; autom&#xE0;ticament la c&#xE0;rrega de les dades que li passem com a refer&#xE8;ncia en la vista assignada pel <strong><code>Holder</code></strong>, per a aix&#xF2; el primer que haurem de crear &#xE9;s el ViewHolder personalitzat que gestione les dades de les nostres aplicaci&#xF3; (reprenem l&apos;exemple i implementem el bot&#xF3; llistar, podem crear un fragment o activity per a mostrar).</p>
<pre data-role="codeBlock" data-info="kotlin{highlight=[[22-28],2]}" class="language-kotlin" data-line="22-28,2"><span class="token keyword keyword-class">class</span> <span class="token function">Adaptador</span><span class="token punctuation">(</span>options<span class="token operator">:</span> FirestoreRecyclerOptions<span class="token operator">&lt;</span>Usuario<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">:</span>
    FirestoreRecyclerAdapter<span class="token operator">&lt;</span>Usuario<span class="token punctuation">,</span> Adaptador<span class="token punctuation">.</span>Holder<span class="token operator">&gt;</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">,</span>
    View<span class="token punctuation">.</span><span class="token function">OnClickListener</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-var">var</span> listener<span class="token operator">:</span> View<span class="token punctuation">.</span>OnClickListener<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword keyword-null">null</span>
    <span class="token keyword keyword-override">override</span>  <span class="token keyword keyword-fun">fun</span> <span class="token function">onBindViewHolder</span><span class="token punctuation">(</span>holder<span class="token operator">:</span> Holder<span class="token punctuation">,</span> position<span class="token operator">:</span> Int<span class="token punctuation">,</span> 
                                   model<span class="token operator">:</span> Usuario<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        holder<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreateViewHolder</span><span class="token punctuation">(</span>parent<span class="token operator">:</span> ViewGroup<span class="token punctuation">,</span> viewType<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> 
                                    Holder <span class="token punctuation">{</span>
        <span class="token keyword keyword-val">val</span> view<span class="token operator">:</span> View <span class="token operator">=</span> LayoutInflater<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>context<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>linea_recycler<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
        view<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">Holder</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">onClickListener</span><span class="token punctuation">(</span>listener<span class="token operator">:</span> View<span class="token punctuation">.</span>OnClickListener<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>listener <span class="token operator">=</span> listener
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onClick</span><span class="token punctuation">(</span>v<span class="token operator">:</span> View<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        listener<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
   <span class="token keyword keyword-inner">inner</span> <span class="token keyword keyword-class">class</span> <span class="token function">Holder</span><span class="token punctuation">(</span>v<span class="token operator">:</span> View<span class="token punctuation">)</span> <span class="token operator">:</span> RecyclerView<span class="token punctuation">.</span><span class="token function">ViewHolder</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> usuario<span class="token operator">:</span> TextView
        <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> correo<span class="token operator">:</span> TextView
        <span class="token keyword keyword-fun">fun</span> <span class="token function">bind</span><span class="token punctuation">(</span>item<span class="token operator">:</span> Usuario<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            usuario<span class="token punctuation">.</span>text <span class="token operator">=</span> item<span class="token punctuation">.</span>usuario
            correo<span class="token punctuation">.</span>text <span class="token operator">=</span> item<span class="token punctuation">.</span>correo
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-init">init</span> <span class="token punctuation">{</span>
            usuario <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>usuario<span class="token punctuation">)</span>
            correo <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>correo<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<div class="line-highlight-wrapper">




















<div aria-hidden="true" class="line-highlight" data-range="22-28" data-start="22" data-end="28">






</div></div><div class="line-highlight-wrapper">
<div aria-hidden="true" class="line-highlight" data-range="2" data-start="2">
</div></div></pre><blockquote>
<p>&#x1F4CC; Definim un adaptador com ja hem fet anteriorment, amb el Holder per a controlar les vistes de les l&#xED;nies del recycler <strong>L&#xED;nia 22 a 28</strong>, on sobreescriur&#xED;em, obligat&#xF2;riament, els dos m&#xE8;todes i el constructor. He implementar&#xED;em els listener necessaris per al funcionament dels esdeveniments. La principal difer&#xE8;ncia &#xE9;s que l&apos;Adaptador hereta de la classe <strong><code>FirestoreRecyclerAdapter</code></strong>. FirebaseUI ens facilita el llistat dels elements extrets de la BD proporcionant aquesta libreria. A aquesta classe li hem d&apos;indicar que els elements usats s&#xF3;n: el ViewHolder personalitzat que acabem de crear i la classe java que utilitzem per a encapsular la informaci&#xF3; de cada element de la llista <strong><code>FirestoreRecyclerAdapter&lt;Usuari, Adaptador.Holder&gt;</code></strong>.<br>
En crear un objecte d&apos;aquesta classe, hem de passar-li un objecte de la mateixa llibreria, de tipus <strong><code>FirestoreRecyclerOptions</code></strong>.</p>
</blockquote>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"> <span class="token keyword keyword-val">val</span> firestoreRecyclerOptions <span class="token operator">=</span> FirestoreRecyclerOptions<span class="token punctuation">.</span>Builder<span class="token operator">&lt;</span>Usuario<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">setQuery</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> Usuario<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><p>Al qual hem de passar-li la seg&#xFC;ent informaci&#xF3;:</p>
<ul>
<li>L&apos;objecte classe del nostre Item (Usuari.class)</li>
<li>La refer&#xE8;ncia al node de la base de dades que cont&#xE9; la llista d&apos;elements que volem mostrar en el control.</li>
</ul>
<p>Ara nom&#xE9;s quedaria crear un objecte del tipus adaptador que ens hem creat, passant-li l&apos;element <strong><code>firebaseRecyclerOption</code></strong> i ja tindr&#xED;em quasi tot fet.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">cargarRecycler</span><span class="token punctuation">(</span>query<span class="token operator">:</span> Query<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-val">val</span> firestoreRecyclerOptions <span class="token operator">=</span> FirestoreRecyclerOptions<span class="token punctuation">.</span>
                                       Builder<span class="token operator">&lt;</span>Usuario<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">setQuery</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> Usuario<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        recyclerView <span class="token operator">=</span> vista<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>recycler<span class="token punctuation">)</span>
        adapter <span class="token operator">=</span> <span class="token function">Adaptador</span><span class="token punctuation">(</span>firestoreRecyclerOptions<span class="token punctuation">)</span>
        <span class="token comment">//Click para eliminar elementos</span>
        adapter<span class="token operator">!!</span><span class="token punctuation">.</span><span class="token function">onClickListener</span><span class="token punctuation">{</span>
                Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>
                    <span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;Elemento eliminado&quot;</span> <span class="token operator">+</span> recyclerView<span class="token operator">!!</span><span class="token punctuation">.</span>
                                           <span class="token function">getChildAdapterPosition</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    Toast<span class="token punctuation">.</span>LENGTH_SHORT
                <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                adapter<span class="token operator">!!</span><span class="token punctuation">.</span>snapshots<span class="token punctuation">.</span><span class="token function">getSnapshot</span><span class="token punctuation">(</span>recyclerView<span class="token operator">!!</span><span class="token punctuation">.</span>
                                            <span class="token function">getChildAdapterPosition</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                                            reference<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        recyclerView<span class="token operator">!!</span><span class="token punctuation">.</span>adapter <span class="token operator">=</span> adapter
        recyclerView<span class="token operator">!!</span><span class="token punctuation">.</span>layoutManager <span class="token operator">=</span> <span class="token function">LinearLayoutManager</span><span class="token punctuation">(</span><span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</pre><p>No haurem d&apos;oblidar iniciar el escuchador de l&apos;adaptador en comen&#xE7;ar l&apos;aplicaci&#xF3; i tancar-lo en acabar.</p>
<span style="align: center;">
<table align="center">
<tbody><tr style="border:hidden;">
<td>
<div align="center">
    <img height src="./imagenes/imagen36.png">
</div></td>
<td style="border:hidden;">
<div align="center">
    <img height src="./imagenes/imagen35.png">
</div>
</td>
</tr>
</tbody></table>
</span>
<h4 class="mume-header" id="filtrat-i-ordenaci%C3%B3">Filtrat i ordenaci&#xF3;</h4>

<p>El primer que hem de tindre en compte &#xE9;s que en les BD de Firebase no tindrem totes les facilitats d&apos;ordenaci&#xF3; i filtrat que solen trobar-se en bases de dades SQL tradicionals. Per a les consultes podem trobar la informaci&#xF3; que necessitem en el seg&#xFC;ent enllace <a href="https://firebase.google.com/docs/firestore/query-data/queries">https://firebase.google.com/docs/firestore/query-data/queries</a>.<br>
Per a realitzar consultes s&apos;utilitza qualsevol dels m&#xE8;todes <strong><code>where</code></strong> que indiquen que tipus de consulta necessitem:</p>
<div align="center">
    <img height="110" src=".\imagenes/imagen37.png">
</div>
<p>Usant la col&#xB7;lecci&#xF3; de l&apos;exemple que ens trobem en l&apos;enlla&#xE7; de la p&#xE0;gina de documentaci&#xF3; de firestore, <em>amb l&apos;expressi&#xF3; seg&#xFC;ent recuperar&#xED;em tots els documents que tenen una poblaci&#xF3; menor a 100000 habitants.</em></p>
<div align="center">
    <img height="20" src=".\imagenes/imagen38.png">
</div>
<p>Es poden enlla&#xE7;ar cerques amb <strong><code>where</code></strong>, de la seg&#xFC;ent manera:</p>
<div align="center">
    <img height="20" src=".\imagenes/imagen39.png">
</div>
<p><em>En aquest cas es buscaran tots els documents d&apos;estat igual a CA i del resultat d&apos;aqueixa cerca s&apos;extrauran nom&#xE9;s aquells que tinguen una poblaci&#xF3; menor a 100000.</em><br>
Tamb&#xE9; est&#xE0; l&apos;opci&#xF3; de buscar dins d&apos;una col&#xB7;lecci&#xF3; directament. Si alguns dels nostres documents tenen un membre que &#xE9;s una col&#xB7;lecci&#xF3;, podrem realitzar la consulta sobre aquest element usant alguna de les sobrec&#xE0;rregues de <strong><code>whereArrayContains</code></strong></p>
<div align="center">
    <img height="30" src=".\imagenes/imagen40.png">
</div>
<p><em>En les dades &#x2018;regions&#x2019; es refereix a un array amb els noms de les regions a les quals pertany cada ciutat, per la qual cosa amb la consulta anterior s&apos;extrauran totes les ciutats que en aqueix array tinguen l&apos;entrada &#x2018;west_coast&#x2019;, si la tenen repetida nom&#xE9;s apareixeran una vegada en els resultats.</em><br>
Si el que volem fer &#xE9;s ordenar les dades obtingudes, tenim tota la informaci&#xF3; en la url <a href="https://firebase.google.com/docs/firestore/query-data/orderlimitdata?hl=es">https://firebase.google.com/docs/firestore/query-data/orderlimitdata?hl=es</a> S&apos;utilitzar&#xE0; qualsevol de les sobrec&#xE0;rregues del m&#xE8;tode <strong><code>orderBy</code></strong></p>
<div align="center">
    <img height="100" src=".\imagenes/imagen41.png">
</div>
<p>Per exemple, es poden combinar m&#xE9;s d&apos;un <strong><code>orderBy</code></strong> per a realitzar la consulta que necessitem. En aquest cas s&apos;ordena pel nom de l&apos;estat i a partir d&apos;ac&#xED; per n&#xFA;mero de poblaci&#xF3; i en ordre descendent.</p>
<div align="center">
    <img height="30" src=".\imagenes/imagen42.png">
</div>
<p>Una cl&#xE0;usula <strong><code>orderBy</code></strong> tamb&#xE9; filtra a la recerca de l&apos;exist&#xE8;ncia del camp donat. El conjunt de resultats no inclour&#xE0; documents que no continguen el camp corresponent. Com &#xE9;s d&apos;esperar, tamb&#xE9; es poden ordenar les dades despr&#xE9;s de realitzar una consulta <strong><code>where</code></strong>, per&#xF2; amb la condici&#xF3; que ha de ser sobre el mateix camp pel qual s&apos;ha fet la cerca.</p>
<div align="center">
    <img height="33" src=".\imagenes/imagen43.png">
</div>
<p>Si amb orderBy es pot especificar l&apos;ordre de classificaci&#xF3; de les dades, amb limit pots limitar la quantitat de documents recuperats.</p>
<p><em>Retorna els noms de les tres primeres ciutats</em></p>
<div align="center">
    <img height="25" src=".\imagenes/imagen44.png">
</div>
<p><em>Retorna els noms de les tres &#xFA;ltimes ciutats</em></p>
<div align="center">
    <img height="25" src=".\imagenes/imagen45.png">
</div>
<p>Altres cursors de consultes que estan disponibles s&#xF3;n:</p>
<span style="align: center;">
<table align="center">
<tbody><tr>
<td style="border:hidden;">
<ul>
<li><strong><code>startAt</code></strong> -&gt; La consulta nom&#xE9;s retornar&#xE0; els elements el valor dels quals siga igual o superior a la dada passada com a par&#xE0;metre.<br>
<em>Ciutats amb nombre d&apos;habitants 100000 i ordenats per n&#xFA;mero de poblaci&#xF3;</em></li>
</ul>
</td>
<td style="border:hidden;">
<div align="center">
    <img height src=".\imagenes/imagen46.png">
</div>
</td>
</tr>
<tr>
<td style="border:hidden;" colspan="2">
<ul>
<li><strong><code>startAfter</code></strong> -&gt; Id&#xE8;ntic a l&apos;anterior per&#xF2; per a valors superiors, no inclou els documents amb valor igual.</li>
</ul>
</td>
</tr>
<tr>
<td style="border:hidden;">
<ul>
<li><strong><code>endAt</code></strong> -&gt; La consulta nom&#xE9;s retornar&#xE0; els elements el valor dels quals siga igual o inferior a la dada passada com a par&#xE0;metre.<br>
<em>Ciutats amb nombre d&apos;habitants &lt;= 100000 i ordenats per n&#xFA;mero de poblaci&#xF3;</em></li>
</ul>

</td>
<td style="border:hidden;">
<div align="center">
    <img width="400" src=".\imagenes/imagen47.png">
</div>
</td>
</tr>
<tr>
<td style="border:hidden;" colspan="2">
<ul>
<li><strong><code>endBefore</code></strong> -&gt; Id&#xE8;ntic a l&apos;anterior per&#xF2; per a valors inferiors, no inclou els documents amb valor igual.</li></ul></td>


</tr>
</tbody></table>
</span>
<p>Tamb&#xE9; podrem utilitzar diversos criteris de filtrat en la mateixa consulta, &#xE9;s a dir podrem combinar diversos dels m&#xE8;todes anteriors per a obtindre nom&#xE9;s el rang d&apos;elements necessari.</p>
<div align="center">
    <img width="300" src=".\imagenes/imagen48.png">
</div>
<h3 class="mume-header" id="firebase-auth-autenticaci%C3%B3">Firebase Auth. Autenticaci&#xF3;</h3>

<p><a href="https://firebase.google.com/docs/auth">Firebase Authentication</a> proporciona serveis de backend, SDK f&#xE0;cils d&apos;usar i biblioteques d&apos;IU ja elaborades per a autenticar als usuaris en l&apos;app. <em>Ens iniciarem en el seu &#xFA;s modificant el projecte anterior, per a aix&#xF2; crearem un altre Fragment que ser&#xE0; el primer que s&apos;inicie en l&apos;aplicaci&#xF3;. Ens permetr&#xE0; crear un compte o autenticar-nos amb una ja existent, si l&apos;autenticaci&#xF3; &#xE9;s correcta es carregar&#xE0; el fragment amb el qual s&apos;iniciava el nostre projecte anteriorment.</em><br>
Si volem autenticar-nos com a usuaris, tenim diverses opcions:<strong><code>email/password, google, tel&#xE8;fon, Facebook, twitter, github, anonymous</code></strong>. <em>Nosaltres veurem l&apos;exemple d&apos;email/password i el de anonymous, en la resta d&apos;autenticacions podeu seguir la documentaci&#xF3; de FireBase.</em></p>
<p>El primer pas seria afegir la depend&#xE8;ncia d&apos;autenticaci&#xF3;, que com tenim incl&#xF2;s la de *firebase-*bom, no necessitar&#xE0; n&#xFA;mero de versi&#xF3;:</p>
<pre data-role="codeBlock" data-info="json" class="language-json"> implementation &apos;com.google.firebase<span class="token operator">:</span>firebase-auth&apos;
</pre><p><em>Tendremos que codificar un layout que permita introducir el usuario y la contrase&#xF1;a para poder logearnos.</em></p>
<div align="center">
    <img width="200" src=".\imagenes/imagen49.png">
</div>
<p>El seg&#xFC;ent ser&#xE0; activar els prove&#xEF;dors amb els quals volem iniciar sessi&#xF3;. Ens anem a l&apos;opci&#xF3; *Authentication i dins d&apos;aquest a la pestanya M&#xE8;todes d&apos;inici de sessi&#xF3;. Haurem de seleccionar tots dos casos i habilitar l&apos;estat.</p>
<div align="center">
    <img width="500" src=".\imagenes/imagen50.png">
</div>
<p>Una vegada afegit els prove&#xEF;dors, tindrem dues maneres de crear els usuaris: <strong>a trav&#xE9;s de la consola i des de l&apos;aplicaci&#xF3;</strong>. Des de la consola ens haurem d&apos;anar a la pestanya usuaris, ac&#xED; podrem crear els usuaris que necessitem. Els usuaris an&#xF2;nims apareixeran solament amb l&apos;aneu &#xFA;nic que assigna Firebase a cada usuari creat.<br>
L&apos;altre cas ser&#xE0; en codificar l&apos;aplicaci&#xF3;. Per a tots els casos d&apos;autenticaci&#xF3; necessitem una inst&#xE0;ncia de <strong><code>FirebaseAuth.getInstance()</code></strong>, a partir d&apos;aquesta podrem afegir els escuchadores necessaris:</p>
<p>El seg&#xFC;ent pas ser&#xE0; decidir si volem permetre crear usuaris nous, o solament logearnos amb algun existent. En la nostra aplicaci&#xF3; farem les dues coses, i fins i tot ens logearemos com a an&#xF2;nims. El codi apareix a continuaci&#xF3;, i un enlla&#xE7; amb tota la informaci&#xF3; <a href="https://firebase.google.com/docs/auth/android/password-auth">https://firebase.google.com/docs/auth/android/password-auth</a></p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"> <span class="token comment">////// Crear usuario nueveo y iniciar sesi&#xF3;n</span>
        btCrear<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">{</span>
               FirebaseAuth<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createUserWithEmailAndPassword</span><span class="token punctuation">(</span>
                    user<span class="token punctuation">.</span>editText<span class="token operator">!!</span><span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pasword<span class="token punctuation">.</span>editText<span class="token operator">!!</span>
                        <span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">addOnCompleteListener</span><span class="token punctuation">(</span><span class="token function">requireActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        OnCompleteListener<span class="token operator">&lt;</span>AuthResult<span class="token operator">?</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> task <span class="token operator">-&gt;</span>
                            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>task<span class="token punctuation">.</span>isSuccessful<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;Usuario creado&quot;</span><span class="token punctuation">,</span>
                                            Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                <span class="token function">iniciarFragmen</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span>result<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span>
                                             <span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;@&quot;</span><span class="token punctuation">)</span><span class="token operator">!!</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>
                                <span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                <span class="token string">&quot;Problemas al crear usuario&quot;</span> <span class="token operator">+</span>task<span class="token punctuation">.</span>exception<span class="token punctuation">,</span>
                                Toast<span class="token punctuation">.</span>LENGTH_SHORT
                            <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> view

</pre><pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token comment">/////Iniciar sesi&#xF3;n con usuario y contrase&#xF1;a</span>
        btIniciar<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">{</span>
             FirebaseAuth<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">signInWithEmailAndPassword</span><span class="token punctuation">(</span>
                user<span class="token punctuation">.</span>editText<span class="token operator">!!</span><span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pasword<span class="token punctuation">.</span>editText<span class="token operator">!!</span>
                    <span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addOnCompleteListener</span><span class="token punctuation">(</span><span class="token function">requireActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    OnCompleteListener<span class="token operator">&lt;</span>AuthResult<span class="token operator">?</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> task <span class="token operator">-&gt;</span>
                        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>task<span class="token punctuation">.</span>isSuccessful<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>
                                <span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                <span class="token string">&quot;Authentication failed:&quot;</span> <span class="token operator">+</span> task<span class="token punctuation">.</span>exception<span class="token punctuation">,</span>
                                Toast<span class="token punctuation">.</span>LENGTH_SHORT
                            <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token function">iniciarFragmen</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span>result<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span>
                                             <span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;@&quot;</span><span class="token punctuation">)</span><span class="token operator">!!</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
</pre><pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"> <span class="token comment">//////// Iniciar sesi&#xF3;n con an&#xF3;nimo</span>
        btAnonimus<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">{</span>
                 FirebaseAuth<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">signInAnonymously</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addOnCompleteListener</span>
                <span class="token punctuation">(</span>
                    <span class="token function">requireActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    OnCompleteListener<span class="token operator">&lt;</span>AuthResult<span class="token operator">?</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> task <span class="token operator">-&gt;</span>
                        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>task<span class="token punctuation">.</span>isSuccessful<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>
                                <span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                <span class="token string">&quot;Authentication failed:&quot;</span> <span class="token operator">+</span> task<span class="token punctuation">.</span>exception<span class="token punctuation">,</span>
                                Toast<span class="token punctuation">.</span>LENGTH_SHORT
                            <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token function">iniciarFragmen</span><span class="token punctuation">(</span><span class="token string">&quot;anonimous&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
</pre><p>Com podem veure en el codi, el que es fa &#xE9;s usar qualsevol dels m&#xE8;todes que h&#xE0;gem triat (*login, an&#xF2;nim o afegir usuari) sobre la inst&#xE0;ncia de <strong><code>FirebaseAuth</code></strong>. Amb aquests passos tindrem l&apos;autenticaci&#xF3; controlada, i podrem seguir amb la nostra aplicaci&#xF3;.</p>
<p><span style="color: DarkRed; font-weight: bold;">&#x2712;&#xFE0F;Resol l&apos;exercici dels exemples fins a aconseguir un correcte funcionament</span></p>

      </div>
      
      
    
    
    
    
    
    
    
    
  
    </body></html>