<!DOCTYPE html><html><head>
      <title>PMDM 2&#xBA; DAM  Resumen B11. Persistencia de Datos I</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/katex.min.css">
      
      
      
      
      
      
      
      
      
      <style>
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}

/* highlight */
pre[data-line] {
  position: relative;
  padding: 1em 0 1em 3em;
}
pre[data-line] .line-highlight-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  background-color: transparent;
  display: block;
  width: 100%;
}

pre[data-line] .line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: hsla(24, 20%, 50%,.08);
  background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}

pre[data-line] .line-highlight:before, 
pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-start);
  position: absolute;
  top: .4em;
  left: .6em;
  min-width: 1em;
  padding: 0 .5em;
  background-color: hsla(24, 20%, 50%,.4);
  color: hsl(24, 20%, 95%);
  font: bold 65%/1.5 sans-serif;
  text-align: center;
  vertical-align: .3em;
  border-radius: 999px;
  text-shadow: none;
  box-shadow: 0 1px white;
}

pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-end);
  top: auto;
  bottom: .4em;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview  ">
      <style>/* 
Añade 

@import "../EstilosPersonalizadosMarkdownEnhanced.less"

justo después del front matter 
*/
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
@font-face {
  font-family: 'Catamaran';
  font-style: normal;
  font-weight: 400;
  src: url(https://fonts.gstatic.com/s/catamaran/v14/o-0bIpQoyXQa2RxT7-5B6Ryxs2E_6n1iPHjd5a7dvg.ttf) format('truetype');
}
.contenedor {
  display: flex;
  justify-content: center;
  margin: 30px auto 30px auto;
}
.fondo {
  background: url(https://programacioniesbalmis.github.io/Imagenes/BannersMoodle/banner.png);
  background-size: cover;
  width: 75%;
  height: 160px;
  border-radius: 10px;
  position: relative;
}
.cita {
  font-family: Arial;
  font-style: italic;
  font-weight: 600;
  text-align: justify;
  line-height: 1.5rem;
  opacity: 0.6;
  color: white;
  padding: 5rem;
  position: relative;
  top: 50%;
  left: 50%;
  font-size: 1.3rem;
  transform: translate(-50%, -50%);
}
.abre_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-left: 30px;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, -15%);
}
.cierra_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-right: 30px;
  right: 0%;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, 55%);
}
.autor {
  font-family: Arial;
  color: white;
  margin: 0px;
  padding-left: 30px;
  position: absolute;
  top: 83%;
  font-size: 1rem;
}
</style>
<h1 class="mume-header undefined" id="apuntes">Apuntes</h1>

<p><a href="./B11_Persistencia_de_Datos_I.pdf">Descargar estos apuntes</a></p>
<h1 class="mume-header undefined" id="resumen-b11-persistencia-de-datos-i">Resumen B11. Persistencia de Datos I</h1>

<h2 class="mume-header undefined" id="%C3%ADndice">&#xCD;ndice</h2>

<ol>
<li><a href="#acceso-a-bases-de-datos-locales-sqlite">Acceso a bases de datos locales. SQLite</a>
<ol>
<li><a href="#introducci%C3%B3n">Introducci&#xF3;n</a></li>
<li><a href="#creaci%C3%B3n-y-apertura-de-la-bd">Creaci&#xF3;n y apertura de la BD</a></li>
<li><a href="#acceso-y-modificaci%C3%B3n-de-los-datos-en-la-bd">Acceso y modificaci&#xF3;n de los datos en la BD</a>
<ol>
<li><a href="#acceso-a-la-bd-mediante-sentencias-sql">Acceso a la BD mediante sentencias sql</a></li>
<li><a href="#acceso-a-la-bd-mediante-sqlitedatabase">Acceso a la BD mediante SQLiteDataBase</a></li>
<li><a href="#recuperaci%C3%B3n-de-datos-con-rawquery">Recuperaci&#xF3;n de datos con rawQuery</a></li>
<li><a href="#recuperaci%C3%B3n-de-datos-con-query">Recuperaci&#xF3;n de datos con query</a></li>
</ol>
</li>
<li><a href="#uso-de-simplecursoradapter">Uso de SimpleCursorAdapter</a>
<ol>
<li><a href="#cursores-con-recyclerview">Cursores con RecyclerView</a></li>
</ol>
</li>
</ol>
</li>
<li><a href="#acceso-a-bases-de-datos-remotas">Acceso a bases de datos remotas</a>
<ol>
<li><a href="#acceso-a-bases-de-datos-con-apirest-y-retrofit">Acceso a bases de datos con Apirest y Retrofit</a>
<ol>
<li><a href="#consumo-de-un-servicio-rest-desde-android">Consumo de un Servicio Rest desde Android</a></li>
</ol>
</li>
</ol>
</li>
<li><a href="#acceso-a-base-de-datos-con-firebase">Acceso a Base de Datos con FIREBASE</a>
<ol>
<li><a href="#creando-un-app-de-firebase">Creando un app de Firebase</a></li>
<li><a href="#firestore-database">Firestore DataBase</a>
<ol>
<li><a href="#firebaseui-y-recyclerview">FirebaseUI y RecyclerView</a></li>
<li><a href="#filtrado-y-ordenaci%C3%B3n">Filtrado y ordenaci&#xF3;n</a></li>
</ol>
</li>
<li><a href="#firebase-auth-autenticaci%C3%B3n">Firebase Auth. Autenticaci&#xF3;n</a></li>
</ol>
</li>
</ol>
<div style="page-break-after:always;"></div>
<h2 class="mume-header" id="acceso-a-bases-de-datos-locales-sqlite">Acceso a bases de datos locales. SQLite</h2>

<h3 class="mume-header" id="introducci%C3%B3n">Introducci&#xF3;n</h3>

<p><a href="https://developer.android.com/training/data-storage/sqlite?hl=es">SQLite</a><br>
Para el acceso a las bases de datos tendremos tres clases que tenemos que conocer. La clase <strong><code>SQLiteOpenHelder</code></strong>, que encapsula todas las funciones de creaci&#xF3;n de la base de datos y versiones de la misma. La clase <strong><code>SQLiteDatabase</code></strong>, que incorpora la gesti&#xF3;n de tablas y datos. Y por &#xFA;ltimo la clase <strong><code>Cursor</code></strong>, que usaremos para movernos por el recordset que nos devuelve una consulta <em>SELECT</em>.</p>
<h3 class="mume-header" id="creaci%C3%B3n-y-apertura-de-la-bd">Creaci&#xF3;n y apertura de la BD</h3>

<p>El m&#xE9;todo recomendado para la creaci&#xF3;n de la base de datos es extender la clase <strong><code>SQLiteOpenHelder</code></strong> y sobrescribir los m&#xE9;todos <strong><code>onCreate</code></strong> y <strong><code>onUpgrade</code></strong>. Si la base de datos ya existe y su versi&#xF3;n actual coincide con la solicitada, se realizar&#xE1; la conexi&#xF3;n a ella.</p>
<p>Para ejecutar la sentencia SQL utilizaremos el m&#xE9;todo <strong><code>execSQL</code></strong> proporcionado por la API para SQLite de Android.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-internal">internal</span> <span class="token keyword keyword-inner">inner</span> <span class="token keyword keyword-class">class</span> <span class="token function">BDClientes</span><span class="token punctuation">(</span>
        context<span class="token operator">:</span> Context<span class="token operator">?</span><span class="token punctuation">,</span>
        name<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>
        factory<span class="token operator">:</span> CursorFactory<span class="token operator">?</span><span class="token punctuation">,</span>
        version<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">SQLiteOpenHelper</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> name<span class="token punctuation">,</span> factory<span class="token punctuation">,</span> version<span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
     <span class="token keyword keyword-var">var</span> sentencia <span class="token operator">=</span>
            <span class="token string">&quot;create table if not exists clientes&quot;</span> <span class="token operator">+</span> 
            <span class="token string">&quot;(dni VARCHAR PRIMARY KEY NOT NULL, nombre TEXT, apellidos TEXT);&quot;</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>sqLiteDatabase<span class="token operator">:</span> SQLiteDatabase<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            sqLiteDatabase<span class="token punctuation">.</span><span class="token function">execSQL</span><span class="token punctuation">(</span>sentencia<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onUpgrade</span><span class="token punctuation">(</span>sqLiteDatabase<span class="token operator">:</span> SQLiteDatabase<span class="token punctuation">,</span> i<span class="token operator">:</span> Int<span class="token punctuation">,</span> i2<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><blockquote>
<p>&#x1F4CC; Si la base de datos existe pero su versi&#xF3;n actual es anterior a la solicitada, se llamar&#xE1; autom&#xE1;ticamente al m&#xE9;todo onUgrade(). Si la base de datos no existe se llama autom&#xE1;ticamente a onCreate().</p>
</blockquote>
<h3 class="mume-header" id="acceso-y-modificaci%C3%B3n-de-los-datos-en-la-bd">Acceso y modificaci&#xF3;n de los datos en la BD</h3>

<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-class">class</span> <span class="token function">BDAdapter</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token operator">?</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
  <span class="token keyword keyword-private">private</span>  <span class="token keyword keyword-var">var</span> clientes<span class="token operator">:</span> BDClientes
    
  <span class="token keyword keyword-init">init</span> <span class="token punctuation">{</span>
        clientes <span class="token operator">=</span> <span class="token function">BDClientes</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">&quot;BDClientes&quot;</span><span class="token punctuation">,</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
     
  <span class="token operator">..</span><span class="token punctuation">.</span> 

  <span class="token keyword keyword-internal">internal</span> <span class="token keyword keyword-inner">inner</span> <span class="token keyword keyword-class">class</span> <span class="token function">BDClientes</span><span class="token punctuation">(</span>
        context<span class="token operator">:</span> Context<span class="token operator">?</span><span class="token punctuation">,</span>
        name<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>
        factory<span class="token operator">:</span> CursorFactory<span class="token operator">?</span><span class="token punctuation">,</span>
        version<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">SQLiteOpenHelper</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> name<span class="token punctuation">,</span> factory<span class="token punctuation">,</span> version<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
        <span class="token keyword keyword-var">var</span> sentencia <span class="token operator">=</span>
            <span class="token string">&quot;create table if not exists clientes&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;(dni VARCHAR PRIMARY KEY NOT NULL, nombre TEXT, apellidos TEXT);&quot;</span>
        <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>sqLiteDatabase<span class="token operator">:</span> SQLiteDatabase<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            sqLiteDatabase<span class="token punctuation">.</span><span class="token function">execSQL</span><span class="token punctuation">(</span>sentencia<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onUpgrade</span><span class="token punctuation">(</span>sqLiteDatabase<span class="token operator">:</span> SQLiteDatabase<span class="token punctuation">,</span> i<span class="token operator">:</span> Int<span class="token punctuation">,</span> i2<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>Para poder usar los m&#xE9;todos creados en la clase, tan solo instanciaremos un objeto de esta pas&#xE1;ndole el contexto (de tipo activity). Con esta instancia podremos llamar a cualquiera de los m&#xE9;todos que crearemos en la clase de utilidad.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-var">var</span> bdAdapter <span class="token operator">=</span> <span class="token function">BDAdapter</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span>
bdAdapter<span class="token punctuation">.</span><span class="token function">insertarDatos</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><h4 class="mume-header" id="acceso-a-la-bd-mediante-sentencias-sql">Acceso a la BD mediante sentencias sql</h4>

<p>Si hemos abierto correctamente la base de datos entonces podremos empezar con las inserciones, actualizaciones, borrado, etc. No deberemos olvidar cerrar el acceso a la BD, siempre y cuando no se est&#xE9; usando un cursor.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-fun">fun</span> <span class="token function">insertarDatos</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-var">var</span> dbClientes <span class="token operator">=</span>clientes<span class="token punctuation">.</span>writableDatabase
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>dbClientes <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token keyword keyword-in">in</span> <span class="token number">0</span><span class="token operator">..</span><span class="token number">9</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-val">val</span> sentencia <span class="token operator">=</span> 
                <span class="token string">&quot;INSERT INTO Clientes (dni, nombre, apellidos) VALUES&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot; (&apos;&quot;</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">&quot;&apos;,&apos;nombre&quot;</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">&quot;&apos;,&apos;apellido&quot;</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">&quot;&apos;);&quot;</span>
                dbClientes<span class="token punctuation">.</span><span class="token function">execSQL</span><span class="token punctuation">(</span>sentencia<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            dbClientes<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><blockquote>
<p>&#x270B; Se ha creado nuestra base de datos en un fichero con el mismo nombre de la base de datos situado en una ruta que sigue el siguiente patr&#xF3;n: <strong>/data/data/paquete.java.de.la.aplicacion/databases/nombre_base_datos</strong></p>
</blockquote>
<h4 class="mume-header" id="acceso-a-la-bd-mediante-sqlitedatabase">Acceso a la BD mediante SQLiteDataBase</h4>

<p>La otra forma de acceder a la BD es utilizar los m&#xE9;todos espec&#xED;ficos <strong>insert(), update() y delete()</strong> de la clase <strong>SQLiteDatabase</strong>.</p>
<ul>
<li><strong><code>insert()</code></strong>: recibe tres par&#xE1;metros <em><code>insert(table, nullColumnHack, values)</code></em>, el primero es el nombre de la tabla, el segundo se utiliza en caso de que necesitemos insertar valores nulos en la tabla &quot;nullColumnHack&quot;  y el tercero son los valores del registro a insertar. Los valores a insertar los pasaremos a su vez como elementos de una colecci&#xF3;n de tipo <strong><code>ContentValues</code></strong>.  Estos elementos se almacenan como parejas <strong>clave-valor</strong>, donde la clave ser&#xE1; el nombre de cada campo y el valor ser&#xE1; el dato que se va a insertar.</li>
<li><strong><code>update()</code></strong>: Pr&#xE1;cticamente es igual que el anterior m&#xE9;todo pero con la excepci&#xF3;n de que aqu&#xED; estamos usando el m&#xE9;todo <em><code>update(table, values, whereClause, whereArgs)</code></em> para actualizar/modificar registros de nuestra tabla. Este m&#xE9;todo nos pide el nombre de la tabla &quot;table&quot;, los valores a modificar/actualizar &quot;values&quot; (ContentValues), una condici&#xF3;n WHERE &quot;whereClause&quot; que nos sirve para indicarle que valor queremos que actualice y como &#xFA;ltimo par&#xE1;metro &quot;whereArgs&quot; podemos pasarle los valores nuevos a insertar, en este caso no lo vamos a necesitar por lo tanto lo ponemos a null.</li>
<li><strong><code>delete()</code></strong>: el m&#xE9;todo <em><code>delete(table, whereClause, whereArgs)</code></em> nos pide el nombre de la tabla &quot;table&quot;, el registro a borrar &quot;whereClause&quot; que tomaremos como referencia su id y como &#xFA;ltimo par&#xE1;metro &quot;whereArgs&quot; los valores a borrar.</li>
</ul>
<div style="page-break-after:always;"></div>
<span style="align: center;">
<table align="center">
<tbody><tr style="border:hidden;">
<td align="center">
<div align="left">
    Insertando con ContentValues
</div>
</td>
<td style="border:hidden;">
<div>
<img height="160" src="./imagenes/imagen8.png">
</div>
</td>
</tr>
<tr style="border:hidden;">
<td style="border:hidden;">
<div>
<img height="130" src="./imagenes/imagen9.png">
</div>
</td>
<td style="border:hidden;">
<div align="left">
    Modificando con ContentValues
</div>
</td>
</tr>
<tr style="border:hidden;">
<td align="center">
<div align="left">
    Borrando con ContentValues
</div>
</td>
<td style="border:hidden;">
<div>
<img height="70" src="./imagenes/imagen10.png">
</div>
</td>
</tr>
</tbody></table>
</span>
<p>Los valores que hemos dejado anteriormente como null son realmente argumentos que podemos utilizar en la sentencia SQL. Ve&#xE1;moslo con un ejemplo:</p>
<div align="center">
    <img height="130" src="./imagenes/imagen11.png">
</div>
<p>Donde las <code>?</code> indican los emplazamientos de los argumentos.</p>
<h4 class="mume-header" id="recuperaci%C3%B3n-de-datos-con-rawquery">Recuperaci&#xF3;n de datos con rawQuery</h4>

<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-fun">fun</span> <span class="token function">seleccionarDatosSelect</span><span class="token punctuation">(</span>sentencia<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>
        <span class="token keyword keyword-val">val</span> listaCliente<span class="token operator">:</span> ArrayList<span class="token operator">&lt;</span>Clientes<span class="token operator">&gt;</span><span class="token operator">?</span>
        <span class="token keyword keyword-val">val</span> dbClientes <span class="token operator">=</span> clientes<span class="token punctuation">.</span>readableDatabase
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>dbClientes <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-val">val</span> cursor<span class="token operator">:</span> Cursor <span class="token operator">=</span> dbClientes<span class="token punctuation">.</span><span class="token function">rawQuery</span><span class="token punctuation">(</span>sentencia<span class="token punctuation">,</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
            listaCliente <span class="token operator">=</span> <span class="token function">getClientes</span><span class="token punctuation">(</span>cursor<span class="token punctuation">)</span>
            dbClientes<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>listaCliente <span class="token operator">==</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token boolean">false</span> <span class="token keyword keyword-else">else</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</pre><p>Se dispone de los m&#xE9;todos <strong><code>moveToFirst()</code></strong>, <strong><code>moveToNext()</code></strong>, <strong><code>moveToLast()</code></strong>, <strong><code>moveToPrevius()</code></strong>, <strong><code>isFirst()</code></strong> y <strong><code>isLast()</code></strong>.<br>
Existen m&#xE9;todos espec&#xED;ficos para la recuperaci&#xF3;n de datos getXXX(indice), donde XXX indica el tipo de dato (String, Blob, Float,&#x2026;) y el par&#xE1;metro &#xED;ndice permite recuperar la columna indicada en el mismo, teniendo en cuenta que comienza en 0.</p>
<p>El m&#xE9;todo getClientes (implementado por nosotros) es el que nos permite leer los datos existentes en la BD y llevarlos al arrayList:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-fun">fun</span> <span class="token function">getClientes</span><span class="token punctuation">(</span>cursor<span class="token operator">:</span> Cursor<span class="token punctuation">)</span><span class="token operator">:</span> ArrayList<span class="token operator">&lt;</span>Clientes<span class="token operator">&gt;</span><span class="token operator">?</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> clientes<span class="token operator">:</span> ArrayList<span class="token operator">&lt;</span>Clientes<span class="token operator">&gt;</span>
    <span class="token keyword keyword-var">var</span> cliente<span class="token operator">:</span> Clientes
    cursor<span class="token punctuation">.</span><span class="token function">moveToFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cursor<span class="token punctuation">.</span><span class="token function">isAfterLast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        clientes <span class="token operator">=</span> <span class="token function">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>cursor<span class="token punctuation">.</span><span class="token function">isAfterLast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cliente <span class="token operator">=</span>
              <span class="token function">Clientes</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cursor<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
              cursor<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            clientes<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>cliente<span class="token punctuation">)</span>
            cursor<span class="token punctuation">.</span><span class="token function">moveToNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> clientes
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-null">null</span>
<span class="token punctuation">}</span>
</pre><h4 class="mume-header" id="recuperaci%C3%B3n-de-datos-con-query">Recuperaci&#xF3;n de datos con query</h4>

<p>La segunda forma de recuperar informaci&#xF3;n de la BD es utilizar el m&#xE9;todo <strong><code>query()</code></strong>. Recibe como par&#xE1;metros el nombre de la tabla, un string con los campos a recuperar, un string donde especificar las condiciones del WHERE, otro para los argumentos si los hubiera, otro para el GROUP BY, otro para HAVING y finalmente otro para ORDER BY.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-fun">fun</span> <span class="token function">seleccionarDatosCodigo</span><span class="token punctuation">(</span>
        columnas<span class="token operator">:</span> Array<span class="token operator">&lt;</span>String<span class="token operator">?</span><span class="token operator">&gt;</span><span class="token operator">?</span><span class="token punctuation">,</span>
        <span class="token keyword keyword-where">where</span><span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>
        valores<span class="token operator">:</span> Array<span class="token operator">&lt;</span>String<span class="token operator">?</span><span class="token operator">&gt;</span><span class="token operator">?</span><span class="token punctuation">,</span>
        orderBy<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> ArrayList<span class="token operator">&lt;</span>Clientes<span class="token operator">&gt;</span><span class="token operator">?</span> 
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-var">var</span> listaCliente<span class="token operator">:</span> ArrayList<span class="token operator">&lt;</span>Clientes<span class="token operator">&gt;</span><span class="token operator">?</span> <span class="token operator">=</span> <span class="token function">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-val">val</span> dbClientes <span class="token operator">=</span> clientes<span class="token punctuation">.</span>readableDatabase
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>dbClientes <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
            <span class="token keyword keyword-val">val</span> cursor<span class="token operator">:</span> Cursor <span class="token operator">=</span> 
             dbClientes<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;clientes&quot;</span><span class="token punctuation">,</span> columnas<span class="token punctuation">,</span> <span class="token keyword keyword-where">where</span><span class="token punctuation">,</span> valores<span class="token punctuation">,</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">,</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">,</span> orderBy<span class="token punctuation">)</span>
            listaCliente <span class="token operator">=</span> <span class="token function">getClientes</span><span class="token punctuation">(</span>cursor<span class="token punctuation">)</span>
            dbClientes<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-return">return</span> listaCliente
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-null">null</span>
    <span class="token punctuation">}</span>
</pre><p>Donde la llamada al m&#xE9;todo podr&#xED;a ser la siguiente:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin">  <span class="token keyword keyword-val">val</span> listaCliente <span class="token operator">=</span> bdAdapter<span class="token punctuation">.</span><span class="token function">seleccionarDatosCodigo</span><span class="token punctuation">(</span>
                    <span class="token function">arrayOf</span><span class="token punctuation">(</span><span class="token string">&quot;dni&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;nombre&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;apellidos&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token keyword keyword-null">null</span><span class="token punctuation">,</span>
                    <span class="token keyword keyword-null">null</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;apellidos&quot;</span><span class="token punctuation">)</span>
</pre><blockquote>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"> binding<span class="token punctuation">.</span>listView<span class="token punctuation">.</span><span class="token function">setAdapter</span><span class="token punctuation">(</span>
                   <span class="token function">AdaptadorClientes</span><span class="token punctuation">(</span>
                       <span class="token keyword keyword-this">this</span><span class="token label symbol">@MainActivity</span><span class="token punctuation">,</span>
                       R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>list_layout<span class="token punctuation">,</span>
                       listaCliente<span class="token operator">!!</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><p>Clase Adaptador para un ListView:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-class">class</span> <span class="token function">AdaptadorClientes</span><span class="token punctuation">(</span><span class="token keyword keyword-var">var</span> activitycontext<span class="token operator">:</span> Activity<span class="token punctuation">,</span> 
                           resource<span class="token operator">:</span> Int<span class="token punctuation">,</span> 
                           objects<span class="token operator">:</span> ArrayList<span class="token operator">&lt;</span>Clientes<span class="token operator">&gt;</span>
                           <span class="token punctuation">)</span> <span class="token operator">:</span>
   ArrayAdapter<span class="token operator">&lt;</span>Any<span class="token operator">&gt;</span><span class="token punctuation">(</span>activitycontext<span class="token punctuation">,</span> resource<span class="token punctuation">,</span> objects <span class="token keyword keyword-as">as</span> List<span class="token operator">&lt;</span>Any<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword keyword-var">var</span> objects<span class="token operator">:</span> ArrayList<span class="token operator">&lt;</span>Clientes<span class="token operator">&gt;</span>
   <span class="token keyword keyword-override">override</span>  <span class="token keyword keyword-fun">fun</span> <span class="token function">getView</span><span class="token punctuation">(</span>position<span class="token operator">:</span> Int<span class="token punctuation">,</span> 
                         convertView<span class="token operator">:</span> View<span class="token operator">?</span><span class="token punctuation">,</span> 
                         parent<span class="token operator">:</span> ViewGroup<span class="token punctuation">)</span><span class="token operator">:</span> View <span class="token punctuation">{</span>
       <span class="token keyword keyword-var">var</span> vista<span class="token operator">:</span> View<span class="token operator">?</span><span class="token operator">=</span> convertView
       <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>vista <span class="token operator">==</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword keyword-val">val</span> inflater <span class="token operator">=</span> activitycontext<span class="token punctuation">.</span>layoutInflater
           vista <span class="token operator">=</span> inflater<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>list_layout<span class="token punctuation">,</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
           <span class="token punctuation">(</span>vista<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>apellidolist<span class="token punctuation">)</span> <span class="token keyword keyword-as">as</span> TextView<span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>objects<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">.</span>apellidos<span class="token punctuation">)</span>
           <span class="token punctuation">(</span>vista<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>nombrelist<span class="token punctuation">)</span> <span class="token keyword keyword-as">as</span> TextView<span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>objects<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">.</span>nombre<span class="token punctuation">)</span>
           <span class="token punctuation">(</span>vista<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>dnilist<span class="token punctuation">)</span> <span class="token keyword keyword-as">as</span> TextView<span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>objects<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">.</span>dni<span class="token punctuation">)</span>
       <span class="token punctuation">}</span>
       <span class="token keyword keyword-return">return</span> vista
   <span class="token punctuation">}</span>

   <span class="token keyword keyword-init">init</span> <span class="token punctuation">{</span>
       <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>objects <span class="token operator">=</span> objects
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre></blockquote>
<h3 class="mume-header" id="uso-de-simplecursoradapter">Uso de SimpleCursorAdapter</h3>

<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-class">class</span> <span class="token function">DBAdapter</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-private">private</span>  <span class="token keyword keyword-var">var</span> ohCategoria<span class="token operator">:</span> OHCategoria
    <span class="token keyword keyword-init">init</span> <span class="token punctuation">{</span>
        ohCategoria <span class="token operator">=</span> <span class="token function">OHCategoria</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">&quot;BBDCategorias&quot;</span><span class="token punctuation">,</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">insertarDatosCodigo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword keyword-val">val</span> sqLiteDatabase <span class="token operator">=</span> ohCategoria<span class="token punctuation">.</span>writableDatabase
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>sqLiteDatabase <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-val">val</span> valores <span class="token operator">=</span> <span class="token function">ContentValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            valores<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;nombre&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ASIR&quot;</span><span class="token punctuation">)</span>
            valores<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;cate&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Superior&quot;</span><span class="token punctuation">)</span>
            valores<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;idcategoria&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
            sqLiteDatabase<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">&quot;categoria&quot;</span><span class="token punctuation">,</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">,</span> valores<span class="token punctuation">)</span>
            valores<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;nombre&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;DAM&quot;</span><span class="token punctuation">)</span>
            valores<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;cate&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Superior&quot;</span><span class="token punctuation">)</span>
            valores<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;idcategoria&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
            sqLiteDatabase<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">&quot;categoria&quot;</span><span class="token punctuation">,</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">,</span> valores<span class="token punctuation">)</span>
            valores<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;nombre&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;SMR&quot;</span><span class="token punctuation">)</span>
            valores<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;cate&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Medio&quot;</span><span class="token punctuation">)</span>
            valores<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;idcategoria&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
            sqLiteDatabase<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">&quot;categoria&quot;</span><span class="token punctuation">,</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">,</span> valores<span class="token punctuation">)</span>
            sqLiteDatabase<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">leerDatos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>Cursor<span class="token operator">?</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-val">val</span> sqLiteDatabase <span class="token operator">=</span> ohCategoria<span class="token punctuation">.</span>readableDatabase
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>sqLiteDatabase <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> sqLiteDatabase<span class="token punctuation">.</span><span class="token function">rawQuery</span><span class="token punctuation">(</span>
                <span class="token string">&quot;select  idcategoria as _id, nombre, cate from categoria&quot;</span><span class="token punctuation">,</span>
                <span class="token keyword keyword-null">null</span> <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-null">null</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-inner">inner</span> <span class="token keyword keyword-class">class</span> <span class="token function">OHCategoria</span><span class="token punctuation">(</span>
         context<span class="token operator">:</span> Context<span class="token operator">?</span><span class="token punctuation">,</span> name<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>
         factory<span class="token operator">:</span> SQLiteDatabase<span class="token punctuation">.</span>CursorFactory<span class="token operator">?</span><span class="token punctuation">,</span> 
         version<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">QLiteOpenHelper</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> name<span class="token punctuation">,</span> factory<span class="token punctuation">,</span> version<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-var">var</span> cadena <span class="token operator">=</span>
            &quot;create table <span class="token keyword keyword-if">if</span> not exists <span class="token function">categoria</span><span class="token punctuation">(</span>idcategoria
             INTEGER PRIMARY KEY NOT NULL<span class="token punctuation">,</span> nombre TEXT<span class="token punctuation">,</span> cate TEXT<span class="token punctuation">)</span><span class="token punctuation">;</span>&quot;
        <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>db<span class="token operator">:</span> SQLiteDatabase<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            db<span class="token punctuation">.</span><span class="token function">execSQL</span><span class="token punctuation">(</span>cadena<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onUpgrade</span><span class="token punctuation">(</span>db<span class="token operator">:</span> SQLiteDatabase<span class="token punctuation">,</span> 
                               oldVersion<span class="token operator">:</span> Int<span class="token punctuation">,</span> newVersion<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>Posteriormente pasamos a crear el cursorAdapter, pero para ello vamos a usar un Spinner para mostrar la informaci&#xF3;n, lo incluimos en el layout principal.</p>
<pre data-role="codeBlock" data-info="kotlin{highlight=[9,10]}" class="language-kotlin" data-line="9,10"> <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        <span class="token keyword keyword-val">val</span> from <span class="token operator">=</span> <span class="token function">arrayOf</span><span class="token punctuation">(</span><span class="token string">&quot;nombre&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;cate&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-val">val</span> <span class="token keyword keyword-to">to</span> <span class="token operator">=</span> <span class="token function">intArrayOf</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>ciclo<span class="token punctuation">,</span> R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>cate<span class="token punctuation">)</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_my<span class="token punctuation">)</span>
        <span class="token keyword keyword-val">val</span> dbAdapter<span class="token operator">=</span><span class="token function">DBAdapter</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span>
        dbAdapter<span class="token punctuation">.</span><span class="token function">insertarDatosCodigo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-val">val</span> desplegable <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>Spinner<span class="token operator">&gt;</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>spinner<span class="token punctuation">)</span>
        <span class="token keyword keyword-val">val</span> cursor<span class="token operator">=</span>dbAdapter<span class="token punctuation">.</span><span class="token function">leerDatos</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-val">val</span> mAdapter <span class="token operator">=</span> <span class="token function">SimpleCursorAdapter</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">,</span> R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>spinner_layout<span class="token punctuation">,</span> 
                                           cursor<span class="token punctuation">,</span> from<span class="token punctuation">,</span> <span class="token keyword keyword-to">to</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">)</span>
        desplegable<span class="token punctuation">.</span><span class="token function">setAdapter</span><span class="token punctuation">(</span>mAdapter<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
<div class="line-highlight-wrapper">







<div aria-hidden="true" class="line-highlight" data-range="9" data-start="9">
</div></div><div class="line-highlight-wrapper">








<div aria-hidden="true" class="line-highlight" data-range="10" data-start="10">
</div></div></pre><h4 class="mume-header" id="cursores-con-recyclerview">Cursores con RecyclerView</h4>

<ol>
<li>
<p>Crear una clase <strong>Abstracta</strong> base que derive de <strong>RecyclerView.Adapter</strong> y en la que implementaremos los m&#xE9;todos sobrescritos derivados de RecyclerView.Adapter:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"> <span class="token keyword keyword-abstract">abstract</span> <span class="token keyword keyword-class">class</span> <span class="token function">CursorRecyclerAdapter</span><span class="token punctuation">(</span>cursor<span class="token operator">:</span> Cursor<span class="token punctuation">)</span> <span class="token operator">:</span>
 RecyclerView<span class="token punctuation">.</span>Adapter<span class="token operator">&lt;</span>RecyclerView<span class="token punctuation">.</span>ViewHolder<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword keyword-var">var</span> mCursor<span class="token operator">:</span> Cursor
 <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onBindViewHolder</span><span class="token punctuation">(</span>holder<span class="token operator">:</span> RecyclerView<span class="token punctuation">.</span>ViewHolder<span class="token punctuation">,</span> 
                               position<span class="token operator">:</span> Int<span class="token punctuation">)</span> 
 <span class="token punctuation">{</span>
     <span class="token function">checkNotNull</span><span class="token punctuation">(</span>mCursor<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token string">&quot;ERROR, cursos vacio&quot;</span> <span class="token punctuation">}</span>
     <span class="token function">check</span><span class="token punctuation">(</span>mCursor<span class="token punctuation">.</span><span class="token function">moveToPosition</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token string">&quot;ERROR, no se puede&quot;</span> <span class="token operator">+</span>
             <span class="token string">&quot; encontrar la posicion:  <span class="token interpolation variable">$position</span>&quot;</span> <span class="token punctuation">}</span>
     <span class="token function">onBindViewHolder</span><span class="token punctuation">(</span>holder<span class="token punctuation">,</span> mCursor<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
 <span class="token keyword keyword-abstract">abstract</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onBindViewHolder</span><span class="token punctuation">(</span>holder<span class="token operator">:</span> RecyclerView<span class="token punctuation">.</span>ViewHolder<span class="token punctuation">,</span> 
                               cursor<span class="token operator">:</span> Cursor<span class="token punctuation">)</span>
 <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getItemCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Int
 <span class="token punctuation">{</span>
     <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>mCursor <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>    mCursor<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-else">else</span> <span class="token number">0</span>
 <span class="token punctuation">}</span>
 <span class="token keyword keyword-init">init</span> <span class="token punctuation">{</span>
     mCursor <span class="token operator">=</span> cursor
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre></li>
<li>
<p>Ahora tendremos que crear nuestra clase RecyclerView derivada de la anterior.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-class">class</span> <span class="token function">RecyclerAdapter</span><span class="token punctuation">(</span>c<span class="token operator">:</span> Cursor<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">CursorRecyclerAdapter</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreateViewHolder</span><span class="token punctuation">(</span>parent<span class="token operator">:</span> ViewGroup<span class="token punctuation">,</span> 
                                 viewType<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> RecyclerView<span class="token punctuation">.</span><span class="token function">ViewHolder</span> 
 <span class="token punctuation">{</span>
     <span class="token keyword keyword-val">val</span> v<span class="token operator">:</span> View <span class="token operator">=</span> LayoutInflater<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>context<span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>recycler_layout<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
     <span class="token keyword keyword-return">return</span> <span class="token function">SimpleViewHolder</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
 <span class="token keyword keyword-override">override</span>  <span class="token keyword keyword-fun">fun</span> <span class="token function">onBindViewHolder</span><span class="token punctuation">(</span>holder<span class="token operator">:</span> RecyclerView<span class="token punctuation">.</span>ViewHolder<span class="token punctuation">,</span>
                                cursor<span class="token operator">:</span> Cursor<span class="token punctuation">)</span> 
 <span class="token punctuation">{</span>
     <span class="token punctuation">(</span>holder <span class="token keyword keyword-as">as</span> SimpleViewHolder<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>cursor<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
 <span class="token keyword keyword-internal">internal</span> <span class="token keyword keyword-inner">inner</span> <span class="token keyword keyword-class">class</span> <span class="token function">SimpleViewHolder</span><span class="token punctuation">(</span>itemView<span class="token operator">:</span> View<span class="token punctuation">)</span> <span class="token operator">:</span>
                   RecyclerView<span class="token punctuation">.</span><span class="token function">ViewHolder</span><span class="token punctuation">(</span>itemView<span class="token punctuation">)</span> 
 <span class="token punctuation">{</span>
     <span class="token keyword keyword-var">var</span> nombre<span class="token operator">:</span> TextView
     <span class="token keyword keyword-var">var</span> cate<span class="token operator">:</span> TextView
     <span class="token keyword keyword-var">var</span> imagen<span class="token operator">:</span> ImageView
     <span class="token keyword keyword-fun">fun</span> <span class="token function">bind</span><span class="token punctuation">(</span>dato<span class="token operator">:</span> Cursor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         nombre<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>dato<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
         cate<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>dato<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token keyword keyword-val">val</span> theImage<span class="token operator">:</span> Bitmap <span class="token operator">=</span> MainActivity<span class="token punctuation">.</span>
                          <span class="token function">convertirStringBitmap</span><span class="token punctuation">(</span>dato<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
         imagen<span class="token punctuation">.</span><span class="token function">setImageBitmap</span><span class="token punctuation">(</span>theImage<span class="token punctuation">)</span>
     <span class="token punctuation">}</span>
     <span class="token keyword keyword-init">init</span> <span class="token punctuation">{</span>
         nombre <span class="token operator">=</span> itemView<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>ciclo<span class="token punctuation">)</span>
         cate <span class="token operator">=</span> itemView<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>cate<span class="token punctuation">)</span>
         imagen <span class="token operator">=</span> itemView<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>imagen<span class="token punctuation">)</span> <span class="token keyword keyword-as">as</span> ImageView
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre></li>
</ol>
<div style="page-break-after:always;"></div>
<span style="align: center;">
<table align="center">
<tbody><tr style="border:hidden;">
<td>
<ol start="3">
<li>Se han incluido im&#xE1;genes para dar m&#xE1;s funcionalidad, hay dos m&#xE9;todos que nos permiten pasar im&#xE1;genes de Bitmap a String y viceversa para poderlas guardar en la BD a trav&#xE9;s del cursor (En la BD se guardar&#xE1;n como Blob). Est&#xE1;n localizados en MyActivity y son est&#xE1;ticos para poder acceder a ellos sin necesidad de objeto.</li>
</ol>
</td>
</tr>
</tbody></table>
</span>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-companion">companion</span> <span class="token keyword keyword-object">object</span> 
<span class="token punctuation">{</span>
  <span class="token keyword keyword-fun">fun</span> <span class="token function">convertirStringBitmap</span><span class="token punctuation">(</span>imagen<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> Bitmap <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> decodedString<span class="token operator">:</span> ByteArray <span class="token operator">=</span> Base64<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>imagen<span class="token punctuation">,</span> Base64<span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span>
    <span class="token keyword keyword-return">return</span> BitmapFactory<span class="token punctuation">.</span><span class="token function">decodeByteArray</span><span class="token punctuation">(</span>decodedString<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> decodedString<span class="token punctuation">.</span>size<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword keyword-fun">fun</span> <span class="token function">ConvertirImagenString</span><span class="token punctuation">(</span>bitmap<span class="token operator">:</span> Bitmap<span class="token punctuation">)</span><span class="token operator">:</span> String <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> stream <span class="token operator">=</span> <span class="token function">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    bitmap<span class="token punctuation">.</span><span class="token function">compress</span><span class="token punctuation">(</span>Bitmap<span class="token punctuation">.</span>CompressFormat<span class="token punctuation">.</span>PNG<span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> stream<span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> byte_arr<span class="token operator">:</span> ByteArray <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-return">return</span> Base64<span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span>byte_arr<span class="token punctuation">,</span> Base64<span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><div style="page-break-after:always;"></div>
<h2 class="mume-header" id="acceso-a-bases-de-datos-remotas">Acceso a bases de datos remotas</h2>

<h3 class="mume-header" id="acceso-a-bases-de-datos-con-apirest-y-retrofit">Acceso a bases de datos con Apirest y Retrofit</h3>

<h4 class="mume-header" id="consumo-de-un-servicio-rest-desde-android">Consumo de un Servicio Rest desde Android</h4>

<p>Retrofit la utilizaremos para hacer peticiones y procesar las respuestas del APIRest, mientras que con Gson transformaremos los datos de JSON a los propios que utilice la aplicaci&#xF3;n.<br>
Para ello a&#xF1;adiremos las siguientes l&#xED;neas en el build.gradle de la app, y no olvides incluir permisos de internet:</p>
<pre data-role="codeBlock" data-info="json" class="language-json">            implementation <span class="token string">&quot;com.squareup.retrofit2:converter-gson:2.9.0&quot;</span>
            implementation &apos;com.squareup.retrofit2<span class="token operator">:</span>retrofit<span class="token operator">:</span><span class="token number">2.9</span>.<span class="token number">0</span>&apos;
</pre><p>Podemos decir que los pasos a seguir ser&#xE1;n los siguientes:</p>
<ol>
<li>Creaci&#xF3;n de un builder de Retrofit.</li>
</ol>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">crearRetrofit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> ProveedorSersvicio <span class="token punctuation">{</span>
    <span class="token comment">//val url = &quot;http://10.0.2.2/usuarios/&quot; //para el AVD de android</span>
    <span class="token keyword keyword-val">val</span> url<span class="token operator">=</span><span class="token string">&quot;http://xusa.iesdoctorbalmis.info/usuarios/&quot;</span> <span class="token comment">//para servidor del instituto</span>
    <span class="token keyword keyword-val">val</span> retrofit <span class="token operator">=</span> Retrofit<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">baseUrl</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addConverterFactory</span><span class="token punctuation">(</span>GsonConverterFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-return">return</span> retrofit<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>ProveedorSersvicio<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</pre><ol start="2">
<li>
<p>Creaci&#xF3;n de las clases Pojo que le servir&#xE1; al Gson para parsear los resultados.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-class">class</span> RespuestaJSon <span class="token punctuation">{</span>
    <span class="token keyword keyword-var">var</span> respuesta <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword keyword-var">var</span> metodo<span class="token operator">:</span> String<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword keyword-null">null</span>
    <span class="token keyword keyword-var">var</span> tabla<span class="token operator">:</span> String<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword keyword-null">null</span>
    <span class="token keyword keyword-var">var</span> mensaje<span class="token operator">:</span> String<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword keyword-null">null</span>
    <span class="token keyword keyword-var">var</span> sqlQuery<span class="token operator">:</span> String<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword keyword-null">null</span>
    <span class="token keyword keyword-var">var</span> sqlError<span class="token operator">:</span> String<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword keyword-null">null</span>
<span class="token punctuation">}</span>
</pre><p>Despu&#xE9;s tienes que crear la estructura de clases para almacenar la informaci&#xF3;n que te resulte &#xFA;til. Clase Usuario en este ejemplo.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-class">class</span> <span class="token function">Usuarios</span><span class="token punctuation">(</span><span class="token keyword keyword-var">var</span> nick<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token keyword keyword-var">var</span> nombre<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token keyword keyword-var">var</span> _id<span class="token operator">:</span> Int <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
</pre></li>
<li>
<p>Necesitaremos crear una interfaz con todos los servicios que quieras utilizar. Aqu&#xED; tienes unos ejemplos:</p>
</li>
</ol>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-interface">interface</span> ProveedorSersvicio <span class="token punctuation">{</span>
    <span class="token annotation builtin">@GET</span><span class="token punctuation">(</span><span class="token string">&quot;usuarios&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation builtin">@Headers</span><span class="token punctuation">(</span><span class="token string">&quot;Accept: application/json&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Content-Type: application/json&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">usuarios</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Response<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Usuarios<span class="token operator">&gt;</span><span class="token operator">&gt;</span>

    <span class="token annotation builtin">@GET</span><span class="token punctuation">(</span><span class="token string">&quot;mensajes&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation builtin">@Headers</span><span class="token punctuation">(</span><span class="token string">&quot;Accept: application/json&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Content-Type: application/json&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">mensajes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>Response<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Mensaje<span class="token operator">&gt;</span><span class="token operator">&gt;</span>

    <span class="token annotation builtin">@GET</span><span class="token punctuation">(</span><span class="token string">&quot;mensajes/{nick}&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation builtin">@Headers</span><span class="token punctuation">(</span><span class="token string">&quot;Accept: application/json&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Content-Type: application/json&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getUsuario</span><span class="token punctuation">(</span><span class="token annotation builtin">@Path</span><span class="token punctuation">(</span><span class="token string">&quot;nick&quot;</span><span class="token punctuation">)</span> nick<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> Response<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Usuarios<span class="token operator">&gt;</span><span class="token operator">&gt;</span>

    <span class="token annotation builtin">@POST</span><span class="token punctuation">(</span><span class="token string">&quot;usuarios&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation builtin">@Headers</span><span class="token punctuation">(</span><span class="token string">&quot;Accept: application/json&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Content-Type: application/json&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">insertarUsuario</span><span class="token punctuation">(</span><span class="token annotation builtin">@Body</span> usuarios<span class="token operator">:</span> Usuarios<span class="token punctuation">)</span><span class="token operator">:</span> Response<span class="token operator">&lt;</span>RespuestaJSon<span class="token operator">&gt;</span>

    <span class="token annotation builtin">@POST</span><span class="token punctuation">(</span><span class="token string">&quot;mensajes&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation builtin">@Headers</span><span class="token punctuation">(</span><span class="token string">&quot;Accept: application/json&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Content-Type: application/json&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">insertarMensaje</span><span class="token punctuation">(</span><span class="token annotation builtin">@Body</span> mensaje<span class="token operator">:</span> Mensaje<span class="token punctuation">)</span><span class="token operator">:</span> Response<span class="token operator">&lt;</span>RespuestaJSon<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</pre><p>[<a href="http://square.github.io/retrofit/">http://square.github.io/retrofit/</a>]</p>
<blockquote>
<p>&#x1F4A1; <strong>Retrofit</strong> para invocar la url de la petici&#xF3;n usa <strong><code>@GET, @POST, @PUT y @DELETE</code></strong>. El par&#xE1;metro corresponder&#xE1; con la url de la petici&#xF3;n.<br>
En el builder de Retrofit se incluye la url base del api terminada con <strong><code>/</code></strong>, que unida con el par&#xE1;metro del servicio crear&#xE1;n la url completa de la petici&#xF3;n:<br>
<strong><code>@GET -&gt; http://&gt;10.0.2.2/usuarios/usuario</code></strong></p>
<ul>
<li><strong><code>@Header y @Headers</code></strong>. Se usan para especificar los valores que vayan en la secci&#xF3;n <em>header</em> de la petici&#xF3;n, como por ejemplo en que formato van a ser enviados y recibidos los datos.</li>
<li><strong><code>@Path</code></strong>. Sirve para incluir un identificador en la url de la petici&#xF3;n, para obtener informaci&#xF3;n sobre algo espec&#xED;fico. El atributo en el m&#xE9;todo de llamada que sea precedido por <em>@Path</em> sustituir&#xE1; al identificador entre llaves de la ruta, que tenga el mismo nombre.</li>
<li><strong><code>@Fields</code></strong>. Nos permite pasar variables b&#xE1;sicas en las peticiones <em>Post y Put</em>.</li>
<li><strong><code>@Body</code></strong>. Es equivalente a Fields pero para variables objeto.</li>
<li><strong><code>@Query</code></strong>. Se usa cuando la petici&#xF3;n va a necesitar par&#xE1;metros (los valores que van despu&#xE9;s del <strong><code>?</code></strong> en una url).</li>
</ul>
</blockquote>
<ol start="4">
<li>Pedir datos a la Api ser&#xED;a el &#xFA;ltimo paso a realizar. Retrofit nos da la opci&#xF3;n de realizarlo de manera s&#xED;ncrona o as&#xED;ncrona.<br>
Si no vamos a esperar a que acabe la corrutina:</li>
</ol>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"> <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">anyadirUsuario</span><span class="token punctuation">(</span>usuarios<span class="token operator">:</span> Usuarios<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-val">val</span> context<span class="token operator">=</span><span class="token keyword keyword-this">this</span>
        <span class="token keyword keyword-var">var</span> salida<span class="token operator">:</span>String<span class="token operator">?</span>
        <span class="token keyword keyword-val">val</span> proveedorServicios<span class="token operator">:</span> ProveedorSersvicio <span class="token operator">=</span> <span class="token function">crearRetrofit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">CoroutineScope</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">launch</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-val">val</span> response <span class="token operator">=</span> proveedorServicios<span class="token punctuation">.</span><span class="token function">insertarUsuario</span><span class="token punctuation">(</span>usuarios<span class="token punctuation">)</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>isSuccessful<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-val">val</span> usuariosResponse <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>usuariosResponse <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> 
                    salida<span class="token operator">=</span>usuariosResponse<span class="token punctuation">.</span>mensaje
                <span class="token keyword keyword-else">else</span> 
                    salida<span class="token operator">=</span>response<span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span>           
                <span class="token punctuation">}</span>
            <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                Log<span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token string">&quot;Error&quot;</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span><span class="token function">errorBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                salida<span class="token operator">=</span>response<span class="token punctuation">.</span><span class="token function">errorBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
                Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> salida<span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_LONG<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>espera <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> espera<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token function">limpiaControl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><p>Y este ser&#xED;a un ejemplo, en el que esperamos a que termine.</p>
<p>Si en el APIAdapter me creo una funci&#xF3;n c&#xF3;mo esta, que implementa la interfaz <strong>Deferred</strong> [<a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-deferred/index.html">https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-deferred/index.html</a>] , y lanza una corrutina de <strong>modo as&#xED;ncrono</strong> [<a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/async.html">https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/async.html</a>]:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin">  <span class="token keyword keyword-fun">fun</span> <span class="token function">seleccionarFotos</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token punctuation">)</span><span class="token operator">:</span> Deferred<span class="token operator">&lt;</span>ArrayList<span class="token operator">&lt;</span>Dato<span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-val">val</span> proveedorServicios<span class="token operator">:</span> ProveedorServicios <span class="token operator">=</span> <span class="token function">crearRetrofit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">CoroutineScope</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">async</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-var">var</span> datosDev<span class="token operator">=</span>ArrayList<span class="token operator">&lt;</span>Dato<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-val">val</span> response<span class="token operator">:</span> Response<span class="token operator">&lt;</span>ArrayList<span class="token operator">&lt;</span>Dato<span class="token operator">&gt;</span><span class="token operator">&gt;</span>
            response<span class="token operator">=</span>proveedorServicios<span class="token punctuation">.</span><span class="token function">getFotos</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>isSuccessful<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                datosDev <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!!</span>
            <span class="token punctuation">}</span>
            datosDev
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><p>Posteriormente podr&#xE9; llamarla diciendo que espere a que dicha funci&#xF3;n termine mediante <strong>.await()</strong> al final:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin">  MainActivity<span class="token punctuation">.</span>datos <span class="token operator">=</span> 
  ApiRestAdapter<span class="token punctuation">.</span><span class="token function">seleccionarFotos</span><span class="token punctuation">(</span><span class="token function">requireContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><blockquote>
<p>&#x1F4CC;Hay que tener en cuenta que si  dentro de una corrutina necesito acceder a this, debo grabarlo anteriormente en una variable, ya que dentro de la rutina this me darr&#xE1; error.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin">  <span class="token keyword keyword-fun">fun</span> <span class="token function">prepararDatos</span><span class="token punctuation">(</span>tipo<span class="token operator">:</span>Int<span class="token punctuation">,</span> texto<span class="token operator">:</span>String<span class="token punctuation">)</span>
 <span class="token punctuation">{</span>
     <span class="token keyword keyword-val">val</span> contextoAplicacion<span class="token operator">:</span>Context<span class="token operator">=</span><span class="token keyword keyword-this">this</span>
     <span class="token function">CoroutineScope</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span><span class="token punctuation">.</span>launch <span class="token operator">&gt;</span><span class="token punctuation">{</span>

        <span class="token keyword keyword-val">val</span> adaptadorAPI<span class="token operator">=</span>AdaptadorAPI<span class="token operator">&gt;</span><span class="token punctuation">(</span>contextoAplicacion<span class="token punctuation">)</span>
         <span class="token operator">..</span><span class="token punctuation">.</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</pre></blockquote>
<div style="page-break-after:always;"></div>
<h2 class="mume-header" id="acceso-a-base-de-datos-con-firebase">Acceso a Base de Datos con FIREBASE</h2>

<p><a href="https://firebase.google.com/">Firebase</a></p>
<h3 class="mume-header" id="creando-un-app-de-firebase">Creando un app de Firebase</h3>

<p>Justo en el momento que termina de crearse la aplicaci&#xF3;n, se descargara un archivo JSON que deberemos copiar en nuestro proyecto Android. Solo tendremos que seguir las instrucciones que proporciona muy claramente la p&#xE1;gina Web de Firebase (copiar el archivo y a&#xF1;adir las l&#xED;neas que indican que vamos a usar servicios de google en los build.gradle de la app y del proyecto).</p>
<ol>
<li>
<p>En el proyecto</p>
<pre data-role="codeBlock" data-info="json" class="language-json">  dependencies <span class="token punctuation">{</span>
     classpath <span class="token string">&quot;com.android.tools.build:gradle:7.0.3&quot;</span>
     classpath <span class="token string">&quot;com.google.gms:google-services:4.3.10&quot;</span> <span class="token comment">//a&#xF1;adir esta l&#xED;nea</span>
     ...
  <span class="token punctuation">}</span>
</pre></li>
<li>
<p>En la APP</p>
<pre data-role="codeBlock" data-info="json" class="language-json">plugins <span class="token punctuation">{</span>
   id &apos;com.android.application&apos;
   id &apos;kotlin-android&apos;
   id &apos;com.google.gms.google-services&apos;  <span class="token comment">// Google Services plugin</span>
<span class="token punctuation">}</span>

dependencies <span class="token punctuation">{</span>
    ...
    implementation &apos;androidx.appcompat<span class="token operator">:</span>appcompat<span class="token operator">:</span><span class="token number">1.3</span>.<span class="token number">1</span>&apos;
    <span class="token comment">//a&#xF1;adir las siguientes dos l&#xED;neas</span>
    implementation platform(&apos;com.google.firebase<span class="token operator">:</span>firebase-bom<span class="token operator">:</span><span class="token number">28.4</span>.<span class="token number">1</span>&apos;)
    implementation &apos;com.google.firebase<span class="token operator">:</span>firebase-analytics&apos;
    ...
<span class="token punctuation">}</span>
</pre></li>
</ol>
<blockquote>
<p>&#x1F4CC;Muy importante no olvidar a&#xF1;adir en el SDK, el servicio de Google Play</p>
</blockquote>
<h3 class="mume-header" id="firestore-database">Firestore DataBase</h3>

<p><a href="https://firebase.google.com/docs/database">Firebase Realtime Database</a><br>
<a href="https://firebase.google.com/docs/firestore">Firebase Firestore DataBase</a></p>
<p>Antes de comenzar con el c&#xF3;digo de acceso a la BD, tendremos que a&#xF1;adir la dependencia que nos permitir&#xE1; hacerlo:</p>
<pre data-role="codeBlock" data-info="json" class="language-json">   implementation &apos;com.google.firebase<span class="token operator">:</span>firebase-firestore&apos;
</pre><p>Para referenciar a nuestra base de datos solamente tendremos que crear un objeto de tipo <strong><code>FirebaseFirestore</code></strong>. El archivo que descargamos al enlazar la app con el proyecto, es el que se encarga de todo el trabajo interno para la conexi&#xF3;n:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-val">val</span> firebaseFirestore <span class="token operator">=</span> FirebaseFirestore<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><p>Para hacer referencia a una colecci&#xF3;n existente o a&#xF1;adirla en caso de no existir, utilizaremos el m&#xE9;todo <strong><code>collection</code></strong> con el nombre de la colecci&#xF3;n como argumento.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin">firebaseFirestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;Usuarios&quot;</span><span class="token punctuation">)</span>
</pre><p>Este m&#xE9;todo devuelve una referencia a la colecci&#xF3;n seleccionada, y con &#xE9;l podremos a&#xF1;adir nuevos elementos a ella (la colecci&#xF3;n se crear&#xE1; al a&#xF1;adir el primer documento, en caso de haber sido creada anteriormente har&#xE1; la referencia solamente).</p>
<p>Para a&#xF1;adir un objeto (documento) a la colecci&#xF3;n lo podremos hacer de dos maneras:</p>
<ol>
<li>Dejando que la plataforma genere una clave aleat&#xF3;ria, para eso utilizaremos el m&#xE9;todo add.</li>
</ol>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin">   firebaseFirestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;Usuarios&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">Usuario</span><span class="token punctuation">(</span><span class="token string">&quot;Pepe&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;correo@gmail.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div align="center">
    <img height="95" src="./imagenes/imagen33.png">
</div>
<ol>
<li>A&#xF1;adiendo nosotros la clave, esta debe ser &#xFA;nica para que el usuario se a&#xF1;ada.</li>
</ol>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin">   firebaseFirestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;Usuarios&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">document</span><span class="token punctuation">(</span>usuario<span class="token punctuation">.</span>correo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>usuario<span class="token punctuation">)</span>
</pre> <div align="center">
    <img height="95" src="./imagenes/imagen34.png">
</div>
<p><strong>Cuidado deberemos tener los atributos p&#xFA;blicos o usar getter y setter.</strong></p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-class">class</span> Usuario <span class="token operator">:</span> Serializable <span class="token punctuation">{</span>
    <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> usuario<span class="token operator">:</span> String
    <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> correo<span class="token operator">:</span> String

    <span class="token keyword keyword-constructor">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword keyword-constructor">constructor</span><span class="token punctuation">(</span>usuario<span class="token operator">:</span> String<span class="token punctuation">,</span> correo<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>usuario <span class="token operator">=</span> usuario
        <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>correo <span class="token operator">=</span> correo
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p><em>El c&#xF3;digo completo para crear la aplicaci&#xF3;n que nos a&#xF1;adir&#xE1; un usuario cada vez que pulsemos el bot&#xF3;n a&#xF1;adir, de forma que el id del usuario sea el correo, ser&#xE1; el siguiente:</em></p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-class">class</span> MainActivity <span class="token operator">:</span> <span class="token function">AppCompatActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> firebaseFirestore<span class="token operator">:</span> FirebaseFirestore
    <span class="token keyword keyword-var">var</span> listenerRegistration<span class="token operator">:</span> ListenerRegistration<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword keyword-null">null</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span>
        firebaseFirestore <span class="token operator">=</span> FirebaseFirestore<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-val">val</span> usuarioET <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>TextInputLayout<span class="token operator">&gt;</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>usuario<span class="token punctuation">)</span>
        <span class="token keyword keyword-val">val</span> correoET <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>TextInputLayout<span class="token operator">&gt;</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>correo<span class="token punctuation">)</span>
        <span class="token keyword keyword-val">val</span> a&#xF1;adir <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>Button<span class="token operator">&gt;</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>anyadir<span class="token punctuation">)</span>

        <span class="token keyword keyword-val">val</span> salida <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>TextView<span class="token operator">&gt;</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>salida<span class="token punctuation">)</span>
        a&#xF1;adir<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">{</span>
            <span class="token keyword keyword-val">val</span> usuario <span class="token operator">=</span> <span class="token function">Usuario</span><span class="token punctuation">(</span>usuarioET<span class="token punctuation">.</span>editText<span class="token operator">?</span><span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                  correoET<span class="token punctuation">.</span>editText<span class="token operator">?</span><span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            firebaseFirestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;Usuarios&quot;</span><span class="token punctuation">)</span>
                             <span class="token punctuation">.</span><span class="token function">document</span><span class="token punctuation">(</span>usuario<span class="token punctuation">.</span>correo<span class="token punctuation">)</span>
                             <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>usuario<span class="token punctuation">)</span>
                             <span class="token punctuation">.</span><span class="token function">addOnSuccessListener</span> <span class="token punctuation">{</span>
                              Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>
                              <span class="token keyword keyword-this">this</span><span class="token punctuation">,</span>
                              <span class="token string">&quot;Usuario A&#xF1;adido&quot;</span><span class="token punctuation">,</span>
                              Toast<span class="token punctuation">.</span>LENGTH_SHORT
                              <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
                             <span class="token punctuation">.</span><span class="token function">addOnFailureListener</span> <span class="token punctuation">{</span> e <span class="token operator">-&gt;</span>
                             Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>
                             <span class="token keyword keyword-this">this</span><span class="token punctuation">,</span>
                             <span class="token string">&quot;Error&quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
                             Toast<span class="token punctuation">.</span>LENGTH_SHORT
                             <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><p><a href="https://cloud.google.com/firestore/docs/query-data/queries?hl=es">Buscar un documento en Cloud Firestore</a>, existen distintas posibilidades  basadas en la clausula <strong>Where</strong>. <em>Por ejemplo, si quisieramos comprobar si el id del usuario no est&#xE1; repetido y solo en ese caso a&#xF1;adirlo, podr&#xED;amos modificar el anterior c&#xF3;digo de la siguiente manera:</em></p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"> <span class="token keyword keyword-fun">fun</span> <span class="token function">compruebaSiExisteyAnayade</span><span class="token punctuation">(</span>usuario<span class="token operator">:</span> Usuario<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        firebaseFirestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;Usuarios&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">whereEqualTo</span><span class="token punctuation">(</span>FieldPath<span class="token punctuation">.</span><span class="token function">documentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> usuario<span class="token punctuation">.</span>correo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addOnCompleteListener</span><span class="token punctuation">(</span>OnCompleteListener<span class="token operator">&lt;</span>QuerySnapshot<span class="token operator">?</span><span class="token operator">&gt;</span>
             <span class="token punctuation">{</span> task <span class="token operator">-&gt;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>task<span class="token punctuation">.</span>isSuccessful<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>task<span class="token punctuation">.</span>result<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">anyadeUsuario</span><span class="token punctuation">(</span>usuario<span class="token punctuation">)</span> 
                    <span class="token keyword keyword-else">else</span> Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>
                        <span class="token keyword keyword-this">this</span><span class="token punctuation">,</span>
                        <span class="token string">&quot;El correo ya existe, introduce uno nuevo&quot;</span><span class="token punctuation">,</span>
                        Toast<span class="token punctuation">.</span>LENGTH_LONG
                    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                    Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">,</span> task<span class="token punctuation">.</span>exception<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                         Toast<span class="token punctuation">.</span>LENGTH_LONG<span class="token punctuation">)</span>
                         <span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">anyadeUsuario</span><span class="token punctuation">(</span>usuario<span class="token operator">:</span> Usuario<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        firebaseFirestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;Usuarios&quot;</span><span class="token punctuation">)</span>
                         <span class="token punctuation">.</span><span class="token function">document</span><span class="token punctuation">(</span>usuario<span class="token punctuation">.</span>correo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>usuario<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addOnSuccessListener</span> <span class="token punctuation">{</span>
                Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>
                    <span class="token keyword keyword-this">this</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;Usuario A&#xF1;adido&quot;</span><span class="token punctuation">,</span>
                    Toast<span class="token punctuation">.</span>LENGTH_SHORT
                <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">addOnFailureListener</span> <span class="token punctuation">{</span> e <span class="token operator">-&gt;</span>
                Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>
                    <span class="token keyword keyword-this">this</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;Error&quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
                    Toast<span class="token punctuation">.</span>LENGTH_SHORT
                <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><p><em>Si quisieramos dar funcionalidad al bot&#xF3;n <strong>Eliminar</strong>, podemos hacer algo parecido a lo siguiente. En este caso se est&#xE1; eliminando por nombre de usuario, as&#xED; que en el caso de existir m&#xE1;s de un documento con el mismo nombre, se eliminar&#xE1;n todos.</em></p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-fun">fun</span> <span class="token function">Elimina</span><span class="token punctuation">(</span>usuario<span class="token operator">:</span> Usuario<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        firebaseFirestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;Usuarios&quot;</span><span class="token punctuation">)</span>
                         <span class="token punctuation">.</span><span class="token function">whereEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;usuario&quot;</span><span class="token punctuation">,</span> usuario<span class="token punctuation">.</span>usuario<span class="token punctuation">)</span>
                         <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addOnCompleteListener</span> <span class="token punctuation">{</span> task <span class="token operator">-&gt;</span> 
               <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>documento <span class="token keyword keyword-in">in</span> task<span class="token punctuation">.</span>result<span class="token operator">!!</span><span class="token punctuation">)</span> documento<span class="token punctuation">.</span>reference<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
                                   <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><p>Si lo que queremos es controlar los cambios que ocurren en la BD, sea a trav&#xE9;s de una aplicaci&#xF3;n o directamente desde la consola de Firebase, tendremos que registrar un listener del tipo ListenerRegistration, que se inicializar&#xE1; sobre la consulta que deseemos con <strong><code>addSnapshotListener</code></strong>. <em>En el siguiente ejemplo ponemos a escuchar todos los documentos de la colecci&#xF3;n Usuarios, mostrando en el TextView (que est&#xE1; bajo los botones) el resultado de cualquier modificaci&#xF3;n en cualquier documento de la colecci&#xF3;n.</em></p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-fun">fun</span> <span class="token function">listarUsuarios</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-val">val</span> query <span class="token operator">=</span> firebaseFirestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;Usuarios&quot;</span><span class="token punctuation">)</span>
        listenerRegistration <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">addSnapshotListener</span> <span class="token punctuation">{</span>value<span class="token punctuation">,</span> error<span class="token operator">-&gt;</span>
           <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>error <span class="token operator">==</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>dc <span class="token keyword keyword-in">in</span> value<span class="token operator">!!</span><span class="token punctuation">.</span>documentChanges<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-when">when</span> <span class="token punctuation">(</span>dc<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        DocumentChange<span class="token punctuation">.</span>Type<span class="token punctuation">.</span>ADDED <span class="token operator">-&gt;</span> salida<span class="token punctuation">.</span>text <span class="token operator">=</span>
                            <span class="token string">&quot;<span class="token interpolation"><span class="token delimiter variable">${</span>salida<span class="token punctuation">.</span>text<span class="token delimiter variable">}</span></span>\nSe ha a&#xF1;adido:&quot;</span><span class="token operator">+</span>
                             <span class="token string">&quot;<span class="token interpolation"><span class="token delimiter variable">${</span>dc<span class="token punctuation">.</span>document<span class="token punctuation">.</span>data<span class="token delimiter variable">}</span></span>\n&quot;</span><span class="token punctuation">.</span><span class="token function">trimIndent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        DocumentChange<span class="token punctuation">.</span>Type<span class="token punctuation">.</span>MODIFIED <span class="token operator">-&gt;</span> salida<span class="token punctuation">.</span>text <span class="token operator">=</span>
                            <span class="token string">&quot;<span class="token interpolation"><span class="token delimiter variable">${</span>salida<span class="token punctuation">.</span>text<span class="token delimiter variable">}</span></span>\n Se ha modificado:&quot;</span><span class="token operator">+</span>
                            <span class="token string">&quot;<span class="token interpolation"><span class="token delimiter variable">${</span>dc<span class="token punctuation">.</span>document<span class="token punctuation">.</span>data<span class="token delimiter variable">}</span></span>\n&quot;</span><span class="token punctuation">.</span><span class="token function">trimIndent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        DocumentChange<span class="token punctuation">.</span>Type<span class="token punctuation">.</span>REMOVED <span class="token operator">-&gt;</span> salida<span class="token punctuation">.</span>text <span class="token operator">=</span>
                            <span class="token string">&quot;<span class="token interpolation"><span class="token delimiter variable">${</span>salida<span class="token punctuation">.</span>text<span class="token delimiter variable">}</span></span>\nSe ha eliminado:&quot;</span><span class="token operator">+</span>
                            <span class="token string">&quot;<span class="token interpolation"><span class="token delimiter variable">${</span>dc<span class="token punctuation">.</span>document<span class="token punctuation">.</span>data<span class="token delimiter variable">}</span></span>\n&quot;</span><span class="token punctuation">.</span><span class="token function">trimIndent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-else">else</span>  Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">,</span> <span class="token string">&quot;No se puede listar&quot;</span><span class="token operator">+</span>error<span class="token punctuation">,</span> 
                                  Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><p>Se puede realizar la consulta sobre cualquier elemento de la colecci&#xF3;n despu&#xE9;s de haber sido seleccionado, de la siguiente manera:</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin">   query<span class="token punctuation">.</span><span class="token function">whereEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;correo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;manuel@gamil.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addSnapshotListener</span><span class="token punctuation">{</span><span class="token operator">..</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</pre><blockquote>
<p>&#x26A0;&#xFE0F; Otro tema importante a tener en cuenta, es que la suscripci&#xF3;n a una referencia de una base de datos de Firebase, es decir, el hecho de asignar un listener a una ubicaci&#xF3;n del &#xE1;rbol para estar al tanto de sus cambios <strong>no es algo gratuito</strong> desde el punto de vista de consumo de recursos. Por tanto, es recomendable eliminar esa suscripci&#xF3;n cuando ya no la necesitamos. Para hacer esto basta con llamar al m&#xE9;todo <strong><code>remove()</code></strong> del listener registrado, cuando no deseemos seguir escuchando.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       listenerRegistration<span class="token operator">!!</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
</pre></blockquote>
<h4 class="mume-header" id="firebaseui-y-recyclerview">FirebaseUI y RecyclerView</h4>

<p><a href="https://github.com/firebase/FirebaseUI-Android">FirebaseUI</a></p>
<p>En el momento de actualizaci&#xF3;n de estos apuntes:</p>
<pre data-role="codeBlock" data-info="json" class="language-json">implementation &apos;com.firebaseui<span class="token operator">:</span>firebase-ui-firestore<span class="token operator">:</span><span class="token number">8.0</span>.<span class="token number">0</span>&apos;
</pre><pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-class">class</span> <span class="token function">Adaptador</span><span class="token punctuation">(</span>options<span class="token operator">:</span> FirestoreRecyclerOptions<span class="token operator">&lt;</span>Usuario<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">:</span>
    FirestoreRecyclerAdapter<span class="token operator">&lt;</span>Usuario<span class="token punctuation">,</span> Adaptador<span class="token punctuation">.</span>Holder<span class="token operator">&gt;</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">,</span>
    View<span class="token punctuation">.</span><span class="token function">OnClickListener</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-var">var</span> listener<span class="token operator">:</span> View<span class="token punctuation">.</span>OnClickListener<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword keyword-null">null</span>
    <span class="token keyword keyword-override">override</span>  <span class="token keyword keyword-fun">fun</span> <span class="token function">onBindViewHolder</span><span class="token punctuation">(</span>holder<span class="token operator">:</span> Holder<span class="token punctuation">,</span> position<span class="token operator">:</span> Int<span class="token punctuation">,</span> 
                                   model<span class="token operator">:</span> Usuario<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        holder<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreateViewHolder</span><span class="token punctuation">(</span>parent<span class="token operator">:</span> ViewGroup<span class="token punctuation">,</span> viewType<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> 
                                    Holder <span class="token punctuation">{</span>
        <span class="token keyword keyword-val">val</span> view<span class="token operator">:</span> View <span class="token operator">=</span> LayoutInflater<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>context<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>linea_recycler<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
        view<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">Holder</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">onClickListener</span><span class="token punctuation">(</span>listener<span class="token operator">:</span> View<span class="token punctuation">.</span>OnClickListener<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>listener <span class="token operator">=</span> listener
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onClick</span><span class="token punctuation">(</span>v<span class="token operator">:</span> View<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        listener<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
   <span class="token keyword keyword-inner">inner</span> <span class="token keyword keyword-class">class</span> <span class="token function">Holder</span><span class="token punctuation">(</span>v<span class="token operator">:</span> View<span class="token punctuation">)</span> <span class="token operator">:</span> RecyclerView<span class="token punctuation">.</span><span class="token function">ViewHolder</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> usuario<span class="token operator">:</span> TextView
        <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> correo<span class="token operator">:</span> TextView
        <span class="token keyword keyword-fun">fun</span> <span class="token function">bind</span><span class="token punctuation">(</span>item<span class="token operator">:</span> Usuario<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            usuario<span class="token punctuation">.</span>text <span class="token operator">=</span> item<span class="token punctuation">.</span>usuario
            correo<span class="token punctuation">.</span>text <span class="token operator">=</span> item<span class="token punctuation">.</span>correo
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-init">init</span> <span class="token punctuation">{</span>
            usuario <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>usuario<span class="token punctuation">)</span>
            correo <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>correo<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>Al crear un objeto de esta clase, debemos pasarle un objeto de la misma librer&#xED;a, de tipo <strong><code>FirestoreRecyclerOptions</code></strong>.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"> <span class="token keyword keyword-val">val</span> firestoreRecyclerOptions <span class="token operator">=</span> FirestoreRecyclerOptions<span class="token punctuation">.</span>Builder<span class="token operator">&lt;</span>Usuario<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">setQuery</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> Usuario<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><p>Ahora solo quedar&#xED;a crear un objeto del tipo adaptador que nos hemos creado, pas&#xE1;ndole el elemento <strong><code>firebaseRecyclerOption</code></strong> y ya tendr&#xED;amos casi todo hecho.</p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">cargarRecycler</span><span class="token punctuation">(</span>query<span class="token operator">:</span> Query<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-val">val</span> firestoreRecyclerOptions <span class="token operator">=</span> FirestoreRecyclerOptions<span class="token punctuation">.</span>
                                       Builder<span class="token operator">&lt;</span>Usuario<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">setQuery</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> Usuario<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        recyclerView <span class="token operator">=</span> vista<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>recycler<span class="token punctuation">)</span>
        adapter <span class="token operator">=</span> <span class="token function">Adaptador</span><span class="token punctuation">(</span>firestoreRecyclerOptions<span class="token punctuation">)</span>
        <span class="token comment">//Click para eliminar elementos</span>
        adapter<span class="token operator">!!</span><span class="token punctuation">.</span><span class="token function">onClickListener</span><span class="token punctuation">{</span>
                Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>
                    <span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;Elemento eliminado&quot;</span> <span class="token operator">+</span> recyclerView<span class="token operator">!!</span><span class="token punctuation">.</span>
                                           <span class="token function">getChildAdapterPosition</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    Toast<span class="token punctuation">.</span>LENGTH_SHORT
                <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                adapter<span class="token operator">!!</span><span class="token punctuation">.</span>snapshots<span class="token punctuation">.</span><span class="token function">getSnapshot</span><span class="token punctuation">(</span>recyclerView<span class="token operator">!!</span><span class="token punctuation">.</span>
                                            <span class="token function">getChildAdapterPosition</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                                            reference<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        recyclerView<span class="token operator">!!</span><span class="token punctuation">.</span>adapter <span class="token operator">=</span> adapter
        recyclerView<span class="token operator">!!</span><span class="token punctuation">.</span>layoutManager <span class="token operator">=</span> <span class="token function">LinearLayoutManager</span><span class="token punctuation">(</span><span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</pre><p>No deberemos olvidar iniciar el escuchador del adaptador al comenzar la aplicaci&#xF3;n y cerrarlo al acabar.</p>
<h4 class="mume-header" id="filtrado-y-ordenaci%C3%B3n">Filtrado y ordenaci&#xF3;n</h4>

<p><a href="https://firebase.google.com/docs/firestore/query-data/queries">https://firebase.google.com/docs/firestore/query-data/queries</a>.</p>
<div align="center">
    <img height="20" src=".\imagenes/imagen38.png">
</div>
<p>Se pueden enlazar b&#xFA;squedas con <strong><code>where</code></strong>, de la siguiente manera:</p>
<div align="center">
    <img height="20" src=".\imagenes/imagen39.png">
</div>
<p>Tambi&#xE9;n est&#xE1; la opci&#xF3;n de buscar dentro de una colecci&#xF3;n directamente. Si algunos de nuestros documentos tienen un miembro que es una colecci&#xF3;n, podremos realizar la consulta sobre este elemento usando alguna de las sobrecargas de <strong><code>whereArrayContains</code></strong></p>
<div align="center">
    <img height="30" src=".\imagenes/imagen40.png">
</div>
<p>Si lo que queremos hacer es ordenar los datos obtenidos, tenemos toda la informaci&#xF3;n en la url <a href="https://firebase.google.com/docs/firestore/query-data/orderlimitdata?hl=es">https://firebase.google.com/docs/firestore/query-data/orderlimitdata?hl=es</a>  Se utilizar&#xE1; cualquiera de las sobrecargas del m&#xE9;todo <strong><code>orderBy</code></strong></p>
<div align="center">
    <img height="30" src=".\imagenes/imagen42.png">
</div>
<p>Una cl&#xE1;usula <strong><code>orderBy</code></strong> tambi&#xE9;n filtra en busca de la existencia del campo dado. El conjunto de resultados no incluir&#xE1; documentos que no contengan el campo correspondiente.  Como es de esperar, tambi&#xE9;n se pueden ordenar los datos despu&#xE9;s de realizar una consulta <strong><code>where</code></strong>,  pero con la condici&#xF3;n que debe ser sobre el mismo campo por el que se ha hecho la b&#xFA;squeda.</p>
<div align="center">
    <img height="33" src=".\imagenes/imagen43.png">
</div>
<p>Si con orderBy se puede especificar el orden de clasificaci&#xF3;n de los datos, con limit puedes limitar la cantidad de documentos recuperados.</p>
<div align="center">
    <img height="25" src=".\imagenes/imagen44.png">
</div>
<p>Otros cursores de consultas que est&#xE1;n disponibles son: startAt, startAfter,endAt, endBefore</p>
<div align="center">
    <img width="300" src=".\imagenes/imagen48.png">
</div>
<h3 class="mume-header" id="firebase-auth-autenticaci%C3%B3n">Firebase Auth. Autenticaci&#xF3;n</h3>

<p><a href="https://firebase.google.com/docs/auth">Firebase Authentication</a></p>
<pre data-role="codeBlock" data-info="json" class="language-json"> implementation &apos;com.google.firebase<span class="token operator">:</span>firebase-auth&apos;
</pre><p>Despu&#xE9;s de tener el layout para identificarse, lo siguiente ser&#xE1; activar los proveedores con los que queremos iniciar sesi&#xF3;n. Nos vamos a la opci&#xF3;n Authentication y dentro de este a la pesta&#xF1;a M&#xE9;todos de inicio de sesi&#xF3;n. Tendremos que seleccionar ambos casos y habilitar el estado.</p>
<div align="center">
    <img width="500" src=".\imagenes/imagen50.png">
</div>
<p>Tendremos dos formas de crear los usuarios: <strong>a trav&#xE9;s de la consola y desde la aplicaci&#xF3;n</strong>.<br>
<a href="https://firebase.google.com/docs/auth/android/password-auth">https://firebase.google.com/docs/auth/android/password-auth</a></p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"> <span class="token comment">////// Crear usuario nueveo y iniciar sesi&#xF3;n</span>
        btCrear<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">{</span>
               FirebaseAuth<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createUserWithEmailAndPassword</span><span class="token punctuation">(</span>
                    user<span class="token punctuation">.</span>editText<span class="token operator">!!</span><span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pasword<span class="token punctuation">.</span>editText<span class="token operator">!!</span>
                        <span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">addOnCompleteListener</span><span class="token punctuation">(</span><span class="token function">requireActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        OnCompleteListener<span class="token operator">&lt;</span>AuthResult<span class="token operator">?</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> task <span class="token operator">-&gt;</span>
                            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>task<span class="token punctuation">.</span>isSuccessful<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;Usuario creado&quot;</span><span class="token punctuation">,</span>
                                            Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                <span class="token function">iniciarFragmen</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span>result<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span>
                                             <span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;@&quot;</span><span class="token punctuation">)</span><span class="token operator">!!</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>
                                <span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                <span class="token string">&quot;Problemas al crear usuario&quot;</span> <span class="token operator">+</span>task<span class="token punctuation">.</span>exception<span class="token punctuation">,</span>
                                Toast<span class="token punctuation">.</span>LENGTH_SHORT
                            <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> view

</pre><pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"><span class="token comment">/////Iniciar sesi&#xF3;n con usuario y contrase&#xF1;a</span>
        btIniciar<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">{</span>
             FirebaseAuth<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">signInWithEmailAndPassword</span><span class="token punctuation">(</span>
                user<span class="token punctuation">.</span>editText<span class="token operator">!!</span><span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pasword<span class="token punctuation">.</span>editText<span class="token operator">!!</span>
                    <span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addOnCompleteListener</span><span class="token punctuation">(</span><span class="token function">requireActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    OnCompleteListener<span class="token operator">&lt;</span>AuthResult<span class="token operator">?</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> task <span class="token operator">-&gt;</span>
                        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>task<span class="token punctuation">.</span>isSuccessful<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>
                                <span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                <span class="token string">&quot;Authentication failed:&quot;</span> <span class="token operator">+</span> task<span class="token punctuation">.</span>exception<span class="token punctuation">,</span>
                                Toast<span class="token punctuation">.</span>LENGTH_SHORT
                            <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token function">iniciarFragmen</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span>result<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span>
                                             <span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;@&quot;</span><span class="token punctuation">)</span><span class="token operator">!!</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
</pre><pre data-role="codeBlock" data-info="kotlin" class="language-kotlin"> <span class="token comment">//////// Iniciar sesi&#xF3;n con an&#xF3;nimo</span>
        btAnonimus<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">{</span>
                 FirebaseAuth<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">signInAnonymously</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addOnCompleteListener</span>
                <span class="token punctuation">(</span>
                    <span class="token function">requireActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    OnCompleteListener<span class="token operator">&lt;</span>AuthResult<span class="token operator">?</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> task <span class="token operator">-&gt;</span>
                        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>task<span class="token punctuation">.</span>isSuccessful<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>
                                <span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                <span class="token string">&quot;Authentication failed:&quot;</span> <span class="token operator">+</span> task<span class="token punctuation">.</span>exception<span class="token punctuation">,</span>
                                Toast<span class="token punctuation">.</span>LENGTH_SHORT
                            <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token function">iniciarFragmen</span><span class="token punctuation">(</span><span class="token string">&quot;anonimous&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
</pre>
      </div>
      
      
    
    
    
    
    
    
    
    
  
    </body></html>